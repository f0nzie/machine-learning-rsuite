\documentclass[]{book}
\usepackage{lmodern}
\usepackage{amssymb,amsmath}
\usepackage{ifxetex,ifluatex}
\usepackage{fixltx2e} % provides \textsubscript
\ifnum 0\ifxetex 1\fi\ifluatex 1\fi=0 % if pdftex
  \usepackage[T1]{fontenc}
  \usepackage[utf8]{inputenc}
\else % if luatex or xelatex
  \ifxetex
    \usepackage{mathspec}
  \else
    \usepackage{fontspec}
  \fi
  \defaultfontfeatures{Ligatures=TeX,Scale=MatchLowercase}
\fi
% use upquote if available, for straight quotes in verbatim environments
\IfFileExists{upquote.sty}{\usepackage{upquote}}{}
% use microtype if available
\IfFileExists{microtype.sty}{%
\usepackage{microtype}
\UseMicrotypeSet[protrusion]{basicmath} % disable protrusion for tt fonts
}{}
\usepackage[margin=1in]{geometry}
\usepackage{hyperref}
\hypersetup{unicode=true,
            pdftitle={Algorithms Comparison},
            pdfauthor={Alfonso R. Reyes},
            pdfborder={0 0 0},
            breaklinks=true}
\urlstyle{same}  % don't use monospace font for urls
\usepackage{natbib}
\bibliographystyle{apalike}
\usepackage{color}
\usepackage{fancyvrb}
\newcommand{\VerbBar}{|}
\newcommand{\VERB}{\Verb[commandchars=\\\{\}]}
\DefineVerbatimEnvironment{Highlighting}{Verbatim}{commandchars=\\\{\}}
% Add ',fontsize=\small' for more characters per line
\usepackage{framed}
\definecolor{shadecolor}{RGB}{248,248,248}
\newenvironment{Shaded}{\begin{snugshade}}{\end{snugshade}}
\newcommand{\AlertTok}[1]{\textcolor[rgb]{0.94,0.16,0.16}{#1}}
\newcommand{\AnnotationTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textbf{\textit{#1}}}}
\newcommand{\AttributeTok}[1]{\textcolor[rgb]{0.77,0.63,0.00}{#1}}
\newcommand{\BaseNTok}[1]{\textcolor[rgb]{0.00,0.00,0.81}{#1}}
\newcommand{\BuiltInTok}[1]{#1}
\newcommand{\CharTok}[1]{\textcolor[rgb]{0.31,0.60,0.02}{#1}}
\newcommand{\CommentTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textit{#1}}}
\newcommand{\CommentVarTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textbf{\textit{#1}}}}
\newcommand{\ConstantTok}[1]{\textcolor[rgb]{0.00,0.00,0.00}{#1}}
\newcommand{\ControlFlowTok}[1]{\textcolor[rgb]{0.13,0.29,0.53}{\textbf{#1}}}
\newcommand{\DataTypeTok}[1]{\textcolor[rgb]{0.13,0.29,0.53}{#1}}
\newcommand{\DecValTok}[1]{\textcolor[rgb]{0.00,0.00,0.81}{#1}}
\newcommand{\DocumentationTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textbf{\textit{#1}}}}
\newcommand{\ErrorTok}[1]{\textcolor[rgb]{0.64,0.00,0.00}{\textbf{#1}}}
\newcommand{\ExtensionTok}[1]{#1}
\newcommand{\FloatTok}[1]{\textcolor[rgb]{0.00,0.00,0.81}{#1}}
\newcommand{\FunctionTok}[1]{\textcolor[rgb]{0.00,0.00,0.00}{#1}}
\newcommand{\ImportTok}[1]{#1}
\newcommand{\InformationTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textbf{\textit{#1}}}}
\newcommand{\KeywordTok}[1]{\textcolor[rgb]{0.13,0.29,0.53}{\textbf{#1}}}
\newcommand{\NormalTok}[1]{#1}
\newcommand{\OperatorTok}[1]{\textcolor[rgb]{0.81,0.36,0.00}{\textbf{#1}}}
\newcommand{\OtherTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{#1}}
\newcommand{\PreprocessorTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textit{#1}}}
\newcommand{\RegionMarkerTok}[1]{#1}
\newcommand{\SpecialCharTok}[1]{\textcolor[rgb]{0.00,0.00,0.00}{#1}}
\newcommand{\SpecialStringTok}[1]{\textcolor[rgb]{0.31,0.60,0.02}{#1}}
\newcommand{\StringTok}[1]{\textcolor[rgb]{0.31,0.60,0.02}{#1}}
\newcommand{\VariableTok}[1]{\textcolor[rgb]{0.00,0.00,0.00}{#1}}
\newcommand{\VerbatimStringTok}[1]{\textcolor[rgb]{0.31,0.60,0.02}{#1}}
\newcommand{\WarningTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textbf{\textit{#1}}}}
\usepackage{longtable,booktabs}
\usepackage{graphicx,grffile}
\makeatletter
\def\maxwidth{\ifdim\Gin@nat@width>\linewidth\linewidth\else\Gin@nat@width\fi}
\def\maxheight{\ifdim\Gin@nat@height>\textheight\textheight\else\Gin@nat@height\fi}
\makeatother
% Scale images if necessary, so that they will not overflow the page
% margins by default, and it is still possible to overwrite the defaults
% using explicit options in \includegraphics[width, height, ...]{}
\setkeys{Gin}{width=\maxwidth,height=\maxheight,keepaspectratio}
\IfFileExists{parskip.sty}{%
\usepackage{parskip}
}{% else
\setlength{\parindent}{0pt}
\setlength{\parskip}{6pt plus 2pt minus 1pt}
}
\setlength{\emergencystretch}{3em}  % prevent overfull lines
\providecommand{\tightlist}{%
  \setlength{\itemsep}{0pt}\setlength{\parskip}{0pt}}
\setcounter{secnumdepth}{5}
% Redefines (sub)paragraphs to behave more like sections
\ifx\paragraph\undefined\else
\let\oldparagraph\paragraph
\renewcommand{\paragraph}[1]{\oldparagraph{#1}\mbox{}}
\fi
\ifx\subparagraph\undefined\else
\let\oldsubparagraph\subparagraph
\renewcommand{\subparagraph}[1]{\oldsubparagraph{#1}\mbox{}}
\fi

%%% Use protect on footnotes to avoid problems with footnotes in titles
\let\rmarkdownfootnote\footnote%
\def\footnote{\protect\rmarkdownfootnote}

%%% Change title format to be more compact
\usepackage{titling}

% Create subtitle command for use in maketitle
\providecommand{\subtitle}[1]{
  \posttitle{
    \begin{center}\large#1\end{center}
    }
}

\setlength{\droptitle}{-2em}

  \title{Algorithms Comparison}
    \pretitle{\vspace{\droptitle}\centering\huge}
  \posttitle{\par}
    \author{Alfonso R. Reyes}
    \preauthor{\centering\large\emph}
  \postauthor{\par}
      \predate{\centering\large\emph}
  \postdate{\par}
    \date{2019-09-18}

\usepackage{booktabs}

\begin{document}
\maketitle

{
\setcounter{tocdepth}{1}
\tableofcontents
}
\hypertarget{prerequisites}{%
\chapter*{Prerequisites}\label{prerequisites}}
\addcontentsline{toc}{chapter}{Prerequisites}

This is a \emph{sample} book written in \textbf{Markdown}. You can use anything that Pandoc's Markdown supports, e.g., a math equation \(a^2 + b^2 = c^2\).

The \textbf{bookdown} package can be installed from CRAN or Github:

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{install.packages}\NormalTok{(}\StringTok{"bookdown"}\NormalTok{)}
\CommentTok{# or the development version}
\CommentTok{# devtools::install_github("rstudio/bookdown")}
\end{Highlighting}
\end{Shaded}

Remember each Rmd file contains one and only one chapter, and a chapter is defined by the first-level heading \texttt{\#}.

To compile this example to PDF, you need XeLaTeX. You are recommended to install TinyTeX (which includes XeLaTeX): \url{https://yihui.name/tinytex/}.

\hypertarget{introduction-to-h2o.-bad-loans-dataset.-glm-rf-gbm-dl-nb}{%
\chapter{\texorpdfstring{Introduction to h2o. Bad Loans dataset. \emph{(GLM, RF, GBM, DL, NB)}}{Introduction to h2o. Bad Loans dataset. (GLM, RF, GBM, DL, NB)}}\label{introduction-to-h2o.-bad-loans-dataset.-glm-rf-gbm-dl-nb}}

Source: \url{https://github.com/h2oai/h2o-tutorials/blob/master/h2o-open-tour-2016/chicago/intro-to-h2o.R}

\hypertarget{introduction}{%
\section{Introduction}\label{introduction}}

Introductory H2O Machine Learning Tutorial
Prepared for H2O Open Chicago 2016: \url{http://open.h2o.ai/chicago.html}

\hypertarget{install-and-download-h2o}{%
\subsection{\texorpdfstring{Install and download \texttt{h2o}}{Install and download h2o}}\label{install-and-download-h2o}}

First step is to download \& install the h2o R library
The latest version is available by clicking on the R tab here: \url{http://h2o-release.s3.amazonaws.com/h2o/latest_stable.html}

Load the H2O library and start up the H2O cluster locally on your machine:

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# Load the H2O library and start up the H2O cluster locally on your machine}
\KeywordTok{library}\NormalTok{(h2o)}
\KeywordTok{h2o.init}\NormalTok{(}\DataTypeTok{nthreads =} \DecValTok{-1}\NormalTok{, }\CommentTok{#Number of threads -1 means use all cores on your machine}
         \DataTypeTok{max_mem_size =} \StringTok{"8G"}\NormalTok{)  }\CommentTok{#max mem size is the maximum memory to allocate to H2O}
\CommentTok{#> }
\CommentTok{#> H2O is not running yet, starting it now...}
\CommentTok{#> }
\CommentTok{#> Note:  In case of errors look at the following log files:}
\CommentTok{#>     /tmp/RtmpRaWpdk/h2o_datascience_started_from_r.out}
\CommentTok{#>     /tmp/RtmpRaWpdk/h2o_datascience_started_from_r.err}
\CommentTok{#> }
\CommentTok{#> }
\CommentTok{#> Starting H2O JVM and connecting: . Connection successful!}
\CommentTok{#> }
\CommentTok{#> R is connected to the H2O cluster: }
\CommentTok{#>     H2O cluster uptime:         2 seconds 192 milliseconds }
\CommentTok{#>     H2O cluster timezone:       America/Chicago }
\CommentTok{#>     H2O data parsing timezone:  UTC }
\CommentTok{#>     H2O cluster version:        3.22.1.1 }
\CommentTok{#>     H2O cluster version age:    8 months and 20 days !!! }
\CommentTok{#>     H2O cluster name:           H2O_started_from_R_datascience_mwl453 }
\CommentTok{#>     H2O cluster total nodes:    1 }
\CommentTok{#>     H2O cluster total memory:   7.11 GB }
\CommentTok{#>     H2O cluster total cores:    8 }
\CommentTok{#>     H2O cluster allowed cores:  8 }
\CommentTok{#>     H2O cluster healthy:        TRUE }
\CommentTok{#>     H2O Connection ip:          localhost }
\CommentTok{#>     H2O Connection port:        54321 }
\CommentTok{#>     H2O Connection proxy:       NA }
\CommentTok{#>     H2O Internal Security:      FALSE }
\CommentTok{#>     H2O API Extensions:         XGBoost, Algos, AutoML, Core V3, Core V4 }
\CommentTok{#>     R Version:                  R version 3.6.0 (2019-04-26)}
\end{Highlighting}
\end{Shaded}

\hypertarget{load-the-dataset}{%
\subsection{Load the dataset}\label{load-the-dataset}}

Next we will import a cleaned up version of the Lending Club ``Bad Loans'' dataset The purpose here is to predict whether a loan will be bad (not repaid to the lender). The response column, bad\_loan, is 1 if the loan was bad, and 0 otherwise

Import the data
\texttt{loan\_csv\ \textless{}-\ "/Volumes/H2OTOUR/loan.csv"}\\
Alternatively, you can import the data directly from a URL

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# modify this for your machine}
\NormalTok{loan_csv <-}\StringTok{ "https://raw.githubusercontent.com/h2oai/app-consumer-loan/master/data/loan.csv"}
\NormalTok{data <-}\StringTok{ }\KeywordTok{h2o.importFile}\NormalTok{(loan_csv)  }\CommentTok{# 163,987 rows x 15 columns}
\CommentTok{#> }
  \OperatorTok{|}\StringTok{                                                                       }
\StringTok{  }\ErrorTok{|}\StringTok{                                                                 }\ErrorTok{|}\StringTok{   }\DecValTok{0}\NormalTok{%}
  \OperatorTok{|}\StringTok{                                                                       }
\StringTok{  }\ErrorTok{|============}\StringTok{                                                     }\ErrorTok{|}\StringTok{  }\DecValTok{19}\NormalTok{%}
  \OperatorTok{|}\StringTok{                                                                       }
\StringTok{  }\ErrorTok{|==========================}\StringTok{                                       }\ErrorTok{|}\StringTok{  }\DecValTok{41}\NormalTok{%}
  \OperatorTok{|}\StringTok{                                                                       }
\StringTok{  }\ErrorTok{|=================================================}\StringTok{                }\ErrorTok{|}\StringTok{  }\DecValTok{75}\NormalTok{%}
  \OperatorTok{|}\StringTok{                                                                       }
\StringTok{  }\ErrorTok{|===========================================================}\StringTok{      }\ErrorTok{|}\StringTok{  }\DecValTok{91}\NormalTok{%}
  \OperatorTok{|}\StringTok{                                                                       }
\StringTok{  }\ErrorTok{|=================================================================|}\StringTok{ }\DecValTok{100}\NormalTok{%}
\KeywordTok{dim}\NormalTok{(data)}
\CommentTok{#> [1] 163987     15}
\CommentTok{# [1] 163987     15}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{url <-}\StringTok{ "https://raw.githubusercontent.com/h2oai/app-consumer-loan/master/data/loan.csv"}
\NormalTok{loans <-}\StringTok{ }\KeywordTok{read.csv}\NormalTok{(url)}
\KeywordTok{write.csv}\NormalTok{(loans, }\DataTypeTok{file =} \KeywordTok{file.path}\NormalTok{(data_raw_dir, }\StringTok{"loan.csv"}\NormalTok{))}
\end{Highlighting}
\end{Shaded}

\hypertarget{feature-engineering}{%
\subsection{Feature Engineering}\label{feature-engineering}}

Since we want to train a binary classification model,
we must ensure that the response is coded as a factor
If the response is 0/1, H2O will assume it's numeric,
which means that H2O will train a regression model instead

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{data}\OperatorTok{$}\NormalTok{bad_loan <-}\StringTok{ }\KeywordTok{as.factor}\NormalTok{(data}\OperatorTok{$}\NormalTok{bad_loan)  }\CommentTok{#encode the binary repsonse as a factor}
\KeywordTok{h2o.levels}\NormalTok{(data}\OperatorTok{$}\NormalTok{bad_loan)  }\CommentTok{#optional: after encoding, this shows the two factor levels, '0' and '1'}
\CommentTok{#> [1] "0" "1"}
\CommentTok{# [1] "0" "1"}
\end{Highlighting}
\end{Shaded}

\hypertarget{partition-data}{%
\subsection{Partition data}\label{partition-data}}

Partition the data into training, validation and test sets

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# Partition the data into training, validation and test sets}
\NormalTok{splits <-}\StringTok{ }\KeywordTok{h2o.splitFrame}\NormalTok{(}\DataTypeTok{data =}\NormalTok{ data, }
                         \DataTypeTok{ratios =} \KeywordTok{c}\NormalTok{(}\FloatTok{0.7}\NormalTok{, }\FloatTok{0.15}\NormalTok{),  }\CommentTok{#partition data into 70%, 15%, 15% chunks}
                         \DataTypeTok{seed =} \DecValTok{1}\NormalTok{)  }\CommentTok{#setting a seed will guarantee reproducibility}
\NormalTok{train <-}\StringTok{ }\NormalTok{splits[[}\DecValTok{1}\NormalTok{]]}
\NormalTok{valid <-}\StringTok{ }\NormalTok{splits[[}\DecValTok{2}\NormalTok{]]}
\NormalTok{test <-}\StringTok{ }\NormalTok{splits[[}\DecValTok{3}\NormalTok{]]}
\end{Highlighting}
\end{Shaded}

Take a look at the size of each partition
Notice that h2o.splitFrame uses approximate splitting not exact splitting (for efficiency) so these are not exactly 70\%, 15\% and 15\% of the total rows

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{nrow}\NormalTok{(train)  }\CommentTok{# 114908}
\CommentTok{#> [1] 114908}
\KeywordTok{nrow}\NormalTok{(valid) }\CommentTok{# 24498}
\CommentTok{#> [1] 24498}
\KeywordTok{nrow}\NormalTok{(test)  }\CommentTok{# 24581}
\CommentTok{#> [1] 24581}
\end{Highlighting}
\end{Shaded}

\hypertarget{identify-response-and-predictor-variables}{%
\subsection{Identify response and predictor variables}\label{identify-response-and-predictor-variables}}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# Identify response and predictor variables}
\NormalTok{y <-}\StringTok{ "bad_loan"}
\NormalTok{x <-}\StringTok{ }\KeywordTok{setdiff}\NormalTok{(}\KeywordTok{names}\NormalTok{(data), }\KeywordTok{c}\NormalTok{(y, }\StringTok{"int_rate"}\NormalTok{))  }\CommentTok{# remove the interest rate column because it's correlated with the outcome}
\KeywordTok{print}\NormalTok{(x)}
\CommentTok{#>  [1] "loan_amnt"             "term"                 }
\CommentTok{#>  [3] "emp_length"            "home_ownership"       }
\CommentTok{#>  [5] "annual_inc"            "purpose"              }
\CommentTok{#>  [7] "addr_state"            "dti"                  }
\CommentTok{#>  [9] "delinq_2yrs"           "revol_util"           }
\CommentTok{#> [11] "total_acc"             "longest_credit_length"}
\CommentTok{#> [13] "verification_status"}
\CommentTok{# [1] "loan_amnt"             "term"                 }
\CommentTok{# [3] "emp_length"            "home_ownership"       }
\CommentTok{# [5] "annual_inc"            "verification_status"  }
\CommentTok{# [7] "purpose"               "addr_state"           }
\CommentTok{# [9] "dti"                   "delinq_2yrs"          }
\CommentTok{# [11] "revol_util"            "total_acc"            }
\CommentTok{# [13] "longest_credit_length"}
\end{Highlighting}
\end{Shaded}

\hypertarget{algorithms}{%
\section{Algorithms}\label{algorithms}}

Now that we have prepared the data, we can train some models
We will start by training a single model from each of the H2O supervised algos:

\begin{enumerate}
\def\labelenumi{\arabic{enumi}.}
\tightlist
\item
  Generalized Linear Model (GLM)
\item
  Random Forest (RF)
\item
  Gradient Boosting Machine (GBM)
\item
  Deep Learning (DL)
\item
  Naive Bayes (NB)
\end{enumerate}

\hypertarget{glm}{%
\section{GLM}\label{glm}}

Let's start with a basic binomial Generalized Linear Model
By default, h2o.glm uses a regularized, elastic net model

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{glm_fit1 <-}\StringTok{ }\KeywordTok{h2o.glm}\NormalTok{(}\DataTypeTok{x =}\NormalTok{ x, }
                    \DataTypeTok{y =}\NormalTok{ y, }
                    \DataTypeTok{training_frame =}\NormalTok{ train,}
                    \DataTypeTok{model_id =} \StringTok{"glm_fit1"}\NormalTok{,}
                    \DataTypeTok{family =} \StringTok{"binomial"}\NormalTok{)  }\CommentTok{#similar to R's glm, h2o.glm has the family argument}
\CommentTok{#> }
  \OperatorTok{|}\StringTok{                                                                       }
\StringTok{  }\ErrorTok{|}\StringTok{                                                                 }\ErrorTok{|}\StringTok{   }\DecValTok{0}\NormalTok{%}
  \OperatorTok{|}\StringTok{                                                                       }
\StringTok{  }\ErrorTok{|=================================================================|}\StringTok{ }\DecValTok{100}\NormalTok{%}
\end{Highlighting}
\end{Shaded}

Next we will do some automatic tuning by passing in a validation frame and setting
\texttt{lambda\_search\ =\ True}. Since we are training a GLM with regularization, we should
try to find the right amount of regularization (to avoid overfitting). The model
parameter, \texttt{lambda}, controls the amount of regularization in a GLM model and we can
find the optimal value for \texttt{lambda} automatically by setting \texttt{lambda\_search\ =\ TRUE}
and passing in a validation frame (which is used to evaluate model performance using a
particular value of lambda).

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{glm_fit2 <-}\StringTok{ }\KeywordTok{h2o.glm}\NormalTok{(}\DataTypeTok{x =}\NormalTok{ x, }
                    \DataTypeTok{y =}\NormalTok{ y, }
                    \DataTypeTok{training_frame =}\NormalTok{ train,}
                    \DataTypeTok{model_id =} \StringTok{"glm_fit2"}\NormalTok{,}
                    \DataTypeTok{validation_frame =}\NormalTok{ valid,}
                    \DataTypeTok{family =} \StringTok{"binomial"}\NormalTok{,}
                    \DataTypeTok{lambda_search =} \OtherTok{TRUE}\NormalTok{)}
\CommentTok{#> }
  \OperatorTok{|}\StringTok{                                                                       }
\StringTok{  }\ErrorTok{|}\StringTok{                                                                 }\ErrorTok{|}\StringTok{   }\DecValTok{0}\NormalTok{%}
  \OperatorTok{|}\StringTok{                                                                       }
\StringTok{  }\ErrorTok{|============}\StringTok{                                                     }\ErrorTok{|}\StringTok{  }\DecValTok{19}\NormalTok{%}
  \OperatorTok{|}\StringTok{                                                                       }
\StringTok{  }\ErrorTok{|===========================}\StringTok{                                      }\ErrorTok{|}\StringTok{  }\DecValTok{42}\NormalTok{%}
  \OperatorTok{|}\StringTok{                                                                       }
\StringTok{  }\ErrorTok{|=========================================}\StringTok{                        }\ErrorTok{|}\StringTok{  }\DecValTok{63}\NormalTok{%}
  \OperatorTok{|}\StringTok{                                                                       }
\StringTok{  }\ErrorTok{|=================================================================|}\StringTok{ }\DecValTok{100}\NormalTok{%}
\end{Highlighting}
\end{Shaded}

Let's compare the performance of the two GLMs

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# Let's compare the performance of the two GLMs}
\NormalTok{glm_perf1 <-}\StringTok{ }\KeywordTok{h2o.performance}\NormalTok{(}\DataTypeTok{model =}\NormalTok{ glm_fit1,}
                             \DataTypeTok{newdata =}\NormalTok{ test)}
\NormalTok{glm_perf2 <-}\StringTok{ }\KeywordTok{h2o.performance}\NormalTok{(}\DataTypeTok{model =}\NormalTok{ glm_fit2,}
                             \DataTypeTok{newdata =}\NormalTok{ test)}

\CommentTok{# Print model performance}
\NormalTok{glm_perf1}
\CommentTok{#> H2OBinomialMetrics: glm}
\CommentTok{#> }
\CommentTok{#> MSE:  0.142}
\CommentTok{#> RMSE:  0.377}
\CommentTok{#> LogLoss:  0.451}
\CommentTok{#> Mean Per-Class Error:  0.37}
\CommentTok{#> AUC:  0.677}
\CommentTok{#> pr_auc:  0.327}
\CommentTok{#> Gini:  0.355}
\CommentTok{#> R^2:  0.0639}
\CommentTok{#> Residual Deviance:  22176}
\CommentTok{#> AIC:  22280}
\CommentTok{#> }
\CommentTok{#> Confusion Matrix (vertical: actual; across: predicted) for F1-optimal threshold:}
\CommentTok{#>            0    1    Error         Rate}
\CommentTok{#> 0      13647 6344 0.317343  =6344/19991}
\CommentTok{#> 1       1939 2651 0.422440   =1939/4590}
\CommentTok{#> Totals 15586 8995 0.336968  =8283/24581}
\CommentTok{#> }
\CommentTok{#> Maximum Metrics: Maximum metrics at their respective thresholds}
\CommentTok{#>                         metric threshold    value idx}
\CommentTok{#> 1                       max f1  0.193323 0.390283 222}
\CommentTok{#> 2                       max f2  0.118600 0.556655 307}
\CommentTok{#> 3                 max f0point5  0.276272 0.354086 146}
\CommentTok{#> 4                 max accuracy  0.494244 0.814410  29}
\CommentTok{#> 5                max precision  0.744500 1.000000   0}
\CommentTok{#> 6                   max recall  0.001225 1.000000 399}
\CommentTok{#> 7              max specificity  0.744500 1.000000   0}
\CommentTok{#> 8             max absolute_mcc  0.198334 0.210606 216}
\CommentTok{#> 9   max min_per_class_accuracy  0.180070 0.627783 236}
\CommentTok{#> 10 max mean_per_class_accuracy  0.193323 0.630109 222}
\CommentTok{#> }
\CommentTok{#> Gains/Lift Table: Extract with `h2o.gainsLift(<model>, <data>)` or `h2o.gainsLift(<model>, valid=<T/F>, xval=<T/F>)`}
\NormalTok{glm_perf2}
\CommentTok{#> H2OBinomialMetrics: glm}
\CommentTok{#> }
\CommentTok{#> MSE:  0.142}
\CommentTok{#> RMSE:  0.377}
\CommentTok{#> LogLoss:  0.451}
\CommentTok{#> Mean Per-Class Error:  0.372}
\CommentTok{#> AUC:  0.677}
\CommentTok{#> pr_auc:  0.326}
\CommentTok{#> Gini:  0.354}
\CommentTok{#> R^2:  0.0635}
\CommentTok{#> Residual Deviance:  22186}
\CommentTok{#> AIC:  22282}
\CommentTok{#> }
\CommentTok{#> Confusion Matrix (vertical: actual; across: predicted) for F1-optimal threshold:}
\CommentTok{#>            0    1    Error         Rate}
\CommentTok{#> 0      13699 6292 0.314742  =6292/19991}
\CommentTok{#> 1       1968 2622 0.428758   =1968/4590}
\CommentTok{#> Totals 15667 8914 0.336032  =8260/24581}
\CommentTok{#> }
\CommentTok{#> Maximum Metrics: Maximum metrics at their respective thresholds}
\CommentTok{#>                         metric threshold    value idx}
\CommentTok{#> 1                       max f1  0.194171 0.388329 216}
\CommentTok{#> 2                       max f2  0.119200 0.555998 306}
\CommentTok{#> 3                 max f0point5  0.256488 0.351893 153}
\CommentTok{#> 4                 max accuracy  0.474001 0.814654  32}
\CommentTok{#> 5                max precision  0.736186 1.000000   0}
\CommentTok{#> 6                   max recall  0.001255 1.000000 399}
\CommentTok{#> 7              max specificity  0.736186 1.000000   0}
\CommentTok{#> 8             max absolute_mcc  0.198114 0.208337 212}
\CommentTok{#> 9   max min_per_class_accuracy  0.180131 0.625181 231}
\CommentTok{#> 10 max mean_per_class_accuracy  0.194171 0.628250 216}
\CommentTok{#> }
\CommentTok{#> Gains/Lift Table: Extract with `h2o.gainsLift(<model>, <data>)` or `h2o.gainsLift(<model>, valid=<T/F>, xval=<T/F>)`}
\end{Highlighting}
\end{Shaded}

Instead of printing the entire model performance metrics object,
it is probably easier to print just the metric that you are interested in comparing.
Retreive test set AUC

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{h2o.auc}\NormalTok{(glm_perf1)  }\CommentTok{#0.677449084114}
\CommentTok{#> [1] 0.677}
\KeywordTok{h2o.auc}\NormalTok{(glm_perf2)  }\CommentTok{#0.677675858276}
\CommentTok{#> [1] 0.677}
\end{Highlighting}
\end{Shaded}

Compare test AUC to the training AUC and validation AUC

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# Compare test AUC to the training AUC and validation AUC}
\KeywordTok{h2o.auc}\NormalTok{(glm_fit2, }\DataTypeTok{train =} \OtherTok{TRUE}\NormalTok{)  }\CommentTok{#0.674306164325 }
\CommentTok{#> [1] 0.673}
\KeywordTok{h2o.auc}\NormalTok{(glm_fit2, }\DataTypeTok{valid =} \OtherTok{TRUE}\NormalTok{)  }\CommentTok{#0.675512216705}
\CommentTok{#> [1] 0.675}
\NormalTok{glm_fit2}\OperatorTok{@}\NormalTok{model}\OperatorTok{$}\NormalTok{validation_metrics  }\CommentTok{#0.675512216705}
\CommentTok{#> H2OBinomialMetrics: glm}
\CommentTok{#> ** Reported on validation data. **}
\CommentTok{#> }
\CommentTok{#> MSE:  0.142}
\CommentTok{#> RMSE:  0.377}
\CommentTok{#> LogLoss:  0.451}
\CommentTok{#> Mean Per-Class Error:  0.37}
\CommentTok{#> AUC:  0.675}
\CommentTok{#> pr_auc:  0.316}
\CommentTok{#> Gini:  0.351}
\CommentTok{#> R^2:  0.0597}
\CommentTok{#> Residual Deviance:  22101}
\CommentTok{#> AIC:  22197}
\CommentTok{#> }
\CommentTok{#> Confusion Matrix (vertical: actual; across: predicted) for F1-optimal threshold:}
\CommentTok{#>            0    1    Error         Rate}
\CommentTok{#> 0      13591 6365 0.318952  =6365/19956}
\CommentTok{#> 1       1916 2626 0.421841   =1916/4542}
\CommentTok{#> Totals 15507 8991 0.338028  =8281/24498}
\CommentTok{#> }
\CommentTok{#> Maximum Metrics: Maximum metrics at their respective thresholds}
\CommentTok{#>                         metric threshold    value idx}
\CommentTok{#> 1                       max f1  0.193519 0.388088 217}
\CommentTok{#> 2                       max f2  0.116436 0.555055 308}
\CommentTok{#> 3                 max f0point5  0.288405 0.343386 132}
\CommentTok{#> 4                 max accuracy  0.487882 0.815250  29}
\CommentTok{#> 5                max precision  0.576333 0.681818   9}
\CommentTok{#> 6                   max recall  0.004789 1.000000 398}
\CommentTok{#> 7              max specificity  0.715719 0.999950   0}
\CommentTok{#> 8             max absolute_mcc  0.195417 0.209494 215}
\CommentTok{#> 9   max min_per_class_accuracy  0.180760 0.627731 230}
\CommentTok{#> 10 max mean_per_class_accuracy  0.192639 0.629672 218}
\CommentTok{#> }
\CommentTok{#> Gains/Lift Table: Extract with `h2o.gainsLift(<model>, <data>)` or `h2o.gainsLift(<model>, valid=<T/F>, xval=<T/F>)`}
\end{Highlighting}
\end{Shaded}

\hypertarget{random-forest}{%
\section{Random Forest}\label{random-forest}}

H2O's Random Forest (RF) implements a distributed version of the standard
Random Forest algorithm and variable importance measures.
First we will train a basic Random Forest model with default parameters.
The Random Forest model will infer the response distribution from the response encoding.
A seed is required for reproducibility.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{rf_fit1 <-}\StringTok{ }\KeywordTok{h2o.randomForest}\NormalTok{(}\DataTypeTok{x =}\NormalTok{ x,}
                            \DataTypeTok{y =}\NormalTok{ y,}
                            \DataTypeTok{training_frame =}\NormalTok{ train,}
                            \DataTypeTok{model_id =} \StringTok{"rf_fit1"}\NormalTok{,}
                            \DataTypeTok{seed =} \DecValTok{1}\NormalTok{)}
\CommentTok{#> }
  \OperatorTok{|}\StringTok{                                                                       }
\StringTok{  }\ErrorTok{|}\StringTok{                                                                 }\ErrorTok{|}\StringTok{   }\DecValTok{0}\NormalTok{%}
  \OperatorTok{|}\StringTok{                                                                       }
\StringTok{  }\ErrorTok{|=}\StringTok{                                                                }\ErrorTok{|}\StringTok{   }\DecValTok{2}\NormalTok{%}
  \OperatorTok{|}\StringTok{                                                                       }
\StringTok{  }\ErrorTok{|=====}\StringTok{                                                            }\ErrorTok{|}\StringTok{   }\DecValTok{8}\NormalTok{%}
  \OperatorTok{|}\StringTok{                                                                       }
\StringTok{  }\ErrorTok{|==========}\StringTok{                                                       }\ErrorTok{|}\StringTok{  }\DecValTok{16}\NormalTok{%}
  \OperatorTok{|}\StringTok{                                                                       }
\StringTok{  }\ErrorTok{|================}\StringTok{                                                 }\ErrorTok{|}\StringTok{  }\DecValTok{24}\NormalTok{%}
  \OperatorTok{|}\StringTok{                                                                       }
\StringTok{  }\ErrorTok{|=======================}\StringTok{                                          }\ErrorTok{|}\StringTok{  }\DecValTok{36}\NormalTok{%}
  \OperatorTok{|}\StringTok{                                                                       }
\StringTok{  }\ErrorTok{|===============================}\StringTok{                                  }\ErrorTok{|}\StringTok{  }\DecValTok{48}\NormalTok{%}
  \OperatorTok{|}\StringTok{                                                                       }
\StringTok{  }\ErrorTok{|=======================================}\StringTok{                          }\ErrorTok{|}\StringTok{  }\DecValTok{60}\NormalTok{%}
  \OperatorTok{|}\StringTok{                                                                       }
\StringTok{  }\ErrorTok{|===============================================}\StringTok{                  }\ErrorTok{|}\StringTok{  }\DecValTok{72}\NormalTok{%}
  \OperatorTok{|}\StringTok{                                                                       }
\StringTok{  }\ErrorTok{|=======================================================}\StringTok{          }\ErrorTok{|}\StringTok{  }\DecValTok{84}\NormalTok{%}
  \OperatorTok{|}\StringTok{                                                                       }
\StringTok{  }\ErrorTok{|==============================================================}\StringTok{   }\ErrorTok{|}\StringTok{  }\DecValTok{96}\NormalTok{%}
  \OperatorTok{|}\StringTok{                                                                       }
\StringTok{  }\ErrorTok{|=================================================================|}\StringTok{ }\DecValTok{100}\NormalTok{%}
\end{Highlighting}
\end{Shaded}

Next we will increase the number of trees used in the forest by setting \texttt{ntrees\ =\ 100}.
The default number of trees in an H2O Random Forest is 50, so this RF will be twice as
big as the default. Usually increasing the number of trees in a RF will increase
performance as well. Unlike Gradient Boosting Machines (GBMs), Random Forests are fairly
resistant (although not free from) overfitting.
See the GBM example below for additional guidance on preventing overfitting using H2O's
early stopping functionality.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{rf_fit2 <-}\StringTok{ }\KeywordTok{h2o.randomForest}\NormalTok{(}\DataTypeTok{x =}\NormalTok{ x,}
                            \DataTypeTok{y =}\NormalTok{ y,}
                            \DataTypeTok{training_frame =}\NormalTok{ train,}
                            \DataTypeTok{model_id =} \StringTok{"rf_fit2"}\NormalTok{,}
                            \CommentTok{#validation_frame = valid,  #only used if stopping_rounds > 0}
                            \DataTypeTok{ntrees =} \DecValTok{100}\NormalTok{,}
                            \DataTypeTok{seed =} \DecValTok{1}\NormalTok{)}
\CommentTok{#> }
  \OperatorTok{|}\StringTok{                                                                       }
\StringTok{  }\ErrorTok{|}\StringTok{                                                                 }\ErrorTok{|}\StringTok{   }\DecValTok{0}\NormalTok{%}
  \OperatorTok{|}\StringTok{                                                                       }
\StringTok{  }\ErrorTok{|===}\StringTok{                                                              }\ErrorTok{|}\StringTok{   }\DecValTok{4}\NormalTok{%}
  \OperatorTok{|}\StringTok{                                                                       }
\StringTok{  }\ErrorTok{|=====}\StringTok{                                                            }\ErrorTok{|}\StringTok{   }\DecValTok{8}\NormalTok{%}
  \OperatorTok{|}\StringTok{                                                                       }
\StringTok{  }\ErrorTok{|========}\StringTok{                                                         }\ErrorTok{|}\StringTok{  }\DecValTok{13}\NormalTok{%}
  \OperatorTok{|}\StringTok{                                                                       }
\StringTok{  }\ErrorTok{|===========}\StringTok{                                                      }\ErrorTok{|}\StringTok{  }\DecValTok{17}\NormalTok{%}
  \OperatorTok{|}\StringTok{                                                                       }
\StringTok{  }\ErrorTok{|==============}\StringTok{                                                   }\ErrorTok{|}\StringTok{  }\DecValTok{22}\NormalTok{%}
  \OperatorTok{|}\StringTok{                                                                       }
\StringTok{  }\ErrorTok{|==================}\StringTok{                                               }\ErrorTok{|}\StringTok{  }\DecValTok{27}\NormalTok{%}
  \OperatorTok{|}\StringTok{                                                                       }
\StringTok{  }\ErrorTok{|====================}\StringTok{                                             }\ErrorTok{|}\StringTok{  }\DecValTok{31}\NormalTok{%}
  \OperatorTok{|}\StringTok{                                                                       }
\StringTok{  }\ErrorTok{|=======================}\StringTok{                                          }\ErrorTok{|}\StringTok{  }\DecValTok{35}\NormalTok{%}
  \OperatorTok{|}\StringTok{                                                                       }
\StringTok{  }\ErrorTok{|==========================}\StringTok{                                       }\ErrorTok{|}\StringTok{  }\DecValTok{40}\NormalTok{%}
  \OperatorTok{|}\StringTok{                                                                       }
\StringTok{  }\ErrorTok{|=============================}\StringTok{                                    }\ErrorTok{|}\StringTok{  }\DecValTok{45}\NormalTok{%}
  \OperatorTok{|}\StringTok{                                                                       }
\StringTok{  }\ErrorTok{|=================================}\StringTok{                                }\ErrorTok{|}\StringTok{  }\DecValTok{51}\NormalTok{%}
  \OperatorTok{|}\StringTok{                                                                       }
\StringTok{  }\ErrorTok{|=====================================}\StringTok{                            }\ErrorTok{|}\StringTok{  }\DecValTok{57}\NormalTok{%}
  \OperatorTok{|}\StringTok{                                                                       }
\StringTok{  }\ErrorTok{|========================================}\StringTok{                         }\ErrorTok{|}\StringTok{  }\DecValTok{62}\NormalTok{%}
  \OperatorTok{|}\StringTok{                                                                       }
\StringTok{  }\ErrorTok{|============================================}\StringTok{                     }\ErrorTok{|}\StringTok{  }\DecValTok{68}\NormalTok{%}
  \OperatorTok{|}\StringTok{                                                                       }
\StringTok{  }\ErrorTok{|================================================}\StringTok{                 }\ErrorTok{|}\StringTok{  }\DecValTok{74}\NormalTok{%}
  \OperatorTok{|}\StringTok{                                                                       }
\StringTok{  }\ErrorTok{|===================================================}\StringTok{              }\ErrorTok{|}\StringTok{  }\DecValTok{79}\NormalTok{%}
  \OperatorTok{|}\StringTok{                                                                       }
\StringTok{  }\ErrorTok{|=======================================================}\StringTok{          }\ErrorTok{|}\StringTok{  }\DecValTok{85}\NormalTok{%}
  \OperatorTok{|}\StringTok{                                                                       }
\StringTok{  }\ErrorTok{|===========================================================}\StringTok{      }\ErrorTok{|}\StringTok{  }\DecValTok{91}\NormalTok{%}
  \OperatorTok{|}\StringTok{                                                                       }
\StringTok{  }\ErrorTok{|==============================================================}\StringTok{   }\ErrorTok{|}\StringTok{  }\DecValTok{96}\NormalTok{%}
  \OperatorTok{|}\StringTok{                                                                       }
\StringTok{  }\ErrorTok{|=================================================================|}\StringTok{ }\DecValTok{100}\NormalTok{%}
\end{Highlighting}
\end{Shaded}

Let's compare the performance of the two RFs

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# Let's compare the performance of the two RFs}
\NormalTok{rf_perf1 <-}\StringTok{ }\KeywordTok{h2o.performance}\NormalTok{(}\DataTypeTok{model =}\NormalTok{ rf_fit1,}
                            \DataTypeTok{newdata =}\NormalTok{ test)}
\NormalTok{rf_perf2 <-}\StringTok{ }\KeywordTok{h2o.performance}\NormalTok{(}\DataTypeTok{model =}\NormalTok{ rf_fit2,}
                            \DataTypeTok{newdata =}\NormalTok{ test)}

\CommentTok{# Print model performance}
\NormalTok{rf_perf1}
\CommentTok{#> H2OBinomialMetrics: drf}
\CommentTok{#> }
\CommentTok{#> MSE:  0.144}
\CommentTok{#> RMSE:  0.379}
\CommentTok{#> LogLoss:  0.459}
\CommentTok{#> Mean Per-Class Error:  0.379}
\CommentTok{#> AUC:  0.663}
\CommentTok{#> pr_auc:  0.311}
\CommentTok{#> Gini:  0.327}
\CommentTok{#> }
\CommentTok{#> Confusion Matrix (vertical: actual; across: predicted) for F1-optimal threshold:}
\CommentTok{#>            0    1    Error         Rate}
\CommentTok{#> 0      12842 7149 0.357611  =7149/19991}
\CommentTok{#> 1       1839 2751 0.400654   =1839/4590}
\CommentTok{#> Totals 14681 9900 0.365648  =8988/24581}
\CommentTok{#> }
\CommentTok{#> Maximum Metrics: Maximum metrics at their respective thresholds}
\CommentTok{#>                         metric threshold    value idx}
\CommentTok{#> 1                       max f1  0.193397 0.379710 229}
\CommentTok{#> 2                       max f2  0.077797 0.547982 344}
\CommentTok{#> 3                 max f0point5  0.277524 0.344251 158}
\CommentTok{#> 4                 max accuracy  0.543639 0.813799  29}
\CommentTok{#> 5                max precision  0.817454 1.000000   0}
\CommentTok{#> 6                   max recall  0.001181 1.000000 399}
\CommentTok{#> 7              max specificity  0.817454 1.000000   0}
\CommentTok{#> 8             max absolute_mcc  0.252480 0.195090 178}
\CommentTok{#> 9   max min_per_class_accuracy  0.186549 0.619826 235}
\CommentTok{#> 10 max mean_per_class_accuracy  0.192603 0.620890 230}
\CommentTok{#> }
\CommentTok{#> Gains/Lift Table: Extract with `h2o.gainsLift(<model>, <data>)` or `h2o.gainsLift(<model>, valid=<T/F>, xval=<T/F>)`}
\NormalTok{rf_perf2}
\CommentTok{#> H2OBinomialMetrics: drf}
\CommentTok{#> }
\CommentTok{#> MSE:  0.143}
\CommentTok{#> RMSE:  0.378}
\CommentTok{#> LogLoss:  0.454}
\CommentTok{#> Mean Per-Class Error:  0.377}
\CommentTok{#> AUC:  0.669}
\CommentTok{#> pr_auc:  0.32}
\CommentTok{#> Gini:  0.339}
\CommentTok{#> }
\CommentTok{#> Confusion Matrix (vertical: actual; across: predicted) for F1-optimal threshold:}
\CommentTok{#>            0    1    Error         Rate}
\CommentTok{#> 0      13172 6819 0.341103  =6819/19991}
\CommentTok{#> 1       1891 2699 0.411983   =1891/4590}
\CommentTok{#> Totals 15063 9518 0.354339  =8710/24581}
\CommentTok{#> }
\CommentTok{#> Maximum Metrics: Maximum metrics at their respective thresholds}
\CommentTok{#>                         metric threshold    value idx}
\CommentTok{#> 1                       max f1  0.196407 0.382620 225}
\CommentTok{#> 2                       max f2  0.092270 0.549691 331}
\CommentTok{#> 3                 max f0point5  0.291396 0.349342 144}
\CommentTok{#> 4                 max accuracy  0.555908 0.813840  20}
\CommentTok{#> 5                max precision  0.651522 0.785714   5}
\CommentTok{#> 6                   max recall  0.004212 1.000000 398}
\CommentTok{#> 7              max specificity  0.711667 0.999950   0}
\CommentTok{#> 8             max absolute_mcc  0.229251 0.204236 194}
\CommentTok{#> 9   max min_per_class_accuracy  0.184594 0.619829 235}
\CommentTok{#> 10 max mean_per_class_accuracy  0.196407 0.623457 225}
\CommentTok{#> }
\CommentTok{#> Gains/Lift Table: Extract with `h2o.gainsLift(<model>, <data>)` or `h2o.gainsLift(<model>, valid=<T/F>, xval=<T/F>)`}

\CommentTok{# Retreive test set AUC}
\KeywordTok{h2o.auc}\NormalTok{(rf_perf1)  }\CommentTok{# 0.662266990734}
\CommentTok{#> [1] 0.663}
\KeywordTok{h2o.auc}\NormalTok{(rf_perf2)  }\CommentTok{# 0.66525468051}
\CommentTok{#> [1] 0.669}
\end{Highlighting}
\end{Shaded}

\hypertarget{cross-validate-performance}{%
\subsection{Cross-validate performance}\label{cross-validate-performance}}

Rather than using held-out test set to evaluate model performance, a user may wish
to estimate model performance using cross-validation. Using the RF algorithm
(with default model parameters) as an example, we demonstrate how to perform k-fold
cross-validation using H2O. No custom code or loops are required, you simply specify
the number of desired folds in the nfolds argument.
Since we are not going to use a test set here, we can use the original (full) dataset,
which we called data rather than the subsampled \texttt{train} dataset. Note that this will
take approximately k (nfolds) times longer than training a single RF model, since it
will train k models in the cross-validation process (trained on n(k-1)/k rows), in
addition to the final model trained on the full training\_frame dataset with n rows.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{rf_fit3 <-}\StringTok{ }\KeywordTok{h2o.randomForest}\NormalTok{(}\DataTypeTok{x =}\NormalTok{ x,}
                            \DataTypeTok{y =}\NormalTok{ y,}
                            \DataTypeTok{training_frame =}\NormalTok{ train,}
                            \DataTypeTok{model_id =} \StringTok{"rf_fit3"}\NormalTok{,}
                            \DataTypeTok{seed =} \DecValTok{1}\NormalTok{,}
                            \DataTypeTok{nfolds =} \DecValTok{5}\NormalTok{)}
\CommentTok{#> }
  \OperatorTok{|}\StringTok{                                                                       }
\StringTok{  }\ErrorTok{|}\StringTok{                                                                 }\ErrorTok{|}\StringTok{   }\DecValTok{0}\NormalTok{%}
  \OperatorTok{|}\StringTok{                                                                       }
\StringTok{  }\ErrorTok{|=}\StringTok{                                                                }\ErrorTok{|}\StringTok{   }\DecValTok{1}\NormalTok{%}
  \OperatorTok{|}\StringTok{                                                                       }
\StringTok{  }\ErrorTok{|==}\StringTok{                                                               }\ErrorTok{|}\StringTok{   }\DecValTok{2}\NormalTok{%}
  \OperatorTok{|}\StringTok{                                                                       }
\StringTok{  }\ErrorTok{|==}\StringTok{                                                               }\ErrorTok{|}\StringTok{   }\DecValTok{3}\NormalTok{%}
  \OperatorTok{|}\StringTok{                                                                       }
\StringTok{  }\ErrorTok{|===}\StringTok{                                                              }\ErrorTok{|}\StringTok{   }\DecValTok{5}\NormalTok{%}
  \OperatorTok{|}\StringTok{                                                                       }
\StringTok{  }\ErrorTok{|====}\StringTok{                                                             }\ErrorTok{|}\StringTok{   }\DecValTok{6}\NormalTok{%}
  \OperatorTok{|}\StringTok{                                                                       }
\StringTok{  }\ErrorTok{|=====}\StringTok{                                                            }\ErrorTok{|}\StringTok{   }\DecValTok{8}\NormalTok{%}
  \OperatorTok{|}\StringTok{                                                                       }
\StringTok{  }\ErrorTok{|======}\StringTok{                                                           }\ErrorTok{|}\StringTok{   }\DecValTok{9}\NormalTok{%}
  \OperatorTok{|}\StringTok{                                                                       }
\StringTok{  }\ErrorTok{|=======}\StringTok{                                                          }\ErrorTok{|}\StringTok{  }\DecValTok{11}\NormalTok{%}
  \OperatorTok{|}\StringTok{                                                                       }
\StringTok{  }\ErrorTok{|========}\StringTok{                                                         }\ErrorTok{|}\StringTok{  }\DecValTok{13}\NormalTok{%}
  \OperatorTok{|}\StringTok{                                                                       }
\StringTok{  }\ErrorTok{|=========}\StringTok{                                                        }\ErrorTok{|}\StringTok{  }\DecValTok{14}\NormalTok{%}
  \OperatorTok{|}\StringTok{                                                                       }
\StringTok{  }\ErrorTok{|===========}\StringTok{                                                      }\ErrorTok{|}\StringTok{  }\DecValTok{16}\NormalTok{%}
  \OperatorTok{|}\StringTok{                                                                       }
\StringTok{  }\ErrorTok{|===========}\StringTok{                                                      }\ErrorTok{|}\StringTok{  }\DecValTok{17}\NormalTok{%}
  \OperatorTok{|}\StringTok{                                                                       }
\StringTok{  }\ErrorTok{|============}\StringTok{                                                     }\ErrorTok{|}\StringTok{  }\DecValTok{18}\NormalTok{%}
  \OperatorTok{|}\StringTok{                                                                       }
\StringTok{  }\ErrorTok{|=============}\StringTok{                                                    }\ErrorTok{|}\StringTok{  }\DecValTok{19}\NormalTok{%}
  \OperatorTok{|}\StringTok{                                                                       }
\StringTok{  }\ErrorTok{|=============}\StringTok{                                                    }\ErrorTok{|}\StringTok{  }\DecValTok{20}\NormalTok{%}
  \OperatorTok{|}\StringTok{                                                                       }
\StringTok{  }\ErrorTok{|==============}\StringTok{                                                   }\ErrorTok{|}\StringTok{  }\DecValTok{21}\NormalTok{%}
  \OperatorTok{|}\StringTok{                                                                       }
\StringTok{  }\ErrorTok{|===============}\StringTok{                                                  }\ErrorTok{|}\StringTok{  }\DecValTok{23}\NormalTok{%}
  \OperatorTok{|}\StringTok{                                                                       }
\StringTok{  }\ErrorTok{|================}\StringTok{                                                 }\ErrorTok{|}\StringTok{  }\DecValTok{25}\NormalTok{%}
  \OperatorTok{|}\StringTok{                                                                       }
\StringTok{  }\ErrorTok{|=================}\StringTok{                                                }\ErrorTok{|}\StringTok{  }\DecValTok{26}\NormalTok{%}
  \OperatorTok{|}\StringTok{                                                                       }
\StringTok{  }\ErrorTok{|==================}\StringTok{                                               }\ErrorTok{|}\StringTok{  }\DecValTok{27}\NormalTok{%}
  \OperatorTok{|}\StringTok{                                                                       }
\StringTok{  }\ErrorTok{|==================}\StringTok{                                               }\ErrorTok{|}\StringTok{  }\DecValTok{28}\NormalTok{%}
  \OperatorTok{|}\StringTok{                                                                       }
\StringTok{  }\ErrorTok{|===================}\StringTok{                                              }\ErrorTok{|}\StringTok{  }\DecValTok{29}\NormalTok{%}
  \OperatorTok{|}\StringTok{                                                                       }
\StringTok{  }\ErrorTok{|====================}\StringTok{                                             }\ErrorTok{|}\StringTok{  }\DecValTok{31}\NormalTok{%}
  \OperatorTok{|}\StringTok{                                                                       }
\StringTok{  }\ErrorTok{|=====================}\StringTok{                                            }\ErrorTok{|}\StringTok{  }\DecValTok{32}\NormalTok{%}
  \OperatorTok{|}\StringTok{                                                                       }
\StringTok{  }\ErrorTok{|=====================}\StringTok{                                            }\ErrorTok{|}\StringTok{  }\DecValTok{33}\NormalTok{%}
  \OperatorTok{|}\StringTok{                                                                       }
\StringTok{  }\ErrorTok{|======================}\StringTok{                                           }\ErrorTok{|}\StringTok{  }\DecValTok{34}\NormalTok{%}
  \OperatorTok{|}\StringTok{                                                                       }
\StringTok{  }\ErrorTok{|=======================}\StringTok{                                          }\ErrorTok{|}\StringTok{  }\DecValTok{35}\NormalTok{%}
  \OperatorTok{|}\StringTok{                                                                       }
\StringTok{  }\ErrorTok{|========================}\StringTok{                                         }\ErrorTok{|}\StringTok{  }\DecValTok{36}\NormalTok{%}
  \OperatorTok{|}\StringTok{                                                                       }
\StringTok{  }\ErrorTok{|========================}\StringTok{                                         }\ErrorTok{|}\StringTok{  }\DecValTok{37}\NormalTok{%}
  \OperatorTok{|}\StringTok{                                                                       }
\StringTok{  }\ErrorTok{|=========================}\StringTok{                                        }\ErrorTok{|}\StringTok{  }\DecValTok{39}\NormalTok{%}
  \OperatorTok{|}\StringTok{                                                                       }
\StringTok{  }\ErrorTok{|===========================}\StringTok{                                      }\ErrorTok{|}\StringTok{  }\DecValTok{41}\NormalTok{%}
  \OperatorTok{|}\StringTok{                                                                       }
\StringTok{  }\ErrorTok{|============================}\StringTok{                                     }\ErrorTok{|}\StringTok{  }\DecValTok{43}\NormalTok{%}
  \OperatorTok{|}\StringTok{                                                                       }
\StringTok{  }\ErrorTok{|=============================}\StringTok{                                    }\ErrorTok{|}\StringTok{  }\DecValTok{45}\NormalTok{%}
  \OperatorTok{|}\StringTok{                                                                       }
\StringTok{  }\ErrorTok{|==============================}\StringTok{                                   }\ErrorTok{|}\StringTok{  }\DecValTok{46}\NormalTok{%}
  \OperatorTok{|}\StringTok{                                                                       }
\StringTok{  }\ErrorTok{|===============================}\StringTok{                                  }\ErrorTok{|}\StringTok{  }\DecValTok{48}\NormalTok{%}
  \OperatorTok{|}\StringTok{                                                                       }
\StringTok{  }\ErrorTok{|================================}\StringTok{                                 }\ErrorTok{|}\StringTok{  }\DecValTok{50}\NormalTok{%}
  \OperatorTok{|}\StringTok{                                                                       }
\StringTok{  }\ErrorTok{|=================================}\StringTok{                                }\ErrorTok{|}\StringTok{  }\DecValTok{51}\NormalTok{%}
  \OperatorTok{|}\StringTok{                                                                       }
\StringTok{  }\ErrorTok{|==================================}\StringTok{                               }\ErrorTok{|}\StringTok{  }\DecValTok{52}\NormalTok{%}
  \OperatorTok{|}\StringTok{                                                                       }
\StringTok{  }\ErrorTok{|===================================}\StringTok{                              }\ErrorTok{|}\StringTok{  }\DecValTok{53}\NormalTok{%}
  \OperatorTok{|}\StringTok{                                                                       }
\StringTok{  }\ErrorTok{|===================================}\StringTok{                              }\ErrorTok{|}\StringTok{  }\DecValTok{54}\NormalTok{%}
  \OperatorTok{|}\StringTok{                                                                       }
\StringTok{  }\ErrorTok{|====================================}\StringTok{                             }\ErrorTok{|}\StringTok{  }\DecValTok{56}\NormalTok{%}
  \OperatorTok{|}\StringTok{                                                                       }
\StringTok{  }\ErrorTok{|=====================================}\StringTok{                            }\ErrorTok{|}\StringTok{  }\DecValTok{58}\NormalTok{%}
  \OperatorTok{|}\StringTok{                                                                       }
\StringTok{  }\ErrorTok{|======================================}\StringTok{                           }\ErrorTok{|}\StringTok{  }\DecValTok{59}\NormalTok{%}
  \OperatorTok{|}\StringTok{                                                                       }
\StringTok{  }\ErrorTok{|=======================================}\StringTok{                          }\ErrorTok{|}\StringTok{  }\DecValTok{61}\NormalTok{%}
  \OperatorTok{|}\StringTok{                                                                       }
\StringTok{  }\ErrorTok{|========================================}\StringTok{                         }\ErrorTok{|}\StringTok{  }\DecValTok{62}\NormalTok{%}
  \OperatorTok{|}\StringTok{                                                                       }
\StringTok{  }\ErrorTok{|=========================================}\StringTok{                        }\ErrorTok{|}\StringTok{  }\DecValTok{64}\NormalTok{%}
  \OperatorTok{|}\StringTok{                                                                       }
\StringTok{  }\ErrorTok{|==========================================}\StringTok{                       }\ErrorTok{|}\StringTok{  }\DecValTok{65}\NormalTok{%}
  \OperatorTok{|}\StringTok{                                                                       }
\StringTok{  }\ErrorTok{|===========================================}\StringTok{                      }\ErrorTok{|}\StringTok{  }\DecValTok{67}\NormalTok{%}
  \OperatorTok{|}\StringTok{                                                                       }
\StringTok{  }\ErrorTok{|============================================}\StringTok{                     }\ErrorTok{|}\StringTok{  }\DecValTok{68}\NormalTok{%}
  \OperatorTok{|}\StringTok{                                                                       }
\StringTok{  }\ErrorTok{|=============================================}\StringTok{                    }\ErrorTok{|}\StringTok{  }\DecValTok{69}\NormalTok{%}
  \OperatorTok{|}\StringTok{                                                                       }
\StringTok{  }\ErrorTok{|==============================================}\StringTok{                   }\ErrorTok{|}\StringTok{  }\DecValTok{70}\NormalTok{%}
  \OperatorTok{|}\StringTok{                                                                       }
\StringTok{  }\ErrorTok{|===============================================}\StringTok{                  }\ErrorTok{|}\StringTok{  }\DecValTok{72}\NormalTok{%}
  \OperatorTok{|}\StringTok{                                                                       }
\StringTok{  }\ErrorTok{|===============================================}\StringTok{                  }\ErrorTok{|}\StringTok{  }\DecValTok{73}\NormalTok{%}
  \OperatorTok{|}\StringTok{                                                                       }
\StringTok{  }\ErrorTok{|================================================}\StringTok{                 }\ErrorTok{|}\StringTok{  }\DecValTok{74}\NormalTok{%}
  \OperatorTok{|}\StringTok{                                                                       }
\StringTok{  }\ErrorTok{|=================================================}\StringTok{                }\ErrorTok{|}\StringTok{  }\DecValTok{76}\NormalTok{%}
  \OperatorTok{|}\StringTok{                                                                       }
\StringTok{  }\ErrorTok{|==================================================}\StringTok{               }\ErrorTok{|}\StringTok{  }\DecValTok{77}\NormalTok{%}
  \OperatorTok{|}\StringTok{                                                                       }
\StringTok{  }\ErrorTok{|===================================================}\StringTok{              }\ErrorTok{|}\StringTok{  }\DecValTok{78}\NormalTok{%}
  \OperatorTok{|}\StringTok{                                                                       }
\StringTok{  }\ErrorTok{|====================================================}\StringTok{             }\ErrorTok{|}\StringTok{  }\DecValTok{80}\NormalTok{%}
  \OperatorTok{|}\StringTok{                                                                       }
\StringTok{  }\ErrorTok{|=====================================================}\StringTok{            }\ErrorTok{|}\StringTok{  }\DecValTok{82}\NormalTok{%}
  \OperatorTok{|}\StringTok{                                                                       }
\StringTok{  }\ErrorTok{|======================================================}\StringTok{           }\ErrorTok{|}\StringTok{  }\DecValTok{82}\NormalTok{%}
  \OperatorTok{|}\StringTok{                                                                       }
\StringTok{  }\ErrorTok{|======================================================}\StringTok{           }\ErrorTok{|}\StringTok{  }\DecValTok{83}\NormalTok{%}
  \OperatorTok{|}\StringTok{                                                                       }
\StringTok{  }\ErrorTok{|=======================================================}\StringTok{          }\ErrorTok{|}\StringTok{  }\DecValTok{85}\NormalTok{%}
  \OperatorTok{|}\StringTok{                                                                       }
\StringTok{  }\ErrorTok{|========================================================}\StringTok{         }\ErrorTok{|}\StringTok{  }\DecValTok{86}\NormalTok{%}
  \OperatorTok{|}\StringTok{                                                                       }
\StringTok{  }\ErrorTok{|=========================================================}\StringTok{        }\ErrorTok{|}\StringTok{  }\DecValTok{88}\NormalTok{%}
  \OperatorTok{|}\StringTok{                                                                       }
\StringTok{  }\ErrorTok{|==========================================================}\StringTok{       }\ErrorTok{|}\StringTok{  }\DecValTok{89}\NormalTok{%}
  \OperatorTok{|}\StringTok{                                                                       }
\StringTok{  }\ErrorTok{|==========================================================}\StringTok{       }\ErrorTok{|}\StringTok{  }\DecValTok{90}\NormalTok{%}
  \OperatorTok{|}\StringTok{                                                                       }
\StringTok{  }\ErrorTok{|============================================================}\StringTok{     }\ErrorTok{|}\StringTok{  }\DecValTok{92}\NormalTok{%}
  \OperatorTok{|}\StringTok{                                                                       }
\StringTok{  }\ErrorTok{|============================================================}\StringTok{     }\ErrorTok{|}\StringTok{  }\DecValTok{93}\NormalTok{%}
  \OperatorTok{|}\StringTok{                                                                       }
\StringTok{  }\ErrorTok{|==============================================================}\StringTok{   }\ErrorTok{|}\StringTok{  }\DecValTok{95}\NormalTok{%}
  \OperatorTok{|}\StringTok{                                                                       }
\StringTok{  }\ErrorTok{|==============================================================}\StringTok{   }\ErrorTok{|}\StringTok{  }\DecValTok{96}\NormalTok{%}
  \OperatorTok{|}\StringTok{                                                                       }
\StringTok{  }\ErrorTok{|===============================================================}\StringTok{  }\ErrorTok{|}\StringTok{  }\DecValTok{98}\NormalTok{%}
  \OperatorTok{|}\StringTok{                                                                       }
\StringTok{  }\ErrorTok{|=================================================================|}\StringTok{ }\DecValTok{100}\NormalTok{%}
\end{Highlighting}
\end{Shaded}

To evaluate the cross-validated AUC, do the following:

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# To evaluate the cross-validated AUC, do the following:}
\KeywordTok{h2o.auc}\NormalTok{(rf_fit3, }\DataTypeTok{xval =} \OtherTok{TRUE}\NormalTok{)  }\CommentTok{# 0.661201482614}
\CommentTok{#> [1] 0.659}
\end{Highlighting}
\end{Shaded}

\hypertarget{gradient-boosting-machine-gbm}{%
\section{Gradient Boosting Machine (GBM)}\label{gradient-boosting-machine-gbm}}

H2O's Gradient Boosting Machine (GBM) offers a Stochastic GBM, which can
increase performance quite a bit compared to the original GBM implementation.

Now we will train a basic GBM model
The GBM model will infer the response distribution from the response encoding if not specified explicitly through the \texttt{distribution} argument. A seed is required for reproducibility.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{gbm_fit1 <-}\StringTok{ }\KeywordTok{h2o.gbm}\NormalTok{(}\DataTypeTok{x =}\NormalTok{ x,}
                    \DataTypeTok{y =}\NormalTok{ y,}
                    \DataTypeTok{training_frame =}\NormalTok{ train,}
                    \DataTypeTok{model_id =} \StringTok{"gbm_fit1"}\NormalTok{,}
                    \DataTypeTok{seed =} \DecValTok{1}\NormalTok{)}
\CommentTok{#> }
  \OperatorTok{|}\StringTok{                                                                       }
\StringTok{  }\ErrorTok{|}\StringTok{                                                                 }\ErrorTok{|}\StringTok{   }\DecValTok{0}\NormalTok{%}
  \OperatorTok{|}\StringTok{                                                                       }
\StringTok{  }\ErrorTok{|=========}\StringTok{                                                        }\ErrorTok{|}\StringTok{  }\DecValTok{14}\NormalTok{%}
  \OperatorTok{|}\StringTok{                                                                       }
\StringTok{  }\ErrorTok{|======================}\StringTok{                                           }\ErrorTok{|}\StringTok{  }\DecValTok{34}\NormalTok{%}
  \OperatorTok{|}\StringTok{                                                                       }
\StringTok{  }\ErrorTok{|===================================}\StringTok{                              }\ErrorTok{|}\StringTok{  }\DecValTok{54}\NormalTok{%}
  \OperatorTok{|}\StringTok{                                                                       }
\StringTok{  }\ErrorTok{|===================================================}\StringTok{              }\ErrorTok{|}\StringTok{  }\DecValTok{78}\NormalTok{%}
  \OperatorTok{|}\StringTok{                                                                       }
\StringTok{  }\ErrorTok{|=================================================================|}\StringTok{ }\DecValTok{100}\NormalTok{%}
\end{Highlighting}
\end{Shaded}

Next we will increase the number of trees used in the GBM by setting \texttt{ntrees=500}.
The default number of trees in an H2O GBM is 50, so this GBM will trained using ten times
the default. Increasing the number of trees in a GBM is one way to increase performance
of the model, however, you have to be careful not to overfit your model to the training data
by using too many trees. To automatically find the optimal number of trees, you must use
H2O's early stopping functionality. This example will not do that, however, the following \# example will.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{gbm_fit2 <-}\StringTok{ }\KeywordTok{h2o.gbm}\NormalTok{(}\DataTypeTok{x =}\NormalTok{ x,}
                    \DataTypeTok{y =}\NormalTok{ y,}
                    \DataTypeTok{training_frame =}\NormalTok{ train,}
                    \DataTypeTok{model_id =} \StringTok{"gbm_fit2"}\NormalTok{,}
                    \CommentTok{#validation_frame = valid,  #only used if stopping_rounds > 0}
                    \DataTypeTok{ntrees =} \DecValTok{500}\NormalTok{,}
                    \DataTypeTok{seed =} \DecValTok{1}\NormalTok{)}
\CommentTok{#> }
  \OperatorTok{|}\StringTok{                                                                       }
\StringTok{  }\ErrorTok{|}\StringTok{                                                                 }\ErrorTok{|}\StringTok{   }\DecValTok{0}\NormalTok{%}
  \OperatorTok{|}\StringTok{                                                                       }
\StringTok{  }\ErrorTok{|=}\StringTok{                                                                }\ErrorTok{|}\StringTok{   }\DecValTok{2}\NormalTok{%}
  \OperatorTok{|}\StringTok{                                                                       }
\StringTok{  }\ErrorTok{|===}\StringTok{                                                              }\ErrorTok{|}\StringTok{   }\DecValTok{4}\NormalTok{%}
  \OperatorTok{|}\StringTok{                                                                       }
\StringTok{  }\ErrorTok{|====}\StringTok{                                                             }\ErrorTok{|}\StringTok{   }\DecValTok{6}\NormalTok{%}
  \OperatorTok{|}\StringTok{                                                                       }
\StringTok{  }\ErrorTok{|=====}\StringTok{                                                            }\ErrorTok{|}\StringTok{   }\DecValTok{8}\NormalTok{%}
  \OperatorTok{|}\StringTok{                                                                       }
\StringTok{  }\ErrorTok{|=======}\StringTok{                                                          }\ErrorTok{|}\StringTok{  }\DecValTok{11}\NormalTok{%}
  \OperatorTok{|}\StringTok{                                                                       }
\StringTok{  }\ErrorTok{|==========}\StringTok{                                                       }\ErrorTok{|}\StringTok{  }\DecValTok{15}\NormalTok{%}
  \OperatorTok{|}\StringTok{                                                                       }
\StringTok{  }\ErrorTok{|=============}\StringTok{                                                    }\ErrorTok{|}\StringTok{  }\DecValTok{20}\NormalTok{%}
  \OperatorTok{|}\StringTok{                                                                       }
\StringTok{  }\ErrorTok{|================}\StringTok{                                                 }\ErrorTok{|}\StringTok{  }\DecValTok{24}\NormalTok{%}
  \OperatorTok{|}\StringTok{                                                                       }
\StringTok{  }\ErrorTok{|======================}\StringTok{                                           }\ErrorTok{|}\StringTok{  }\DecValTok{34}\NormalTok{%}
  \OperatorTok{|}\StringTok{                                                                       }
\StringTok{  }\ErrorTok{|=================================}\StringTok{                                }\ErrorTok{|}\StringTok{  }\DecValTok{51}\NormalTok{%}
  \OperatorTok{|}\StringTok{                                                                       }
\StringTok{  }\ErrorTok{|=============================================}\StringTok{                    }\ErrorTok{|}\StringTok{  }\DecValTok{69}\NormalTok{%}
  \OperatorTok{|}\StringTok{                                                                       }
\StringTok{  }\ErrorTok{|=======================================================}\StringTok{          }\ErrorTok{|}\StringTok{  }\DecValTok{84}\NormalTok{%}
  \OperatorTok{|}\StringTok{                                                                       }
\StringTok{  }\ErrorTok{|================================================================}\StringTok{ }\ErrorTok{|}\StringTok{  }\DecValTok{98}\NormalTok{%}
  \OperatorTok{|}\StringTok{                                                                       }
\StringTok{  }\ErrorTok{|=================================================================|}\StringTok{ }\DecValTok{100}\NormalTok{%}
\end{Highlighting}
\end{Shaded}

We will again set \texttt{ntrees\ =\ 500}, however, this time we will use early stopping in order to
prevent overfitting (from too many trees). All of H2O's algorithms have early stopping available, however early stopping is not enabled by default (with the exception of Deep Learning).
There are several parameters that should be used to control early stopping. The three that are common to all the algorithms are: \texttt{stopping\_rounds}, \texttt{stopping\_metric} and \texttt{stopping\_tolerance}.
The stopping metric is the metric by which you'd like to measure performance, and so we will choose AUC here. The \texttt{score\_tree\_interval} is a parameter specific to the Random Forest model and the GBM.
Setting \texttt{score\_tree\_interval\ =\ 5} will score the model after every five trees. The parameters we have set below specify that the model will stop training after there have been three scoring intervals where the AUC has not increased more than 0.0005. Since we have specified a validation frame, the stopping tolerance will be computed on validation AUC rather than training AUC.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{gbm_fit3 <-}\StringTok{ }\KeywordTok{h2o.gbm}\NormalTok{(}\DataTypeTok{x =}\NormalTok{ x,}
                    \DataTypeTok{y =}\NormalTok{ y,}
                    \DataTypeTok{training_frame =}\NormalTok{ train,}
                    \DataTypeTok{model_id =} \StringTok{"gbm_fit3"}\NormalTok{,}
                    \DataTypeTok{validation_frame =}\NormalTok{ valid,  }\CommentTok{#only used if stopping_rounds > 0}
                    \DataTypeTok{ntrees =} \DecValTok{500}\NormalTok{,}
                    \DataTypeTok{score_tree_interval =} \DecValTok{5}\NormalTok{,      }\CommentTok{#used for early stopping}
                    \DataTypeTok{stopping_rounds =} \DecValTok{3}\NormalTok{,          }\CommentTok{#used for early stopping}
                    \DataTypeTok{stopping_metric =} \StringTok{"AUC"}\NormalTok{,      }\CommentTok{#used for early stopping}
                    \DataTypeTok{stopping_tolerance =} \FloatTok{0.0005}\NormalTok{,  }\CommentTok{#used for early stopping}
                    \DataTypeTok{seed =} \DecValTok{1}\NormalTok{)}
\CommentTok{#> }
  \OperatorTok{|}\StringTok{                                                                       }
\StringTok{  }\ErrorTok{|}\StringTok{                                                                 }\ErrorTok{|}\StringTok{   }\DecValTok{0}\NormalTok{%}
  \OperatorTok{|}\StringTok{                                                                       }
\StringTok{  }\ErrorTok{|==}\StringTok{                                                               }\ErrorTok{|}\StringTok{   }\DecValTok{2}\NormalTok{%}
  \OperatorTok{|}\StringTok{                                                                       }
\StringTok{  }\ErrorTok{|===}\StringTok{                                                              }\ErrorTok{|}\StringTok{   }\DecValTok{4}\NormalTok{%}
  \OperatorTok{|}\StringTok{                                                                       }
\StringTok{  }\ErrorTok{|=====}\StringTok{                                                            }\ErrorTok{|}\StringTok{   }\DecValTok{7}\NormalTok{%}
  \OperatorTok{|}\StringTok{                                                                       }
\StringTok{  }\ErrorTok{|======}\StringTok{                                                           }\ErrorTok{|}\StringTok{  }\DecValTok{10}\NormalTok{%}
  \OperatorTok{|}\StringTok{                                                                       }
\StringTok{  }\ErrorTok{|========}\StringTok{                                                         }\ErrorTok{|}\StringTok{  }\DecValTok{13}\NormalTok{%}
  \OperatorTok{|}\StringTok{                                                                       }
\StringTok{  }\ErrorTok{|==========}\StringTok{                                                       }\ErrorTok{|}\StringTok{  }\DecValTok{16}\NormalTok{%}
  \OperatorTok{|}\StringTok{                                                                       }
\StringTok{  }\ErrorTok{|============}\StringTok{                                                     }\ErrorTok{|}\StringTok{  }\DecValTok{19}\NormalTok{%}
  \OperatorTok{|}\StringTok{                                                                       }
\StringTok{  }\ErrorTok{|=================================================================|}\StringTok{ }\DecValTok{100}\NormalTok{%}
\end{Highlighting}
\end{Shaded}

Let's compare the performance of the two GBMs

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# Let's compare the performance of the two GBMs}
\NormalTok{gbm_perf1 <-}\StringTok{ }\KeywordTok{h2o.performance}\NormalTok{(}\DataTypeTok{model =}\NormalTok{ gbm_fit1,}
                             \DataTypeTok{newdata =}\NormalTok{ test)}
\NormalTok{gbm_perf2 <-}\StringTok{ }\KeywordTok{h2o.performance}\NormalTok{(}\DataTypeTok{model =}\NormalTok{ gbm_fit2,}
                             \DataTypeTok{newdata =}\NormalTok{ test)}
\NormalTok{gbm_perf3 <-}\StringTok{ }\KeywordTok{h2o.performance}\NormalTok{(}\DataTypeTok{model =}\NormalTok{ gbm_fit3,}
                             \DataTypeTok{newdata =}\NormalTok{ test)}

\CommentTok{# Print model performance}
\NormalTok{gbm_perf1}
\CommentTok{#> H2OBinomialMetrics: gbm}
\CommentTok{#> }
\CommentTok{#> MSE:  0.141}
\CommentTok{#> RMSE:  0.376}
\CommentTok{#> LogLoss:  0.448}
\CommentTok{#> Mean Per-Class Error:  0.367}
\CommentTok{#> AUC:  0.684}
\CommentTok{#> pr_auc:  0.332}
\CommentTok{#> Gini:  0.368}
\CommentTok{#> }
\CommentTok{#> Confusion Matrix (vertical: actual; across: predicted) for F1-optimal threshold:}
\CommentTok{#>            0     1    Error         Rate}
\CommentTok{#> 0      12143  7848 0.392577  =7848/19991}
\CommentTok{#> 1       1571  3019 0.342266   =1571/4590}
\CommentTok{#> Totals 13714 10867 0.383182  =9419/24581}
\CommentTok{#> }
\CommentTok{#> Maximum Metrics: Maximum metrics at their respective thresholds}
\CommentTok{#>                         metric threshold    value idx}
\CommentTok{#> 1                       max f1  0.171139 0.390632 251}
\CommentTok{#> 2                       max f2  0.108885 0.560103 328}
\CommentTok{#> 3                 max f0point5  0.285149 0.356430 145}
\CommentTok{#> 4                 max accuracy  0.510077 0.814410  27}
\CommentTok{#> 5                max precision  0.601699 0.636364   8}
\CommentTok{#> 6                   max recall  0.037543 1.000000 398}
\CommentTok{#> 7              max specificity  0.719189 0.999950   0}
\CommentTok{#> 8             max absolute_mcc  0.220471 0.215401 199}
\CommentTok{#> 9   max min_per_class_accuracy  0.176689 0.628540 244}
\CommentTok{#> 10 max mean_per_class_accuracy  0.170225 0.632624 252}
\CommentTok{#> }
\CommentTok{#> Gains/Lift Table: Extract with `h2o.gainsLift(<model>, <data>)` or `h2o.gainsLift(<model>, valid=<T/F>, xval=<T/F>)`}
\NormalTok{gbm_perf2}
\CommentTok{#> H2OBinomialMetrics: gbm}
\CommentTok{#> }
\CommentTok{#> MSE:  0.142}
\CommentTok{#> RMSE:  0.376}
\CommentTok{#> LogLoss:  0.449}
\CommentTok{#> Mean Per-Class Error:  0.367}
\CommentTok{#> AUC:  0.684}
\CommentTok{#> pr_auc:  0.329}
\CommentTok{#> Gini:  0.368}
\CommentTok{#> }
\CommentTok{#> Confusion Matrix (vertical: actual; across: predicted) for F1-optimal threshold:}
\CommentTok{#>            0    1    Error         Rate}
\CommentTok{#> 0      13661 6330 0.316642  =6330/19991}
\CommentTok{#> 1       1918 2672 0.417865   =1918/4590}
\CommentTok{#> Totals 15579 9002 0.335544  =8248/24581}
\CommentTok{#> }
\CommentTok{#> Maximum Metrics: Maximum metrics at their respective thresholds}
\CommentTok{#>                         metric threshold    value idx}
\CommentTok{#> 1                       max f1  0.189615 0.393172 234}
\CommentTok{#> 2                       max f2  0.096969 0.558918 333}
\CommentTok{#> 3                 max f0point5  0.278776 0.359560 160}
\CommentTok{#> 4                 max accuracy  0.521287 0.814287  37}
\CommentTok{#> 5                max precision  0.901295 1.000000   0}
\CommentTok{#> 6                   max recall  0.018504 1.000000 398}
\CommentTok{#> 7              max specificity  0.901295 1.000000   0}
\CommentTok{#> 8             max absolute_mcc  0.231089 0.217255 196}
\CommentTok{#> 9   max min_per_class_accuracy  0.174914 0.630834 249}
\CommentTok{#> 10 max mean_per_class_accuracy  0.156944 0.633792 267}
\CommentTok{#> }
\CommentTok{#> Gains/Lift Table: Extract with `h2o.gainsLift(<model>, <data>)` or `h2o.gainsLift(<model>, valid=<T/F>, xval=<T/F>)`}
\NormalTok{gbm_perf3}
\CommentTok{#> H2OBinomialMetrics: gbm}
\CommentTok{#> }
\CommentTok{#> MSE:  0.141}
\CommentTok{#> RMSE:  0.376}
\CommentTok{#> LogLoss:  0.448}
\CommentTok{#> Mean Per-Class Error:  0.367}
\CommentTok{#> AUC:  0.684}
\CommentTok{#> pr_auc:  0.331}
\CommentTok{#> Gini:  0.369}
\CommentTok{#> }
\CommentTok{#> Confusion Matrix (vertical: actual; across: predicted) for F1-optimal threshold:}
\CommentTok{#>            0    1    Error         Rate}
\CommentTok{#> 0      13652 6339 0.317093  =6339/19991}
\CommentTok{#> 1       1917 2673 0.417647   =1917/4590}
\CommentTok{#> Totals 15569 9012 0.335869  =8256/24581}
\CommentTok{#> }
\CommentTok{#> Maximum Metrics: Maximum metrics at their respective thresholds}
\CommentTok{#>                         metric threshold    value idx}
\CommentTok{#> 1                       max f1  0.189870 0.393030 234}
\CommentTok{#> 2                       max f2  0.109837 0.559580 321}
\CommentTok{#> 3                 max f0point5  0.294571 0.356508 148}
\CommentTok{#> 4                 max accuracy  0.510869 0.814572  40}
\CommentTok{#> 5                max precision  0.797620 1.000000   0}
\CommentTok{#> 6                   max recall  0.026373 1.000000 397}
\CommentTok{#> 7              max specificity  0.797620 1.000000   0}
\CommentTok{#> 8             max absolute_mcc  0.231530 0.218255 197}
\CommentTok{#> 9   max min_per_class_accuracy  0.176566 0.631808 248}
\CommentTok{#> 10 max mean_per_class_accuracy  0.175468 0.633400 249}
\CommentTok{#> }
\CommentTok{#> Gains/Lift Table: Extract with `h2o.gainsLift(<model>, <data>)` or `h2o.gainsLift(<model>, valid=<T/F>, xval=<T/F>)`}

\CommentTok{# Retreive test set AUC}
\KeywordTok{h2o.auc}\NormalTok{(gbm_perf1)  }\CommentTok{# 0.682765594191}
\CommentTok{#> [1] 0.684}
\KeywordTok{h2o.auc}\NormalTok{(gbm_perf2)  }\CommentTok{# 0.671854616713}
\CommentTok{#> [1] 0.684}
\KeywordTok{h2o.auc}\NormalTok{(gbm_perf3)  }\CommentTok{# 0.68309902855}
\CommentTok{#> [1] 0.684}
\end{Highlighting}
\end{Shaded}

To examine the scoring history, use the \texttt{scoring\_history} method on a trained model.
If \texttt{score\_tree\_interval} is not specified, it will score at various intervals, as we can
see for \texttt{h2o.scoreHistory()} below. However, regular 5-tree intervals are used
for \texttt{h2o.scoreHistory()}.
The \texttt{gbm\_fit2} was trained only using a training set (no validation set), so the scoring
history is calculated for training set performance metrics only.

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{h2o.scoreHistory}\NormalTok{(gbm_fit2)}
\CommentTok{#> Scoring History: }
\CommentTok{#>             timestamp   duration number_of_trees training_rmse}
\CommentTok{#> 1 2019-09-18 13:26:39  0.009 sec               0       0.38563}
\CommentTok{#> 2 2019-09-18 13:26:39  0.156 sec               1       0.38370}
\CommentTok{#> 3 2019-09-18 13:26:39  0.207 sec               2       0.38206}
\CommentTok{#> 4 2019-09-18 13:26:39  0.277 sec               3       0.38069}
\CommentTok{#> 5 2019-09-18 13:26:39  0.357 sec               4       0.37954}
\CommentTok{#>   training_logloss training_auc training_pr_auc training_lift}
\CommentTok{#> 1          0.47403      0.50000         0.00000       1.00000}
\CommentTok{#> 2          0.46913      0.65779         0.30174       2.68330}
\CommentTok{#> 3          0.46512      0.66583         0.31164       2.79399}
\CommentTok{#> 4          0.46184      0.66851         0.31500       2.97100}
\CommentTok{#> 5          0.45912      0.67011         0.31822       2.97544}
\CommentTok{#>   training_classification_error}
\CommentTok{#> 1                       0.81825}
\CommentTok{#> 2                       0.40069}
\CommentTok{#> 3                       0.33325}
\CommentTok{#> 4                       0.34475}
\CommentTok{#> 5                       0.33180}
\CommentTok{#> }
\CommentTok{#> ---}
\CommentTok{#>              timestamp   duration number_of_trees training_rmse}
\CommentTok{#> 37 2019-09-18 13:26:42  3.660 sec              36       0.36864}
\CommentTok{#> 38 2019-09-18 13:26:43  3.825 sec              37       0.36849}
\CommentTok{#> 39 2019-09-18 13:26:43  3.951 sec              38       0.36834}
\CommentTok{#> 40 2019-09-18 13:26:47  7.990 sec             116       0.36240}
\CommentTok{#> 41 2019-09-18 13:26:51 12.012 sec             404       0.36129}
\CommentTok{#> 42 2019-09-18 13:26:52 13.455 sec             500       0.36129}
\CommentTok{#>    training_logloss training_auc training_pr_auc training_lift}
\CommentTok{#> 37          0.43381      0.70801         0.36444       3.55969}
\CommentTok{#> 38          0.43345      0.70872         0.36547       3.58361}
\CommentTok{#> 39          0.43311      0.70955         0.36656       3.56447}
\CommentTok{#> 40          0.42008      0.73512         0.41026       4.12426}
\CommentTok{#> 41          0.41770      0.74024         0.41866       4.25823}
\CommentTok{#> 42          0.41770      0.74024         0.41866       4.25823}
\CommentTok{#>    training_classification_error}
\CommentTok{#> 37                       0.29517}
\CommentTok{#> 38                       0.29555}
\CommentTok{#> 39                       0.29962}
\CommentTok{#> 40                       0.27824}
\CommentTok{#> 41                       0.25719}
\CommentTok{#> 42                       0.25719}
\end{Highlighting}
\end{Shaded}

When early stopping is used, we see that training stopped at 105 trees instead of the full 500. Since we used a validation set in \texttt{gbm\_fit3}, both training and validation performance metrics are stored in the scoring history object. Take a look at the validation AUC to observe that the correct stopping tolerance was enforced.

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{h2o.scoreHistory}\NormalTok{(gbm_fit3)}
\CommentTok{#> Scoring History: }
\CommentTok{#>              timestamp   duration number_of_trees training_rmse}
\CommentTok{#> 1  2019-09-18 13:26:53  0.005 sec               0       0.38563}
\CommentTok{#> 2  2019-09-18 13:26:54  0.435 sec               5       0.37853}
\CommentTok{#> 3  2019-09-18 13:26:54  0.840 sec              10       0.37508}
\CommentTok{#> 4  2019-09-18 13:26:55  1.215 sec              15       0.37307}
\CommentTok{#> 5  2019-09-18 13:26:55  1.803 sec              20       0.37152}
\CommentTok{#> 6  2019-09-18 13:26:56  2.441 sec              25       0.37041}
\CommentTok{#> 7  2019-09-18 13:26:56  2.751 sec              30       0.36947}
\CommentTok{#> 8  2019-09-18 13:26:57  3.107 sec              35       0.36877}
\CommentTok{#> 9  2019-09-18 13:26:57  3.415 sec              40       0.36808}
\CommentTok{#> 10 2019-09-18 13:26:57  3.787 sec              45       0.36748}
\CommentTok{#> 11 2019-09-18 13:26:58  4.157 sec              50       0.36699}
\CommentTok{#> 12 2019-09-18 13:26:58  4.503 sec              55       0.36651}
\CommentTok{#> 13 2019-09-18 13:26:58  4.839 sec              60       0.36607}
\CommentTok{#> 14 2019-09-18 13:26:59  5.159 sec              65       0.36574}
\CommentTok{#> 15 2019-09-18 13:26:59  5.501 sec              70       0.36531}
\CommentTok{#> 16 2019-09-18 13:26:59  5.794 sec              75       0.36503}
\CommentTok{#> 17 2019-09-18 13:27:00  6.243 sec              80       0.36460}
\CommentTok{#> 18 2019-09-18 13:27:00  6.537 sec              85       0.36426}
\CommentTok{#> 19 2019-09-18 13:27:00  6.839 sec              90       0.36394}
\CommentTok{#> 20 2019-09-18 13:27:01  7.128 sec              95       0.36362}
\CommentTok{#>    training_logloss training_auc training_pr_auc training_lift}
\CommentTok{#> 1           0.47403      0.50000         0.00000       1.00000}
\CommentTok{#> 2           0.45676      0.67362         0.32194       3.04518}
\CommentTok{#> 3           0.44884      0.68117         0.33330       3.19128}
\CommentTok{#> 4           0.44424      0.68708         0.34105       3.30132}
\CommentTok{#> 5           0.44060      0.69498         0.34930       3.46878}
\CommentTok{#> 6           0.43800      0.69983         0.35479       3.47356}
\CommentTok{#> 7           0.43578      0.70425         0.36014       3.48792}
\CommentTok{#> 8           0.43410      0.70746         0.36373       3.53576}
\CommentTok{#> 9           0.43252      0.71082         0.36837       3.61710}
\CommentTok{#> 10          0.43116      0.71346         0.37174       3.66495}
\CommentTok{#> 11          0.43002      0.71568         0.37493       3.66016}
\CommentTok{#> 12          0.42899      0.71765         0.37852       3.70801}
\CommentTok{#> 13          0.42801      0.71953         0.38157       3.73193}
\CommentTok{#> 14          0.42726      0.72093         0.38411       3.78934}
\CommentTok{#> 15          0.42632      0.72277         0.38733       3.82762}
\CommentTok{#> 16          0.42572      0.72396         0.38955       3.85154}
\CommentTok{#> 17          0.42477      0.72596         0.39282       3.95202}
\CommentTok{#> 18          0.42407      0.72713         0.39550       3.99508}
\CommentTok{#> 19          0.42338      0.72852         0.39819       4.02857}
\CommentTok{#> 20          0.42272      0.72984         0.40069       4.02378}
\CommentTok{#>    training_classification_error validation_rmse validation_logloss}
\CommentTok{#> 1                        0.81825         0.38864            0.47953}
\CommentTok{#> 2                        0.32117         0.38233            0.46398}
\CommentTok{#> 3                        0.32202         0.37958            0.45742}
\CommentTok{#> 4                        0.32027         0.37828            0.45428}
\CommentTok{#> 5                        0.33371         0.37739            0.45210}
\CommentTok{#> 6                        0.32537         0.37676            0.45053}
\CommentTok{#> 7                        0.29722         0.37636            0.44949}
\CommentTok{#> 8                        0.29544         0.37604            0.44866}
\CommentTok{#> 9                        0.28871         0.37587            0.44818}
\CommentTok{#> 10                       0.30181         0.37574            0.44781}
\CommentTok{#> 11                       0.30179         0.37560            0.44744}
\CommentTok{#> 12                       0.29464         0.37552            0.44718}
\CommentTok{#> 13                       0.30343         0.37547            0.44703}
\CommentTok{#> 14                       0.28692         0.37543            0.44694}
\CommentTok{#> 15                       0.28579         0.37536            0.44676}
\CommentTok{#> 16                       0.26903         0.37536            0.44673}
\CommentTok{#> 17                       0.28476         0.37534            0.44664}
\CommentTok{#> 18                       0.26950         0.37537            0.44671}
\CommentTok{#> 19                       0.27036         0.37538            0.44671}
\CommentTok{#> 20                       0.26573         0.37540            0.44673}
\CommentTok{#>    validation_auc validation_pr_auc validation_lift}
\CommentTok{#> 1         0.50000           0.00000         1.00000}
\CommentTok{#> 2         0.66168           0.30421         2.75098}
\CommentTok{#> 3         0.66767           0.30959         2.68582}
\CommentTok{#> 4         0.67061           0.31287         2.70784}
\CommentTok{#> 5         0.67426           0.31757         2.79590}
\CommentTok{#> 6         0.67685           0.32121         2.99403}
\CommentTok{#> 7         0.67866           0.32312         2.97202}
\CommentTok{#> 8         0.68006           0.32477         3.03806}
\CommentTok{#> 9         0.68113           0.32493         2.90597}
\CommentTok{#> 10        0.68183           0.32549         2.88396}
\CommentTok{#> 11        0.68251           0.32659         2.86194}
\CommentTok{#> 12        0.68326           0.32626         2.86194}
\CommentTok{#> 13        0.68354           0.32686         2.88396}
\CommentTok{#> 14        0.68364           0.32705         2.83993}
\CommentTok{#> 15        0.68405           0.32754         2.97202}
\CommentTok{#> 16        0.68423           0.32747         2.88396}
\CommentTok{#> 17        0.68454           0.32735         2.86194}
\CommentTok{#> 18        0.68431           0.32727         2.83993}
\CommentTok{#> 19        0.68434           0.32718         2.95000}
\CommentTok{#> 20        0.68436           0.32678         2.92799}
\CommentTok{#>    validation_classification_error}
\CommentTok{#> 1                          0.81460}
\CommentTok{#> 2                          0.35387}
\CommentTok{#> 3                          0.35285}
\CommentTok{#> 4                          0.39028}
\CommentTok{#> 5                          0.36770}
\CommentTok{#> 6                          0.35240}
\CommentTok{#> 7                          0.34848}
\CommentTok{#> 8                          0.34386}
\CommentTok{#> 9                          0.34807}
\CommentTok{#> 10                         0.38681}
\CommentTok{#> 11                         0.33774}
\CommentTok{#> 12                         0.34215}
\CommentTok{#> 13                         0.34431}
\CommentTok{#> 14                         0.34146}
\CommentTok{#> 15                         0.34329}
\CommentTok{#> 16                         0.33872}
\CommentTok{#> 17                         0.34276}
\CommentTok{#> 18                         0.34256}
\CommentTok{#> 19                         0.34289}
\CommentTok{#> 20                         0.35097}
\end{Highlighting}
\end{Shaded}

Look at scoring history for third GBM model

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# Look at scoring history for third GBM model}
\KeywordTok{plot}\NormalTok{(gbm_fit3, }
     \DataTypeTok{timestep =} \StringTok{"number_of_trees"}\NormalTok{, }
     \DataTypeTok{metric =} \StringTok{"AUC"}\NormalTok{)}
\KeywordTok{plot}\NormalTok{(gbm_fit3, }
     \DataTypeTok{timestep =} \StringTok{"number_of_trees"}\NormalTok{, }
     \DataTypeTok{metric =} \StringTok{"logloss"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{center}\includegraphics[width=0.7\linewidth]{classification_907-bad_loans-h2o_files/figure-latex/plot-gbm-fit3-1} \includegraphics[width=0.7\linewidth]{classification_907-bad_loans-h2o_files/figure-latex/plot-gbm-fit3-2} \end{center}

\hypertarget{deep-learning}{%
\section{Deep Learning}\label{deep-learning}}

H2O's Deep Learning algorithm is a multilayer feed-forward artificial neural network.
It can also be used to train an autoencoder. In this example we will train
a standard supervised prediction model.

\hypertarget{train-a-default-dl}{%
\subsection{Train a default DL}\label{train-a-default-dl}}

First we will train a basic DL model with default parameters. The DL model will infer the response distribution from the response encoding if it is not specified explicitly through the \texttt{distribution} argument. H2O's DL will not be reproducible if it is run on more than a single core, so in this example, the performance metrics below may vary slightly from what you see on your machine.
In H2O's DL, early stopping is enabled by default, so below, it will use the training set and default stopping parameters to perform early stopping.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{dl_fit1 <-}\StringTok{ }\KeywordTok{h2o.deeplearning}\NormalTok{(}\DataTypeTok{x =}\NormalTok{ x,}
                            \DataTypeTok{y =}\NormalTok{ y,}
                            \DataTypeTok{training_frame =}\NormalTok{ train,}
                            \DataTypeTok{model_id =} \StringTok{"dl_fit1"}\NormalTok{,}
                            \DataTypeTok{seed =} \DecValTok{1}\NormalTok{)}
\CommentTok{#> }
  \OperatorTok{|}\StringTok{                                                                       }
\StringTok{  }\ErrorTok{|}\StringTok{                                                                 }\ErrorTok{|}\StringTok{   }\DecValTok{0}\NormalTok{%}
  \OperatorTok{|}\StringTok{                                                                       }
\StringTok{  }\ErrorTok{|=====}\StringTok{                                                            }\ErrorTok{|}\StringTok{   }\DecValTok{7}\NormalTok{%}
  \OperatorTok{|}\StringTok{                                                                       }
\StringTok{  }\ErrorTok{|=========}\StringTok{                                                        }\ErrorTok{|}\StringTok{  }\DecValTok{14}\NormalTok{%}
  \OperatorTok{|}\StringTok{                                                                       }
\StringTok{  }\ErrorTok{|==============}\StringTok{                                                   }\ErrorTok{|}\StringTok{  }\DecValTok{22}\NormalTok{%}
  \OperatorTok{|}\StringTok{                                                                       }
\StringTok{  }\ErrorTok{|===================}\StringTok{                                              }\ErrorTok{|}\StringTok{  }\DecValTok{29}\NormalTok{%}
  \OperatorTok{|}\StringTok{                                                                       }
\StringTok{  }\ErrorTok{|=======================}\StringTok{                                          }\ErrorTok{|}\StringTok{  }\DecValTok{36}\NormalTok{%}
  \OperatorTok{|}\StringTok{                                                                       }
\StringTok{  }\ErrorTok{|============================}\StringTok{                                     }\ErrorTok{|}\StringTok{  }\DecValTok{43}\NormalTok{%}
  \OperatorTok{|}\StringTok{                                                                       }
\StringTok{  }\ErrorTok{|=================================}\StringTok{                                }\ErrorTok{|}\StringTok{  }\DecValTok{50}\NormalTok{%}
  \OperatorTok{|}\StringTok{                                                                       }
\StringTok{  }\ErrorTok{|======================================}\StringTok{                           }\ErrorTok{|}\StringTok{  }\DecValTok{58}\NormalTok{%}
  \OperatorTok{|}\StringTok{                                                                       }
\StringTok{  }\ErrorTok{|==========================================}\StringTok{                       }\ErrorTok{|}\StringTok{  }\DecValTok{65}\NormalTok{%}
  \OperatorTok{|}\StringTok{                                                                       }
\StringTok{  }\ErrorTok{|===============================================}\StringTok{                  }\ErrorTok{|}\StringTok{  }\DecValTok{72}\NormalTok{%}
  \OperatorTok{|}\StringTok{                                                                       }
\StringTok{  }\ErrorTok{|====================================================}\StringTok{             }\ErrorTok{|}\StringTok{  }\DecValTok{79}\NormalTok{%}
  \OperatorTok{|}\StringTok{                                                                       }
\StringTok{  }\ErrorTok{|========================================================}\StringTok{         }\ErrorTok{|}\StringTok{  }\DecValTok{87}\NormalTok{%}
  \OperatorTok{|}\StringTok{                                                                       }
\StringTok{  }\ErrorTok{|=============================================================}\StringTok{    }\ErrorTok{|}\StringTok{  }\DecValTok{94}\NormalTok{%}
  \OperatorTok{|}\StringTok{                                                                       }
\StringTok{  }\ErrorTok{|=================================================================|}\StringTok{ }\DecValTok{100}\NormalTok{%}
\end{Highlighting}
\end{Shaded}

\hypertarget{train-a-dl-with-new-architecture-and-more-epochs.}{%
\subsection{Train a DL with new architecture and more epochs.}\label{train-a-dl-with-new-architecture-and-more-epochs.}}

Next we will increase the number of epochs used in the GBM by setting \texttt{epochs=20} (the default is 10).
Increasing the number of epochs in a deep neural net may increase performance of the model, however, you have to be careful not to overfit your model to your training data. To automatically find the optimal number of epochs, you must use H2O's early stopping functionality. Unlike the rest of the H2O algorithms, H2O's DL will use early stopping by default, so for comparison we will first turn off early stopping. We do this in the next example by setting \texttt{stopping\_rounds=0}.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{dl_fit2 <-}\StringTok{ }\KeywordTok{h2o.deeplearning}\NormalTok{(}\DataTypeTok{x =}\NormalTok{ x,}
                            \DataTypeTok{y =}\NormalTok{ y,}
                            \DataTypeTok{training_frame =}\NormalTok{ train,}
                            \DataTypeTok{model_id =} \StringTok{"dl_fit2"}\NormalTok{,}
                            \CommentTok{#validation_frame = valid,  #only used if stopping_rounds > 0}
                            \DataTypeTok{epochs =} \DecValTok{20}\NormalTok{,}
                            \DataTypeTok{hidden=} \KeywordTok{c}\NormalTok{(}\DecValTok{10}\NormalTok{,}\DecValTok{10}\NormalTok{),}
                            \DataTypeTok{stopping_rounds =} \DecValTok{0}\NormalTok{,  }\CommentTok{# disable early stopping}
                            \DataTypeTok{seed =} \DecValTok{1}\NormalTok{)}
\CommentTok{#> }
  \OperatorTok{|}\StringTok{                                                                       }
\StringTok{  }\ErrorTok{|}\StringTok{                                                                 }\ErrorTok{|}\StringTok{   }\DecValTok{0}\NormalTok{%}
  \OperatorTok{|}\StringTok{                                                                       }
\StringTok{  }\ErrorTok{|===========}\StringTok{                                                      }\ErrorTok{|}\StringTok{  }\DecValTok{17}\NormalTok{%}
  \OperatorTok{|}\StringTok{                                                                       }
\StringTok{  }\ErrorTok{|=======================}\StringTok{                                          }\ErrorTok{|}\StringTok{  }\DecValTok{35}\NormalTok{%}
  \OperatorTok{|}\StringTok{                                                                       }
\StringTok{  }\ErrorTok{|=====================================}\StringTok{                            }\ErrorTok{|}\StringTok{  }\DecValTok{57}\NormalTok{%}
  \OperatorTok{|}\StringTok{                                                                       }
\StringTok{  }\ErrorTok{|======================================================}\StringTok{           }\ErrorTok{|}\StringTok{  }\DecValTok{83}\NormalTok{%}
  \OperatorTok{|}\StringTok{                                                                       }
\StringTok{  }\ErrorTok{|=================================================================|}\StringTok{ }\DecValTok{100}\NormalTok{%}
\end{Highlighting}
\end{Shaded}

\hypertarget{train-a-dl-with-early-stopping}{%
\subsection{Train a DL with early stopping}\label{train-a-dl-with-early-stopping}}

This example will use the same model parameters as \texttt{dl\_fit2}. This time, we will turn on
early stopping and specify the stopping criterion. We will also pass a validation set, as is recommended for early stopping.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{dl_fit3 <-}\StringTok{ }\KeywordTok{h2o.deeplearning}\NormalTok{(}\DataTypeTok{x =}\NormalTok{ x,}
                            \DataTypeTok{y =}\NormalTok{ y,}
                            \DataTypeTok{training_frame =}\NormalTok{ train,}
                            \DataTypeTok{model_id =} \StringTok{"dl_fit3"}\NormalTok{,}
                            \DataTypeTok{validation_frame =}\NormalTok{ valid,  }\CommentTok{#in DL, early stopping is on by default}
                            \DataTypeTok{epochs =} \DecValTok{20}\NormalTok{,}
                            \DataTypeTok{hidden =} \KeywordTok{c}\NormalTok{(}\DecValTok{10}\NormalTok{,}\DecValTok{10}\NormalTok{),}
                            \DataTypeTok{score_interval =} \DecValTok{1}\NormalTok{,           }\CommentTok{#used for early stopping}
                            \DataTypeTok{stopping_rounds =} \DecValTok{3}\NormalTok{,          }\CommentTok{#used for early stopping}
                            \DataTypeTok{stopping_metric =} \StringTok{"AUC"}\NormalTok{,      }\CommentTok{#used for early stopping}
                            \DataTypeTok{stopping_tolerance =} \FloatTok{0.0005}\NormalTok{,  }\CommentTok{#used for early stopping}
                            \DataTypeTok{seed =} \DecValTok{1}\NormalTok{)}
\CommentTok{#> }
  \OperatorTok{|}\StringTok{                                                                       }
\StringTok{  }\ErrorTok{|}\StringTok{                                                                 }\ErrorTok{|}\StringTok{   }\DecValTok{0}\NormalTok{%}
  \OperatorTok{|}\StringTok{                                                                       }
\StringTok{  }\ErrorTok{|========}\StringTok{                                                         }\ErrorTok{|}\StringTok{  }\DecValTok{13}\NormalTok{%}
  \OperatorTok{|}\StringTok{                                                                       }
\StringTok{  }\ErrorTok{|=======================}\StringTok{                                          }\ErrorTok{|}\StringTok{  }\DecValTok{35}\NormalTok{%}
  \OperatorTok{|}\StringTok{                                                                       }
\StringTok{  }\ErrorTok{|========================================}\StringTok{                         }\ErrorTok{|}\StringTok{  }\DecValTok{61}\NormalTok{%}
  \OperatorTok{|}\StringTok{                                                                       }
\StringTok{  }\ErrorTok{|======================================================}\StringTok{           }\ErrorTok{|}\StringTok{  }\DecValTok{83}\NormalTok{%}
  \OperatorTok{|}\StringTok{                                                                       }
\StringTok{  }\ErrorTok{|=================================================================|}\StringTok{ }\DecValTok{100}\NormalTok{%}
\end{Highlighting}
\end{Shaded}

Let's compare the performance of the three DL models

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# Let's compare the performance of the three DL models}
\NormalTok{dl_perf1 <-}\StringTok{ }\KeywordTok{h2o.performance}\NormalTok{(}\DataTypeTok{model =}\NormalTok{ dl_fit1,}
                            \DataTypeTok{newdata =}\NormalTok{ test)}
\NormalTok{dl_perf2 <-}\StringTok{ }\KeywordTok{h2o.performance}\NormalTok{(}\DataTypeTok{model =}\NormalTok{ dl_fit2,}
                            \DataTypeTok{newdata =}\NormalTok{ test)}
\NormalTok{dl_perf3 <-}\StringTok{ }\KeywordTok{h2o.performance}\NormalTok{(}\DataTypeTok{model =}\NormalTok{ dl_fit3,}
                            \DataTypeTok{newdata =}\NormalTok{ test)}

\CommentTok{# Print model performance}
\NormalTok{dl_perf1}
\CommentTok{#> H2OBinomialMetrics: deeplearning}
\CommentTok{#> }
\CommentTok{#> MSE:  0.142}
\CommentTok{#> RMSE:  0.377}
\CommentTok{#> LogLoss:  0.453}
\CommentTok{#> Mean Per-Class Error:  0.368}
\CommentTok{#> AUC:  0.68}
\CommentTok{#> pr_auc:  0.328}
\CommentTok{#> Gini:  0.361}
\CommentTok{#> }
\CommentTok{#> Confusion Matrix (vertical: actual; across: predicted) for F1-optimal threshold:}
\CommentTok{#>            0     1    Error         Rate}
\CommentTok{#> 0      12340  7651 0.382722  =7651/19991}
\CommentTok{#> 1       1619  2971 0.352723   =1619/4590}
\CommentTok{#> Totals 13959 10622 0.377121  =9270/24581}
\CommentTok{#> }
\CommentTok{#> Maximum Metrics: Maximum metrics at their respective thresholds}
\CommentTok{#>                         metric threshold    value idx}
\CommentTok{#> 1                       max f1  0.160846 0.390613 242}
\CommentTok{#> 2                       max f2  0.089911 0.557712 319}
\CommentTok{#> 3                 max f0point5  0.260368 0.358963 155}
\CommentTok{#> 4                 max accuracy  0.451630 0.814165  48}
\CommentTok{#> 5                max precision  0.916585 1.000000   0}
\CommentTok{#> 6                   max recall  0.001856 1.000000 399}
\CommentTok{#> 7              max specificity  0.916585 1.000000   0}
\CommentTok{#> 8             max absolute_mcc  0.203948 0.214742 204}
\CommentTok{#> 9   max min_per_class_accuracy  0.164615 0.629194 238}
\CommentTok{#> 10 max mean_per_class_accuracy  0.160846 0.632277 242}
\CommentTok{#> }
\CommentTok{#> Gains/Lift Table: Extract with `h2o.gainsLift(<model>, <data>)` or `h2o.gainsLift(<model>, valid=<T/F>, xval=<T/F>)`}
\NormalTok{dl_perf2}
\CommentTok{#> H2OBinomialMetrics: deeplearning}
\CommentTok{#> }
\CommentTok{#> MSE:  0.142}
\CommentTok{#> RMSE:  0.377}
\CommentTok{#> LogLoss:  0.451}
\CommentTok{#> Mean Per-Class Error:  0.371}
\CommentTok{#> AUC:  0.678}
\CommentTok{#> pr_auc:  0.323}
\CommentTok{#> Gini:  0.356}
\CommentTok{#> }
\CommentTok{#> Confusion Matrix (vertical: actual; across: predicted) for F1-optimal threshold:}
\CommentTok{#>            0     1    Error         Rate}
\CommentTok{#> 0      11963  8028 0.401581  =8028/19991}
\CommentTok{#> 1       1563  3027 0.340523   =1563/4590}
\CommentTok{#> Totals 13526 11055 0.390179  =9591/24581}
\CommentTok{#> }
\CommentTok{#> Maximum Metrics: Maximum metrics at their respective thresholds}
\CommentTok{#>                         metric threshold    value idx}
\CommentTok{#> 1                       max f1  0.174451 0.386961 239}
\CommentTok{#> 2                       max f2  0.108823 0.557393 311}
\CommentTok{#> 3                 max f0point5  0.264272 0.354205 156}
\CommentTok{#> 4                 max accuracy  0.496031 0.813799  29}
\CommentTok{#> 5                max precision  0.630382 0.714286   5}
\CommentTok{#> 6                   max recall  0.008995 1.000000 397}
\CommentTok{#> 7              max specificity  0.703701 0.999950   0}
\CommentTok{#> 8             max absolute_mcc  0.223873 0.207801 190}
\CommentTok{#> 9   max min_per_class_accuracy  0.182983 0.626362 230}
\CommentTok{#> 10 max mean_per_class_accuracy  0.174451 0.628948 239}
\CommentTok{#> }
\CommentTok{#> Gains/Lift Table: Extract with `h2o.gainsLift(<model>, <data>)` or `h2o.gainsLift(<model>, valid=<T/F>, xval=<T/F>)`}
\NormalTok{dl_perf3}
\CommentTok{#> H2OBinomialMetrics: deeplearning}
\CommentTok{#> }
\CommentTok{#> MSE:  0.142}
\CommentTok{#> RMSE:  0.377}
\CommentTok{#> LogLoss:  0.45}
\CommentTok{#> Mean Per-Class Error:  0.369}
\CommentTok{#> AUC:  0.68}
\CommentTok{#> pr_auc:  0.331}
\CommentTok{#> Gini:  0.36}
\CommentTok{#> }
\CommentTok{#> Confusion Matrix (vertical: actual; across: predicted) for F1-optimal threshold:}
\CommentTok{#>            0    1    Error         Rate}
\CommentTok{#> 0      13127 6864 0.343355  =6864/19991}
\CommentTok{#> 1       1808 2782 0.393900   =1808/4590}
\CommentTok{#> Totals 14935 9646 0.352793  =8672/24581}
\CommentTok{#> }
\CommentTok{#> Maximum Metrics: Maximum metrics at their respective thresholds}
\CommentTok{#>                         metric threshold    value idx}
\CommentTok{#> 1                       max f1  0.213309 0.390840 211}
\CommentTok{#> 2                       max f2  0.115230 0.556916 307}
\CommentTok{#> 3                 max f0point5  0.315823 0.355585 130}
\CommentTok{#> 4                 max accuracy  0.548601 0.814694  25}
\CommentTok{#> 5                max precision  0.669774 0.750000   2}
\CommentTok{#> 6                   max recall  0.005888 1.000000 398}
\CommentTok{#> 7              max specificity  0.762541 0.999950   0}
\CommentTok{#> 8             max absolute_mcc  0.228065 0.210358 199}
\CommentTok{#> 9   max min_per_class_accuracy  0.204577 0.628433 218}
\CommentTok{#> 10 max mean_per_class_accuracy  0.213309 0.631373 211}
\CommentTok{#> }
\CommentTok{#> Gains/Lift Table: Extract with `h2o.gainsLift(<model>, <data>)` or `h2o.gainsLift(<model>, valid=<T/F>, xval=<T/F>)`}

\CommentTok{# Retreive test set AUC}
\KeywordTok{h2o.auc}\NormalTok{(dl_perf1)  }\CommentTok{# 0.6774335}
\CommentTok{#> [1] 0.68}
\KeywordTok{h2o.auc}\NormalTok{(dl_perf2)  }\CommentTok{# 0.678446}
\CommentTok{#> [1] 0.678}
\KeywordTok{h2o.auc}\NormalTok{(dl_perf3)  }\CommentTok{# 0.6770498}
\CommentTok{#> [1] 0.68}
\end{Highlighting}
\end{Shaded}

Look at scoring history for third DL model

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# Look at scoring history for third DL model}
\KeywordTok{plot}\NormalTok{(dl_fit3, }
     \DataTypeTok{timestep =} \StringTok{"epochs"}\NormalTok{, }
     \DataTypeTok{metric =} \StringTok{"AUC"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{center}\includegraphics[width=0.7\linewidth]{classification_907-bad_loans-h2o_files/figure-latex/unnamed-chunk-15-1} \end{center}

\hypertarget{scoring-history}{%
\subsection{Scoring history}\label{scoring-history}}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# Scoring history}
\KeywordTok{h2o.scoreHistory}\NormalTok{(dl_fit3)}
\CommentTok{#> Scoring History: }
\CommentTok{#>             timestamp   duration training_speed   epochs iterations}
\CommentTok{#> 1 2019-09-18 13:27:52  0.000 sec             NA  0.00000          0}
\CommentTok{#> 2 2019-09-18 13:27:52  0.481 sec 270981 obs/sec  0.87019          1}
\CommentTok{#> 3 2019-09-18 13:27:53  1.515 sec 379657 obs/sec  4.35139          5}
\CommentTok{#> 4 2019-09-18 13:27:54  2.520 sec 446895 obs/sec  8.70006         10}
\CommentTok{#> 5 2019-09-18 13:27:55  3.609 sec 493255 obs/sec 13.92523         16}
\CommentTok{#> 6 2019-09-18 13:27:56  4.640 sec 525771 obs/sec 19.14884         22}
\CommentTok{#> 7 2019-09-18 13:27:56  4.882 sec 531737 obs/sec 20.01859         23}
\CommentTok{#>          samples training_rmse training_logloss training_r2 training_auc}
\CommentTok{#> 1       0.000000            NA               NA          NA           NA}
\CommentTok{#> 2   99992.000000       0.38629          0.48694     0.01270      0.65923}
\CommentTok{#> 3  500009.000000       0.37744          0.45198     0.05740      0.67180}
\CommentTok{#> 4  999706.000000       0.37667          0.45021     0.06126      0.67662}
\CommentTok{#> 5 1600120.000000       0.37650          0.44937     0.06212      0.67740}
\CommentTok{#> 6 2200355.000000       0.37782          0.45380     0.05550      0.67459}
\CommentTok{#> 7 2300296.000000       0.37637          0.44942     0.06276      0.67954}
\CommentTok{#>   training_pr_auc training_lift training_classification_error}
\CommentTok{#> 1              NA            NA                            NA}
\CommentTok{#> 2         0.30388       2.66706                       0.36701}
\CommentTok{#> 3         0.31138       2.39491                       0.35558}
\CommentTok{#> 4         0.32077       2.83035                       0.35528}
\CommentTok{#> 5         0.32044       2.72149                       0.34122}
\CommentTok{#> 6         0.31749       3.04807                       0.41970}
\CommentTok{#> 7         0.32694       3.04807                       0.36863}
\CommentTok{#>   validation_rmse validation_logloss validation_r2 validation_auc}
\CommentTok{#> 1              NA                 NA            NA             NA}
\CommentTok{#> 2         0.38590            0.48541       0.01399        0.66299}
\CommentTok{#> 3         0.37698            0.45096       0.05904        0.67397}
\CommentTok{#> 4         0.37650            0.45014       0.06143        0.67749}
\CommentTok{#> 5         0.37640            0.44951       0.06191        0.67729}
\CommentTok{#> 6         0.37780            0.45375       0.05493        0.67476}
\CommentTok{#> 7         0.37644            0.44997       0.06172        0.67884}
\CommentTok{#>   validation_pr_auc validation_lift validation_classification_error}
\CommentTok{#> 1                NA              NA                              NA}
\CommentTok{#> 2           0.30441         2.61978                         0.38591}
\CommentTok{#> 3           0.31460         2.55373                         0.36354}
\CommentTok{#> 4           0.31899         2.57575                         0.35754}
\CommentTok{#> 5           0.31988         2.64179                         0.36117}
\CommentTok{#> 6           0.31464         2.59776                         0.35934}
\CommentTok{#> 7           0.32263         2.86194                         0.34954}
\CommentTok{# Scoring History: }
\CommentTok{#   timestamp   duration  training_speed   epochs}
\CommentTok{# 1 2016-05-03 10:33:29  0.000 sec                  0.00000}
\CommentTok{# 2 2016-05-03 10:33:29  0.347 sec 424697 rows/sec  0.86851}
\CommentTok{# 3 2016-05-03 10:33:30  1.356 sec 601925 rows/sec  6.09185}
\CommentTok{# 4 2016-05-03 10:33:31  2.348 sec 717617 rows/sec 13.05168}
\CommentTok{# 5 2016-05-03 10:33:32  3.281 sec 777538 rows/sec 20.00783}
\CommentTok{# 6 2016-05-03 10:33:32  3.345 sec 777275 rows/sec 20.00783}
\CommentTok{# iterations        samples training_MSE training_r2}
\CommentTok{# 1          0       0.000000                         }
\CommentTok{# 2          1   99804.000000      0.14402     0.03691}
\CommentTok{# 3          7  700039.000000      0.14157     0.05333}
\CommentTok{# 4         15 1499821.000000      0.14033     0.06159}
\CommentTok{# 5         23 2299180.000000      0.14079     0.05853}
\CommentTok{# 6         23 2299180.000000      0.14157     0.05333}
\CommentTok{# training_logloss training_AUC training_lift}
\CommentTok{# 1                                            }
\CommentTok{# 2          0.45930      0.66685       2.20727}
\CommentTok{# 3          0.45220      0.68133       2.59354}
\CommentTok{# 4          0.44710      0.67993       2.70390}
\CommentTok{# 5          0.45100      0.68192       2.81426}
\CommentTok{# 6          0.45220      0.68133       2.59354}
\CommentTok{# training_classification_error validation_MSE validation_r2}
\CommentTok{# 1                                                           }
\CommentTok{# 2                       0.36145        0.14682       0.03426}
\CommentTok{# 3                       0.33647        0.14500       0.04619}
\CommentTok{# 4                       0.37126        0.14411       0.05204}
\CommentTok{# 5                       0.32868        0.14474       0.04793}
\CommentTok{# 6                       0.33647        0.14500       0.04619}
\CommentTok{# validation_logloss validation_AUC validation_lift}
\CommentTok{# 1                                                  }
\CommentTok{# 2            0.46692        0.66582         2.53209}
\CommentTok{# 3            0.46256        0.67354         2.64124}
\CommentTok{# 4            0.45789        0.66986         2.44478}
\CommentTok{# 5            0.46292        0.67117         2.70672}
\CommentTok{# 6            0.46256        0.67354         2.64124}
\CommentTok{# validation_classification_error}
\CommentTok{# 1                                }
\CommentTok{# 2                         0.37197}
\CommentTok{# 3                         0.34716}
\CommentTok{# 4                         0.34385}
\CommentTok{# 5                         0.36544}
\CommentTok{# 6                         0.34716}
\end{Highlighting}
\end{Shaded}

\hypertarget{naive-bayes-model}{%
\section{Naive Bayes model}\label{naive-bayes-model}}

The Naive Bayes (NB) algorithm does not usually beat an algorithm like a Random Forest
or GBM, however it is still a popular algorithm, especially in the text domain (when your
input is text encoded as ``Bag of Words'', for example). The Naive Bayes algorithm is for
binary or multiclass classification problems only, not regression. Therefore, your response
must be a factor instead of a numeric.

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# First we will train a basic NB model with default parameters. }
\NormalTok{nb_fit1 <-}\StringTok{ }\KeywordTok{h2o.naiveBayes}\NormalTok{(}\DataTypeTok{x =}\NormalTok{ x,}
                          \DataTypeTok{y =}\NormalTok{ y,}
                          \DataTypeTok{training_frame =}\NormalTok{ train,}
                          \DataTypeTok{model_id =} \StringTok{"nb_fit1"}\NormalTok{)}
\CommentTok{#> }
  \OperatorTok{|}\StringTok{                                                                       }
\StringTok{  }\ErrorTok{|}\StringTok{                                                                 }\ErrorTok{|}\StringTok{   }\DecValTok{0}\NormalTok{%}
  \OperatorTok{|}\StringTok{                                                                       }
\StringTok{  }\ErrorTok{|===========}\StringTok{                                                      }\ErrorTok{|}\StringTok{  }\DecValTok{17}\NormalTok{%}
  \OperatorTok{|}\StringTok{                                                                       }
\StringTok{  }\ErrorTok{|=================================================================|}\StringTok{ }\DecValTok{100}\NormalTok{%}
\end{Highlighting}
\end{Shaded}

\hypertarget{train-a-nb-model-with-laplace-smoothing}{%
\subsection{Train a NB model with Laplace Smoothing}\label{train-a-nb-model-with-laplace-smoothing}}

One of the few tunable model parameters for the Naive Bayes algorithm is the amount of Laplace
smoothing. The H2O Naive Bayes model will not use any Laplace smoothing by default.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{nb_fit2 <-}\StringTok{ }\KeywordTok{h2o.naiveBayes}\NormalTok{(}\DataTypeTok{x =}\NormalTok{ x,}
                          \DataTypeTok{y =}\NormalTok{ y,}
                          \DataTypeTok{training_frame =}\NormalTok{ train,}
                          \DataTypeTok{model_id =} \StringTok{"nb_fit2"}\NormalTok{,}
                          \DataTypeTok{laplace =} \DecValTok{6}\NormalTok{)}
\CommentTok{#> }
  \OperatorTok{|}\StringTok{                                                                       }
\StringTok{  }\ErrorTok{|}\StringTok{                                                                 }\ErrorTok{|}\StringTok{   }\DecValTok{0}\NormalTok{%}
  \OperatorTok{|}\StringTok{                                                                       }
\StringTok{  }\ErrorTok{|======================================================}\StringTok{           }\ErrorTok{|}\StringTok{  }\DecValTok{83}\NormalTok{%}
  \OperatorTok{|}\StringTok{                                                                       }
\StringTok{  }\ErrorTok{|=================================================================|}\StringTok{ }\DecValTok{100}\NormalTok{%}

\CommentTok{# Let's compare the performance of the two NB models}
\NormalTok{nb_perf1 <-}\StringTok{ }\KeywordTok{h2o.performance}\NormalTok{(}\DataTypeTok{model =}\NormalTok{ nb_fit1,}
                            \DataTypeTok{newdata =}\NormalTok{ test)}
\NormalTok{nb_perf2 <-}\StringTok{ }\KeywordTok{h2o.performance}\NormalTok{(}\DataTypeTok{model =}\NormalTok{ nb_fit2,}
                            \DataTypeTok{newdata =}\NormalTok{ test)}

\CommentTok{# Print model performance}
\NormalTok{nb_perf1}
\CommentTok{#> H2OBinomialMetrics: naivebayes}
\CommentTok{#> }
\CommentTok{#> MSE:  0.15}
\CommentTok{#> RMSE:  0.387}
\CommentTok{#> LogLoss:  0.489}
\CommentTok{#> Mean Per-Class Error:  0.39}
\CommentTok{#> AUC:  0.651}
\CommentTok{#> pr_auc:  0.297}
\CommentTok{#> Gini:  0.303}
\CommentTok{#> }
\CommentTok{#> Confusion Matrix (vertical: actual; across: predicted) for F1-optimal threshold:}
\CommentTok{#>            0    1    Error         Rate}
\CommentTok{#> 0      13184 6807 0.340503  =6807/19991}
\CommentTok{#> 1       2021 2569 0.440305   =2021/4590}
\CommentTok{#> Totals 15205 9376 0.359139  =8828/24581}
\CommentTok{#> }
\CommentTok{#> Maximum Metrics: Maximum metrics at their respective thresholds}
\CommentTok{#>                         metric threshold    value idx}
\CommentTok{#> 1                       max f1  0.225948 0.367893 236}
\CommentTok{#> 2                       max f2  0.090634 0.545538 346}
\CommentTok{#> 3                 max f0point5  0.340471 0.335807 166}
\CommentTok{#> 4                 max accuracy  0.999554 0.812945   0}
\CommentTok{#> 5                max precision  0.559607 0.428747  70}
\CommentTok{#> 6                   max recall  0.000196 1.000000 399}
\CommentTok{#> 7              max specificity  0.999554 0.999550   0}
\CommentTok{#> 8             max absolute_mcc  0.287231 0.188641 196}
\CommentTok{#> 9   max min_per_class_accuracy  0.208724 0.602832 250}
\CommentTok{#> 10 max mean_per_class_accuracy  0.225948 0.609596 236}
\CommentTok{#> }
\CommentTok{#> Gains/Lift Table: Extract with `h2o.gainsLift(<model>, <data>)` or `h2o.gainsLift(<model>, valid=<T/F>, xval=<T/F>)`}
\NormalTok{nb_perf2}
\CommentTok{#> H2OBinomialMetrics: naivebayes}
\CommentTok{#> }
\CommentTok{#> MSE:  0.15}
\CommentTok{#> RMSE:  0.387}
\CommentTok{#> LogLoss:  0.489}
\CommentTok{#> Mean Per-Class Error:  0.39}
\CommentTok{#> AUC:  0.651}
\CommentTok{#> pr_auc:  0.297}
\CommentTok{#> Gini:  0.303}
\CommentTok{#> }
\CommentTok{#> Confusion Matrix (vertical: actual; across: predicted) for F1-optimal threshold:}
\CommentTok{#>            0    1    Error         Rate}
\CommentTok{#> 0      14002 5989 0.299585  =5989/19991}
\CommentTok{#> 1       2207 2383 0.480828   =2207/4590}
\CommentTok{#> Totals 16209 8372 0.333428  =8196/24581}
\CommentTok{#> }
\CommentTok{#> Maximum Metrics: Maximum metrics at their respective thresholds}
\CommentTok{#>                         metric threshold    value idx}
\CommentTok{#> 1                       max f1  0.242206 0.367690 222}
\CommentTok{#> 2                       max f2  0.088660 0.545677 347}
\CommentTok{#> 3                 max f0point5  0.362995 0.336012 152}
\CommentTok{#> 4                 max accuracy  0.999564 0.812945   0}
\CommentTok{#> 5                max precision  0.574610 0.428775  63}
\CommentTok{#> 6                   max recall  0.000207 1.000000 399}
\CommentTok{#> 7              max specificity  0.999564 0.999550   0}
\CommentTok{#> 8             max absolute_mcc  0.286635 0.189479 192}
\CommentTok{#> 9   max min_per_class_accuracy  0.207609 0.604357 248}
\CommentTok{#> 10 max mean_per_class_accuracy  0.247906 0.609878 218}
\CommentTok{#> }
\CommentTok{#> Gains/Lift Table: Extract with `h2o.gainsLift(<model>, <data>)` or `h2o.gainsLift(<model>, valid=<T/F>, xval=<T/F>)`}

\CommentTok{# Retreive test set AUC}
\KeywordTok{h2o.auc}\NormalTok{(nb_perf1)  }\CommentTok{# 0.6488014}
\CommentTok{#> [1] 0.651}
\KeywordTok{h2o.auc}\NormalTok{(nb_perf2)  }\CommentTok{# 0.6490678}
\CommentTok{#> [1] 0.651}
\end{Highlighting}
\end{Shaded}

\hypertarget{classification-algorithms-comparison.-diabetes-datset.-cart-lda-svm-knn-rf}{%
\chapter{\texorpdfstring{Classification algorithms comparison. Diabetes datset. (\emph{CART, LDA, SVM, KNN, RF})}{Classification algorithms comparison. Diabetes datset. (CART, LDA, SVM, KNN, RF)}}\label{classification-algorithms-comparison.-diabetes-datset.-cart-lda-svm-knn-rf}}

\hypertarget{pimaindiansdiabetes-dataset}{%
\section{\texorpdfstring{\texttt{PimaIndiansDiabetes} dataset}{PimaIndiansDiabetes dataset}}\label{pimaindiansdiabetes-dataset}}

\hypertarget{introduction-1}{%
\section{Introduction}\label{introduction-1}}

We compare the following clasification algorithms:

\begin{itemize}
\tightlist
\item
  CART
\item
  LDA
\item
  SVM
\item
  KNN
\item
  RF
\end{itemize}

\hypertarget{workflow}{%
\section{Workflow}\label{workflow}}

\begin{enumerate}
\def\labelenumi{\arabic{enumi}.}
\tightlist
\item
  Load dataset
\item
  Create the train dataset
\item
  Train the models
\item
  Collect resamples
\item
  Plot comparison
\item
  Summarize p-values
\end{enumerate}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# load packages}
\KeywordTok{library}\NormalTok{(mlbench)}
\KeywordTok{library}\NormalTok{(caret)}
\CommentTok{# load the dataset}
\KeywordTok{data}\NormalTok{(PimaIndiansDiabetes)}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{dplyr}\OperatorTok{::}\KeywordTok{glimpse}\NormalTok{(PimaIndiansDiabetes)}
\CommentTok{#> Observations: 768}
\CommentTok{#> Variables: 9}
\CommentTok{#> $ pregnant <dbl> 6, 1, 8, 1, 0, 5, 3, 10, 2, 8, 4, 10, 10, 1, 5, 7, 0,...}
\CommentTok{#> $ glucose  <dbl> 148, 85, 183, 89, 137, 116, 78, 115, 197, 125, 110, 1...}
\CommentTok{#> $ pressure <dbl> 72, 66, 64, 66, 40, 74, 50, 0, 70, 96, 92, 74, 80, 60...}
\CommentTok{#> $ triceps  <dbl> 35, 29, 0, 23, 35, 0, 32, 0, 45, 0, 0, 0, 0, 23, 19, ...}
\CommentTok{#> $ insulin  <dbl> 0, 0, 0, 94, 168, 0, 88, 0, 543, 0, 0, 0, 0, 846, 175...}
\CommentTok{#> $ mass     <dbl> 33.6, 26.6, 23.3, 28.1, 43.1, 25.6, 31.0, 35.3, 30.5,...}
\CommentTok{#> $ pedigree <dbl> 0.627, 0.351, 0.672, 0.167, 2.288, 0.201, 0.248, 0.13...}
\CommentTok{#> $ age      <dbl> 50, 31, 32, 21, 33, 30, 26, 29, 53, 54, 30, 34, 57, 5...}
\CommentTok{#> $ diabetes <fct> pos, neg, pos, neg, pos, neg, pos, neg, pos, pos, neg...}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{tibble}\OperatorTok{::}\KeywordTok{as_tibble}\NormalTok{(PimaIndiansDiabetes)}
\CommentTok{#> # A tibble: 768 x 9}
\CommentTok{#>   pregnant glucose pressure triceps insulin  mass pedigree   age diabetes}
\CommentTok{#>      <dbl>   <dbl>    <dbl>   <dbl>   <dbl> <dbl>    <dbl> <dbl> <fct>   }
\CommentTok{#> 1        6     148       72      35       0  33.6    0.627    50 pos     }
\CommentTok{#> 2        1      85       66      29       0  26.6    0.351    31 neg     }
\CommentTok{#> 3        8     183       64       0       0  23.3    0.672    32 pos     }
\CommentTok{#> 4        1      89       66      23      94  28.1    0.167    21 neg     }
\CommentTok{#> 5        0     137       40      35     168  43.1    2.29     33 pos     }
\CommentTok{#> 6        5     116       74       0       0  25.6    0.201    30 neg     }
\CommentTok{#> # ... with 762 more rows}
\end{Highlighting}
\end{Shaded}

\hypertarget{train-the-models-using-cross-validation}{%
\section{Train the models using cross-validation}\label{train-the-models-using-cross-validation}}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# prepare training scheme}
\NormalTok{trainControl <-}\StringTok{ }\KeywordTok{trainControl}\NormalTok{(}\DataTypeTok{method =} \StringTok{"repeatedcv"}\NormalTok{, }
                             \DataTypeTok{number=}\DecValTok{10}\NormalTok{, }
                             \DataTypeTok{repeats=}\DecValTok{3}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# CART}
\KeywordTok{set.seed}\NormalTok{(}\DecValTok{7}\NormalTok{)}
\NormalTok{fit.cart <-}\StringTok{ }\KeywordTok{train}\NormalTok{(diabetes}\OperatorTok{~}\NormalTok{., }\DataTypeTok{data=}\NormalTok{PimaIndiansDiabetes, }
                  \DataTypeTok{method =} \StringTok{"rpart"}\NormalTok{, }\DataTypeTok{trControl=}\NormalTok{trainControl)}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# LDA: Linear Discriminant Analysis}
\KeywordTok{set.seed}\NormalTok{(}\DecValTok{7}\NormalTok{)}
\NormalTok{fit.lda <-}\StringTok{ }\KeywordTok{train}\NormalTok{(diabetes}\OperatorTok{~}\NormalTok{., }\DataTypeTok{data=}\NormalTok{PimaIndiansDiabetes, }
                 \DataTypeTok{method=}\StringTok{"lda"}\NormalTok{, }\DataTypeTok{trControl=}\NormalTok{trainControl)}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# SVM}
\KeywordTok{set.seed}\NormalTok{(}\DecValTok{7}\NormalTok{)}
\NormalTok{fit.svm <-}\StringTok{ }\KeywordTok{train}\NormalTok{(diabetes}\OperatorTok{~}\NormalTok{., }\DataTypeTok{data=}\NormalTok{PimaIndiansDiabetes, }
                 \DataTypeTok{method=}\StringTok{"svmRadial"}\NormalTok{, }\DataTypeTok{trControl=}\NormalTok{trainControl)}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# KNN}
\KeywordTok{set.seed}\NormalTok{(}\DecValTok{7}\NormalTok{)}
\NormalTok{fit.knn <-}\StringTok{ }\KeywordTok{train}\NormalTok{(diabetes}\OperatorTok{~}\NormalTok{., }\DataTypeTok{data=}\NormalTok{PimaIndiansDiabetes, }
                 \DataTypeTok{method=}\StringTok{"knn"}\NormalTok{, }\DataTypeTok{trControl=}\NormalTok{trainControl)}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# Random Forest}
\KeywordTok{set.seed}\NormalTok{(}\DecValTok{7}\NormalTok{)}
\NormalTok{fit.rf <-}\StringTok{ }\KeywordTok{train}\NormalTok{(diabetes}\OperatorTok{~}\NormalTok{., }\DataTypeTok{data=}\NormalTok{PimaIndiansDiabetes, }
                \DataTypeTok{method=}\StringTok{"rf"}\NormalTok{, }\DataTypeTok{trControl=}\NormalTok{trainControl)}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# collect resamples}
\NormalTok{results <-}\StringTok{ }\KeywordTok{resamples}\NormalTok{(}\KeywordTok{list}\NormalTok{(}\DataTypeTok{CART=}\NormalTok{fit.cart, }
                          \DataTypeTok{LDA=}\NormalTok{fit.lda, }
                          \DataTypeTok{SVM=}\NormalTok{fit.svm, }
                          \DataTypeTok{KNN=}\NormalTok{fit.knn, }
                          \DataTypeTok{RF=}\NormalTok{fit.rf))}
\end{Highlighting}
\end{Shaded}

\hypertarget{compare-models}{%
\section{Compare models}\label{compare-models}}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# summarize differences between models}
\KeywordTok{summary}\NormalTok{(results)}
\CommentTok{#> }
\CommentTok{#> Call:}
\CommentTok{#> summary.resamples(object = results)}
\CommentTok{#> }
\CommentTok{#> Models: CART, LDA, SVM, KNN, RF }
\CommentTok{#> Number of resamples: 30 }
\CommentTok{#> }
\CommentTok{#> Accuracy }
\CommentTok{#>       Min. 1st Qu. Median  Mean 3rd Qu.  Max. NA's}
\CommentTok{#> CART 0.675   0.727  0.753 0.747   0.766 0.792    0}
\CommentTok{#> LDA  0.714   0.751  0.766 0.779   0.800 0.908    0}
\CommentTok{#> SVM  0.724   0.751  0.763 0.771   0.792 0.895    0}
\CommentTok{#> KNN  0.675   0.704  0.727 0.737   0.766 0.831    0}
\CommentTok{#> RF   0.684   0.731  0.760 0.764   0.802 0.842    0}
\CommentTok{#> }
\CommentTok{#> Kappa }
\CommentTok{#>       Min. 1st Qu. Median  Mean 3rd Qu.  Max. NA's}
\CommentTok{#> CART 0.276   0.362  0.424 0.415   0.486 0.525    0}
\CommentTok{#> LDA  0.301   0.419  0.466 0.486   0.531 0.781    0}
\CommentTok{#> SVM  0.339   0.400  0.446 0.462   0.523 0.748    0}
\CommentTok{#> KNN  0.255   0.341  0.384 0.398   0.454 0.620    0}
\CommentTok{#> RF   0.295   0.378  0.464 0.463   0.545 0.643    0}
\end{Highlighting}
\end{Shaded}

\hypertarget{plot-comparison}{%
\section{Plot comparison}\label{plot-comparison}}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# box and whisker plots to compare models}
\NormalTok{scales <-}\StringTok{ }\KeywordTok{list}\NormalTok{(}\DataTypeTok{x=}\KeywordTok{list}\NormalTok{(}\DataTypeTok{relation=}\StringTok{"free"}\NormalTok{), }\DataTypeTok{y=}\KeywordTok{list}\NormalTok{(}\DataTypeTok{relation=}\StringTok{"free"}\NormalTok{))}
\KeywordTok{bwplot}\NormalTok{(results, }\DataTypeTok{scales=}\NormalTok{scales)}
\end{Highlighting}
\end{Shaded}

\begin{center}\includegraphics[width=0.7\linewidth]{comparison_312-classification-diabetes-multi_files/figure-latex/unnamed-chunk-5-1} \end{center}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# density plots of accuracy}
\NormalTok{scales <-}\StringTok{ }\KeywordTok{list}\NormalTok{(}\DataTypeTok{x=}\KeywordTok{list}\NormalTok{(}\DataTypeTok{relation=}\StringTok{"free"}\NormalTok{), }\DataTypeTok{y=}\KeywordTok{list}\NormalTok{(}\DataTypeTok{relation=}\StringTok{"free"}\NormalTok{))}
\KeywordTok{densityplot}\NormalTok{(results, }\DataTypeTok{scales=}\NormalTok{scales, }\DataTypeTok{pch =} \StringTok{"|"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{center}\includegraphics[width=0.7\linewidth]{comparison_312-classification-diabetes-multi_files/figure-latex/density_plot-1} \end{center}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# dot plots of accuracy}
\NormalTok{scales <-}\StringTok{ }\KeywordTok{list}\NormalTok{(}\DataTypeTok{x=}\KeywordTok{list}\NormalTok{(}\DataTypeTok{relation=}\StringTok{"free"}\NormalTok{), }\DataTypeTok{y=}\KeywordTok{list}\NormalTok{(}\DataTypeTok{relation=}\StringTok{"free"}\NormalTok{))}
\KeywordTok{dotplot}\NormalTok{(results, }\DataTypeTok{scales=}\NormalTok{scales)}
\end{Highlighting}
\end{Shaded}

\begin{center}\includegraphics[width=0.7\linewidth]{comparison_312-classification-diabetes-multi_files/figure-latex/dot_plot-1} \end{center}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# parallel plots to compare models}
\KeywordTok{parallelplot}\NormalTok{(results)}
\end{Highlighting}
\end{Shaded}

\begin{center}\includegraphics[width=0.7\linewidth]{comparison_312-classification-diabetes-multi_files/figure-latex/parallel_plot-1} \end{center}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# pairwise scatter plots of predictions to compare models}
\KeywordTok{splom}\NormalTok{(results)}
\end{Highlighting}
\end{Shaded}

\begin{center}\includegraphics[width=0.7\linewidth]{comparison_312-classification-diabetes-multi_files/figure-latex/pairwise_plot-1} \end{center}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# xyplot plots to compare models}
\KeywordTok{xyplot}\NormalTok{(results, }\DataTypeTok{models=}\KeywordTok{c}\NormalTok{(}\StringTok{"LDA"}\NormalTok{, }\StringTok{"SVM"}\NormalTok{))}
\end{Highlighting}
\end{Shaded}

\begin{center}\includegraphics[width=0.7\linewidth]{comparison_312-classification-diabetes-multi_files/figure-latex/xy_plot-1} \end{center}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# difference in model predictions}
\NormalTok{diffs <-}\StringTok{ }\KeywordTok{diff}\NormalTok{(results)}
\CommentTok{# summarize p-values for pairwise comparisons}
\KeywordTok{summary}\NormalTok{(diffs)}
\CommentTok{#> }
\CommentTok{#> Call:}
\CommentTok{#> summary.diff.resamples(object = diffs)}
\CommentTok{#> }
\CommentTok{#> p-value adjustment: bonferroni }
\CommentTok{#> Upper diagonal: estimates of the difference}
\CommentTok{#> Lower diagonal: p-value for H0: difference = 0}
\CommentTok{#> }
\CommentTok{#> Accuracy }
\CommentTok{#>      CART     LDA      SVM      KNN      RF      }
\CommentTok{#> CART          -0.03214 -0.02432  0.01002 -0.01688}
\CommentTok{#> LDA  0.001186           0.00781  0.04216  0.01525}
\CommentTok{#> SVM  0.011640 0.915689           0.03434  0.00744}
\CommentTok{#> KNN  1.000000 6.68e-05 0.000294          -0.02690}
\CommentTok{#> RF   0.272754 0.449062 1.000000 0.018379         }
\CommentTok{#> }
\CommentTok{#> Kappa }
\CommentTok{#>      CART     LDA       SVM       KNN       RF       }
\CommentTok{#> CART          -0.071016 -0.046972  0.016687 -0.047894}
\CommentTok{#> LDA  0.000809            0.024044  0.087703  0.023122}
\CommentTok{#> SVM  0.025808 0.356273             0.063659 -0.000922}
\CommentTok{#> KNN  1.000000 0.000386  0.004082            -0.064581}
\CommentTok{#> RF   0.021176 1.000000  1.000000  0.015897}
\end{Highlighting}
\end{Shaded}

\hypertarget{multiclass-classification-comparison.-diabetes-dataset.-lda-cart-knn-svm-rf}{%
\chapter{\texorpdfstring{Multiclass classification comparison. Diabetes dataset. (\emph{LDA, CART, KNN, SVM, RF})}{Multiclass classification comparison. Diabetes dataset. (LDA, CART, KNN, SVM, RF)}}\label{multiclass-classification-comparison.-diabetes-dataset.-lda-cart-knn-svm-rf}}

\hypertarget{iris-dataset}{%
\section{\texorpdfstring{\texttt{iris} dataset}{iris dataset}}\label{iris-dataset}}

\hypertarget{introduction-2}{%
\section{Introduction}\label{introduction-2}}

These are the algorithms used:

\begin{enumerate}
\def\labelenumi{\arabic{enumi}.}
\tightlist
\item
  LDA
\item
  CART
\item
  KNN
\item
  SVM
\item
  RF
\end{enumerate}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# load the caret package}
\KeywordTok{library}\NormalTok{(caret)}
\CommentTok{#> Loading required package: lattice}
\CommentTok{#> Loading required package: ggplot2}
\CommentTok{#> Registered S3 methods overwritten by 'ggplot2':}
\CommentTok{#>   method         from }
\CommentTok{#>   [.quosures     rlang}
\CommentTok{#>   c.quosures     rlang}
\CommentTok{#>   print.quosures rlang}
\CommentTok{# attach the iris dataset to the environment}
\KeywordTok{data}\NormalTok{(iris)}
\CommentTok{# rename the dataset}
\NormalTok{dataset <-}\StringTok{ }\NormalTok{iris}
\end{Highlighting}
\end{Shaded}

\hypertarget{workflow-1}{%
\section{Workflow}\label{workflow-1}}

\begin{enumerate}
\def\labelenumi{\arabic{enumi}.}
\tightlist
\item
  Load dataset
\item
  Create train and test datasets, 80/20
\item
  Inspect dataset
\item
  Visualize features
\item
  Set the train control to
\end{enumerate}

\begin{itemize}
\tightlist
\item
  10 cross-validations
\item
  Metric: accuracy
\end{itemize}

\begin{enumerate}
\def\labelenumi{\arabic{enumi}.}
\setcounter{enumi}{5}
\tightlist
\item
  Train the models
\item
  Compare accuracy of models
\item
  Visual comparison
\item
  Make predictions on \texttt{validation} set
\end{enumerate}

We will split the loaded dataset into two, 80\% of which we will use to train our models and 20\% that we will hold back as a validation dataset.

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# create a list of 80% of the rows in the original dataset we can use for training}
\NormalTok{validationIndex <-}\StringTok{ }\KeywordTok{createDataPartition}\NormalTok{(dataset}\OperatorTok{$}\NormalTok{Species, }\DataTypeTok{p=}\FloatTok{0.80}\NormalTok{, }\DataTypeTok{list=}\OtherTok{FALSE}\NormalTok{)}
\CommentTok{# select 20% of the data for validation}
\NormalTok{validation <-}\StringTok{ }\NormalTok{dataset[}\OperatorTok{-}\NormalTok{validationIndex,]}

\CommentTok{# use the remaining 80% of data to training and testing the models}
\NormalTok{dataset <-}\StringTok{ }\NormalTok{dataset[validationIndex,]}

\CommentTok{# dimensions of dataset}
\KeywordTok{dim}\NormalTok{(dataset)}
\CommentTok{#> [1] 120   5}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# list types for each attribute}
\KeywordTok{sapply}\NormalTok{(dataset, class)}
\CommentTok{#> Sepal.Length  Sepal.Width Petal.Length  Petal.Width      Species }
\CommentTok{#>    "numeric"    "numeric"    "numeric"    "numeric"     "factor"}
\end{Highlighting}
\end{Shaded}

\hypertarget{peek-at-the-dataset}{%
\section{Peek at the dataset}\label{peek-at-the-dataset}}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# take a peek at the first 5 rows of the data}
\KeywordTok{head}\NormalTok{(dataset)}
\CommentTok{#>   Sepal.Length Sepal.Width Petal.Length Petal.Width Species}
\CommentTok{#> 1          5.1         3.5          1.4         0.2  setosa}
\CommentTok{#> 2          4.9         3.0          1.4         0.2  setosa}
\CommentTok{#> 3          4.7         3.2          1.3         0.2  setosa}
\CommentTok{#> 4          4.6         3.1          1.5         0.2  setosa}
\CommentTok{#> 5          5.0         3.6          1.4         0.2  setosa}
\CommentTok{#> 6          5.4         3.9          1.7         0.4  setosa}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{library}\NormalTok{(dplyr)}
\CommentTok{#> }
\CommentTok{#> Attaching package: 'dplyr'}
\CommentTok{#> The following objects are masked from 'package:stats':}
\CommentTok{#> }
\CommentTok{#>     filter, lag}
\CommentTok{#> The following objects are masked from 'package:base':}
\CommentTok{#> }
\CommentTok{#>     intersect, setdiff, setequal, union}

\KeywordTok{glimpse}\NormalTok{(dataset)}
\CommentTok{#> Observations: 120}
\CommentTok{#> Variables: 5}
\CommentTok{#> $ Sepal.Length <dbl> 5.1, 4.9, 4.7, 4.6, 5.0, 5.4, 4.6, 5.0, 4.4, 4.9,...}
\CommentTok{#> $ Sepal.Width  <dbl> 3.5, 3.0, 3.2, 3.1, 3.6, 3.9, 3.4, 3.4, 2.9, 3.1,...}
\CommentTok{#> $ Petal.Length <dbl> 1.4, 1.4, 1.3, 1.5, 1.4, 1.7, 1.4, 1.5, 1.4, 1.5,...}
\CommentTok{#> $ Petal.Width  <dbl> 0.2, 0.2, 0.2, 0.2, 0.2, 0.4, 0.3, 0.2, 0.2, 0.1,...}
\CommentTok{#> $ Species      <fct> setosa, setosa, setosa, setosa, setosa, setosa, s...}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{library}\NormalTok{(skimr)}
\CommentTok{#> }
\CommentTok{#> Attaching package: 'skimr'}
\CommentTok{#> The following object is masked from 'package:stats':}
\CommentTok{#> }
\CommentTok{#>     filter}

\KeywordTok{skim}\NormalTok{(dataset)}
\CommentTok{#> Skim summary statistics}
\CommentTok{#>  n obs: 120 }
\CommentTok{#>  n variables: 5 }
\CommentTok{#> }
\CommentTok{#> -- Variable type:factor ----------------------------------------------------------}
\CommentTok{#>  variable missing complete   n n_unique                       top_counts}
\CommentTok{#>   Species       0      120 120        3 set: 40, ver: 40, vir: 40, NA: 0}
\CommentTok{#>  ordered}
\CommentTok{#>    FALSE}
\CommentTok{#> }
\CommentTok{#> -- Variable type:numeric ---------------------------------------------------------}
\CommentTok{#>      variable missing complete   n mean   sd  p0  p25  p50  p75 p100}
\CommentTok{#>  Petal.Length       0      120 120 3.76 1.78 1   1.58 4.35 5.1   6.9}
\CommentTok{#>   Petal.Width       0      120 120 1.2  0.76 0.1 0.3  1.3  1.8   2.5}
\CommentTok{#>  Sepal.Length       0      120 120 5.86 0.84 4.3 5.1  5.8  6.4   7.9}
\CommentTok{#>   Sepal.Width       0      120 120 3.06 0.44 2   2.8  3    3.32  4.4}
\CommentTok{#>      hist}
\CommentTok{#>  ▇▁▁▂▅▅▃▁}
\CommentTok{#>  ▇▁▁▅▃▃▃▂}
\CommentTok{#>  ▂▇▅▆▆▅▁▂}
\CommentTok{#>  ▁▃▅▇▅▂▁▁}
\end{Highlighting}
\end{Shaded}

\hypertarget{levels-of-the-class}{%
\section{Levels of the class}\label{levels-of-the-class}}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# list the levels for the class}
\KeywordTok{levels}\NormalTok{(dataset}\OperatorTok{$}\NormalTok{Species)}
\CommentTok{#> [1] "setosa"     "versicolor" "virginica"}
\end{Highlighting}
\end{Shaded}

\hypertarget{class-distribution}{%
\section{class distribution}\label{class-distribution}}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# summarize the class distribution}
\NormalTok{percentage <-}\StringTok{ }\KeywordTok{prop.table}\NormalTok{(}\KeywordTok{table}\NormalTok{(dataset}\OperatorTok{$}\NormalTok{Species)) }\OperatorTok{*}\StringTok{ }\DecValTok{100}
\KeywordTok{cbind}\NormalTok{(}\DataTypeTok{freq=}\KeywordTok{table}\NormalTok{(dataset}\OperatorTok{$}\NormalTok{Species), }\DataTypeTok{percentage=}\NormalTok{percentage)}
\CommentTok{#>            freq percentage}
\CommentTok{#> setosa       40       33.3}
\CommentTok{#> versicolor   40       33.3}
\CommentTok{#> virginica    40       33.3}
\end{Highlighting}
\end{Shaded}

\hypertarget{visualize-the-dataset}{%
\section{Visualize the dataset}\label{visualize-the-dataset}}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# split input and output}
\NormalTok{x <-}\StringTok{ }\NormalTok{dataset[,}\DecValTok{1}\OperatorTok{:}\DecValTok{4}\NormalTok{]}
\NormalTok{y <-}\StringTok{ }\NormalTok{dataset[,}\DecValTok{5}\NormalTok{]}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# boxplot for each attribute on one image}
\KeywordTok{par}\NormalTok{(}\DataTypeTok{mfrow=}\KeywordTok{c}\NormalTok{(}\DecValTok{1}\NormalTok{,}\DecValTok{4}\NormalTok{))}
\ControlFlowTok{for}\NormalTok{(i }\ControlFlowTok{in} \DecValTok{1}\OperatorTok{:}\DecValTok{4}\NormalTok{) \{}
    \KeywordTok{boxplot}\NormalTok{(x[,i], }\DataTypeTok{main=}\KeywordTok{names}\NormalTok{(dataset)[i])}
\NormalTok{\}}
\end{Highlighting}
\end{Shaded}

\begin{center}\includegraphics[width=0.7\linewidth]{comparison_320-classification_iris-multi_files/figure-latex/unnamed-chunk-11-1} \end{center}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# barplot for class breakdown}
\KeywordTok{plot}\NormalTok{(y)}
\end{Highlighting}
\end{Shaded}

\begin{center}\includegraphics[width=0.7\linewidth]{comparison_320-classification_iris-multi_files/figure-latex/unnamed-chunk-12-1} \end{center}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# scatter plot matrix}
\KeywordTok{featurePlot}\NormalTok{(}\DataTypeTok{x=}\NormalTok{x, }\DataTypeTok{y=}\NormalTok{y, }\DataTypeTok{plot=}\StringTok{"ellipse"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{center}\includegraphics[width=0.7\linewidth]{comparison_320-classification_iris-multi_files/figure-latex/unnamed-chunk-13-1} \end{center}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# box and whisker plots for each attribute}
\KeywordTok{featurePlot}\NormalTok{(}\DataTypeTok{x=}\NormalTok{x, }\DataTypeTok{y=}\NormalTok{y, }\DataTypeTok{plot=}\StringTok{"box"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{center}\includegraphics[width=0.7\linewidth]{comparison_320-classification_iris-multi_files/figure-latex/unnamed-chunk-14-1} \end{center}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# density plots for each attribute by class value}
\NormalTok{scales <-}\StringTok{ }\KeywordTok{list}\NormalTok{(}\DataTypeTok{x=}\KeywordTok{list}\NormalTok{(}\DataTypeTok{relation=}\StringTok{"free"}\NormalTok{), }\DataTypeTok{y=}\KeywordTok{list}\NormalTok{(}\DataTypeTok{relation=}\StringTok{"free"}\NormalTok{))}
\KeywordTok{featurePlot}\NormalTok{(}\DataTypeTok{x=}\NormalTok{x, }\DataTypeTok{y=}\NormalTok{y, }\DataTypeTok{plot=}\StringTok{"density"}\NormalTok{, }\DataTypeTok{scales=}\NormalTok{scales)}
\end{Highlighting}
\end{Shaded}

\begin{center}\includegraphics[width=0.7\linewidth]{comparison_320-classification_iris-multi_files/figure-latex/unnamed-chunk-15-1} \end{center}

\hypertarget{evaluate-algorithms}{%
\section{Evaluate algorithms}\label{evaluate-algorithms}}

\hypertarget{split-and-metrics}{%
\subsection{split and metrics}\label{split-and-metrics}}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# Run algorithms using 10-fold cross-validation}
\NormalTok{trainControl <-}\StringTok{ }\KeywordTok{trainControl}\NormalTok{(}\DataTypeTok{method=}\StringTok{"cv"}\NormalTok{, }\DataTypeTok{number=}\DecValTok{10}\NormalTok{)}
\NormalTok{metric <-}\StringTok{ "Accuracy"}
\end{Highlighting}
\end{Shaded}

\hypertarget{build-models}{%
\subsection{build models}\label{build-models}}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# LDA}
\KeywordTok{set.seed}\NormalTok{(}\DecValTok{7}\NormalTok{)}
\NormalTok{fit.lda <-}\StringTok{ }\KeywordTok{train}\NormalTok{(Species}\OperatorTok{~}\NormalTok{., }\DataTypeTok{data=}\NormalTok{dataset, }\DataTypeTok{method =} \StringTok{"lda"}\NormalTok{, }
                 \DataTypeTok{metric=}\NormalTok{metric, }\DataTypeTok{trControl=}\NormalTok{trainControl)}
\CommentTok{# CART}
\KeywordTok{set.seed}\NormalTok{(}\DecValTok{7}\NormalTok{)}
\NormalTok{fit.cart <-}\StringTok{ }\KeywordTok{train}\NormalTok{(Species}\OperatorTok{~}\NormalTok{., }\DataTypeTok{data=}\NormalTok{dataset, }\DataTypeTok{method =} \StringTok{"rpart"}\NormalTok{, }
                  \DataTypeTok{metric=}\NormalTok{metric, }\DataTypeTok{trControl=}\NormalTok{trainControl)}
\CommentTok{# KNN}
\KeywordTok{set.seed}\NormalTok{(}\DecValTok{7}\NormalTok{)}
\NormalTok{fit.knn <-}\StringTok{ }\KeywordTok{train}\NormalTok{(Species}\OperatorTok{~}\NormalTok{., }\DataTypeTok{data=}\NormalTok{dataset, }\DataTypeTok{method =} \StringTok{"knn"}\NormalTok{, }
                 \DataTypeTok{metric=}\NormalTok{metric, }\DataTypeTok{trControl=}\NormalTok{trainControl)}
\CommentTok{# SVM}
\KeywordTok{set.seed}\NormalTok{(}\DecValTok{7}\NormalTok{)}
\NormalTok{fit.svm <-}\StringTok{ }\KeywordTok{train}\NormalTok{(Species}\OperatorTok{~}\NormalTok{., }\DataTypeTok{data=}\NormalTok{dataset, }\DataTypeTok{method =} \StringTok{"svmRadial"}\NormalTok{, }
                 \DataTypeTok{metric=}\NormalTok{metric, }\DataTypeTok{trControl=}\NormalTok{trainControl)}
\CommentTok{# Random Forest}
\KeywordTok{set.seed}\NormalTok{(}\DecValTok{7}\NormalTok{)}
\NormalTok{fit.rf <-}\StringTok{ }\KeywordTok{train}\NormalTok{(Species}\OperatorTok{~}\NormalTok{., }\DataTypeTok{data=}\NormalTok{dataset, }\DataTypeTok{method =} \StringTok{"rf"}\NormalTok{, }
                \DataTypeTok{metric=}\NormalTok{metric, }\DataTypeTok{trControl=}\NormalTok{trainControl)}
\end{Highlighting}
\end{Shaded}

\hypertarget{compare}{%
\subsection{compare}\label{compare}}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{#summarize accuracy of models}
\NormalTok{results <-}\StringTok{ }\KeywordTok{resamples}\NormalTok{(}\KeywordTok{list}\NormalTok{(}\DataTypeTok{lda  =}\NormalTok{ fit.lda, }
                          \DataTypeTok{cart =}\NormalTok{ fit.cart, }
                          \DataTypeTok{knn  =}\NormalTok{ fit.knn, }
                          \DataTypeTok{svm  =}\NormalTok{ fit.svm, }
                          \DataTypeTok{rf   =}\NormalTok{ fit.rf))}
\KeywordTok{summary}\NormalTok{(results)}
\CommentTok{#> }
\CommentTok{#> Call:}
\CommentTok{#> summary.resamples(object = results)}
\CommentTok{#> }
\CommentTok{#> Models: lda, cart, knn, svm, rf }
\CommentTok{#> Number of resamples: 10 }
\CommentTok{#> }
\CommentTok{#> Accuracy }
\CommentTok{#>       Min. 1st Qu. Median  Mean 3rd Qu. Max. NA's}
\CommentTok{#> lda  0.917   1.000      1 0.992       1    1    0}
\CommentTok{#> cart 0.917   0.917      1 0.967       1    1    0}
\CommentTok{#> knn  0.917   0.938      1 0.975       1    1    0}
\CommentTok{#> svm  0.833   0.917      1 0.958       1    1    0}
\CommentTok{#> rf   0.917   0.917      1 0.967       1    1    0}
\CommentTok{#> }
\CommentTok{#> Kappa }
\CommentTok{#>       Min. 1st Qu. Median  Mean 3rd Qu. Max. NA's}
\CommentTok{#> lda  0.875   1.000      1 0.987       1    1    0}
\CommentTok{#> cart 0.875   0.875      1 0.950       1    1    0}
\CommentTok{#> knn  0.875   0.906      1 0.962       1    1    0}
\CommentTok{#> svm  0.750   0.875      1 0.937       1    1    0}
\CommentTok{#> rf   0.875   0.875      1 0.950       1    1    0}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# compare accuracy of models}
\KeywordTok{dotplot}\NormalTok{(results)}
\end{Highlighting}
\end{Shaded}

\begin{center}\includegraphics[width=0.7\linewidth]{comparison_320-classification_iris-multi_files/figure-latex/unnamed-chunk-19-1} \end{center}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# summarize Best Model}
\KeywordTok{print}\NormalTok{(fit.lda)}
\CommentTok{#> Linear Discriminant Analysis }
\CommentTok{#> }
\CommentTok{#> 120 samples}
\CommentTok{#>   4 predictor}
\CommentTok{#>   3 classes: 'setosa', 'versicolor', 'virginica' }
\CommentTok{#> }
\CommentTok{#> No pre-processing}
\CommentTok{#> Resampling: Cross-Validated (10 fold) }
\CommentTok{#> Summary of sample sizes: 108, 108, 108, 108, 108, 108, ... }
\CommentTok{#> Resampling results:}
\CommentTok{#> }
\CommentTok{#>   Accuracy  Kappa}
\CommentTok{#>   0.992     0.987}
\end{Highlighting}
\end{Shaded}

\hypertarget{make-predictions}{%
\section{Make predictions}\label{make-predictions}}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# estimate skill of LDA on the validation dataset}
\NormalTok{predictions <-}\StringTok{ }\KeywordTok{predict}\NormalTok{(fit.lda, validation)}
\KeywordTok{confusionMatrix}\NormalTok{(predictions, validation}\OperatorTok{$}\NormalTok{Species)}
\CommentTok{#> Confusion Matrix and Statistics}
\CommentTok{#> }
\CommentTok{#>             Reference}
\CommentTok{#> Prediction   setosa versicolor virginica}
\CommentTok{#>   setosa         10          0         0}
\CommentTok{#>   versicolor      0          9         1}
\CommentTok{#>   virginica       0          1         9}
\CommentTok{#> }
\CommentTok{#> Overall Statistics}
\CommentTok{#>                                         }
\CommentTok{#>                Accuracy : 0.933         }
\CommentTok{#>                  95% CI : (0.779, 0.992)}
\CommentTok{#>     No Information Rate : 0.333         }
\CommentTok{#>     P-Value [Acc > NIR] : 8.75e-12      }
\CommentTok{#>                                         }
\CommentTok{#>                   Kappa : 0.9           }
\CommentTok{#>                                         }
\CommentTok{#>  Mcnemar's Test P-Value : NA            }
\CommentTok{#> }
\CommentTok{#> Statistics by Class:}
\CommentTok{#> }
\CommentTok{#>                      Class: setosa Class: versicolor Class: virginica}
\CommentTok{#> Sensitivity                  1.000             0.900            0.900}
\CommentTok{#> Specificity                  1.000             0.950            0.950}
\CommentTok{#> Pos Pred Value               1.000             0.900            0.900}
\CommentTok{#> Neg Pred Value               1.000             0.950            0.950}
\CommentTok{#> Prevalence                   0.333             0.333            0.333}
\CommentTok{#> Detection Rate               0.333             0.300            0.300}
\CommentTok{#> Detection Prevalence         0.333             0.333            0.333}
\CommentTok{#> Balanced Accuracy            1.000             0.925            0.925}
\end{Highlighting}
\end{Shaded}

\hypertarget{regression-algorithms-comparison.-boston-dataset.-lm-gkm-glmnet-svm-cart-knn}{%
\chapter{\texorpdfstring{Regression algorithms comparison. Boston dataset. (\emph{LM, GKM, GLMNET, SVM, CART, KNN})}{Regression algorithms comparison. Boston dataset. (LM, GKM, GLMNET, SVM, CART, KNN)}}\label{regression-algorithms-comparison.-boston-dataset.-lm-gkm-glmnet-svm-cart-knn}}

\hypertarget{boston-dataset}{%
\section{\texorpdfstring{\texttt{Boston} dataset}{Boston dataset}}\label{boston-dataset}}

\begin{itemize}
\tightlist
\item
  Comparison of various algorithms.
\end{itemize}

\hypertarget{introduction-3}{%
\section{Introduction}\label{introduction-3}}

These are the algorithms used:

\begin{enumerate}
\def\labelenumi{\arabic{enumi}.}
\tightlist
\item
  LM
\item
  GLM
\item
  GLMNET
\item
  SVM
\item
  CART
\item
  KNN
\end{enumerate}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# load packages}
\KeywordTok{library}\NormalTok{(mlbench)}
\KeywordTok{library}\NormalTok{(caret)}
\CommentTok{#> Loading required package: lattice}
\CommentTok{#> Loading required package: ggplot2}
\CommentTok{#> Registered S3 methods overwritten by 'ggplot2':}
\CommentTok{#>   method         from }
\CommentTok{#>   [.quosures     rlang}
\CommentTok{#>   c.quosures     rlang}
\CommentTok{#>   print.quosures rlang}
\KeywordTok{library}\NormalTok{(corrplot)}
\CommentTok{#> corrplot 0.84 loaded}

\CommentTok{# attach the BostonHousing dataset}
\KeywordTok{data}\NormalTok{(BostonHousing)}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{dplyr}\OperatorTok{::}\KeywordTok{glimpse}\NormalTok{(BostonHousing)}
\CommentTok{#> Observations: 506}
\CommentTok{#> Variables: 14}
\CommentTok{#> $ crim    <dbl> 0.00632, 0.02731, 0.02729, 0.03237, 0.06905, 0.02985, ...}
\CommentTok{#> $ zn      <dbl> 18.0, 0.0, 0.0, 0.0, 0.0, 0.0, 12.5, 12.5, 12.5, 12.5,...}
\CommentTok{#> $ indus   <dbl> 2.31, 7.07, 7.07, 2.18, 2.18, 2.18, 7.87, 7.87, 7.87, ...}
\CommentTok{#> $ chas    <fct> 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, ...}
\CommentTok{#> $ nox     <dbl> 0.538, 0.469, 0.469, 0.458, 0.458, 0.458, 0.524, 0.524...}
\CommentTok{#> $ rm      <dbl> 6.58, 6.42, 7.18, 7.00, 7.15, 6.43, 6.01, 6.17, 5.63, ...}
\CommentTok{#> $ age     <dbl> 65.2, 78.9, 61.1, 45.8, 54.2, 58.7, 66.6, 96.1, 100.0,...}
\CommentTok{#> $ dis     <dbl> 4.09, 4.97, 4.97, 6.06, 6.06, 6.06, 5.56, 5.95, 6.08, ...}
\CommentTok{#> $ rad     <dbl> 1, 2, 2, 3, 3, 3, 5, 5, 5, 5, 5, 5, 5, 4, 4, 4, 4, 4, ...}
\CommentTok{#> $ tax     <dbl> 296, 242, 242, 222, 222, 222, 311, 311, 311, 311, 311,...}
\CommentTok{#> $ ptratio <dbl> 15.3, 17.8, 17.8, 18.7, 18.7, 18.7, 15.2, 15.2, 15.2, ...}
\CommentTok{#> $ b       <dbl> 397, 397, 393, 395, 397, 394, 396, 397, 387, 387, 393,...}
\CommentTok{#> $ lstat   <dbl> 4.98, 9.14, 4.03, 2.94, 5.33, 5.21, 12.43, 19.15, 29.9...}
\CommentTok{#> $ medv    <dbl> 24.0, 21.6, 34.7, 33.4, 36.2, 28.7, 22.9, 27.1, 16.5, ...}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{tibble}\OperatorTok{::}\KeywordTok{as_tibble}\NormalTok{(BostonHousing)}
\CommentTok{#> # A tibble: 506 x 14}
\CommentTok{#>      crim    zn indus chas    nox    rm   age   dis   rad   tax ptratio}
\CommentTok{#>     <dbl> <dbl> <dbl> <fct> <dbl> <dbl> <dbl> <dbl> <dbl> <dbl>   <dbl>}
\CommentTok{#> 1 0.00632    18  2.31 0     0.538  6.58  65.2  4.09     1   296    15.3}
\CommentTok{#> 2 0.0273      0  7.07 0     0.469  6.42  78.9  4.97     2   242    17.8}
\CommentTok{#> 3 0.0273      0  7.07 0     0.469  7.18  61.1  4.97     2   242    17.8}
\CommentTok{#> 4 0.0324      0  2.18 0     0.458  7.00  45.8  6.06     3   222    18.7}
\CommentTok{#> 5 0.0690      0  2.18 0     0.458  7.15  54.2  6.06     3   222    18.7}
\CommentTok{#> 6 0.0298      0  2.18 0     0.458  6.43  58.7  6.06     3   222    18.7}
\CommentTok{#> # ... with 500 more rows, and 3 more variables: b <dbl>, lstat <dbl>,}
\CommentTok{#> #   medv <dbl>}
\end{Highlighting}
\end{Shaded}

\hypertarget{workflow-2}{%
\section{Workflow}\label{workflow-2}}

\begin{enumerate}
\def\labelenumi{\arabic{enumi}.}
\tightlist
\item
  Load dataset
\item
  Create train and test datasets, 80/20
\item
  Inspect dataset:
\end{enumerate}

\begin{itemize}
\tightlist
\item
  Dimension
\item
  classes
\item
  \texttt{skimr}
\end{itemize}

\begin{enumerate}
\def\labelenumi{\arabic{enumi}.}
\setcounter{enumi}{3}
\tightlist
\item
  Analyze features
\end{enumerate}

\begin{itemize}
\tightlist
\item
  correlation
\end{itemize}

\begin{enumerate}
\def\labelenumi{\arabic{enumi}.}
\setcounter{enumi}{4}
\tightlist
\item
  Visualize features
\end{enumerate}

\begin{itemize}
\tightlist
\item
  histograms
\item
  density plots
\item
  pairwise
\item
  correlogram
\end{itemize}

\begin{enumerate}
\def\labelenumi{\arabic{enumi}.}
\setcounter{enumi}{4}
\tightlist
\item
  Train as-is\\
\end{enumerate}

\begin{itemize}
\tightlist
\item
  Set the train control to

  \begin{itemize}
  \tightlist
  \item
    10 cross-validations
  \item
    3 repetitions
  \item
    Metric: RMSE
  \end{itemize}
\item
  Train the models
\item
  Compare accuracy of models
\item
  Visual comparison

  \begin{itemize}
  \tightlist
  \item
    dot plot
  \end{itemize}
\end{itemize}

\begin{enumerate}
\def\labelenumi{\arabic{enumi}.}
\setcounter{enumi}{5}
\tightlist
\item
  Train with Feature selection
\end{enumerate}

\begin{itemize}
\tightlist
\item
  Feature selection

  \begin{itemize}
  \tightlist
  \item
    \texttt{findCorrelation}
  \item
    generate new dataset
  \end{itemize}
\item
  Train models again\\
\item
  Compare RMSE again
\item
  Visual comparison

  \begin{itemize}
  \tightlist
  \item
    dot plot\\
  \end{itemize}
\end{itemize}

\begin{enumerate}
\def\labelenumi{\arabic{enumi}.}
\setcounter{enumi}{6}
\tightlist
\item
  Train with dataset transformation
\end{enumerate}

\begin{itemize}
\tightlist
\item
  data transformatiom

  \begin{itemize}
  \tightlist
  \item
    Center
  \item
    Scale
  \item
    BoxCox
  \end{itemize}
\item
  Train models
\item
  Compare RMSE
\item
  Visual comparison

  \begin{itemize}
  \tightlist
  \item
    dot plot
  \end{itemize}
\end{itemize}

\begin{enumerate}
\def\labelenumi{\arabic{enumi}.}
\setcounter{enumi}{7}
\tightlist
\item
  Tune the best model
\end{enumerate}

\begin{itemize}
\tightlist
\item
  Set the train control to

  \begin{itemize}
  \tightlist
  \item
    10 cross-validations
  \item
    3 repetitions
  \item
    Metric: RMSE
  \end{itemize}
\item
  Train the models

  \begin{itemize}
  \tightlist
  \item
    Radial SVM
  \item
    Sigma vector
  \item
    .C
  \item
    BoxCox
    9, Ensembling
  \end{itemize}
\item
  Select the algorithms

  \begin{itemize}
  \tightlist
  \item
    Random Forest
  \item
    Stochastic Gradient Boosting
  \item
    Cubist
  \end{itemize}
\item
  Numeric comparison

  \begin{itemize}
  \tightlist
  \item
    resample
  \item
    summary
  \end{itemize}
\item
  Visual comparison
\item
  dot plot
\end{itemize}

\begin{enumerate}
\def\labelenumi{\arabic{enumi}.}
\setcounter{enumi}{9}
\tightlist
\item
  Tune the best model: Cubist
\end{enumerate}

\begin{itemize}
\tightlist
\item
  Set the train control to

  \begin{itemize}
  \tightlist
  \item
    10 cross-validations
  \item
    3 repetitions
  \item
    Metric: RMSE
  \end{itemize}
\item
  Train the models

  \begin{itemize}
  \tightlist
  \item
    Cubist
  \item
    \texttt{.committees}
  \item
    \texttt{.neighbors}
  \item
    BoxCox
  \end{itemize}
\item
  Evaluate the tuning parameters

  \begin{itemize}
  \tightlist
  \item
    Numeric comparison

    \begin{itemize}
    \tightlist
    \item
      print tuned model
    \end{itemize}
  \item
    Visual comparison

    \begin{itemize}
    \tightlist
    \item
      scatter plot
    \end{itemize}
  \end{itemize}
\end{itemize}

\begin{enumerate}
\def\labelenumi{\arabic{enumi}.}
\setcounter{enumi}{10}
\tightlist
\item
  Finalize the model
\end{enumerate}

\begin{itemize}
\tightlist
\item
  Back transformation
\item
  Summary
\end{itemize}

\begin{enumerate}
\def\labelenumi{\arabic{enumi}.}
\setcounter{enumi}{11}
\tightlist
\item
  Apply model to validation set

  \begin{itemize}
  \tightlist
  \item
    Transform the dataset
  \item
    Make prediction
  \item
    Calculate the RMSE
  \end{itemize}
\end{enumerate}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# Split out validation dataset}
\CommentTok{# create a list of 80% of the rows in the original dataset we can use for training}
\KeywordTok{set.seed}\NormalTok{(}\DecValTok{7}\NormalTok{)}
\NormalTok{validationIndex <-}\StringTok{ }\KeywordTok{createDataPartition}\NormalTok{(BostonHousing}\OperatorTok{$}\NormalTok{medv, }
                                       \DataTypeTok{p=}\FloatTok{0.80}\NormalTok{, }\DataTypeTok{list=}\OtherTok{FALSE}\NormalTok{)}

\CommentTok{# select 20% of the data for validation}
\NormalTok{validation <-}\StringTok{ }\NormalTok{BostonHousing[}\OperatorTok{-}\NormalTok{validationIndex,]}

\CommentTok{# use the remaining 80% of data to training and testing the models}
\NormalTok{dataset <-}\StringTok{ }\NormalTok{BostonHousing[validationIndex,]}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# dimensions of dataset}
\KeywordTok{dim}\NormalTok{(validation)}
\CommentTok{#> [1] 99 14}
\KeywordTok{dim}\NormalTok{(dataset)}
\CommentTok{#> [1] 407  14}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# list types for each attribute}
\KeywordTok{sapply}\NormalTok{(dataset, class)}
\CommentTok{#>      crim        zn     indus      chas       nox        rm       age }
\CommentTok{#> "numeric" "numeric" "numeric"  "factor" "numeric" "numeric" "numeric" }
\CommentTok{#>       dis       rad       tax   ptratio         b     lstat      medv }
\CommentTok{#> "numeric" "numeric" "numeric" "numeric" "numeric" "numeric" "numeric"}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# take a peek at the first 20 rows of the data}
\KeywordTok{head}\NormalTok{(dataset, }\DataTypeTok{n=}\DecValTok{20}\NormalTok{)}
\CommentTok{#>       crim   zn indus chas   nox   rm   age  dis rad tax ptratio   b lstat}
\CommentTok{#> 1  0.00632 18.0  2.31    0 0.538 6.58  65.2 4.09   1 296    15.3 397  4.98}
\CommentTok{#> 2  0.02731  0.0  7.07    0 0.469 6.42  78.9 4.97   2 242    17.8 397  9.14}
\CommentTok{#> 3  0.02729  0.0  7.07    0 0.469 7.18  61.1 4.97   2 242    17.8 393  4.03}
\CommentTok{#> 4  0.03237  0.0  2.18    0 0.458 7.00  45.8 6.06   3 222    18.7 395  2.94}
\CommentTok{#> 5  0.06905  0.0  2.18    0 0.458 7.15  54.2 6.06   3 222    18.7 397  5.33}
\CommentTok{#> 6  0.02985  0.0  2.18    0 0.458 6.43  58.7 6.06   3 222    18.7 394  5.21}
\CommentTok{#> 7  0.08829 12.5  7.87    0 0.524 6.01  66.6 5.56   5 311    15.2 396 12.43}
\CommentTok{#> 10 0.17004 12.5  7.87    0 0.524 6.00  85.9 6.59   5 311    15.2 387 17.10}
\CommentTok{#> 11 0.22489 12.5  7.87    0 0.524 6.38  94.3 6.35   5 311    15.2 393 20.45}
\CommentTok{#> 12 0.11747 12.5  7.87    0 0.524 6.01  82.9 6.23   5 311    15.2 397 13.27}
\CommentTok{#> 13 0.09378 12.5  7.87    0 0.524 5.89  39.0 5.45   5 311    15.2 390 15.71}
\CommentTok{#> 14 0.62976  0.0  8.14    0 0.538 5.95  61.8 4.71   4 307    21.0 397  8.26}
\CommentTok{#> 15 0.63796  0.0  8.14    0 0.538 6.10  84.5 4.46   4 307    21.0 380 10.26}
\CommentTok{#> 17 1.05393  0.0  8.14    0 0.538 5.93  29.3 4.50   4 307    21.0 387  6.58}
\CommentTok{#> 20 0.72580  0.0  8.14    0 0.538 5.73  69.5 3.80   4 307    21.0 391 11.28}
\CommentTok{#> 21 1.25179  0.0  8.14    0 0.538 5.57  98.1 3.80   4 307    21.0 377 21.02}
\CommentTok{#> 22 0.85204  0.0  8.14    0 0.538 5.96  89.2 4.01   4 307    21.0 393 13.83}
\CommentTok{#> 23 1.23247  0.0  8.14    0 0.538 6.14  91.7 3.98   4 307    21.0 397 18.72}
\CommentTok{#> 24 0.98843  0.0  8.14    0 0.538 5.81 100.0 4.10   4 307    21.0 395 19.88}
\CommentTok{#> 25 0.75026  0.0  8.14    0 0.538 5.92  94.1 4.40   4 307    21.0 394 16.30}
\CommentTok{#>    medv}
\CommentTok{#> 1  24.0}
\CommentTok{#> 2  21.6}
\CommentTok{#> 3  34.7}
\CommentTok{#> 4  33.4}
\CommentTok{#> 5  36.2}
\CommentTok{#> 6  28.7}
\CommentTok{#> 7  22.9}
\CommentTok{#> 10 18.9}
\CommentTok{#> 11 15.0}
\CommentTok{#> 12 18.9}
\CommentTok{#> 13 21.7}
\CommentTok{#> 14 20.4}
\CommentTok{#> 15 18.2}
\CommentTok{#> 17 23.1}
\CommentTok{#> 20 18.2}
\CommentTok{#> 21 13.6}
\CommentTok{#> 22 19.6}
\CommentTok{#> 23 15.2}
\CommentTok{#> 24 14.5}
\CommentTok{#> 25 15.6}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{library}\NormalTok{(skimr)}
\CommentTok{#> }
\CommentTok{#> Attaching package: 'skimr'}
\CommentTok{#> The following object is masked from 'package:stats':}
\CommentTok{#> }
\CommentTok{#>     filter}
\KeywordTok{skim_with}\NormalTok{(}\DataTypeTok{numeric =} \KeywordTok{list}\NormalTok{(}\DataTypeTok{hist =} \OtherTok{NULL}\NormalTok{))}
\KeywordTok{skim}\NormalTok{(dataset)}
\CommentTok{#> Skim summary statistics}
\CommentTok{#>  n obs: 407 }
\CommentTok{#>  n variables: 14 }
\CommentTok{#> }
\CommentTok{#> -- Variable type:factor ----------------------------------------------------------}
\CommentTok{#>  variable missing complete   n n_unique           top_counts ordered}
\CommentTok{#>      chas       0      407 407        2 0: 378, 1: 29, NA: 0   FALSE}
\CommentTok{#> }
\CommentTok{#> -- Variable type:numeric ---------------------------------------------------------}
\CommentTok{#>  variable missing complete   n   mean     sd       p0    p25    p50    p75}
\CommentTok{#>       age       0      407 407  68.38  28.16   6.2     42.7   77.3   94.2 }
\CommentTok{#>         b       0      407 407 357.19  89.67   0.32   373.81 391.27 396.02}
\CommentTok{#>      crim       0      407 407   3.64   8.8    0.0063   0.08   0.27   3.69}
\CommentTok{#>       dis       0      407 407   3.82   2.12   1.13     2.11   3.15   5.21}
\CommentTok{#>     indus       0      407 407  11      6.87   0.74     4.93   8.56  18.1 }
\CommentTok{#>     lstat       0      407 407  12.56   7.03   1.92     7.06  11.32  16.45}
\CommentTok{#>      medv       0      407 407  22.52   8.96   5       17.05  21.2   25   }
\CommentTok{#>       nox       0      407 407   0.55   0.12   0.39     0.45   0.54   0.63}
\CommentTok{#>   ptratio       0      407 407  18.42   2.18  12.6     17     19     20.2 }
\CommentTok{#>       rad       0      407 407   9.59   8.77   1        4      5     24   }
\CommentTok{#>        rm       0      407 407   6.29   0.7    3.56     5.89   6.21   6.62}
\CommentTok{#>       tax       0      407 407 408.75 168.72 187      280.5  334    666   }
\CommentTok{#>        zn       0      407 407  11.92  24.19   0        0      0     15   }
\CommentTok{#>    p100}
\CommentTok{#>  100   }
\CommentTok{#>  396.9 }
\CommentTok{#>   88.98}
\CommentTok{#>   12.13}
\CommentTok{#>   27.74}
\CommentTok{#>   37.97}
\CommentTok{#>   50   }
\CommentTok{#>    0.87}
\CommentTok{#>   22   }
\CommentTok{#>   24   }
\CommentTok{#>    8.78}
\CommentTok{#>  711   }
\CommentTok{#>  100}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{dataset[,}\DecValTok{4}\NormalTok{] <-}\StringTok{ }\KeywordTok{as.numeric}\NormalTok{(}\KeywordTok{as.character}\NormalTok{(dataset[,}\DecValTok{4}\NormalTok{]))}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{skim}\NormalTok{(dataset)}
\CommentTok{#> Skim summary statistics}
\CommentTok{#>  n obs: 407 }
\CommentTok{#>  n variables: 14 }
\CommentTok{#> }
\CommentTok{#> -- Variable type:numeric ---------------------------------------------------------}
\CommentTok{#>  variable missing complete   n    mean     sd       p0    p25    p50}
\CommentTok{#>       age       0      407 407  68.38   28.16   6.2     42.7   77.3 }
\CommentTok{#>         b       0      407 407 357.19   89.67   0.32   373.81 391.27}
\CommentTok{#>      chas       0      407 407   0.071   0.26   0        0      0   }
\CommentTok{#>      crim       0      407 407   3.64    8.8    0.0063   0.08   0.27}
\CommentTok{#>       dis       0      407 407   3.82    2.12   1.13     2.11   3.15}
\CommentTok{#>     indus       0      407 407  11       6.87   0.74     4.93   8.56}
\CommentTok{#>     lstat       0      407 407  12.56    7.03   1.92     7.06  11.32}
\CommentTok{#>      medv       0      407 407  22.52    8.96   5       17.05  21.2 }
\CommentTok{#>       nox       0      407 407   0.55    0.12   0.39     0.45   0.54}
\CommentTok{#>   ptratio       0      407 407  18.42    2.18  12.6     17     19   }
\CommentTok{#>       rad       0      407 407   9.59    8.77   1        4      5   }
\CommentTok{#>        rm       0      407 407   6.29    0.7    3.56     5.89   6.21}
\CommentTok{#>       tax       0      407 407 408.75  168.72 187      280.5  334   }
\CommentTok{#>        zn       0      407 407  11.92   24.19   0        0      0   }
\CommentTok{#>     p75   p100}
\CommentTok{#>   94.2  100   }
\CommentTok{#>  396.02 396.9 }
\CommentTok{#>    0      1   }
\CommentTok{#>    3.69  88.98}
\CommentTok{#>    5.21  12.13}
\CommentTok{#>   18.1   27.74}
\CommentTok{#>   16.45  37.97}
\CommentTok{#>   25     50   }
\CommentTok{#>    0.63   0.87}
\CommentTok{#>   20.2   22   }
\CommentTok{#>   24     24   }
\CommentTok{#>    6.62   8.78}
\CommentTok{#>  666    711   }
\CommentTok{#>   15    100}
\end{Highlighting}
\end{Shaded}

\begin{quote}
no more factors or character variables
\end{quote}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# find correlation between variables}
\KeywordTok{cor}\NormalTok{(dataset[,}\DecValTok{1}\OperatorTok{:}\DecValTok{13}\NormalTok{])}
\CommentTok{#>            crim      zn   indus     chas     nox     rm     age    dis}
\CommentTok{#> crim     1.0000 -0.1996  0.4076 -0.05507  0.4099 -0.194  0.3524 -0.376}
\CommentTok{#> zn      -0.1996  1.0000 -0.5314 -0.02987 -0.5202  0.311 -0.5845  0.680}
\CommentTok{#> indus    0.4076 -0.5314  1.0000  0.06583  0.7733 -0.383  0.6512 -0.711}
\CommentTok{#> chas    -0.0551 -0.0299  0.0658  1.00000  0.0934  0.127  0.0735 -0.099}
\CommentTok{#> nox      0.4099 -0.5202  0.7733  0.09340  1.0000 -0.296  0.7338 -0.769}
\CommentTok{#> rm      -0.1940  0.3111 -0.3826  0.12677 -0.2961  1.000 -0.2262  0.207}
\CommentTok{#> age      0.3524 -0.5845  0.6512  0.07350  0.7338 -0.226  1.0000 -0.749}
\CommentTok{#> dis     -0.3756  0.6799 -0.7113 -0.09905 -0.7693  0.207 -0.7492  1.000}
\CommentTok{#> rad      0.6083 -0.3227  0.6200 -0.00245  0.6276 -0.221  0.4690 -0.504}
\CommentTok{#> tax      0.5711 -0.3184  0.7185 -0.03064  0.6758 -0.295  0.5058 -0.526}
\CommentTok{#> ptratio  0.2897 -0.3888  0.3782 -0.12283  0.1888 -0.365  0.2709 -0.228}
\CommentTok{#> b       -0.3442  0.1747 -0.3644  0.03782 -0.3684  0.126 -0.2742  0.284}
\CommentTok{#> lstat    0.4229 -0.4219  0.6136 -0.08430  0.5839 -0.612  0.6066 -0.501}
\CommentTok{#>              rad     tax ptratio       b   lstat}
\CommentTok{#> crim     0.60834  0.5711   0.290 -0.3442  0.4229}
\CommentTok{#> zn      -0.32273 -0.3184  -0.389  0.1747 -0.4219}
\CommentTok{#> indus    0.61998  0.7185   0.378 -0.3644  0.6136}
\CommentTok{#> chas    -0.00245 -0.0306  -0.123  0.0378 -0.0843}
\CommentTok{#> nox      0.62760  0.6758   0.189 -0.3684  0.5839}
\CommentTok{#> rm      -0.22126 -0.2953  -0.365  0.1260 -0.6120}
\CommentTok{#> age      0.46896  0.5058   0.271 -0.2742  0.6066}
\CommentTok{#> dis     -0.50372 -0.5264  -0.228  0.2843 -0.5013}
\CommentTok{#> rad      1.00000  0.9201   0.480 -0.4231  0.5025}
\CommentTok{#> tax      0.92005  1.0000   0.469 -0.4303  0.5538}
\CommentTok{#> ptratio  0.47971  0.4691   1.000 -0.1700  0.4093}
\CommentTok{#> b       -0.42314 -0.4303  -0.170  1.0000 -0.3509}
\CommentTok{#> lstat    0.50251  0.5538   0.409 -0.3509  1.0000}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{library}\NormalTok{(dplyr)}
\CommentTok{#> }
\CommentTok{#> Attaching package: 'dplyr'}
\CommentTok{#> The following objects are masked from 'package:stats':}
\CommentTok{#> }
\CommentTok{#>     filter, lag}
\CommentTok{#> The following objects are masked from 'package:base':}
\CommentTok{#> }
\CommentTok{#>     intersect, setdiff, setequal, union}

\NormalTok{m <-}\StringTok{ }\KeywordTok{cor}\NormalTok{(dataset[,}\DecValTok{1}\OperatorTok{:}\DecValTok{13}\NormalTok{])}
\KeywordTok{diag}\NormalTok{(m) <-}\StringTok{ }\DecValTok{0}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# select variables with correlation 0.7 and above}
\NormalTok{threshold <-}\StringTok{ }\FloatTok{0.7}
\NormalTok{ok <-}\StringTok{ }\KeywordTok{apply}\NormalTok{(}\KeywordTok{abs}\NormalTok{(m) }\OperatorTok{>=}\StringTok{ }\NormalTok{threshold, }\DecValTok{1}\NormalTok{, any)}
\NormalTok{m[ok, ok]}
\CommentTok{#>        indus    nox    age    dis    rad    tax}
\CommentTok{#> indus  0.000  0.773  0.651 -0.711  0.620  0.719}
\CommentTok{#> nox    0.773  0.000  0.734 -0.769  0.628  0.676}
\CommentTok{#> age    0.651  0.734  0.000 -0.749  0.469  0.506}
\CommentTok{#> dis   -0.711 -0.769 -0.749  0.000 -0.504 -0.526}
\CommentTok{#> rad    0.620  0.628  0.469 -0.504  0.000  0.920}
\CommentTok{#> tax    0.719  0.676  0.506 -0.526  0.920  0.000}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# values of correlation >= 0.7}
\NormalTok{ind <-}\StringTok{ }\KeywordTok{sapply}\NormalTok{(}\DecValTok{1}\OperatorTok{:}\DecValTok{13}\NormalTok{, }\ControlFlowTok{function}\NormalTok{(x) }\KeywordTok{abs}\NormalTok{(m[, x]) }\OperatorTok{>}\StringTok{ }\FloatTok{0.7}\NormalTok{)}
\NormalTok{m[ind]}
\CommentTok{#>  [1]  0.773 -0.711  0.719  0.773  0.734 -0.769  0.734 -0.749 -0.711 -0.769}
\CommentTok{#> [11] -0.749  0.920  0.719  0.920}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# defining a index for selecting if the condition is met}
\NormalTok{cind <-}\StringTok{ }\KeywordTok{apply}\NormalTok{(m, }\DecValTok{2}\NormalTok{, }\ControlFlowTok{function}\NormalTok{(x) }\KeywordTok{any}\NormalTok{(}\KeywordTok{abs}\NormalTok{(x) }\OperatorTok{>}\StringTok{ }\FloatTok{0.7}\NormalTok{))}
\NormalTok{cm <-}\StringTok{ }\NormalTok{m[, cind] }\CommentTok{# since col6 only has values less than 0.5 it is not taken}
\NormalTok{cm}
\CommentTok{#>           indus     nox     age    dis      rad     tax}
\CommentTok{#> crim     0.4076  0.4099  0.3524 -0.376  0.60834  0.5711}
\CommentTok{#> zn      -0.5314 -0.5202 -0.5845  0.680 -0.32273 -0.3184}
\CommentTok{#> indus    0.0000  0.7733  0.6512 -0.711  0.61998  0.7185}
\CommentTok{#> chas     0.0658  0.0934  0.0735 -0.099 -0.00245 -0.0306}
\CommentTok{#> nox      0.7733  0.0000  0.7338 -0.769  0.62760  0.6758}
\CommentTok{#> rm      -0.3826 -0.2961 -0.2262  0.207 -0.22126 -0.2953}
\CommentTok{#> age      0.6512  0.7338  0.0000 -0.749  0.46896  0.5058}
\CommentTok{#> dis     -0.7113 -0.7693 -0.7492  0.000 -0.50372 -0.5264}
\CommentTok{#> rad      0.6200  0.6276  0.4690 -0.504  0.00000  0.9201}
\CommentTok{#> tax      0.7185  0.6758  0.5058 -0.526  0.92005  0.0000}
\CommentTok{#> ptratio  0.3782  0.1888  0.2709 -0.228  0.47971  0.4691}
\CommentTok{#> b       -0.3644 -0.3684 -0.2742  0.284 -0.42314 -0.4303}
\CommentTok{#> lstat    0.6136  0.5839  0.6066 -0.501  0.50251  0.5538}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{rind <-}\StringTok{ }\KeywordTok{apply}\NormalTok{(cm, }\DecValTok{1}\NormalTok{, }\ControlFlowTok{function}\NormalTok{(x) }\KeywordTok{any}\NormalTok{(}\KeywordTok{abs}\NormalTok{(x) }\OperatorTok{>}\StringTok{ }\FloatTok{0.7}\NormalTok{))  }
\NormalTok{rm <-}\StringTok{ }\NormalTok{cm[rind, ]}
\NormalTok{rm}
\CommentTok{#>        indus    nox    age    dis    rad    tax}
\CommentTok{#> indus  0.000  0.773  0.651 -0.711  0.620  0.719}
\CommentTok{#> nox    0.773  0.000  0.734 -0.769  0.628  0.676}
\CommentTok{#> age    0.651  0.734  0.000 -0.749  0.469  0.506}
\CommentTok{#> dis   -0.711 -0.769 -0.749  0.000 -0.504 -0.526}
\CommentTok{#> rad    0.620  0.628  0.469 -0.504  0.000  0.920}
\CommentTok{#> tax    0.719  0.676  0.506 -0.526  0.920  0.000}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# histograms for each attribute}
\KeywordTok{par}\NormalTok{(}\DataTypeTok{mfrow=}\KeywordTok{c}\NormalTok{(}\DecValTok{3}\NormalTok{,}\DecValTok{5}\NormalTok{))}
\ControlFlowTok{for}\NormalTok{(i }\ControlFlowTok{in} \DecValTok{1}\OperatorTok{:}\DecValTok{13}\NormalTok{) \{}
    \KeywordTok{hist}\NormalTok{(dataset[,i], }\DataTypeTok{main=}\KeywordTok{names}\NormalTok{(dataset)[i])}
\NormalTok{\}}
\end{Highlighting}
\end{Shaded}

\begin{center}\includegraphics[width=0.7\linewidth]{comparison_321-regression_boston-multi_files/figure-latex/plot-histograms-1} \end{center}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# density plot for each attribute}
\KeywordTok{par}\NormalTok{(}\DataTypeTok{mfrow=}\KeywordTok{c}\NormalTok{(}\DecValTok{3}\NormalTok{,}\DecValTok{5}\NormalTok{))}
\ControlFlowTok{for}\NormalTok{(i }\ControlFlowTok{in} \DecValTok{1}\OperatorTok{:}\DecValTok{13}\NormalTok{) \{}
\KeywordTok{plot}\NormalTok{(}\KeywordTok{density}\NormalTok{(dataset[,i]), }\DataTypeTok{main=}\KeywordTok{names}\NormalTok{(dataset)[i])}
\NormalTok{\}}
\end{Highlighting}
\end{Shaded}

\begin{center}\includegraphics[width=0.7\linewidth]{comparison_321-regression_boston-multi_files/figure-latex/plot-density-1} \end{center}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# boxplots for each attribute}
\KeywordTok{par}\NormalTok{(}\DataTypeTok{mfrow=}\KeywordTok{c}\NormalTok{(}\DecValTok{3}\NormalTok{,}\DecValTok{5}\NormalTok{))}
\ControlFlowTok{for}\NormalTok{(i }\ControlFlowTok{in} \DecValTok{1}\OperatorTok{:}\DecValTok{13}\NormalTok{) \{}
\KeywordTok{boxplot}\NormalTok{(dataset[,i], }\DataTypeTok{main=}\KeywordTok{names}\NormalTok{(dataset)[i])}
\NormalTok{\}}
\end{Highlighting}
\end{Shaded}

\begin{center}\includegraphics[width=0.7\linewidth]{comparison_321-regression_boston-multi_files/figure-latex/plot-boxplots, -1} \end{center}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# scatter plot matrix}
\KeywordTok{pairs}\NormalTok{(dataset[,}\DecValTok{1}\OperatorTok{:}\DecValTok{13}\NormalTok{])}
\end{Highlighting}
\end{Shaded}

\begin{center}\includegraphics[width=0.7\linewidth]{comparison_321-regression_boston-multi_files/figure-latex/unnamed-chunk-19-1} \end{center}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# correlation plot}
\NormalTok{correlations <-}\StringTok{ }\KeywordTok{cor}\NormalTok{(dataset[,}\DecValTok{1}\OperatorTok{:}\DecValTok{13}\NormalTok{])}
\KeywordTok{corrplot}\NormalTok{(correlations, }\DataTypeTok{method=}\StringTok{"circle"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{center}\includegraphics[width=0.7\linewidth]{comparison_321-regression_boston-multi_files/figure-latex/plot-correlation-1} \end{center}

\hypertarget{evaluation}{%
\section{Evaluation}\label{evaluation}}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# Run algorithms using 10-fold cross-validation}
\NormalTok{trainControl <-}\StringTok{ }\KeywordTok{trainControl}\NormalTok{(}\DataTypeTok{method=}\StringTok{"repeatedcv"}\NormalTok{, }\DataTypeTok{number=}\DecValTok{10}\NormalTok{, }\DataTypeTok{repeats=}\DecValTok{3}\NormalTok{)}
\NormalTok{metric <-}\StringTok{ "RMSE"}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# LM}
\KeywordTok{set.seed}\NormalTok{(}\DecValTok{7}\NormalTok{)}
\NormalTok{fit.lm <-}\StringTok{ }\KeywordTok{train}\NormalTok{(medv}\OperatorTok{~}\NormalTok{., }\DataTypeTok{data=}\NormalTok{dataset, }\DataTypeTok{method=}\StringTok{"lm"}\NormalTok{, }
                \DataTypeTok{metric=}\NormalTok{metric, }\DataTypeTok{preProc=}\KeywordTok{c}\NormalTok{(}\StringTok{"center"}\NormalTok{, }\StringTok{"scale"}\NormalTok{), }
                \DataTypeTok{trControl=}\NormalTok{trainControl)}
\CommentTok{# GLM}
\KeywordTok{set.seed}\NormalTok{(}\DecValTok{7}\NormalTok{)}
\NormalTok{fit.glm <-}\StringTok{ }\KeywordTok{train}\NormalTok{(medv}\OperatorTok{~}\NormalTok{., }\DataTypeTok{data=}\NormalTok{dataset, }\DataTypeTok{method=}\StringTok{"glm"}\NormalTok{, }
                 \DataTypeTok{metric=}\NormalTok{metric, }\DataTypeTok{preProc=}\KeywordTok{c}\NormalTok{(}\StringTok{"center"}\NormalTok{, }\StringTok{"scale"}\NormalTok{), }
                 \DataTypeTok{trControl=}\NormalTok{trainControl)}
\CommentTok{# GLMNET}
\KeywordTok{set.seed}\NormalTok{(}\DecValTok{7}\NormalTok{)}
\NormalTok{fit.glmnet <-}\StringTok{ }\KeywordTok{train}\NormalTok{(medv}\OperatorTok{~}\NormalTok{., }\DataTypeTok{data=}\NormalTok{dataset, }\DataTypeTok{method=}\StringTok{"glmnet"}\NormalTok{, }
                    \DataTypeTok{metric=}\NormalTok{metric, }
                    \DataTypeTok{preProc=}\KeywordTok{c}\NormalTok{(}\StringTok{"center"}\NormalTok{, }\StringTok{"scale"}\NormalTok{), }
                    \DataTypeTok{trControl=}\NormalTok{trainControl)}
\CommentTok{# SVM}
\KeywordTok{set.seed}\NormalTok{(}\DecValTok{7}\NormalTok{)}
\NormalTok{fit.svm <-}\StringTok{ }\KeywordTok{train}\NormalTok{(medv}\OperatorTok{~}\NormalTok{., }\DataTypeTok{data=}\NormalTok{dataset, }\DataTypeTok{method=}\StringTok{"svmRadial"}\NormalTok{, }
                 \DataTypeTok{metric=}\NormalTok{metric, }
                 \DataTypeTok{preProc=}\KeywordTok{c}\NormalTok{(}\StringTok{"center"}\NormalTok{, }\StringTok{"scale"}\NormalTok{), }
                 \DataTypeTok{trControl=}\NormalTok{trainControl)}
\CommentTok{# CART}
\KeywordTok{set.seed}\NormalTok{(}\DecValTok{7}\NormalTok{)}
\NormalTok{grid <-}\StringTok{ }\KeywordTok{expand.grid}\NormalTok{(}\DataTypeTok{.cp=}\KeywordTok{c}\NormalTok{(}\DecValTok{0}\NormalTok{, }\FloatTok{0.05}\NormalTok{, }\FloatTok{0.1}\NormalTok{))}
\NormalTok{fit.cart <-}\StringTok{ }\KeywordTok{train}\NormalTok{(medv}\OperatorTok{~}\NormalTok{., }\DataTypeTok{data=}\NormalTok{dataset, }\DataTypeTok{method=}\StringTok{"rpart"}\NormalTok{, }
                  \DataTypeTok{metric=}\NormalTok{metric, }\DataTypeTok{tuneGrid=}\NormalTok{grid, }
                  \DataTypeTok{preProc=}\KeywordTok{c}\NormalTok{(}\StringTok{"center"}\NormalTok{, }\StringTok{"scale"}\NormalTok{), }
                  \DataTypeTok{trControl=}\NormalTok{trainControl)}
\CommentTok{# KNN}
\KeywordTok{set.seed}\NormalTok{(}\DecValTok{7}\NormalTok{)}
\NormalTok{fit.knn <-}\StringTok{ }\KeywordTok{train}\NormalTok{(medv}\OperatorTok{~}\NormalTok{., }\DataTypeTok{data=}\NormalTok{dataset, }\DataTypeTok{method=}\StringTok{"knn"}\NormalTok{, }
                 \DataTypeTok{metric=}\NormalTok{metric, }\DataTypeTok{preProc=}\KeywordTok{c}\NormalTok{(}\StringTok{"center"}\NormalTok{, }\StringTok{"scale"}\NormalTok{), }
                 \DataTypeTok{trControl=}\NormalTok{trainControl)}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# Compare algorithms}
\NormalTok{results <-}\StringTok{ }\KeywordTok{resamples}\NormalTok{(}\KeywordTok{list}\NormalTok{(}\DataTypeTok{LM     =}\NormalTok{ fit.lm, }
                          \DataTypeTok{GLM    =}\NormalTok{ fit.glm, }
                          \DataTypeTok{GLMNET =}\NormalTok{ fit.glmnet, }
                          \DataTypeTok{SVM    =}\NormalTok{ fit.svm, }
                          \DataTypeTok{CART   =}\NormalTok{ fit.cart, }
                          \DataTypeTok{KNN    =}\NormalTok{ fit.knn))}
\KeywordTok{summary}\NormalTok{(results)}
\CommentTok{#> }
\CommentTok{#> Call:}
\CommentTok{#> summary.resamples(object = results)}
\CommentTok{#> }
\CommentTok{#> Models: LM, GLM, GLMNET, SVM, CART, KNN }
\CommentTok{#> Number of resamples: 30 }
\CommentTok{#> }
\CommentTok{#> MAE }
\CommentTok{#>        Min. 1st Qu. Median Mean 3rd Qu. Max. NA's}
\CommentTok{#> LM     2.30    2.90   3.37 3.32    3.70 4.64    0}
\CommentTok{#> GLM    2.30    2.90   3.37 3.32    3.70 4.64    0}
\CommentTok{#> GLMNET 2.30    2.88   3.34 3.30    3.70 4.63    0}
\CommentTok{#> SVM    1.42    1.99   2.52 2.39    2.65 3.35    0}
\CommentTok{#> CART   2.22    2.62   2.88 2.93    3.08 4.16    0}
\CommentTok{#> KNN    1.98    2.69   2.87 2.95    3.24 4.00    0}
\CommentTok{#> }
\CommentTok{#> RMSE }
\CommentTok{#>        Min. 1st Qu. Median Mean 3rd Qu. Max. NA's}
\CommentTok{#> LM     2.99    3.87   4.63 4.63    5.32 6.69    0}
\CommentTok{#> GLM    2.99    3.87   4.63 4.63    5.32 6.69    0}
\CommentTok{#> GLMNET 2.99    3.88   4.62 4.62    5.32 6.69    0}
\CommentTok{#> SVM    2.05    2.95   3.81 3.91    4.46 6.98    0}
\CommentTok{#> CART   2.77    3.38   4.00 4.20    4.60 7.09    0}
\CommentTok{#> KNN    2.65    3.74   4.42 4.48    5.06 6.98    0}
\CommentTok{#> }
\CommentTok{#> Rsquared }
\CommentTok{#>         Min. 1st Qu. Median  Mean 3rd Qu.  Max. NA's}
\CommentTok{#> LM     0.505   0.674  0.747 0.740   0.813 0.900    0}
\CommentTok{#> GLM    0.505   0.674  0.747 0.740   0.813 0.900    0}
\CommentTok{#> GLMNET 0.503   0.673  0.747 0.741   0.816 0.904    0}
\CommentTok{#> SVM    0.519   0.762  0.845 0.810   0.896 0.970    0}
\CommentTok{#> CART   0.514   0.737  0.816 0.778   0.842 0.899    0}
\CommentTok{#> KNN    0.519   0.748  0.804 0.770   0.829 0.931    0}
\KeywordTok{dotplot}\NormalTok{(results)}
\end{Highlighting}
\end{Shaded}

\begin{center}\includegraphics[width=0.7\linewidth]{comparison_321-regression_boston-multi_files/figure-latex/unnamed-chunk-21-1} \end{center}

\hypertarget{feature-selection}{%
\section{Feature selection}\label{feature-selection}}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# remove correlated attributes}
\CommentTok{# find attributes that are highly correlated}
\KeywordTok{set.seed}\NormalTok{(}\DecValTok{7}\NormalTok{)}
\NormalTok{cutoff <-}\StringTok{ }\FloatTok{0.70}
\NormalTok{correlations <-}\StringTok{ }\KeywordTok{cor}\NormalTok{(dataset[,}\DecValTok{1}\OperatorTok{:}\DecValTok{13}\NormalTok{])}
\NormalTok{highlyCorrelated <-}\StringTok{ }\KeywordTok{findCorrelation}\NormalTok{(correlations, }\DataTypeTok{cutoff=}\NormalTok{cutoff)}

\ControlFlowTok{for}\NormalTok{ (value }\ControlFlowTok{in}\NormalTok{ highlyCorrelated) \{}
    \KeywordTok{print}\NormalTok{(}\KeywordTok{names}\NormalTok{(dataset)[value])}
\NormalTok{\}}
\CommentTok{#> [1] "indus"}
\CommentTok{#> [1] "nox"}
\CommentTok{#> [1] "tax"}
\CommentTok{#> [1] "dis"}

\CommentTok{# create a new dataset without highly correlated features}
\NormalTok{datasetFeatures <-}\StringTok{ }\NormalTok{dataset[,}\OperatorTok{-}\NormalTok{highlyCorrelated]}
\KeywordTok{dim}\NormalTok{(datasetFeatures)}
\CommentTok{#> [1] 407  10}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# Run algorithms using 10-fold cross-validation}
\NormalTok{trainControl <-}\StringTok{ }\KeywordTok{trainControl}\NormalTok{(}\DataTypeTok{method=}\StringTok{"repeatedcv"}\NormalTok{, }\DataTypeTok{number=}\DecValTok{10}\NormalTok{, }\DataTypeTok{repeats=}\DecValTok{3}\NormalTok{)}
\NormalTok{metric <-}\StringTok{ "RMSE"}

\CommentTok{# LM}
\KeywordTok{set.seed}\NormalTok{(}\DecValTok{7}\NormalTok{)}
\NormalTok{fit.lm <-}\StringTok{ }\KeywordTok{train}\NormalTok{(medv}\OperatorTok{~}\NormalTok{., }\DataTypeTok{data=}\NormalTok{dataset, }\DataTypeTok{method=}\StringTok{"lm"}\NormalTok{, }
                \DataTypeTok{metric=}\NormalTok{metric, }\DataTypeTok{preProc=}\KeywordTok{c}\NormalTok{(}\StringTok{"center"}\NormalTok{, }\StringTok{"scale"}\NormalTok{), }
                \DataTypeTok{trControl=}\NormalTok{trainControl)}
\CommentTok{# GLM}
\KeywordTok{set.seed}\NormalTok{(}\DecValTok{7}\NormalTok{)}
\NormalTok{fit.glm <-}\StringTok{ }\KeywordTok{train}\NormalTok{(medv}\OperatorTok{~}\NormalTok{., }\DataTypeTok{data=}\NormalTok{dataset, }\DataTypeTok{method=}\StringTok{"glm"}\NormalTok{, }
                 \DataTypeTok{metric=}\NormalTok{metric, }\DataTypeTok{preProc=}\KeywordTok{c}\NormalTok{(}\StringTok{"center"}\NormalTok{, }\StringTok{"scale"}\NormalTok{), }
                 \DataTypeTok{trControl=}\NormalTok{trainControl)}
\CommentTok{# GLMNET}
\KeywordTok{set.seed}\NormalTok{(}\DecValTok{7}\NormalTok{)}
\NormalTok{fit.glmnet <-}\StringTok{ }\KeywordTok{train}\NormalTok{(medv}\OperatorTok{~}\NormalTok{., }\DataTypeTok{data=}\NormalTok{dataset, }\DataTypeTok{method=}\StringTok{"glmnet"}\NormalTok{, }
                    \DataTypeTok{metric=}\NormalTok{metric, }
                    \DataTypeTok{preProc=}\KeywordTok{c}\NormalTok{(}\StringTok{"center"}\NormalTok{, }\StringTok{"scale"}\NormalTok{), }
                    \DataTypeTok{trControl=}\NormalTok{trainControl)}
\CommentTok{# SVM}
\KeywordTok{set.seed}\NormalTok{(}\DecValTok{7}\NormalTok{)}
\NormalTok{fit.svm <-}\StringTok{ }\KeywordTok{train}\NormalTok{(medv}\OperatorTok{~}\NormalTok{., }\DataTypeTok{data=}\NormalTok{dataset, }\DataTypeTok{method=}\StringTok{"svmRadial"}\NormalTok{, }
                 \DataTypeTok{metric=}\NormalTok{metric, }
                 \DataTypeTok{preProc=}\KeywordTok{c}\NormalTok{(}\StringTok{"center"}\NormalTok{, }\StringTok{"scale"}\NormalTok{), }
                 \DataTypeTok{trControl=}\NormalTok{trainControl)}
\CommentTok{# CART}
\KeywordTok{set.seed}\NormalTok{(}\DecValTok{7}\NormalTok{)}
\NormalTok{grid <-}\StringTok{ }\KeywordTok{expand.grid}\NormalTok{(}\DataTypeTok{.cp=}\KeywordTok{c}\NormalTok{(}\DecValTok{0}\NormalTok{, }\FloatTok{0.05}\NormalTok{, }\FloatTok{0.1}\NormalTok{))}
\NormalTok{fit.cart <-}\StringTok{ }\KeywordTok{train}\NormalTok{(medv}\OperatorTok{~}\NormalTok{., }\DataTypeTok{data=}\NormalTok{dataset, }\DataTypeTok{method=}\StringTok{"rpart"}\NormalTok{, }
                  \DataTypeTok{metric=}\NormalTok{metric, }\DataTypeTok{tuneGrid=}\NormalTok{grid, }
                  \DataTypeTok{preProc=}\KeywordTok{c}\NormalTok{(}\StringTok{"center"}\NormalTok{, }\StringTok{"scale"}\NormalTok{), }
                  \DataTypeTok{trControl=}\NormalTok{trainControl)}
\CommentTok{# KNN}
\KeywordTok{set.seed}\NormalTok{(}\DecValTok{7}\NormalTok{)}
\NormalTok{fit.knn <-}\StringTok{ }\KeywordTok{train}\NormalTok{(medv}\OperatorTok{~}\NormalTok{., }\DataTypeTok{data=}\NormalTok{dataset, }\DataTypeTok{method=}\StringTok{"knn"}\NormalTok{, }
                 \DataTypeTok{metric=}\NormalTok{metric, }\DataTypeTok{preProc=}\KeywordTok{c}\NormalTok{(}\StringTok{"center"}\NormalTok{, }\StringTok{"scale"}\NormalTok{), }
                 \DataTypeTok{trControl=}\NormalTok{trainControl)}

\CommentTok{# Compare algorithms}
\NormalTok{feature_results <-}\StringTok{ }\KeywordTok{resamples}\NormalTok{(}\KeywordTok{list}\NormalTok{(}\DataTypeTok{LM     =}\NormalTok{ fit.lm, }
                                  \DataTypeTok{GLM    =}\NormalTok{ fit.glm, }
                                  \DataTypeTok{GLMNET =}\NormalTok{ fit.glmnet, }
                                  \DataTypeTok{SVM    =}\NormalTok{ fit.svm, }
                                  \DataTypeTok{CART   =}\NormalTok{ fit.cart, }
                                  \DataTypeTok{KNN    =}\NormalTok{ fit.knn))}
\KeywordTok{summary}\NormalTok{(feature_results)}
\CommentTok{#> }
\CommentTok{#> Call:}
\CommentTok{#> summary.resamples(object = feature_results)}
\CommentTok{#> }
\CommentTok{#> Models: LM, GLM, GLMNET, SVM, CART, KNN }
\CommentTok{#> Number of resamples: 30 }
\CommentTok{#> }
\CommentTok{#> MAE }
\CommentTok{#>        Min. 1st Qu. Median Mean 3rd Qu. Max. NA's}
\CommentTok{#> LM     2.30    2.90   3.37 3.32    3.70 4.64    0}
\CommentTok{#> GLM    2.30    2.90   3.37 3.32    3.70 4.64    0}
\CommentTok{#> GLMNET 2.30    2.88   3.34 3.30    3.70 4.63    0}
\CommentTok{#> SVM    1.42    1.99   2.52 2.39    2.65 3.35    0}
\CommentTok{#> CART   2.22    2.62   2.88 2.93    3.08 4.16    0}
\CommentTok{#> KNN    1.98    2.69   2.87 2.95    3.24 4.00    0}
\CommentTok{#> }
\CommentTok{#> RMSE }
\CommentTok{#>        Min. 1st Qu. Median Mean 3rd Qu. Max. NA's}
\CommentTok{#> LM     2.99    3.87   4.63 4.63    5.32 6.69    0}
\CommentTok{#> GLM    2.99    3.87   4.63 4.63    5.32 6.69    0}
\CommentTok{#> GLMNET 2.99    3.88   4.62 4.62    5.32 6.69    0}
\CommentTok{#> SVM    2.05    2.95   3.81 3.91    4.46 6.98    0}
\CommentTok{#> CART   2.77    3.38   4.00 4.20    4.60 7.09    0}
\CommentTok{#> KNN    2.65    3.74   4.42 4.48    5.06 6.98    0}
\CommentTok{#> }
\CommentTok{#> Rsquared }
\CommentTok{#>         Min. 1st Qu. Median  Mean 3rd Qu.  Max. NA's}
\CommentTok{#> LM     0.505   0.674  0.747 0.740   0.813 0.900    0}
\CommentTok{#> GLM    0.505   0.674  0.747 0.740   0.813 0.900    0}
\CommentTok{#> GLMNET 0.503   0.673  0.747 0.741   0.816 0.904    0}
\CommentTok{#> SVM    0.519   0.762  0.845 0.810   0.896 0.970    0}
\CommentTok{#> CART   0.514   0.737  0.816 0.778   0.842 0.899    0}
\CommentTok{#> KNN    0.519   0.748  0.804 0.770   0.829 0.931    0}
\KeywordTok{dotplot}\NormalTok{(feature_results)}
\end{Highlighting}
\end{Shaded}

\begin{center}\includegraphics[width=0.7\linewidth]{comparison_321-regression_boston-multi_files/figure-latex/models-second-run-removeFeatures-1} \end{center}

Comparing the results, we can see that this has made the RMSE worse for the linear and the nonlinear algorithms. The correlated attributes we removed are contributing to the accuracy of the models.

\hypertarget{evaluate-algorithms-box-cox-transform}{%
\section{Evaluate Algorithms: Box-Cox Transform}\label{evaluate-algorithms-box-cox-transform}}

We know that some of the attributes have a skew and others perhaps have an
exponential distribution. One option would be to explore squaring and log
transforms respectively (you could try this!). Another approach would be to use a power transform and let it figure out the amount to correct each attribute. One example is the \texttt{Box-Cox} power transform. Let's try using this transform to rescale the original data and evaluate the effect on the same 6 algorithms. We will also leave in the centering and scaling for the benefit of the instance-based methods.

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# Run algorithms using 10-fold cross-validation}
\NormalTok{trainControl <-}\StringTok{ }\KeywordTok{trainControl}\NormalTok{(}\DataTypeTok{method=}\StringTok{"repeatedcv"}\NormalTok{, }\DataTypeTok{number=}\DecValTok{10}\NormalTok{, }\DataTypeTok{repeats=}\DecValTok{3}\NormalTok{)}
\NormalTok{metric <-}\StringTok{ "RMSE"}

\CommentTok{# lm}
\KeywordTok{set.seed}\NormalTok{(}\DecValTok{7}\NormalTok{)}
\NormalTok{fit.lm <-}\StringTok{ }\KeywordTok{train}\NormalTok{(medv}\OperatorTok{~}\NormalTok{., }\DataTypeTok{data=}\NormalTok{dataset, }\DataTypeTok{method=}\StringTok{"lm"}\NormalTok{, }\DataTypeTok{metric=}\NormalTok{metric, }
                \DataTypeTok{preProc=}\KeywordTok{c}\NormalTok{(}\StringTok{"center"}\NormalTok{, }\StringTok{"scale"}\NormalTok{, }\StringTok{"BoxCox"}\NormalTok{), }
                \DataTypeTok{trControl=}\NormalTok{trainControl)}
\CommentTok{# GLM}
\KeywordTok{set.seed}\NormalTok{(}\DecValTok{7}\NormalTok{)}
\NormalTok{fit.glm <-}\StringTok{ }\KeywordTok{train}\NormalTok{(medv}\OperatorTok{~}\NormalTok{., }\DataTypeTok{data=}\NormalTok{dataset, }\DataTypeTok{method=}\StringTok{"glm"}\NormalTok{, }\DataTypeTok{metric=}\NormalTok{metric, }
                 \DataTypeTok{preProc=}\KeywordTok{c}\NormalTok{(}\StringTok{"center"}\NormalTok{, }\StringTok{"scale"}\NormalTok{, }\StringTok{"BoxCox"}\NormalTok{), }
                 \DataTypeTok{trControl=}\NormalTok{trainControl)}
\CommentTok{# GLMNET}
\KeywordTok{set.seed}\NormalTok{(}\DecValTok{7}\NormalTok{)}
\NormalTok{fit.glmnet <-}\StringTok{ }\KeywordTok{train}\NormalTok{(medv}\OperatorTok{~}\NormalTok{., }\DataTypeTok{data=}\NormalTok{dataset, }\DataTypeTok{method=}\StringTok{"glmnet"}\NormalTok{, }\DataTypeTok{metric=}\NormalTok{metric, }
                    \DataTypeTok{preProc=}\KeywordTok{c}\NormalTok{(}\StringTok{"center"}\NormalTok{, }\StringTok{"scale"}\NormalTok{, }\StringTok{"BoxCox"}\NormalTok{),}
                    \DataTypeTok{trControl=}\NormalTok{trainControl)}
\CommentTok{# SVM}
\KeywordTok{set.seed}\NormalTok{(}\DecValTok{7}\NormalTok{)}
\NormalTok{fit.svm <-}\StringTok{ }\KeywordTok{train}\NormalTok{(medv}\OperatorTok{~}\NormalTok{., }\DataTypeTok{data=}\NormalTok{dataset, }\DataTypeTok{method=}\StringTok{"svmRadial"}\NormalTok{, }\DataTypeTok{metric=}\NormalTok{metric, }
                 \DataTypeTok{preProc=}\KeywordTok{c}\NormalTok{(}\StringTok{"center"}\NormalTok{, }\StringTok{"scale"}\NormalTok{, }\StringTok{"BoxCox"}\NormalTok{),}
                 \DataTypeTok{trControl=}\NormalTok{trainControl)}
\CommentTok{# CART}
\KeywordTok{set.seed}\NormalTok{(}\DecValTok{7}\NormalTok{)}
\NormalTok{grid <-}\StringTok{ }\KeywordTok{expand.grid}\NormalTok{(}\DataTypeTok{.cp=}\KeywordTok{c}\NormalTok{(}\DecValTok{0}\NormalTok{, }\FloatTok{0.05}\NormalTok{, }\FloatTok{0.1}\NormalTok{))}
\NormalTok{fit.cart <-}\StringTok{ }\KeywordTok{train}\NormalTok{(medv}\OperatorTok{~}\NormalTok{., }\DataTypeTok{data=}\NormalTok{dataset, }\DataTypeTok{method=}\StringTok{"rpart"}\NormalTok{, }\DataTypeTok{metric=}\NormalTok{metric,}
                  \DataTypeTok{tuneGrid=}\NormalTok{grid,}
                  \DataTypeTok{preProc=}\KeywordTok{c}\NormalTok{(}\StringTok{"center"}\NormalTok{, }\StringTok{"scale"}\NormalTok{, }\StringTok{"BoxCox"}\NormalTok{),}
                  \DataTypeTok{trControl=}\NormalTok{trainControl)}
\CommentTok{# KNN}
\KeywordTok{set.seed}\NormalTok{(}\DecValTok{7}\NormalTok{)}
\NormalTok{fit.knn <-}\StringTok{ }\KeywordTok{train}\NormalTok{(medv}\OperatorTok{~}\NormalTok{., }\DataTypeTok{data=}\NormalTok{dataset, }\DataTypeTok{method=}\StringTok{"knn"}\NormalTok{, }\DataTypeTok{metric=}\NormalTok{metric, }
                 \DataTypeTok{preProc=}\KeywordTok{c}\NormalTok{(}\StringTok{"center"}\NormalTok{, }\StringTok{"scale"}\NormalTok{, }\StringTok{"BoxCox"}\NormalTok{), }
                 \DataTypeTok{trControl=}\NormalTok{trainControl)}

\CommentTok{# Compare algorithms}
\NormalTok{transformResults <-}\StringTok{ }\KeywordTok{resamples}\NormalTok{(}\KeywordTok{list}\NormalTok{(}\DataTypeTok{LM     =}\NormalTok{ fit.lm, }
                                  \DataTypeTok{GLM    =}\NormalTok{ fit.glm, }
                                  \DataTypeTok{GLMNET =}\NormalTok{ fit.glmnet, }
                                  \DataTypeTok{SVM    =}\NormalTok{ fit.svm, }
                                  \DataTypeTok{CART   =}\NormalTok{ fit.cart, }
                                  \DataTypeTok{KNN    =}\NormalTok{ fit.knn))}
\KeywordTok{summary}\NormalTok{(transformResults)}
\CommentTok{#> }
\CommentTok{#> Call:}
\CommentTok{#> summary.resamples(object = transformResults)}
\CommentTok{#> }
\CommentTok{#> Models: LM, GLM, GLMNET, SVM, CART, KNN }
\CommentTok{#> Number of resamples: 30 }
\CommentTok{#> }
\CommentTok{#> MAE }
\CommentTok{#>        Min. 1st Qu. Median Mean 3rd Qu. Max. NA's}
\CommentTok{#> LM     2.10    2.80   3.21 3.18    3.45 4.44    0}
\CommentTok{#> GLM    2.10    2.80   3.21 3.18    3.45 4.44    0}
\CommentTok{#> GLMNET 2.11    2.80   3.21 3.17    3.45 4.43    0}
\CommentTok{#> SVM    1.30    1.95   2.25 2.26    2.48 3.19    0}
\CommentTok{#> CART   2.22    2.62   2.89 2.94    3.11 4.16    0}
\CommentTok{#> KNN    2.33    2.66   2.82 2.97    3.27 3.96    0}
\CommentTok{#> }
\CommentTok{#> RMSE }
\CommentTok{#>        Min. 1st Qu. Median Mean 3rd Qu. Max. NA's}
\CommentTok{#> LM     2.82    3.81   4.43 4.37    5.00 6.16    0}
\CommentTok{#> GLM    2.82    3.81   4.43 4.37    5.00 6.16    0}
\CommentTok{#> GLMNET 2.83    3.79   4.42 4.36    5.00 6.18    0}
\CommentTok{#> SVM    1.80    2.73   3.41 3.70    4.24 6.73    0}
\CommentTok{#> CART   2.77    3.38   4.00 4.23    4.83 7.09    0}
\CommentTok{#> KNN    3.01    3.73   4.37 4.52    5.02 7.30    0}
\CommentTok{#> }
\CommentTok{#> Rsquared }
\CommentTok{#>         Min. 1st Qu. Median  Mean 3rd Qu.  Max. NA's}
\CommentTok{#> LM     0.560   0.712  0.775 0.766   0.825 0.910    0}
\CommentTok{#> GLM    0.560   0.712  0.775 0.766   0.825 0.910    0}
\CommentTok{#> GLMNET 0.556   0.713  0.775 0.766   0.826 0.910    0}
\CommentTok{#> SVM    0.524   0.778  0.854 0.827   0.907 0.979    0}
\CommentTok{#> CART   0.514   0.727  0.816 0.774   0.843 0.899    0}
\CommentTok{#> KNN    0.492   0.723  0.792 0.762   0.842 0.937    0}
\KeywordTok{dotplot}\NormalTok{(transformResults)}
\end{Highlighting}
\end{Shaded}

\begin{center}\includegraphics[width=0.7\linewidth]{comparison_321-regression_boston-multi_files/figure-latex/model-third-run-boxcox-1} \end{center}

\hypertarget{tune-svm}{%
\section{Tune SVM}\label{tune-svm}}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{print}\NormalTok{(fit.svm)}
\CommentTok{#> Support Vector Machines with Radial Basis Function Kernel }
\CommentTok{#> }
\CommentTok{#> 407 samples}
\CommentTok{#>  13 predictor}
\CommentTok{#> }
\CommentTok{#> Pre-processing: centered (13), scaled (13), Box-Cox transformation (11) }
\CommentTok{#> Resampling: Cross-Validated (10 fold, repeated 3 times) }
\CommentTok{#> Summary of sample sizes: 365, 366, 366, 367, 366, 366, ... }
\CommentTok{#> Resampling results across tuning parameters:}
\CommentTok{#> }
\CommentTok{#>   C     RMSE  Rsquared  MAE }
\CommentTok{#>   0.25  4.54  0.772     2.73}
\CommentTok{#>   0.50  4.07  0.802     2.46}
\CommentTok{#>   1.00  3.70  0.827     2.26}
\CommentTok{#> }
\CommentTok{#> Tuning parameter 'sigma' was held constant at a value of 0.116}
\CommentTok{#> RMSE was used to select the optimal model using the smallest value.}
\CommentTok{#> The final values used for the model were sigma = 0.116 and C = 1.}
\end{Highlighting}
\end{Shaded}

Let's design a grid search around a C value of 1. We might see a small trend of decreasing RMSE with increasing C, so let's try all integer C values between 1 and 10. Another parameter that caret let us tune is the sigma parameter. This is a smoothing parameter. Good sigma values often start around 0.1, so we will try numbers before and after.

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# tune SVM sigma and C parametres}
\NormalTok{trainControl <-}\StringTok{ }\KeywordTok{trainControl}\NormalTok{(}\DataTypeTok{method=}\StringTok{"repeatedcv"}\NormalTok{, }\DataTypeTok{number=}\DecValTok{10}\NormalTok{, }\DataTypeTok{repeats=}\DecValTok{3}\NormalTok{)}
\NormalTok{metric <-}\StringTok{ "RMSE"}
\KeywordTok{set.seed}\NormalTok{(}\DecValTok{7}\NormalTok{)}

\NormalTok{grid <-}\StringTok{ }\KeywordTok{expand.grid}\NormalTok{(}\DataTypeTok{.sigma =} \KeywordTok{c}\NormalTok{(}\FloatTok{0.025}\NormalTok{, }\FloatTok{0.05}\NormalTok{, }\FloatTok{0.1}\NormalTok{, }\FloatTok{0.15}\NormalTok{), }
                    \DataTypeTok{.C =} \KeywordTok{seq}\NormalTok{(}\DecValTok{1}\NormalTok{, }\DecValTok{10}\NormalTok{, }\DataTypeTok{by=}\DecValTok{1}\NormalTok{))}

\NormalTok{fit.svm <-}\StringTok{ }\KeywordTok{train}\NormalTok{(medv}\OperatorTok{~}\NormalTok{., }\DataTypeTok{data=}\NormalTok{dataset, }\DataTypeTok{method=}\StringTok{"svmRadial"}\NormalTok{, }\DataTypeTok{metric=}\NormalTok{metric, }
                 \DataTypeTok{tuneGrid=}\NormalTok{grid, }
                 \DataTypeTok{preProc=}\KeywordTok{c}\NormalTok{(}\StringTok{"BoxCox"}\NormalTok{), }\DataTypeTok{trControl=}\NormalTok{trainControl)}
\KeywordTok{print}\NormalTok{(fit.svm)}
\CommentTok{#> Support Vector Machines with Radial Basis Function Kernel }
\CommentTok{#> }
\CommentTok{#> 407 samples}
\CommentTok{#>  13 predictor}
\CommentTok{#> }
\CommentTok{#> Pre-processing: Box-Cox transformation (11) }
\CommentTok{#> Resampling: Cross-Validated (10 fold, repeated 3 times) }
\CommentTok{#> Summary of sample sizes: 365, 366, 366, 367, 366, 366, ... }
\CommentTok{#> Resampling results across tuning parameters:}
\CommentTok{#> }
\CommentTok{#>   sigma  C   RMSE  Rsquared  MAE }
\CommentTok{#>   0.025   1  3.67  0.830     2.34}
\CommentTok{#>   0.025   2  3.49  0.840     2.21}
\CommentTok{#>   0.025   3  3.45  0.842     2.17}
\CommentTok{#>   0.025   4  3.42  0.844     2.14}
\CommentTok{#>   0.025   5  3.41  0.845     2.13}
\CommentTok{#>   0.025   6  3.40  0.846     2.12}
\CommentTok{#>   0.025   7  3.39  0.846     2.11}
\CommentTok{#>   0.025   8  3.39  0.846     2.11}
\CommentTok{#>   0.025   9  3.38  0.846     2.11}
\CommentTok{#>   0.025  10  3.37  0.847     2.10}
\CommentTok{#>   0.050   1  3.61  0.833     2.25}
\CommentTok{#>   0.050   2  3.44  0.843     2.17}
\CommentTok{#>   0.050   3  3.36  0.848     2.11}
\CommentTok{#>   0.050   4  3.30  0.852     2.08}
\CommentTok{#>   0.050   5  3.25  0.856     2.05}
\CommentTok{#>   0.050   6  3.20  0.860     2.03}
\CommentTok{#>   0.050   7  3.16  0.862     2.02}
\CommentTok{#>   0.050   8  3.13  0.865     2.02}
\CommentTok{#>   0.050   9  3.11  0.866     2.01}
\CommentTok{#>   0.050  10  3.10  0.867     2.01}
\CommentTok{#>   0.100   1  3.68  0.829     2.26}
\CommentTok{#>   0.100   2  3.37  0.848     2.12}
\CommentTok{#>   0.100   3  3.23  0.858     2.06}
\CommentTok{#>   0.100   4  3.17  0.862     2.04}
\CommentTok{#>   0.100   5  3.14  0.865     2.04}
\CommentTok{#>   0.100   6  3.11  0.866     2.04}
\CommentTok{#>   0.100   7  3.09  0.868     2.04}
\CommentTok{#>   0.100   8  3.09  0.868     2.04}
\CommentTok{#>   0.100   9  3.08  0.868     2.04}
\CommentTok{#>   0.100  10  3.08  0.868     2.05}
\CommentTok{#>   0.150   1  3.79  0.822     2.30}
\CommentTok{#>   0.150   2  3.42  0.846     2.14}
\CommentTok{#>   0.150   3  3.30  0.854     2.09}
\CommentTok{#>   0.150   4  3.26  0.857     2.09}
\CommentTok{#>   0.150   5  3.24  0.858     2.09}
\CommentTok{#>   0.150   6  3.23  0.858     2.10}
\CommentTok{#>   0.150   7  3.23  0.857     2.12}
\CommentTok{#>   0.150   8  3.24  0.856     2.13}
\CommentTok{#>   0.150   9  3.26  0.855     2.15}
\CommentTok{#>   0.150  10  3.27  0.854     2.17}
\CommentTok{#> }
\CommentTok{#> RMSE was used to select the optimal model using the smallest value.}
\CommentTok{#> The final values used for the model were sigma = 0.1 and C = 9.}
\KeywordTok{plot}\NormalTok{(fit.svm)}
\end{Highlighting}
\end{Shaded}

\begin{center}\includegraphics[width=0.7\linewidth]{comparison_321-regression_boston-multi_files/figure-latex/model-svm-run-1} \end{center}

\hypertarget{ensembling}{%
\section{Ensembling}\label{ensembling}}

We can try some ensemble methods on the problem and see if we can get a further decrease in our RMSE.

\begin{itemize}
\tightlist
\item
  Random Forest, bagging (RF).
\item
  Gradient Boosting Machines (GBM).
\item
  Cubist, boosting (CUBIST).
\end{itemize}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# try ensembles}
\NormalTok{seed <-}\StringTok{ }\DecValTok{7}
\NormalTok{trainControl <-}\StringTok{ }\KeywordTok{trainControl}\NormalTok{(}\DataTypeTok{method=}\StringTok{"repeatedcv"}\NormalTok{, }\DataTypeTok{number=}\DecValTok{10}\NormalTok{, }\DataTypeTok{repeats=}\DecValTok{3}\NormalTok{)}
\NormalTok{metric <-}\StringTok{ "RMSE"}

\CommentTok{# Random Forest}
\KeywordTok{set.seed}\NormalTok{(seed)}
\NormalTok{fit.rf <-}\StringTok{ }\KeywordTok{train}\NormalTok{(medv}\OperatorTok{~}\NormalTok{., }\DataTypeTok{data=}\NormalTok{dataset, }\DataTypeTok{method=}\StringTok{"rf"}\NormalTok{, }\DataTypeTok{metric=}\NormalTok{metric, }
                \DataTypeTok{preProc=}\KeywordTok{c}\NormalTok{(}\StringTok{"BoxCox"}\NormalTok{),}
                \DataTypeTok{trControl=}\NormalTok{trainControl)}

\CommentTok{# Stochastic Gradient Boosting}
\KeywordTok{set.seed}\NormalTok{(seed)}
\NormalTok{fit.gbm <-}\StringTok{ }\KeywordTok{train}\NormalTok{(medv}\OperatorTok{~}\NormalTok{., }\DataTypeTok{data=}\NormalTok{dataset, }\DataTypeTok{method=}\StringTok{"gbm"}\NormalTok{, }\DataTypeTok{metric=}\NormalTok{metric, }
                 \DataTypeTok{preProc=}\KeywordTok{c}\NormalTok{(}\StringTok{"BoxCox"}\NormalTok{), }
                 \DataTypeTok{trControl=}\NormalTok{trainControl, }\DataTypeTok{verbose=}\OtherTok{FALSE}\NormalTok{)}
\CommentTok{# Cubist}
\KeywordTok{set.seed}\NormalTok{(seed)}
\NormalTok{fit.cubist <-}\StringTok{ }\KeywordTok{train}\NormalTok{(medv}\OperatorTok{~}\NormalTok{., }\DataTypeTok{data=}\NormalTok{dataset, }\DataTypeTok{method=}\StringTok{"cubist"}\NormalTok{, }\DataTypeTok{metric=}\NormalTok{metric, }
                    \DataTypeTok{preProc=}\KeywordTok{c}\NormalTok{(}\StringTok{"BoxCox"}\NormalTok{), }\DataTypeTok{trControl=}\NormalTok{trainControl)}
\CommentTok{# Compare algorithms}
\NormalTok{ensembleResults <-}\StringTok{ }\KeywordTok{resamples}\NormalTok{(}\KeywordTok{list}\NormalTok{(}\DataTypeTok{RF  =}\NormalTok{ fit.rf, }
                                  \DataTypeTok{GBM =}\NormalTok{ fit.gbm, }
                                  \DataTypeTok{CUBIST =}\NormalTok{ fit.cubist))}
\KeywordTok{summary}\NormalTok{(ensembleResults)}
\CommentTok{#> }
\CommentTok{#> Call:}
\CommentTok{#> summary.resamples(object = ensembleResults)}
\CommentTok{#> }
\CommentTok{#> Models: RF, GBM, CUBIST }
\CommentTok{#> Number of resamples: 30 }
\CommentTok{#> }
\CommentTok{#> MAE }
\CommentTok{#>        Min. 1st Qu. Median Mean 3rd Qu. Max. NA's}
\CommentTok{#> RF     1.64    1.98   2.20 2.21    2.30 3.22    0}
\CommentTok{#> GBM    1.65    1.98   2.27 2.33    2.55 3.75    0}
\CommentTok{#> CUBIST 1.31    1.75   1.95 2.00    2.17 2.89    0}
\CommentTok{#> }
\CommentTok{#> RMSE }
\CommentTok{#>        Min. 1st Qu. Median Mean 3rd Qu. Max. NA's}
\CommentTok{#> RF     2.11    2.58   3.08 3.22    3.70 6.52    0}
\CommentTok{#> GBM    1.92    2.54   3.31 3.38    3.67 6.85    0}
\CommentTok{#> CUBIST 1.79    2.38   2.74 3.09    3.78 5.79    0}
\CommentTok{#> }
\CommentTok{#> Rsquared }
\CommentTok{#>         Min. 1st Qu. Median  Mean 3rd Qu.  Max. NA's}
\CommentTok{#> RF     0.597   0.852  0.900 0.869   0.919 0.972    0}
\CommentTok{#> GBM    0.558   0.815  0.889 0.851   0.912 0.964    0}
\CommentTok{#> CUBIST 0.681   0.818  0.909 0.875   0.932 0.970    0}
\KeywordTok{dotplot}\NormalTok{(ensembleResults)}
\end{Highlighting}
\end{Shaded}

\begin{center}\includegraphics[width=0.7\linewidth]{comparison_321-regression_boston-multi_files/figure-latex/models-ensembling-run-1} \end{center}

Let's dive deeper into Cubist and see if we can tune it further and get more skill out of it. Cubist has two parameters that are tunable with caret: committees which is the number of boosting operations and neighbors which is used during prediction and is the number of instances used to correct the rule-based prediction (although the documentation is perhaps a little ambiguous on this).

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# look at parameters used for Cubist}
\KeywordTok{print}\NormalTok{(fit.cubist)}
\CommentTok{#> Cubist }
\CommentTok{#> }
\CommentTok{#> 407 samples}
\CommentTok{#>  13 predictor}
\CommentTok{#> }
\CommentTok{#> Pre-processing: Box-Cox transformation (11) }
\CommentTok{#> Resampling: Cross-Validated (10 fold, repeated 3 times) }
\CommentTok{#> Summary of sample sizes: 365, 366, 366, 367, 366, 366, ... }
\CommentTok{#> Resampling results across tuning parameters:}
\CommentTok{#> }
\CommentTok{#>   committees  neighbors  RMSE  Rsquared  MAE }
\CommentTok{#>    1          0          3.94  0.805     2.50}
\CommentTok{#>    1          5          3.66  0.828     2.24}
\CommentTok{#>    1          9          3.69  0.825     2.26}
\CommentTok{#>   10          0          3.45  0.848     2.29}
\CommentTok{#>   10          5          3.19  0.868     2.04}
\CommentTok{#>   10          9          3.23  0.864     2.07}
\CommentTok{#>   20          0          3.34  0.858     2.25}
\CommentTok{#>   20          5          3.09  0.875     2.00}
\CommentTok{#>   20          9          3.12  0.872     2.03}
\CommentTok{#> }
\CommentTok{#> RMSE was used to select the optimal model using the smallest value.}
\CommentTok{#> The final values used for the model were committees = 20 and neighbors = 5.}
\end{Highlighting}
\end{Shaded}

Let's use a grid search to tune around those values. We'll try all committees between 15 and 25 and spot-check a neighbors value above and below 5.

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{library}\NormalTok{(Cubist)}
\CommentTok{# Tune the Cubist algorithm}
\NormalTok{trainControl <-}\StringTok{ }\KeywordTok{trainControl}\NormalTok{(}\DataTypeTok{method=}\StringTok{"repeatedcv"}\NormalTok{, }\DataTypeTok{number=}\DecValTok{10}\NormalTok{, }\DataTypeTok{repeats=}\DecValTok{3}\NormalTok{)}
\NormalTok{metric <-}\StringTok{ "RMSE"}
\KeywordTok{set.seed}\NormalTok{(}\DecValTok{7}\NormalTok{)}
\NormalTok{grid <-}\StringTok{ }\KeywordTok{expand.grid}\NormalTok{(}\DataTypeTok{.committees =} \KeywordTok{seq}\NormalTok{(}\DecValTok{15}\NormalTok{, }\DecValTok{25}\NormalTok{, }\DataTypeTok{by=}\DecValTok{1}\NormalTok{), }
                    \DataTypeTok{.neighbors =} \KeywordTok{c}\NormalTok{(}\DecValTok{3}\NormalTok{, }\DecValTok{5}\NormalTok{, }\DecValTok{7}\NormalTok{))}

\NormalTok{tune.cubist <-}\StringTok{ }\KeywordTok{train}\NormalTok{(medv}\OperatorTok{~}\NormalTok{., }\DataTypeTok{data=}\NormalTok{dataset, }\DataTypeTok{method =} \StringTok{"cubist"}\NormalTok{, }\DataTypeTok{metric=}\NormalTok{metric, }
                     \DataTypeTok{preProc=}\KeywordTok{c}\NormalTok{(}\StringTok{"BoxCox"}\NormalTok{), }
                     \DataTypeTok{tuneGrid=}\NormalTok{grid, }\DataTypeTok{trControl=}\NormalTok{trainControl)}
\KeywordTok{print}\NormalTok{(tune.cubist)}
\CommentTok{#> Cubist }
\CommentTok{#> }
\CommentTok{#> 407 samples}
\CommentTok{#>  13 predictor}
\CommentTok{#> }
\CommentTok{#> Pre-processing: Box-Cox transformation (11) }
\CommentTok{#> Resampling: Cross-Validated (10 fold, repeated 3 times) }
\CommentTok{#> Summary of sample sizes: 365, 366, 366, 367, 366, 366, ... }
\CommentTok{#> Resampling results across tuning parameters:}
\CommentTok{#> }
\CommentTok{#>   committees  neighbors  RMSE  Rsquared  MAE }
\CommentTok{#>   15          3          3.07  0.877     2.00}
\CommentTok{#>   15          5          3.13  0.873     2.02}
\CommentTok{#>   15          7          3.14  0.871     2.03}
\CommentTok{#>   16          3          3.05  0.878     1.99}
\CommentTok{#>   16          5          3.11  0.874     2.01}
\CommentTok{#>   16          7          3.12  0.872     2.02}
\CommentTok{#>   17          3          3.04  0.879     1.98}
\CommentTok{#>   17          5          3.09  0.875     2.00}
\CommentTok{#>   17          7          3.11  0.873     2.01}
\CommentTok{#>   18          3          3.03  0.880     1.97}
\CommentTok{#>   18          5          3.08  0.876     2.00}
\CommentTok{#>   18          7          3.10  0.874     2.01}
\CommentTok{#>   19          3          3.03  0.880     1.97}
\CommentTok{#>   19          5          3.08  0.876     1.99}
\CommentTok{#>   19          7          3.10  0.874     2.01}
\CommentTok{#>   20          3          3.03  0.879     1.98}
\CommentTok{#>   20          5          3.09  0.875     2.00}
\CommentTok{#>   20          7          3.10  0.874     2.01}
\CommentTok{#>   21          3          3.03  0.879     1.98}
\CommentTok{#>   21          5          3.09  0.876     2.00}
\CommentTok{#>   21          7          3.10  0.874     2.02}
\CommentTok{#>   22          3          3.03  0.879     1.98}
\CommentTok{#>   22          5          3.09  0.875     2.00}
\CommentTok{#>   22          7          3.10  0.874     2.02}
\CommentTok{#>   23          3          3.03  0.880     1.98}
\CommentTok{#>   23          5          3.09  0.876     2.01}
\CommentTok{#>   23          7          3.10  0.874     2.02}
\CommentTok{#>   24          3          3.03  0.879     1.98}
\CommentTok{#>   24          5          3.09  0.875     2.01}
\CommentTok{#>   24          7          3.11  0.873     2.02}
\CommentTok{#>   25          3          3.03  0.880     1.98}
\CommentTok{#>   25          5          3.09  0.876     2.01}
\CommentTok{#>   25          7          3.10  0.874     2.02}
\CommentTok{#> }
\CommentTok{#> RMSE was used to select the optimal model using the smallest value.}
\CommentTok{#> The final values used for the model were committees = 25 and neighbors = 3.}
\KeywordTok{plot}\NormalTok{(tune.cubist)}
\end{Highlighting}
\end{Shaded}

\begin{center}\includegraphics[width=0.7\linewidth]{comparison_321-regression_boston-multi_files/figure-latex/model-cubist-run-1} \end{center}

\begin{quote}
We can see that we have achieved a more accurate model again with an RMSE of 2.822 using committees = 18 and neighbors = 3.
\end{quote}

It looks like the results for the Cubist algorithm are the most accurate. Let's finalize it by creating a new standalone Cubist model with the parameters above trained using the whole dataset. We must also use the Box-Cox power transform.

\hypertarget{finalize-the-model}{%
\section{Finalize the model}\label{finalize-the-model}}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# prepare the data transform using training data}
\KeywordTok{set.seed}\NormalTok{(}\DecValTok{7}\NormalTok{)}
\NormalTok{x <-}\StringTok{ }\NormalTok{dataset[,}\DecValTok{1}\OperatorTok{:}\DecValTok{13}\NormalTok{]}
\NormalTok{y <-}\StringTok{ }\NormalTok{dataset[,}\DecValTok{14}\NormalTok{]}

\CommentTok{# transform}
\NormalTok{preprocessParams <-}\StringTok{ }\KeywordTok{preProcess}\NormalTok{(x, }\DataTypeTok{method=}\KeywordTok{c}\NormalTok{(}\StringTok{"BoxCox"}\NormalTok{))}
\NormalTok{transX <-}\StringTok{ }\KeywordTok{predict}\NormalTok{(preprocessParams, x)}

\CommentTok{# train the final model}
\NormalTok{finalModel <-}\StringTok{ }\KeywordTok{cubist}\NormalTok{(}\DataTypeTok{x =}\NormalTok{ transX, }\DataTypeTok{y=}\NormalTok{y, }\DataTypeTok{committees=}\DecValTok{18}\NormalTok{)}
\KeywordTok{summary}\NormalTok{(finalModel)}
\CommentTok{#> }
\CommentTok{#> Call:}
\CommentTok{#> cubist.default(x = transX, y = y, committees = 18)}
\CommentTok{#> }
\CommentTok{#> }
\CommentTok{#> Cubist [Release 2.07 GPL Edition]  Wed Sep 18 13:36:54 2019}
\CommentTok{#> ---------------------------------}
\CommentTok{#> }
\CommentTok{#>     Target attribute `outcome'}
\CommentTok{#> }
\CommentTok{#> Read 407 cases (14 attributes) from undefined.data}
\CommentTok{#> }
\CommentTok{#> Model 1:}
\CommentTok{#> }
\CommentTok{#>   Rule 1/1: [84 cases, mean 14.29, range 5 to 27.5, est err 1.97]}
\CommentTok{#> }
\CommentTok{#>     if}
\CommentTok{#>  nox > -0.4864544}
\CommentTok{#>     then}
\CommentTok{#>  outcome = 35.08 - 2.45 crim - 4.31 lstat + 2.1e-05 b}
\CommentTok{#> }
\CommentTok{#>   Rule 1/2: [163 cases, mean 19.37, range 7 to 31, est err 2.10]}
\CommentTok{#> }
\CommentTok{#>     if}
\CommentTok{#>  nox <= -0.4864544}
\CommentTok{#>  lstat > 2.848535}
\CommentTok{#>     then}
\CommentTok{#>  outcome = 186.8 - 2.34 lstat - 3.3 dis - 88 tax + 2 rad + 4.4 rm}
\CommentTok{#>            - 0.033 ptratio - 0.0116 age + 3.3e-05 b}
\CommentTok{#> }
\CommentTok{#>   Rule 1/3: [24 cases, mean 21.65, range 18.2 to 25.3, est err 1.19]}
\CommentTok{#> }
\CommentTok{#>     if}
\CommentTok{#>  rm <= 3.326479}
\CommentTok{#>  dis > 1.345056}
\CommentTok{#>  lstat <= 2.848535}
\CommentTok{#>     then}
\CommentTok{#>  outcome = 43.83 + 14.5 rm - 2.29 lstat - 3.8 dis - 30 tax}
\CommentTok{#>            - 0.014 ptratio - 1.4 nox + 0.017 zn + 0.4 rad + 0.15 crim}
\CommentTok{#>            - 0.0025 age + 8e-06 b}
\CommentTok{#> }
\CommentTok{#>   Rule 1/4: [7 cases, mean 27.66, range 20.7 to 50, est err 7.89]}
\CommentTok{#> }
\CommentTok{#>     if}
\CommentTok{#>  rm > 3.326479}
\CommentTok{#>  ptratio > 193.545}
\CommentTok{#>  lstat <= 2.848535}
\CommentTok{#>     then}
\CommentTok{#>  outcome = 19.64 + 7.8 rm - 3.4 dis - 1.62 lstat + 0.27 crim - 0.006 age}
\CommentTok{#>            + 0.023 zn - 7 tax - 0.003 ptratio}
\CommentTok{#> }
\CommentTok{#>   Rule 1/5: [141 cases, mean 30.60, range 15 to 50, est err 2.09]}
\CommentTok{#> }
\CommentTok{#>     if}
\CommentTok{#>  rm > 3.326479}
\CommentTok{#>  ptratio <= 193.545}
\CommentTok{#>     then}
\CommentTok{#>  outcome = 137.95 + 21.7 rm - 3.43 lstat - 4.9 dis - 87 tax - 0.0162 age}
\CommentTok{#>            - 0.039 ptratio + 0.06 crim + 0.005 zn}
\CommentTok{#> }
\CommentTok{#>   Rule 1/6: [8 cases, mean 32.16, range 22.1 to 50, est err 8.67]}
\CommentTok{#> }
\CommentTok{#>     if}
\CommentTok{#>  rm <= 3.326479}
\CommentTok{#>  dis <= 1.345056}
\CommentTok{#>  lstat <= 2.848535}
\CommentTok{#>     then}
\CommentTok{#>  outcome = -19.71 + 18.58 lstat - 15.9 dis + 5.6 rm}
\CommentTok{#> }
\CommentTok{#> Model 2:}
\CommentTok{#> }
\CommentTok{#>   Rule 2/1: [23 cases, mean 10.57, range 5 to 15, est err 3.06]}
\CommentTok{#> }
\CommentTok{#>     if}
\CommentTok{#>  crim > 2.086391}
\CommentTok{#>  dis <= 0.6604174}
\CommentTok{#>  b > 67032.41}
\CommentTok{#>     then}
\CommentTok{#>  outcome = 37.22 - 4.83 crim - 7 dis - 1.9 lstat - 1.9e-05 b - 0.7 rm}
\CommentTok{#> }
\CommentTok{#>   Rule 2/2: [70 cases, mean 14.82, range 5 to 50, est err 3.90]}
\CommentTok{#> }
\CommentTok{#>     if}
\CommentTok{#>  rm <= 3.620525}
\CommentTok{#>  dis <= 0.6604174}
\CommentTok{#>     then}
\CommentTok{#>  outcome = 74.6 - 21 dis - 5.09 lstat - 15 tax - 0.0017 age + 6e-06 b}
\CommentTok{#> }
\CommentTok{#>   Rule 2/3: [18 cases, mean 18.03, range 7.5 to 50, est err 6.81]}
\CommentTok{#> }
\CommentTok{#>     if}
\CommentTok{#>  crim > 2.086391}
\CommentTok{#>  dis <= 0.6604174}
\CommentTok{#>  b <= 67032.41}
\CommentTok{#>     then}
\CommentTok{#>  outcome = 94.95 - 40.1 dis - 8.15 crim - 7.14 lstat - 3.5e-05 b - 1.3 rm}
\CommentTok{#> }
\CommentTok{#>   Rule 2/4: [258 cases, mean 20.74, range 9.5 to 36.2, est err 1.92]}
\CommentTok{#> }
\CommentTok{#>     if}
\CommentTok{#>  rm <= 3.620525}
\CommentTok{#>  dis > 0.6604174}
\CommentTok{#>  lstat > 1.805082}
\CommentTok{#>     then}
\CommentTok{#>  outcome = 61.89 - 2.56 lstat + 5.5 rm - 2.8 dis + 7.3e-05 b - 0.0132 age}
\CommentTok{#>            - 26 tax - 0.11 indus - 0.004 ptratio + 0.05 crim}
\CommentTok{#> }
\CommentTok{#>   Rule 2/5: [37 cases, mean 31.66, range 10.4 to 50, est err 3.70]}
\CommentTok{#> }
\CommentTok{#>     if}
\CommentTok{#>  rm > 3.620525}
\CommentTok{#>  lstat > 1.805082}
\CommentTok{#>     then}
\CommentTok{#>  outcome = 370.03 - 180 tax - 2.19 lstat - 1.7 dis + 2.6 rm}
\CommentTok{#>            - 0.016 ptratio - 0.25 indus + 0.12 crim - 0.0021 age}
\CommentTok{#>            + 9e-06 b - 0.5 nox}
\CommentTok{#> }
\CommentTok{#>   Rule 2/6: [42 cases, mean 38.23, range 22.8 to 50, est err 3.70]}
\CommentTok{#> }
\CommentTok{#>     if}
\CommentTok{#>  lstat <= 1.805082}
\CommentTok{#>     then}
\CommentTok{#>  outcome = -73.87 + 32.4 rm - 9.4e-05 b - 1.8 dis + 0.028 zn}
\CommentTok{#>            - 0.013 ptratio}
\CommentTok{#> }
\CommentTok{#>   Rule 2/7: [4 cases, mean 40.20, range 37.6 to 42.8, est err 7.33]}
\CommentTok{#> }
\CommentTok{#>     if}
\CommentTok{#>  rm > 4.151791}
\CommentTok{#>  dis > 1.114486}
\CommentTok{#>     then}
\CommentTok{#>  outcome = 35.8}
\CommentTok{#> }
\CommentTok{#>   Rule 2/8: [8 cases, mean 47.45, range 41.3 to 50, est err 10.01]}
\CommentTok{#> }
\CommentTok{#>     if}
\CommentTok{#>  dis <= 1.114486}
\CommentTok{#>  lstat <= 1.805082}
\CommentTok{#>     then}
\CommentTok{#>  outcome = 48.96 + 7.53 crim - 4.1e-05 b - 0.8 dis + 1.2 rm + 0.008 zn}
\CommentTok{#> }
\CommentTok{#> Model 3:}
\CommentTok{#> }
\CommentTok{#>   Rule 3/1: [81 cases, mean 13.93, range 5 to 23.2, est err 2.24]}
\CommentTok{#> }
\CommentTok{#>     if}
\CommentTok{#>  nox > -0.4864544}
\CommentTok{#>  lstat > 2.848535}
\CommentTok{#>     then}
\CommentTok{#>  outcome = 55.03 - 0.0631 age - 2.11 crim + 12 nox - 4.16 lstat}
\CommentTok{#>            + 3.2e-05 b}
\CommentTok{#> }
\CommentTok{#>   Rule 3/2: [163 cases, mean 19.37, range 7 to 31, est err 2.29]}
\CommentTok{#> }
\CommentTok{#>     if}
\CommentTok{#>  nox <= -0.4864544}
\CommentTok{#>  lstat > 2.848535}
\CommentTok{#>     then}
\CommentTok{#>  outcome = 77.73 - 0.059 ptratio + 5.8 rm - 3.2 dis - 0.0139 age}
\CommentTok{#>            - 1.15 lstat - 30 tax - 1.1 nox + 0.4 rad}
\CommentTok{#> }
\CommentTok{#>   Rule 3/3: [62 cases, mean 24.01, range 18.2 to 50, est err 3.56]}
\CommentTok{#> }
\CommentTok{#>     if}
\CommentTok{#>  rm <= 3.448196}
\CommentTok{#>  lstat <= 2.848535}
\CommentTok{#>     then}
\CommentTok{#>  outcome = 94.86 + 18.2 rm + 0.63 crim - 68 tax - 2.3 dis - 3 nox}
\CommentTok{#>            - 0.0098 age - 0.41 indus - 0.011 ptratio}
\CommentTok{#> }
\CommentTok{#>   Rule 3/4: [143 cases, mean 28.76, range 16.5 to 50, est err 2.53]}
\CommentTok{#> }
\CommentTok{#>     if}
\CommentTok{#>  dis > 0.9547035}
\CommentTok{#>  lstat <= 2.848535}
\CommentTok{#>     then}
\CommentTok{#>  outcome = 269.46 + 17.9 rm - 6.1 dis - 153 tax + 0.96 crim - 0.0217 age}
\CommentTok{#>            - 5.5 nox - 0.62 indus - 0.028 ptratio - 0.89 lstat + 0.4 rad}
\CommentTok{#>            + 0.004 zn}
\CommentTok{#> }
\CommentTok{#>   Rule 3/5: [10 cases, mean 35.13, range 21.9 to 50, est err 9.31]}
\CommentTok{#> }
\CommentTok{#>     if}
\CommentTok{#>  dis <= 0.6492998}
\CommentTok{#>  lstat <= 2.848535}
\CommentTok{#>     then}
\CommentTok{#>  outcome = 58.69 - 56.8 dis - 8.4 nox}
\CommentTok{#> }
\CommentTok{#>   Rule 3/6: [10 cases, mean 41.67, range 22 to 50, est err 9.89]}
\CommentTok{#> }
\CommentTok{#>     if}
\CommentTok{#>  dis > 0.6492998}
\CommentTok{#>  dis <= 0.9547035}
\CommentTok{#>  lstat <= 2.848535}
\CommentTok{#>     then}
\CommentTok{#>  outcome = 47.93}
\CommentTok{#> }
\CommentTok{#> Model 4:}
\CommentTok{#> }
\CommentTok{#>   Rule 4/1: [69 cases, mean 12.69, range 5 to 27.5, est err 2.55]}
\CommentTok{#> }
\CommentTok{#>     if}
\CommentTok{#>  dis <= 0.719156}
\CommentTok{#>  lstat > 3.508535}
\CommentTok{#>     then}
\CommentTok{#>  outcome = 180.13 - 7.2 dis + 0.039 age - 3.78 lstat - 83 tax}
\CommentTok{#> }
\CommentTok{#>   Rule 4/2: [164 cases, mean 19.42, range 12 to 31, est err 1.96]}
\CommentTok{#> }
\CommentTok{#>     if}
\CommentTok{#>  dis > 0.719156}
\CommentTok{#>  lstat > 2.848535}
\CommentTok{#>     then}
\CommentTok{#>  outcome = 52.75 + 7.1 rm - 2.05 lstat - 3.6 dis + 8.2e-05 b - 0.0152 age}
\CommentTok{#>            - 25 tax + 0.5 rad - 1.2 nox - 0.008 ptratio}
\CommentTok{#> }
\CommentTok{#>   Rule 4/3: [11 cases, mean 20.39, range 15 to 27.9, est err 3.51]}
\CommentTok{#> }
\CommentTok{#>     if}
\CommentTok{#>  dis <= 0.719156}
\CommentTok{#>  lstat > 2.848535}
\CommentTok{#>  lstat <= 3.508535}
\CommentTok{#>     then}
\CommentTok{#>  outcome = 21.69}
\CommentTok{#> }
\CommentTok{#>   Rule 4/4: [63 cases, mean 23.22, range 16.5 to 31.5, est err 1.67]}
\CommentTok{#> }
\CommentTok{#>     if}
\CommentTok{#>  rm <= 3.483629}
\CommentTok{#>  dis > 0.9731624}
\CommentTok{#>  lstat <= 2.848535}
\CommentTok{#>     then}
\CommentTok{#>  outcome = 59.35 - 3.96 lstat - 3.1 dis + 1 rm - 14 tax + 0.3 rad}
\CommentTok{#>            - 0.7 nox - 0.005 ptratio + 6e-06 b}
\CommentTok{#> }
\CommentTok{#>   Rule 4/5: [8 cases, mean 33.08, range 22 to 50, est err 23.91]}
\CommentTok{#> }
\CommentTok{#>     if}
\CommentTok{#>  rm > 3.369183}
\CommentTok{#>  dis <= 0.9731624}
\CommentTok{#>  lstat > 2.254579}
\CommentTok{#>  lstat <= 2.848535}
\CommentTok{#>     then}
\CommentTok{#>  outcome = -322.28 + 64.9 lstat + 56.8 rm - 30.2 dis}
\CommentTok{#> }
\CommentTok{#>   Rule 4/6: [7 cases, mean 33.87, range 22.1 to 50, est err 13.21]}
\CommentTok{#> }
\CommentTok{#>     if}
\CommentTok{#>  rm <= 3.369183}
\CommentTok{#>  dis <= 0.9731624}
\CommentTok{#>  lstat <= 2.848535}
\CommentTok{#>     then}
\CommentTok{#>  outcome = -52.11 + 43.45 lstat - 30.8 dis}
\CommentTok{#> }
\CommentTok{#>   Rule 4/7: [91 cases, mean 34.43, range 21.9 to 50, est err 3.32]}
\CommentTok{#> }
\CommentTok{#>     if}
\CommentTok{#>  rm > 3.483629}
\CommentTok{#>  lstat <= 2.848535}
\CommentTok{#>     then}
\CommentTok{#>  outcome = -33.09 + 22 rm - 5.02 lstat - 0.038 ptratio - 0.9 dis}
\CommentTok{#>            + 0.005 zn}
\CommentTok{#> }
\CommentTok{#>   Rule 4/8: [22 cases, mean 36.99, range 21.9 to 50, est err 13.21]}
\CommentTok{#> }
\CommentTok{#>     if}
\CommentTok{#>  dis <= 0.9731624}
\CommentTok{#>  lstat <= 2.848535}
\CommentTok{#>     then}
\CommentTok{#>  outcome = 80.3 - 17.43 lstat - 0.134 ptratio + 2.5 rm - 1.2 dis}
\CommentTok{#>            + 0.008 zn}
\CommentTok{#> }
\CommentTok{#> Model 5:}
\CommentTok{#> }
\CommentTok{#>   Rule 5/1: [84 cases, mean 14.29, range 5 to 27.5, est err 2.81]}
\CommentTok{#> }
\CommentTok{#>     if}
\CommentTok{#>  nox > -0.4864544}
\CommentTok{#>     then}
\CommentTok{#>  outcome = 56.48 + 28.5 nox - 0.0875 age - 3.58 crim - 5.9 dis}
\CommentTok{#>            - 2.96 lstat + 0.073 ptratio + 1.7e-05 b}
\CommentTok{#> }
\CommentTok{#>   Rule 5/2: [163 cases, mean 19.37, range 7 to 31, est err 2.38]}
\CommentTok{#> }
\CommentTok{#>     if}
\CommentTok{#>  nox <= -0.4864544}
\CommentTok{#>  lstat > 2.848535}
\CommentTok{#>     then}
\CommentTok{#>  outcome = 61.59 - 0.064 ptratio + 5.9 rm - 3.1 dis - 0.0142 age}
\CommentTok{#>            - 0.77 lstat - 21 tax}
\CommentTok{#> }
\CommentTok{#>   Rule 5/3: [163 cases, mean 29.94, range 16.5 to 50, est err 3.65]}
\CommentTok{#> }
\CommentTok{#>     if}
\CommentTok{#>  lstat <= 2.848535}
\CommentTok{#>     then}
\CommentTok{#>  outcome = 264.17 + 21.9 rm - 8 dis - 155 tax - 0.0317 age}
\CommentTok{#>            - 0.032 ptratio + 0.29 crim - 1.6 nox - 0.25 indus}
\CommentTok{#> }
\CommentTok{#>   Rule 5/4: [10 cases, mean 35.13, range 21.9 to 50, est err 11.79]}
\CommentTok{#> }
\CommentTok{#>     if}
\CommentTok{#>  dis <= 0.6492998}
\CommentTok{#>  lstat <= 2.848535}
\CommentTok{#>     then}
\CommentTok{#>  outcome = 68.19 - 73.4 dis + 1.1 rm + 0.11 crim - 0.6 nox - 0.1 indus}
\CommentTok{#>            - 0.0017 age - 0.12 lstat}
\CommentTok{#> }
\CommentTok{#> Model 6:}
\CommentTok{#> }
\CommentTok{#>   Rule 6/1: [71 cases, mean 15.57, range 5 to 50, est err 4.42]}
\CommentTok{#> }
\CommentTok{#>     if}
\CommentTok{#>  dis <= 0.6443245}
\CommentTok{#>  lstat > 1.793385}
\CommentTok{#>     then}
\CommentTok{#>  outcome = 45.7 - 20.6 dis - 5.38 lstat}
\CommentTok{#> }
\CommentTok{#>   Rule 6/2: [159 cases, mean 19.53, range 8.3 to 36.2, est err 2.08]}
\CommentTok{#> }
\CommentTok{#>     if}
\CommentTok{#>  rm <= 3.329365}
\CommentTok{#>  dis > 0.6443245}
\CommentTok{#>     then}
\CommentTok{#>  outcome = 24.33 + 8.8 rm + 0.000118 b - 0.0146 age - 2.5 dis}
\CommentTok{#>            - 0.95 lstat + 0.37 crim - 0.32 indus + 0.02 zn - 16 tax}
\CommentTok{#>            + 0.2 rad - 0.5 nox - 0.004 ptratio}
\CommentTok{#> }
\CommentTok{#>   Rule 6/3: [175 cases, mean 27.80, range 9.5 to 50, est err 2.95]}
\CommentTok{#> }
\CommentTok{#>     if}
\CommentTok{#>  rm > 3.329365}
\CommentTok{#>  dis > 0.6443245}
\CommentTok{#>     then}
\CommentTok{#>  outcome = 0.11 + 18.7 rm - 3.11 lstat + 8.1e-05 b - 1.1 dis + 0.19 crim}
\CommentTok{#>            - 20 tax - 0.19 indus + 0.3 rad - 0.7 nox - 0.005 ptratio}
\CommentTok{#>            + 0.006 zn}
\CommentTok{#> }
\CommentTok{#>   Rule 6/4: [8 cases, mean 32.50, range 21.9 to 50, est err 10.34]}
\CommentTok{#> }
\CommentTok{#>     if}
\CommentTok{#>  dis <= 0.6443245}
\CommentTok{#>  lstat > 1.793385}
\CommentTok{#>  lstat <= 2.894121}
\CommentTok{#>     then}
\CommentTok{#>  outcome = 69.38 - 71.2 dis - 0.14 lstat}
\CommentTok{#> }
\CommentTok{#>   Rule 6/5: [34 cases, mean 37.55, range 22.8 to 50, est err 3.55]}
\CommentTok{#> }
\CommentTok{#>     if}
\CommentTok{#>  rm <= 4.151791}
\CommentTok{#>  lstat <= 1.793385}
\CommentTok{#>     then}
\CommentTok{#>  outcome = -125.14 + 41.7 rm + 4.3 rad + 1.48 indus - 0.014 ptratio}
\CommentTok{#> }
\CommentTok{#>   Rule 6/6: [7 cases, mean 43.66, range 37.6 to 50, est err 3.12]}
\CommentTok{#> }
\CommentTok{#>     if}
\CommentTok{#>  rm > 4.151791}
\CommentTok{#>  lstat <= 1.793385}
\CommentTok{#>     then}
\CommentTok{#>  outcome = -137.67 + 44.6 rm - 0.064 ptratio}
\CommentTok{#> }
\CommentTok{#> Model 7:}
\CommentTok{#> }
\CommentTok{#>   Rule 7/1: [84 cases, mean 14.29, range 5 to 27.5, est err 2.91]}
\CommentTok{#> }
\CommentTok{#>     if}
\CommentTok{#>  nox > -0.4864544}
\CommentTok{#>     then}
\CommentTok{#>  outcome = 46.85 - 3.45 crim - 0.0621 age + 14.2 nox + 4.4 dis}
\CommentTok{#>            - 2.01 lstat + 2.5e-05 b}
\CommentTok{#> }
\CommentTok{#>   Rule 7/2: [323 cases, mean 24.66, range 7 to 50, est err 3.68]}
\CommentTok{#> }
\CommentTok{#>     if}
\CommentTok{#>  nox <= -0.4864544}
\CommentTok{#>     then}
\CommentTok{#>  outcome = 57.59 - 0.065 ptratio - 4.4 dis + 6.8 rm - 0.0143 age}
\CommentTok{#>            - 1.36 lstat - 19 tax - 0.8 nox - 0.12 crim + 0.09 indus}
\CommentTok{#> }
\CommentTok{#>   Rule 7/3: [132 cases, mean 28.24, range 16.5 to 50, est err 2.55]}
\CommentTok{#> }
\CommentTok{#>     if}
\CommentTok{#>  dis > 1.063503}
\CommentTok{#>  lstat <= 2.848535}
\CommentTok{#>     then}
\CommentTok{#>  outcome = 270.92 + 24.5 rm - 0.0418 age - 165 tax - 5.7 dis}
\CommentTok{#>            - 0.028 ptratio + 0.26 crim + 0.017 zn}
\CommentTok{#> }
\CommentTok{#>   Rule 7/4: [7 cases, mean 36.01, range 23.3 to 50, est err 3.87]}
\CommentTok{#> }
\CommentTok{#>     if}
\CommentTok{#>  dis <= 0.6002641}
\CommentTok{#>  lstat <= 2.848535}
\CommentTok{#>     then}
\CommentTok{#>  outcome = 57.18 - 69.5 dis - 6.5 nox + 1.9 rm - 0.015 ptratio}
\CommentTok{#> }
\CommentTok{#>   Rule 7/5: [24 cases, mean 37.55, range 21.9 to 50, est err 8.66]}
\CommentTok{#> }
\CommentTok{#>     if}
\CommentTok{#>  dis > 0.6002641}
\CommentTok{#>  dis <= 1.063503}
\CommentTok{#>  lstat <= 2.848535}
\CommentTok{#>     then}
\CommentTok{#>  outcome = -3.76 - 14.8 dis - 2.93 crim - 0.16 ptratio + 17.5 rm - 15 nox}
\CommentTok{#> }
\CommentTok{#> Model 8:}
\CommentTok{#> }
\CommentTok{#>   Rule 8/1: [80 cases, mean 13.75, range 5 to 27.9, est err 3.51]}
\CommentTok{#> }
\CommentTok{#>     if}
\CommentTok{#>  dis <= 0.719156}
\CommentTok{#>  lstat > 2.848535}
\CommentTok{#>     then}
\CommentTok{#>  outcome = 123.46 - 11.3 dis - 5.06 lstat - 45 tax + 0.9 rad + 1.7e-05 b}
\CommentTok{#> }
\CommentTok{#>   Rule 8/2: [164 cases, mean 19.42, range 12 to 31, est err 2.05]}
\CommentTok{#> }
\CommentTok{#>     if}
\CommentTok{#>  dis > 0.719156}
\CommentTok{#>  lstat > 2.848535}
\CommentTok{#>     then}
\CommentTok{#>  outcome = 227.11 - 120 tax + 6.4 rm + 9.3e-05 b - 3.3 dis + 2 rad}
\CommentTok{#>            - 0.0183 age - 0.93 lstat + 0.05 crim - 0.3 nox}
\CommentTok{#> }
\CommentTok{#>   Rule 8/3: [163 cases, mean 29.94, range 16.5 to 50, est err 3.54]}
\CommentTok{#> }
\CommentTok{#>     if}
\CommentTok{#>  lstat <= 2.848535}
\CommentTok{#>     then}
\CommentTok{#>  outcome = 158.14 - 5.73 lstat + 10.8 rm - 4 dis - 83 tax - 4.1 nox}
\CommentTok{#>            + 0.61 crim - 0.54 indus + 1 rad + 3.6e-05 b}
\CommentTok{#> }
\CommentTok{#>   Rule 8/4: [7 cases, mean 36.01, range 23.3 to 50, est err 11.44]}
\CommentTok{#> }
\CommentTok{#>     if}
\CommentTok{#>  dis <= 0.6002641}
\CommentTok{#>  lstat <= 2.848535}
\CommentTok{#>     then}
\CommentTok{#>  outcome = 72.89 - 87.2 dis + 0.6 rm - 0.13 lstat}
\CommentTok{#> }
\CommentTok{#>   Rule 8/5: [47 cases, mean 38.44, range 15 to 50, est err 5.71]}
\CommentTok{#> }
\CommentTok{#>     if}
\CommentTok{#>  rm > 3.726352}
\CommentTok{#>     then}
\CommentTok{#>  outcome = 602.95 - 10.4 lstat + 21 rm - 326 tax - 0.093 ptratio}
\CommentTok{#> }
\CommentTok{#> Model 9:}
\CommentTok{#> }
\CommentTok{#>   Rule 9/1: [81 cases, mean 13.93, range 5 to 23.2, est err 2.91]}
\CommentTok{#> }
\CommentTok{#>     if}
\CommentTok{#>  nox > -0.4864544}
\CommentTok{#>  lstat > 2.848535}
\CommentTok{#>     then}
\CommentTok{#>  outcome = 41.11 - 3.98 crim - 4.42 lstat + 6.7 nox}
\CommentTok{#> }
\CommentTok{#>   Rule 9/2: [163 cases, mean 19.37, range 7 to 31, est err 2.49]}
\CommentTok{#> }
\CommentTok{#>     if}
\CommentTok{#>  nox <= -0.4864544}
\CommentTok{#>  lstat > 2.848535}
\CommentTok{#>     then}
\CommentTok{#>  outcome = 44.98 - 0.068 ptratio - 4.4 dis + 6.6 rm - 1.25 lstat}
\CommentTok{#>            - 0.0118 age - 0.9 nox - 12 tax - 0.08 crim + 0.06 indus}
\CommentTok{#> }
\CommentTok{#>   Rule 9/3: [132 cases, mean 28.24, range 16.5 to 50, est err 2.35]}
\CommentTok{#> }
\CommentTok{#>     if}
\CommentTok{#>  dis > 1.063503}
\CommentTok{#>  lstat <= 2.848535}
\CommentTok{#>     then}
\CommentTok{#>  outcome = 157.67 + 22.2 rm - 0.0383 age - 104 tax - 0.033 ptratio}
\CommentTok{#>            - 2.2 dis}
\CommentTok{#> }
\CommentTok{#>   Rule 9/4: [7 cases, mean 30.76, range 21.9 to 50, est err 6.77]}
\CommentTok{#> }
\CommentTok{#>     if}
\CommentTok{#>  dis <= 1.063503}
\CommentTok{#>  b <= 66469.73}
\CommentTok{#>  lstat <= 2.848535}
\CommentTok{#>     then}
\CommentTok{#>  outcome = 48.52 - 56.1 dis - 12.9 nox - 0.032 ptratio + 2.7 rm}
\CommentTok{#> }
\CommentTok{#>   Rule 9/5: [24 cases, mean 39.09, range 22 to 50, est err 6.20]}
\CommentTok{#> }
\CommentTok{#>     if}
\CommentTok{#>  dis <= 1.063503}
\CommentTok{#>  b > 66469.73}
\CommentTok{#>  lstat <= 2.848535}
\CommentTok{#>     then}
\CommentTok{#>  outcome = -5.49 - 34.8 dis - 20.7 nox + 18.2 rm - 0.051 ptratio}
\CommentTok{#> }
\CommentTok{#> Model 10:}
\CommentTok{#> }
\CommentTok{#>   Rule 10/1: [327 cases, mean 19.45, range 5 to 50, est err 2.77]}
\CommentTok{#> }
\CommentTok{#>     if}
\CommentTok{#>  rm <= 3.617282}
\CommentTok{#>  lstat > 1.805082}
\CommentTok{#>     then}
\CommentTok{#>  outcome = 270.78 - 4.09 lstat - 131 tax + 2.9 rad + 5.3e-05 b - 0.6 dis}
\CommentTok{#>            - 0.16 indus + 0.7 rm - 0.3 nox}
\CommentTok{#> }
\CommentTok{#>   Rule 10/2: [38 cases, mean 31.57, range 10.4 to 50, est err 4.71]}
\CommentTok{#> }
\CommentTok{#>     if}
\CommentTok{#>  rm > 3.617282}
\CommentTok{#>  lstat > 1.805082}
\CommentTok{#>     then}
\CommentTok{#>  outcome = 308.44 - 150 tax - 2.63 lstat + 1.6 rad - 1.9 dis - 0.49 indus}
\CommentTok{#>            + 2.5 rm + 3e-05 b - 1.2 nox + 0.14 crim - 0.005 ptratio}
\CommentTok{#> }
\CommentTok{#>   Rule 10/3: [35 cases, mean 37.15, range 22.8 to 50, est err 2.76]}
\CommentTok{#> }
\CommentTok{#>     if}
\CommentTok{#>  rm <= 4.151791}
\CommentTok{#>  lstat <= 1.805082}
\CommentTok{#>     then}
\CommentTok{#>  outcome = -71.65 + 33.4 rm - 0.017 ptratio - 0.34 lstat + 0.2 rad}
\CommentTok{#>            - 0.3 dis - 7 tax - 0.4 nox}
\CommentTok{#> }
\CommentTok{#>   Rule 10/4: [10 cases, mean 42.63, range 21.9 to 50, est err 7.11]}
\CommentTok{#> }
\CommentTok{#>     if}
\CommentTok{#>  rm > 4.151791}
\CommentTok{#>     then}
\CommentTok{#>  outcome = -92.51 + 32.8 rm - 0.03 ptratio}
\CommentTok{#> }
\CommentTok{#> Model 11:}
\CommentTok{#> }
\CommentTok{#>   Rule 11/1: [84 cases, mean 14.29, range 5 to 27.5, est err 4.13]}
\CommentTok{#> }
\CommentTok{#>     if}
\CommentTok{#>  nox > -0.4864544}
\CommentTok{#>     then}
\CommentTok{#>  outcome = 42.75 - 4.12 crim + 18.1 nox - 0.045 age + 6.8 dis}
\CommentTok{#>            - 1.86 lstat}
\CommentTok{#> }
\CommentTok{#>   Rule 11/2: [244 cases, mean 17.56, range 5 to 31, est err 4.29]}
\CommentTok{#> }
\CommentTok{#>     if}
\CommentTok{#>  lstat > 2.848535}
\CommentTok{#>     then}
\CommentTok{#>  outcome = 34.83 - 5.2 dis - 0.058 ptratio - 0.0228 age + 5.8 rm}
\CommentTok{#>            - 0.56 lstat - 0.07 crim - 0.4 nox - 5 tax}
\CommentTok{#> }
\CommentTok{#>   Rule 11/3: [163 cases, mean 29.94, range 16.5 to 50, est err 3.49]}
\CommentTok{#> }
\CommentTok{#>     if}
\CommentTok{#>  lstat <= 2.848535}
\CommentTok{#>     then}
\CommentTok{#>  outcome = 151.5 + 23.3 rm - 5.5 dis + 1.01 crim - 0.0211 age}
\CommentTok{#>            - 0.052 ptratio - 98 tax + 0.031 zn}
\CommentTok{#> }
\CommentTok{#>   Rule 11/4: [10 cases, mean 35.13, range 21.9 to 50, est err 25.19]}
\CommentTok{#> }
\CommentTok{#>     if}
\CommentTok{#>  dis <= 0.6492998}
\CommentTok{#>  lstat <= 2.848535}
\CommentTok{#>     then}
\CommentTok{#>  outcome = 130.87 - 157.1 dis - 15.76 crim}
\CommentTok{#> }
\CommentTok{#> Model 12:}
\CommentTok{#> }
\CommentTok{#>   Rule 12/1: [80 cases, mean 13.75, range 5 to 27.9, est err 4.76]}
\CommentTok{#> }
\CommentTok{#>     if}
\CommentTok{#>  dis <= 0.719156}
\CommentTok{#>  lstat > 2.894121}
\CommentTok{#>     then}
\CommentTok{#>  outcome = 182.68 - 6.03 lstat - 7.6 dis - 76 tax + 1.3 rad - 0.52 indus}
\CommentTok{#>            + 2.6e-05 b}
\CommentTok{#> }
\CommentTok{#>   Rule 12/2: [300 cases, mean 19.10, range 5 to 50, est err 2.76]}
\CommentTok{#> }
\CommentTok{#>     if}
\CommentTok{#>  rm <= 3.50716}
\CommentTok{#>  lstat > 1.793385}
\CommentTok{#>     then}
\CommentTok{#>  outcome = 83.61 - 3 lstat + 9.6e-05 b - 0.0072 age - 33 tax + 0.7 rad}
\CommentTok{#>            + 0.32 indus}
\CommentTok{#> }
\CommentTok{#>   Rule 12/3: [10 cases, mean 24.25, range 15.7 to 36.2, est err 13.88]}
\CommentTok{#> }
\CommentTok{#>     if}
\CommentTok{#>  rm <= 3.50716}
\CommentTok{#>  tax <= 1.865769}
\CommentTok{#>     then}
\CommentTok{#>  outcome = 35.46}
\CommentTok{#> }
\CommentTok{#>   Rule 12/4: [10 cases, mean 32.66, range 21.9 to 50, est err 6.28]}
\CommentTok{#> }
\CommentTok{#>     if}
\CommentTok{#>  dis <= 0.719156}
\CommentTok{#>  lstat > 1.793385}
\CommentTok{#>  lstat <= 2.894121}
\CommentTok{#>     then}
\CommentTok{#>  outcome = 82.78 - 69.5 dis - 3.66 indus}
\CommentTok{#> }
\CommentTok{#>   Rule 12/5: [89 cases, mean 32.75, range 13.4 to 50, est err 3.39]}
\CommentTok{#> }
\CommentTok{#>     if}
\CommentTok{#>  rm > 3.50716}
\CommentTok{#>  dis > 0.719156}
\CommentTok{#>     then}
\CommentTok{#>  outcome = 313.22 + 13.7 rm - 174 tax - 3.06 lstat + 4.8e-05 b - 1.5 dis}
\CommentTok{#>            - 0.41 indus + 0.7 rad - 0.0055 age + 0.22 crim}
\CommentTok{#> }
\CommentTok{#>   Rule 12/6: [34 cases, mean 37.55, range 22.8 to 50, est err 3.25]}
\CommentTok{#> }
\CommentTok{#>     if}
\CommentTok{#>  rm <= 4.151791}
\CommentTok{#>  lstat <= 1.793385}
\CommentTok{#>     then}
\CommentTok{#>  outcome = -86.8 + 36 rm - 0.3 lstat - 5 tax}
\CommentTok{#> }
\CommentTok{#>   Rule 12/7: [7 cases, mean 43.66, range 37.6 to 50, est err 5.79]}
\CommentTok{#> }
\CommentTok{#>     if}
\CommentTok{#>  rm > 4.151791}
\CommentTok{#>  lstat <= 1.793385}
\CommentTok{#>     then}
\CommentTok{#>  outcome = -158.68 + 47.4 rm - 0.02 ptratio}
\CommentTok{#> }
\CommentTok{#> Model 13:}
\CommentTok{#> }
\CommentTok{#>   Rule 13/1: [84 cases, mean 14.29, range 5 to 27.5, est err 2.87]}
\CommentTok{#> }
\CommentTok{#>     if}
\CommentTok{#>  nox > -0.4864544}
\CommentTok{#>     then}
\CommentTok{#>  outcome = 54.69 - 3.79 crim - 0.0644 age + 11.4 nox - 2.53 lstat}
\CommentTok{#> }
\CommentTok{#>   Rule 13/2: [8 cases, mean 17.76, range 7 to 27.9, est err 13.69]}
\CommentTok{#> }
\CommentTok{#>     if}
\CommentTok{#>  nox <= -0.4864544}
\CommentTok{#>  age > 296.3423}
\CommentTok{#>  b <= 60875.57}
\CommentTok{#>     then}
\CommentTok{#>  outcome = -899.55 + 3.0551 age}
\CommentTok{#> }
\CommentTok{#>   Rule 13/3: [31 cases, mean 17.94, range 7 to 27.9, est err 5.15]}
\CommentTok{#> }
\CommentTok{#>     if}
\CommentTok{#>  nox <= -0.4864544}
\CommentTok{#>  b <= 60875.57}
\CommentTok{#>  lstat > 2.848535}
\CommentTok{#>     then}
\CommentTok{#>  outcome = 44.43 - 3.51 lstat - 0.054 ptratio - 1.4 dis - 0.26 crim}
\CommentTok{#>            - 0.0042 age - 0.21 indus + 0.9 rm}
\CommentTok{#> }
\CommentTok{#>   Rule 13/4: [163 cases, mean 19.37, range 7 to 31, est err 3.37]}
\CommentTok{#> }
\CommentTok{#>     if}
\CommentTok{#>  nox <= -0.4864544}
\CommentTok{#>  lstat > 2.848535}
\CommentTok{#>     then}
\CommentTok{#>  outcome = -5.76 + 0.000242 b + 8.9 rm - 5.2 dis - 0.0209 age}
\CommentTok{#>            - 0.042 ptratio - 0.63 indus}
\CommentTok{#> }
\CommentTok{#>   Rule 13/5: [163 cases, mean 29.94, range 16.5 to 50, est err 3.45]}
\CommentTok{#> }
\CommentTok{#>     if}
\CommentTok{#>  lstat <= 2.848535}
\CommentTok{#>     then}
\CommentTok{#>  outcome = 178.84 + 23.8 rm - 0.0343 age - 4.5 dis - 114 tax + 0.88 crim}
\CommentTok{#>            - 0.048 ptratio + 0.026 zn}
\CommentTok{#> }
\CommentTok{#>   Rule 13/6: [7 cases, mean 36.01, range 23.3 to 50, est err 14.09]}
\CommentTok{#> }
\CommentTok{#>     if}
\CommentTok{#>  dis <= 0.6002641}
\CommentTok{#>  lstat <= 2.848535}
\CommentTok{#>     then}
\CommentTok{#>  outcome = 45.82 - 70.3 dis - 9.9 nox + 5.1 rm + 1.5 rad}
\CommentTok{#> }
\CommentTok{#>   Rule 13/7: [31 cases, mean 37.21, range 21.9 to 50, est err 7.73]}
\CommentTok{#> }
\CommentTok{#>     if}
\CommentTok{#>  dis <= 1.063503}
\CommentTok{#>  lstat <= 2.848535}
\CommentTok{#>     then}
\CommentTok{#>  outcome = 95.05 - 4.52 lstat - 7.5 dis + 8.8 rm - 0.064 ptratio}
\CommentTok{#>            - 6.2 nox - 36 tax}
\CommentTok{#> }
\CommentTok{#> Model 14:}
\CommentTok{#> }
\CommentTok{#>   Rule 14/1: [49 cases, mean 16.06, range 8.4 to 22.7, est err 3.17]}
\CommentTok{#> }
\CommentTok{#>     if}
\CommentTok{#>  nox > -0.4205732}
\CommentTok{#>  lstat > 2.848535}
\CommentTok{#>     then}
\CommentTok{#>  outcome = 12.83 + 42.3 nox - 4.77 lstat + 9.7 rm + 7.8e-05 b}
\CommentTok{#> }
\CommentTok{#>   Rule 14/2: [78 cases, mean 16.36, range 5 to 50, est err 5.17]}
\CommentTok{#> }
\CommentTok{#>     if}
\CommentTok{#>  dis <= 0.6604174}
\CommentTok{#>     then}
\CommentTok{#>  outcome = 110.6 - 10.4 dis - 4.85 lstat + 0.0446 age - 46 tax + 0.8 rad}
\CommentTok{#> }
\CommentTok{#>   Rule 14/3: [57 cases, mean 18.40, range 9.5 to 31, est err 2.43]}
\CommentTok{#> }
\CommentTok{#>     if}
\CommentTok{#>  nox > -0.9365134}
\CommentTok{#>  nox <= -0.4205732}
\CommentTok{#>  age > 245.2507}
\CommentTok{#>  dis > 0.6604174}
\CommentTok{#>  lstat > 2.848535}
\CommentTok{#>     then}
\CommentTok{#>  outcome = 206.69 - 0.1012 age - 7.05 lstat + 12.2 nox - 67 tax + 0.3 rad}
\CommentTok{#>            + 0.5 rm - 0.3 dis}
\CommentTok{#> }
\CommentTok{#>   Rule 14/4: [230 cases, mean 20.19, range 9.5 to 36.2, est err 2.09]}
\CommentTok{#> }
\CommentTok{#>     if}
\CommentTok{#>  rm <= 3.483629}
\CommentTok{#>  dis > 0.6492998}
\CommentTok{#>     then}
\CommentTok{#>  outcome = 119.15 - 2.61 lstat + 5.2 rm - 57 tax - 1.8 dis - 2.4 nox}
\CommentTok{#>            + 0.7 rad + 0.24 crim + 0.003 age - 0.007 ptratio + 9e-06 b}
\CommentTok{#> }
\CommentTok{#>   Rule 14/5: [48 cases, mean 20.28, range 10.2 to 24.5, est err 2.13]}
\CommentTok{#> }
\CommentTok{#>     if}
\CommentTok{#>  nox > -0.9365134}
\CommentTok{#>  nox <= -0.4205732}
\CommentTok{#>  age <= 245.2507}
\CommentTok{#>  dis > 0.6604174}
\CommentTok{#>  lstat > 2.848535}
\CommentTok{#>     then}
\CommentTok{#>  outcome = 19.4 - 1.91 lstat + 1.02 indus - 0.013 age + 2.7 rm + 2.6 nox}
\CommentTok{#>            - 0.009 ptratio}
\CommentTok{#> }
\CommentTok{#>   Rule 14/6: [44 cases, mean 20.69, range 14.4 to 29.6, est err 2.26]}
\CommentTok{#> }
\CommentTok{#>     if}
\CommentTok{#>  nox <= -0.9365134}
\CommentTok{#>  lstat > 2.848535}
\CommentTok{#>     then}
\CommentTok{#>  outcome = 87.55 - 0.000315 b - 6.5 dis + 2.6 rad - 0.59 lstat - 18 tax}
\CommentTok{#> }
\CommentTok{#>   Rule 14/7: [102 cases, mean 32.44, range 13.4 to 50, est err 3.35]}
\CommentTok{#> }
\CommentTok{#>     if}
\CommentTok{#>  rm > 3.483629}
\CommentTok{#>  dis > 0.6492998}
\CommentTok{#>     then}
\CommentTok{#>  outcome = 126.92 + 22.7 rm - 4.68 lstat - 85 tax - 0.036 ptratio}
\CommentTok{#>            - 1.1 dis + 0.007 zn}
\CommentTok{#> }
\CommentTok{#>   Rule 14/8: [84 cases, mean 33.40, range 21 to 50, est err 2.44]}
\CommentTok{#> }
\CommentTok{#>     if}
\CommentTok{#>  rm > 3.483629}
\CommentTok{#>  tax <= 1.896025}
\CommentTok{#>     then}
\CommentTok{#>  outcome = 347.12 + 25.2 rm - 213 tax - 3.5 lstat - 0.013 ptratio}
\CommentTok{#> }
\CommentTok{#>   Rule 14/9: [10 cases, mean 35.13, range 21.9 to 50, est err 12.13]}
\CommentTok{#> }
\CommentTok{#>     if}
\CommentTok{#>  dis <= 0.6492998}
\CommentTok{#>  lstat <= 2.848535}
\CommentTok{#>     then}
\CommentTok{#>  outcome = 72.65 - 77.8 dis}
\CommentTok{#> }
\CommentTok{#> Model 15:}
\CommentTok{#> }
\CommentTok{#>   Rule 15/1: [28 cases, mean 12.35, range 5 to 27.9, est err 4.09]}
\CommentTok{#> }
\CommentTok{#>     if}
\CommentTok{#>  crim > 2.405809}
\CommentTok{#>  b > 16084.5}
\CommentTok{#>     then}
\CommentTok{#>  outcome = 53.45 - 7.8 crim - 3.5 lstat - 0.0189 age}
\CommentTok{#> }
\CommentTok{#>   Rule 15/2: [11 cases, mean 13.56, range 8.3 to 27.5, est err 5.99]}
\CommentTok{#> }
\CommentTok{#>     if}
\CommentTok{#>  crim > 2.405809}
\CommentTok{#>  b <= 16084.5}
\CommentTok{#>     then}
\CommentTok{#>  outcome = 8.73 + 0.001756 b}
\CommentTok{#> }
\CommentTok{#>   Rule 15/3: [244 cases, mean 17.56, range 5 to 31, est err 2.73]}
\CommentTok{#> }
\CommentTok{#>     if}
\CommentTok{#>  lstat > 2.848535}
\CommentTok{#>     then}
\CommentTok{#>  outcome = 103.02 - 0.0251 age - 2.37 lstat - 3.5 dis + 6.8e-05 b + 4 rm}
\CommentTok{#>            - 0.035 ptratio - 41 tax - 0.25 crim}
\CommentTok{#> }
\CommentTok{#>   Rule 15/4: [131 cases, mean 28.22, range 16.5 to 50, est err 2.59]}
\CommentTok{#> }
\CommentTok{#>     if}
\CommentTok{#>  dis > 1.086337}
\CommentTok{#>  lstat <= 2.848535}
\CommentTok{#>     then}
\CommentTok{#>  outcome = 267.07 + 17.7 rm - 0.0421 age - 150 tax - 5.5 dis + 0.88 crim}
\CommentTok{#>            - 0.035 ptratio + 0.031 zn - 0.12 lstat - 0.3 nox}
\CommentTok{#> }
\CommentTok{#>   Rule 15/5: [13 cases, mean 33.08, range 22 to 50, est err 4.44]}
\CommentTok{#> }
\CommentTok{#>     if}
\CommentTok{#>  nox <= -0.7229691}
\CommentTok{#>  dis <= 1.086337}
\CommentTok{#>  lstat <= 2.848535}
\CommentTok{#>     then}
\CommentTok{#>  outcome = 148.52 - 0.002365 b - 85.9 nox - 1 dis + 0.16 crim + 0.8 rm}
\CommentTok{#>            + 0.007 zn - 0.0016 age - 7 tax - 0.003 ptratio}
\CommentTok{#> }
\CommentTok{#>   Rule 15/6: [7 cases, mean 36.01, range 23.3 to 50, est err 7.00]}
\CommentTok{#> }
\CommentTok{#>     if}
\CommentTok{#>  dis <= 0.6002641}
\CommentTok{#>  lstat <= 2.848535}
\CommentTok{#>     then}
\CommentTok{#>  outcome = 50.55 - 68.1 dis - 11.4 nox + 0.00012 b + 1 rm - 0.008 ptratio}
\CommentTok{#> }
\CommentTok{#>   Rule 15/7: [12 cases, mean 41.77, range 21.9 to 50, est err 9.73]}
\CommentTok{#> }
\CommentTok{#>     if}
\CommentTok{#>  nox > -0.7229691}
\CommentTok{#>  dis > 0.6002641}
\CommentTok{#>  lstat <= 2.848535}
\CommentTok{#>     then}
\CommentTok{#>  outcome = 13.74 - 92 nox - 40.5 dis - 0.023 ptratio + 2.6 rm}
\CommentTok{#> }
\CommentTok{#> Model 16:}
\CommentTok{#> }
\CommentTok{#>   Rule 16/1: [60 cases, mean 15.95, range 7.2 to 27.5, est err 3.16]}
\CommentTok{#> }
\CommentTok{#>     if}
\CommentTok{#>  nox > -0.4344906}
\CommentTok{#>     then}
\CommentTok{#>  outcome = 46.98 - 6.53 lstat - 6.9 dis - 1.1 rm}
\CommentTok{#> }
\CommentTok{#>   Rule 16/2: [45 cases, mean 16.89, range 5 to 50, est err 5.45]}
\CommentTok{#> }
\CommentTok{#>     if}
\CommentTok{#>  nox <= -0.4344906}
\CommentTok{#>  dis <= 0.6557049}
\CommentTok{#>     then}
\CommentTok{#>  outcome = 35.33 - 37 dis - 51.7 nox - 7.38 lstat - 0.4 rm}
\CommentTok{#> }
\CommentTok{#>   Rule 16/3: [128 cases, mean 19.97, range 9.5 to 36.2, est err 2.52]}
\CommentTok{#> }
\CommentTok{#>     if}
\CommentTok{#>  rm <= 3.626081}
\CommentTok{#>  dis > 0.6557049}
\CommentTok{#>  dis <= 1.298828}
\CommentTok{#>  lstat > 2.133251}
\CommentTok{#>     then}
\CommentTok{#>  outcome = 61.65 - 3.35 lstat + 4.9 dis + 1.6 rm - 1.3 nox - 22 tax}
\CommentTok{#>            + 0.5 rad + 1.8e-05 b + 0.09 crim - 0.004 ptratio}
\CommentTok{#> }
\CommentTok{#>   Rule 16/4: [140 cases, mean 21.93, range 12.7 to 35.1, est err 2.19]}
\CommentTok{#> }
\CommentTok{#>     if}
\CommentTok{#>  rm <= 3.626081}
\CommentTok{#>  dis > 1.298828}
\CommentTok{#>     then}
\CommentTok{#>  outcome = 54.16 - 3.58 lstat + 2.2 rad - 1.6 dis - 1.9 nox + 1.8 rm}
\CommentTok{#>            - 17 tax + 1.3e-05 b + 0.06 crim - 0.003 ptratio}
\CommentTok{#> }
\CommentTok{#>   Rule 16/5: [30 cases, mean 21.97, range 14.4 to 29.1, est err 2.41]}
\CommentTok{#> }
\CommentTok{#>     if}
\CommentTok{#>  rm <= 3.626081}
\CommentTok{#>  dis > 1.298828}
\CommentTok{#>  tax <= 1.879832}
\CommentTok{#>  lstat > 2.133251}
\CommentTok{#>     then}
\CommentTok{#>  outcome = -1065.35 + 566 tax + 8.7 rm - 0.13 lstat - 0.2 dis - 0.3 nox}
\CommentTok{#> }
\CommentTok{#>   Rule 16/6: [22 cases, mean 30.88, range 10.4 to 50, est err 4.51]}
\CommentTok{#> }
\CommentTok{#>     if}
\CommentTok{#>  rm > 3.626081}
\CommentTok{#>  lstat > 2.133251}
\CommentTok{#>     then}
\CommentTok{#>  outcome = 42.24 + 18.7 rm - 1.5 indus - 1.84 lstat - 2.5 nox - 1.6 dis}
\CommentTok{#>            - 39 tax + 0.7 rad - 0.012 ptratio + 0.0035 age + 1.2e-05 b}
\CommentTok{#>            + 0.11 crim}
\CommentTok{#> }
\CommentTok{#>   Rule 16/7: [73 cases, mean 34.52, range 20.6 to 50, est err 3.36]}
\CommentTok{#> }
\CommentTok{#>     if}
\CommentTok{#>  lstat <= 2.133251}
\CommentTok{#>     then}
\CommentTok{#>  outcome = 50.6 + 19.6 rm - 2.77 lstat - 3.2 nox - 1.7 dis - 45 tax}
\CommentTok{#>            + 1 rad + 0.007 age - 0.014 ptratio}
\CommentTok{#> }
\CommentTok{#> Model 17:}
\CommentTok{#> }
\CommentTok{#>   Rule 17/1: [116 cases, mean 15.37, range 5 to 27.9, est err 2.55]}
\CommentTok{#> }
\CommentTok{#>     if}
\CommentTok{#>  crim > 0.4779842}
\CommentTok{#>  lstat > 2.944963}
\CommentTok{#>     then}
\CommentTok{#>  outcome = 35.96 - 3.68 crim - 3.41 lstat + 0.3 nox}
\CommentTok{#> }
\CommentTok{#>   Rule 17/2: [112 cases, mean 19.13, range 7 to 31, est err 2.14]}
\CommentTok{#> }
\CommentTok{#>     if}
\CommentTok{#>  crim <= 0.4779842}
\CommentTok{#>  lstat > 2.944963}
\CommentTok{#>     then}
\CommentTok{#>  outcome = 184.65 - 0.0365 age + 9 rm - 4.1 dis - 97 tax + 8.4e-05 b}
\CommentTok{#>            - 0.024 ptratio}
\CommentTok{#> }
\CommentTok{#>   Rule 17/3: [9 cases, mean 28.37, range 15 to 50, est err 11.17]}
\CommentTok{#> }
\CommentTok{#>     if}
\CommentTok{#>  dis <= 0.9547035}
\CommentTok{#>  b <= 66469.73}
\CommentTok{#>  lstat <= 2.944963}
\CommentTok{#>     then}
\CommentTok{#>  outcome = -1.12 + 0.000454 b}
\CommentTok{#> }
\CommentTok{#>   Rule 17/4: [179 cases, mean 29.28, range 15 to 50, est err 3.35]}
\CommentTok{#> }
\CommentTok{#>     if}
\CommentTok{#>  lstat <= 2.944963}
\CommentTok{#>     then}
\CommentTok{#>  outcome = 278.16 + 20 rm - 7.4 dis - 0.0356 age - 161 tax + 0.051 zn}
\CommentTok{#>            - 0.61 lstat + 0.17 crim - 0.008 ptratio}
\CommentTok{#> }
\CommentTok{#>   Rule 17/5: [23 cases, mean 36.10, range 15 to 50, est err 10.83]}
\CommentTok{#> }
\CommentTok{#>     if}
\CommentTok{#>  dis <= 0.9547035}
\CommentTok{#>  lstat <= 2.944963}
\CommentTok{#>     then}
\CommentTok{#>  outcome = 233.74 - 8.5 dis + 12.1 rm + 1.15 crim - 2.42 lstat - 113 tax}
\CommentTok{#>            - 0.0221 age + 0.068 zn - 0.031 ptratio}
\CommentTok{#> }
\CommentTok{#> Model 18:}
\CommentTok{#> }
\CommentTok{#>   Rule 18/1: [84 cases, mean 14.29, range 5 to 27.5, est err 2.44]}
\CommentTok{#> }
\CommentTok{#>     if}
\CommentTok{#>  nox > -0.4864544}
\CommentTok{#>     then}
\CommentTok{#>  outcome = 41.55 - 6.2 lstat + 14.6 nox + 3.8e-05 b}
\CommentTok{#> }
\CommentTok{#>   Rule 18/2: [163 cases, mean 19.37, range 7 to 31, est err 2.44]}
\CommentTok{#> }
\CommentTok{#>     if}
\CommentTok{#>  nox <= -0.4864544}
\CommentTok{#>  lstat > 2.848535}
\CommentTok{#>     then}
\CommentTok{#>  outcome = 172.79 - 3.67 lstat + 3.1 rad - 3.5 dis - 72 tax - 0.72 indus}
\CommentTok{#>            - 0.033 ptratio - 1.2 nox + 0.0027 age + 0.6 rm + 0.05 crim}
\CommentTok{#>            + 5e-06 b}
\CommentTok{#> }
\CommentTok{#>   Rule 18/3: [106 cases, mean 25.41, range 16.5 to 50, est err 2.76]}
\CommentTok{#> }
\CommentTok{#>     if}
\CommentTok{#>  rm <= 3.626081}
\CommentTok{#>  lstat <= 2.848535}
\CommentTok{#>     then}
\CommentTok{#>  outcome = 10.71 - 4.6 dis - 2.21 lstat + 2.3 rad + 5.5 rm - 5.3 nox}
\CommentTok{#>            - 0.83 indus - 0.003 ptratio}
\CommentTok{#> }
\CommentTok{#>   Rule 18/4: [4 cases, mean 33.47, range 30.1 to 36.2, est err 5.61]}
\CommentTok{#> }
\CommentTok{#>     if}
\CommentTok{#>  rm <= 3.626081}
\CommentTok{#>  tax <= 1.863917}
\CommentTok{#>  lstat <= 2.848535}
\CommentTok{#>     then}
\CommentTok{#>  outcome = 36.84}
\CommentTok{#> }
\CommentTok{#>   Rule 18/5: [10 cases, mean 35.13, range 21.9 to 50, est err 17.40]}
\CommentTok{#> }
\CommentTok{#>     if}
\CommentTok{#>  dis <= 0.6492998}
\CommentTok{#>  lstat <= 2.848535}
\CommentTok{#>     then}
\CommentTok{#>  outcome = 84.58 - 94.7 dis - 0.15 lstat}
\CommentTok{#> }
\CommentTok{#>   Rule 18/6: [57 cases, mean 38.38, range 21.9 to 50, est err 3.97]}
\CommentTok{#> }
\CommentTok{#>     if}
\CommentTok{#>  rm > 3.626081}
\CommentTok{#>  lstat <= 2.848535}
\CommentTok{#>     then}
\CommentTok{#>  outcome = 100.34 + 22.3 rm - 5.79 lstat - 0.062 ptratio - 69 tax}
\CommentTok{#>            + 0.3 rad - 0.5 nox - 0.3 dis + 0.0011 age}
\CommentTok{#> }
\CommentTok{#> }
\CommentTok{#> Evaluation on training data (407 cases):}
\CommentTok{#> }
\CommentTok{#>     Average  |error|               1.72}
\CommentTok{#>     Relative |error|               0.26}
\CommentTok{#>     Correlation coefficient        0.96}
\CommentTok{#> }
\CommentTok{#> }
\CommentTok{#>  Attribute usage:}
\CommentTok{#>    Conds  Model}
\CommentTok{#> }
\CommentTok{#>     72%    84%    lstat}
\CommentTok{#>     38%    85%    dis}
\CommentTok{#>     35%    80%    rm}
\CommentTok{#>     27%    55%    nox}
\CommentTok{#>      4%    58%    crim}
\CommentTok{#>      2%    49%    b}
\CommentTok{#>      2%    68%    ptratio}
\CommentTok{#>      1%    78%    tax}
\CommentTok{#>      1%    67%    age}
\CommentTok{#>            41%    rad}
\CommentTok{#>            36%    indus}
\CommentTok{#>            20%    zn}
\CommentTok{#> }
\CommentTok{#> }
\CommentTok{#> Time: 0.2 secs}
\end{Highlighting}
\end{Shaded}

We can now use this model to evaluate our held-out validation dataset. Again, we must prepare the input data using the same Box-Cox transform.

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# transform the validation dataset}
\KeywordTok{set.seed}\NormalTok{(}\DecValTok{7}\NormalTok{)}
\NormalTok{valX <-}\StringTok{ }\NormalTok{validation[,}\DecValTok{1}\OperatorTok{:}\DecValTok{13}\NormalTok{]}
\NormalTok{trans_valX <-}\StringTok{ }\KeywordTok{predict}\NormalTok{(preprocessParams, valX)}
\NormalTok{valY <-}\StringTok{ }\NormalTok{validation[,}\DecValTok{14}\NormalTok{]}

\CommentTok{# use final model to make predictions on the validation dataset}
\NormalTok{predictions <-}\StringTok{ }\KeywordTok{predict}\NormalTok{(finalModel, }\DataTypeTok{newdata =}\NormalTok{ trans_valX, }\DataTypeTok{neighbors=}\DecValTok{3}\NormalTok{)}

\CommentTok{# calculate RMSE}
\NormalTok{rmse <-}\StringTok{ }\KeywordTok{RMSE}\NormalTok{(predictions, valY)}
\NormalTok{r2 <-}\StringTok{ }\KeywordTok{R2}\NormalTok{(predictions, valY)}
\KeywordTok{print}\NormalTok{(rmse)}
\CommentTok{#> [1] 3.24}
\end{Highlighting}
\end{Shaded}

\begin{quote}
We can see that the estimated RMSE on this unseen data is about 2.666, lower but not too dissimilar from our expected RMSE of 2.822.
\end{quote}

\hypertarget{classification-algorithms-comparison.-breast-cancer-dataset-lg-lda-glmnet-knn-cartm-nb-svm}{%
\chapter{\texorpdfstring{Classification algorithms comparison. Breast cancer dataset, (\emph{LG, LDA, GLMNET, KNN, CARTM NB, SVM})}{Classification algorithms comparison. Breast cancer dataset, (LG, LDA, GLMNET, KNN, CARTM NB, SVM)}}\label{classification-algorithms-comparison.-breast-cancer-dataset-lg-lda-glmnet-knn-cartm-nb-svm}}

\hypertarget{breastcancer-dataset}{%
\section{\texorpdfstring{\texttt{BreastCancer} dataset}{BreastCancer dataset}}\label{breastcancer-dataset}}

\hypertarget{introduction-4}{%
\section{Introduction}\label{introduction-4}}

In this classification problem we apply these algorithms:

\begin{itemize}
\tightlist
\item
  Linear

  \begin{enumerate}
  \def\labelenumi{\arabic{enumi}.}
  \tightlist
  \item
    LG (logistic regression)
  \item
    LDA (linear discriminant analysis)
  \item
    GLMNET (Regularized logistic regression)
  \end{enumerate}
\item
  Non-linear

  \begin{enumerate}
  \def\labelenumi{\arabic{enumi}.}
  \setcounter{enumi}{3}
  \tightlist
  \item
    KNN (k-Nearest Neighbors)
  \item
    CART (Classification and Regression Trees)
  \item
    NB (Naive Bayes)
  \item
    SVM (Support Vector Machines)
  \end{enumerate}
\end{itemize}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# load packages}
\KeywordTok{library}\NormalTok{(mlbench)}
\KeywordTok{library}\NormalTok{(caret)}
\CommentTok{#> Loading required package: lattice}
\CommentTok{#> Loading required package: ggplot2}
\CommentTok{#> Registered S3 methods overwritten by 'ggplot2':}
\CommentTok{#>   method         from }
\CommentTok{#>   [.quosures     rlang}
\CommentTok{#>   c.quosures     rlang}
\CommentTok{#>   print.quosures rlang}
\KeywordTok{library}\NormalTok{(tictoc)}

\CommentTok{# Load data}
\KeywordTok{data}\NormalTok{(BreastCancer)}
\end{Highlighting}
\end{Shaded}

\hypertarget{workflow-3}{%
\section{Workflow}\label{workflow-3}}

\begin{enumerate}
\def\labelenumi{\arabic{enumi}.}
\tightlist
\item
  Load dataset
\item
  Create train and validation datasets, 80/20
\item
  Inspect dataset:
\end{enumerate}

\begin{itemize}
\tightlist
\item
  dimension
\item
  class of variables
\item
  \texttt{skimr}
\end{itemize}

\begin{enumerate}
\def\labelenumi{\arabic{enumi}.}
\setcounter{enumi}{3}
\tightlist
\item
  Clean up features
\end{enumerate}

\begin{itemize}
\tightlist
\item
  Convert character to numeric
\item
  Frequency table on class
\item
  remove NAs
\end{itemize}

\begin{enumerate}
\def\labelenumi{\arabic{enumi}.}
\setcounter{enumi}{4}
\tightlist
\item
  Visualize features
\end{enumerate}

\begin{itemize}
\tightlist
\item
  histograms (loop on variables)
\item
  density plots (loop)
\item
  boxplot (loop)
\item
  Pairwise jittered plot
\item
  Barplots for all features (loop)
\end{itemize}

\begin{enumerate}
\def\labelenumi{\arabic{enumi}.}
\setcounter{enumi}{5}
\tightlist
\item
  Train as-is\\
\end{enumerate}

\begin{itemize}
\tightlist
\item
  Set the train control to

  \begin{itemize}
  \tightlist
  \item
    10 cross-validations
  \item
    3 repetitions
  \item
    Metric: Accuracy
  \end{itemize}
\item
  Train the models
\item
  Numeric comparison of model results
\item
  Visual comparison

  \begin{itemize}
  \tightlist
  \item
    dot plot
  \end{itemize}
\end{itemize}

\begin{enumerate}
\def\labelenumi{\arabic{enumi}.}
\setcounter{enumi}{6}
\tightlist
\item
  Train with data transformation
\end{enumerate}

\begin{itemize}
\tightlist
\item
  data transformatiom

  \begin{itemize}
  \tightlist
  \item
    BoxCox
  \end{itemize}
\item
  Train models
\item
  Numeric comparison
\item
  Visual comparison

  \begin{itemize}
  \tightlist
  \item
    dot plot
  \end{itemize}
\end{itemize}

\begin{enumerate}
\def\labelenumi{\arabic{enumi}.}
\setcounter{enumi}{7}
\tightlist
\item
  Tune the best model: SVM
\end{enumerate}

\begin{itemize}
\tightlist
\item
  Set the train control to

  \begin{itemize}
  \tightlist
  \item
    10 cross-validations
  \item
    3 repetitions
  \item
    Metric: Accuracy
  \end{itemize}
\item
  Train the models

  \begin{itemize}
  \tightlist
  \item
    Radial SVM
  \item
    Sigma vector
  \item
    \texttt{.C}
  \item
    BoxCox
  \end{itemize}
\item
  Evaluate tuning parameters
\end{itemize}

\begin{enumerate}
\def\labelenumi{\arabic{enumi}.}
\setcounter{enumi}{8}
\tightlist
\item
  Tune the best model: KNN
\end{enumerate}

\begin{itemize}
\tightlist
\item
  Set the train control to

  \begin{itemize}
  \tightlist
  \item
    10 cross-validations
  \item
    3 repetitions
  \item
    Metric: Accuracy
  \end{itemize}
\item
  Train the models

  \begin{itemize}
  \tightlist
  \item
    .k
  \item
    BoxCox
  \end{itemize}
\item
  Evaluate tuning parameters

  \begin{itemize}
  \tightlist
  \item
    Scatter plot
    10, Ensembling
  \end{itemize}
\item
  Select the algorithms

  \begin{itemize}
  \tightlist
  \item
    Bagged CART
  \item
    Random Forest
  \item
    Stochastic Gradient Boosting
  \item
    C5.0
  \end{itemize}
\item
  Numeric comparison

  \begin{itemize}
  \tightlist
  \item
    resamples
  \item
    summary
  \end{itemize}
\item
  Visual comparison

  \begin{itemize}
  \tightlist
  \item
    dot plot\\
  \end{itemize}
\end{itemize}

\begin{enumerate}
\def\labelenumi{\arabic{enumi}.}
\setcounter{enumi}{10}
\tightlist
\item
  Finalize the model
\end{enumerate}

\begin{itemize}
\tightlist
\item
  Back transformation

  \begin{itemize}
  \tightlist
  \item
    \texttt{preProcess}
  \item
    \texttt{predict}
  \end{itemize}
\end{itemize}

\begin{enumerate}
\def\labelenumi{\arabic{enumi}.}
\setcounter{enumi}{11}
\tightlist
\item
  Apply model to validation set
\end{enumerate}

\begin{itemize}
\tightlist
\item
  Prepare validation set
\item
  Transform the dataset
\item
  Make prediction

  \begin{itemize}
  \tightlist
  \item
    \texttt{knn3Train}
  \end{itemize}
\item
  Calculate accuracy

  \begin{itemize}
  \tightlist
  \item
    Confusion Matrix
  \end{itemize}
\end{itemize}

\hypertarget{inspect-the-dataset}{%
\section{Inspect the dataset}\label{inspect-the-dataset}}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{dplyr}\OperatorTok{::}\KeywordTok{glimpse}\NormalTok{(BreastCancer)}
\CommentTok{#> Observations: 699}
\CommentTok{#> Variables: 11}
\CommentTok{#> $ Id              <chr> "1000025", "1002945", "1015425", "1016277", "1...}
\CommentTok{#> $ Cl.thickness    <ord> 5, 5, 3, 6, 4, 8, 1, 2, 2, 4, 1, 2, 5, 1, 8, 7...}
\CommentTok{#> $ Cell.size       <ord> 1, 4, 1, 8, 1, 10, 1, 1, 1, 2, 1, 1, 3, 1, 7, ...}
\CommentTok{#> $ Cell.shape      <ord> 1, 4, 1, 8, 1, 10, 1, 2, 1, 1, 1, 1, 3, 1, 5, ...}
\CommentTok{#> $ Marg.adhesion   <ord> 1, 5, 1, 1, 3, 8, 1, 1, 1, 1, 1, 1, 3, 1, 10, ...}
\CommentTok{#> $ Epith.c.size    <ord> 2, 7, 2, 3, 2, 7, 2, 2, 2, 2, 1, 2, 2, 2, 7, 6...}
\CommentTok{#> $ Bare.nuclei     <fct> 1, 10, 2, 4, 1, 10, 10, 1, 1, 1, 1, 1, 3, 3, 9...}
\CommentTok{#> $ Bl.cromatin     <fct> 3, 3, 3, 3, 3, 9, 3, 3, 1, 2, 3, 2, 4, 3, 5, 4...}
\CommentTok{#> $ Normal.nucleoli <fct> 1, 2, 1, 7, 1, 7, 1, 1, 1, 1, 1, 1, 4, 1, 5, 3...}
\CommentTok{#> $ Mitoses         <fct> 1, 1, 1, 1, 1, 1, 1, 1, 5, 1, 1, 1, 1, 1, 4, 1...}
\CommentTok{#> $ Class           <fct> benign, benign, benign, benign, benign, malign...}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{tibble}\OperatorTok{::}\KeywordTok{as_tibble}\NormalTok{(BreastCancer)}
\CommentTok{#> # A tibble: 699 x 11}
\CommentTok{#>   Id    Cl.thickness Cell.size Cell.shape Marg.adhesion Epith.c.size}
\CommentTok{#>   <chr> <ord>        <ord>     <ord>      <ord>         <ord>       }
\CommentTok{#> 1 1000~ 5            1         1          1             2           }
\CommentTok{#> 2 1002~ 5            4         4          5             7           }
\CommentTok{#> 3 1015~ 3            1         1          1             2           }
\CommentTok{#> 4 1016~ 6            8         8          1             3           }
\CommentTok{#> 5 1017~ 4            1         1          3             2           }
\CommentTok{#> 6 1017~ 8            10        10         8             7           }
\CommentTok{#> # ... with 693 more rows, and 5 more variables: Bare.nuclei <fct>,}
\CommentTok{#> #   Bl.cromatin <fct>, Normal.nucleoli <fct>, Mitoses <fct>, Class <fct>}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# Split out validation dataset}
\CommentTok{# create a list of 80% of the rows in the original dataset we can use for training}
\KeywordTok{set.seed}\NormalTok{(}\DecValTok{7}\NormalTok{)}
\NormalTok{validationIndex <-}\StringTok{ }\KeywordTok{createDataPartition}\NormalTok{(BreastCancer}\OperatorTok{$}\NormalTok{Class, }
                                       \DataTypeTok{p=}\FloatTok{0.80}\NormalTok{, }
                                       \DataTypeTok{list=}\OtherTok{FALSE}\NormalTok{)}

\CommentTok{# select 20% of the data for validation}
\NormalTok{validation <-}\StringTok{ }\NormalTok{BreastCancer[}\OperatorTok{-}\NormalTok{validationIndex,]}
\CommentTok{# use the remaining 80% of data to training and testing the models}
\NormalTok{dataset <-}\StringTok{ }\NormalTok{BreastCancer[validationIndex,]}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# dimensions of dataset}
\KeywordTok{dim}\NormalTok{(validation)}
\CommentTok{#> [1] 139  11}
\KeywordTok{dim}\NormalTok{(dataset)}
\CommentTok{#> [1] 560  11}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# peek}
\KeywordTok{head}\NormalTok{(dataset, }\DataTypeTok{n=}\DecValTok{20}\NormalTok{)}
\CommentTok{#>         Id Cl.thickness Cell.size Cell.shape Marg.adhesion Epith.c.size}
\CommentTok{#> 1  1000025            5         1          1             1            2}
\CommentTok{#> 2  1002945            5         4          4             5            7}
\CommentTok{#> 3  1015425            3         1          1             1            2}
\CommentTok{#> 5  1017023            4         1          1             3            2}
\CommentTok{#> 6  1017122            8        10         10             8            7}
\CommentTok{#> 7  1018099            1         1          1             1            2}
\CommentTok{#> 8  1018561            2         1          2             1            2}
\CommentTok{#> 9  1033078            2         1          1             1            2}
\CommentTok{#> 10 1033078            4         2          1             1            2}
\CommentTok{#> 11 1035283            1         1          1             1            1}
\CommentTok{#> 13 1041801            5         3          3             3            2}
\CommentTok{#> 14 1043999            1         1          1             1            2}
\CommentTok{#> 15 1044572            8         7          5            10            7}
\CommentTok{#> 16 1047630            7         4          6             4            6}
\CommentTok{#> 18 1049815            4         1          1             1            2}
\CommentTok{#> 19 1050670           10         7          7             6            4}
\CommentTok{#> 21 1054590            7         3          2            10            5}
\CommentTok{#> 22 1054593           10         5          5             3            6}
\CommentTok{#> 23 1056784            3         1          1             1            2}
\CommentTok{#> 24 1057013            8         4          5             1            2}
\CommentTok{#>    Bare.nuclei Bl.cromatin Normal.nucleoli Mitoses     Class}
\CommentTok{#> 1            1           3               1       1    benign}
\CommentTok{#> 2           10           3               2       1    benign}
\CommentTok{#> 3            2           3               1       1    benign}
\CommentTok{#> 5            1           3               1       1    benign}
\CommentTok{#> 6           10           9               7       1 malignant}
\CommentTok{#> 7           10           3               1       1    benign}
\CommentTok{#> 8            1           3               1       1    benign}
\CommentTok{#> 9            1           1               1       5    benign}
\CommentTok{#> 10           1           2               1       1    benign}
\CommentTok{#> 11           1           3               1       1    benign}
\CommentTok{#> 13           3           4               4       1 malignant}
\CommentTok{#> 14           3           3               1       1    benign}
\CommentTok{#> 15           9           5               5       4 malignant}
\CommentTok{#> 16           1           4               3       1 malignant}
\CommentTok{#> 18           1           3               1       1    benign}
\CommentTok{#> 19          10           4               1       2 malignant}
\CommentTok{#> 21          10           5               4       4 malignant}
\CommentTok{#> 22           7           7              10       1 malignant}
\CommentTok{#> 23           1           2               1       1    benign}
\CommentTok{#> 24        <NA>           7               3       1 malignant}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{library}\NormalTok{(skimr)}
\CommentTok{#> }
\CommentTok{#> Attaching package: 'skimr'}
\CommentTok{#> The following object is masked from 'package:stats':}
\CommentTok{#> }
\CommentTok{#>     filter}
\KeywordTok{skim}\NormalTok{(dataset)}
\CommentTok{#> Skim summary statistics}
\CommentTok{#>  n obs: 560 }
\CommentTok{#>  n variables: 11 }
\CommentTok{#> }
\CommentTok{#> -- Variable type:character -------------------------------------------------------}
\CommentTok{#>  variable missing complete   n min max empty n_unique}
\CommentTok{#>        Id       0      560 560   5   8     0      523}
\CommentTok{#> }
\CommentTok{#> -- Variable type:factor ----------------------------------------------------------}
\CommentTok{#>         variable missing complete   n n_unique}
\CommentTok{#>      Bare.nuclei      12      548 560       10}
\CommentTok{#>      Bl.cromatin       0      560 560       10}
\CommentTok{#>       Cell.shape       0      560 560       10}
\CommentTok{#>        Cell.size       0      560 560       10}
\CommentTok{#>     Cl.thickness       0      560 560       10}
\CommentTok{#>            Class       0      560 560        2}
\CommentTok{#>     Epith.c.size       0      560 560       10}
\CommentTok{#>    Marg.adhesion       0      560 560       10}
\CommentTok{#>          Mitoses       0      560 560        9}
\CommentTok{#>  Normal.nucleoli       0      560 560       10}
\CommentTok{#>                     top_counts ordered}
\CommentTok{#>  1: 327, 10: 102, 2: 28, 5: 24   FALSE}
\CommentTok{#>  3: 136, 2: 134, 1: 118, 7: 64   FALSE}
\CommentTok{#>   1: 281, 10: 48, 3: 47, 2: 46    TRUE}
\CommentTok{#>   1: 307, 10: 55, 3: 43, 2: 36    TRUE}
\CommentTok{#>    1: 113, 3: 94, 5: 94, 4: 62    TRUE}
\CommentTok{#>      ben: 367, mal: 193, NA: 0   FALSE}
\CommentTok{#>    2: 304, 3: 60, 4: 40, 1: 38    TRUE}
\CommentTok{#>   1: 331, 2: 44, 10: 44, 3: 42    TRUE}
\CommentTok{#>    1: 466, 3: 29, 2: 23, 4: 10   FALSE}
\CommentTok{#>   1: 347, 10: 50, 3: 36, 2: 29   FALSE}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# types}
\KeywordTok{sapply}\NormalTok{(dataset, class)}
\CommentTok{#> $Id}
\CommentTok{#> [1] "character"}
\CommentTok{#> }
\CommentTok{#> $Cl.thickness}
\CommentTok{#> [1] "ordered" "factor" }
\CommentTok{#> }
\CommentTok{#> $Cell.size}
\CommentTok{#> [1] "ordered" "factor" }
\CommentTok{#> }
\CommentTok{#> $Cell.shape}
\CommentTok{#> [1] "ordered" "factor" }
\CommentTok{#> }
\CommentTok{#> $Marg.adhesion}
\CommentTok{#> [1] "ordered" "factor" }
\CommentTok{#> }
\CommentTok{#> $Epith.c.size}
\CommentTok{#> [1] "ordered" "factor" }
\CommentTok{#> }
\CommentTok{#> $Bare.nuclei}
\CommentTok{#> [1] "factor"}
\CommentTok{#> }
\CommentTok{#> $Bl.cromatin}
\CommentTok{#> [1] "factor"}
\CommentTok{#> }
\CommentTok{#> $Normal.nucleoli}
\CommentTok{#> [1] "factor"}
\CommentTok{#> }
\CommentTok{#> $Mitoses}
\CommentTok{#> [1] "factor"}
\CommentTok{#> }
\CommentTok{#> $Class}
\CommentTok{#> [1] "factor"}
\end{Highlighting}
\end{Shaded}

We can see that besides the Id, the attributes are factors. This makes sense. I
think for modeling it may be more useful to work with the data as numbers than
factors. Factors might make things easier for decision tree algorithms (or not).
Given that there is an ordinal relationship between the levels we can expose
that structure to other algorithms better if we work directly with the integer
numbers.

\hypertarget{clean-up}{%
\section{clean up}\label{clean-up}}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# Remove redundant variable Id}
\NormalTok{dataset <-}\StringTok{ }\NormalTok{dataset[,}\OperatorTok{-}\DecValTok{1}\NormalTok{]}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# convert input values to numeric}
\ControlFlowTok{for}\NormalTok{(i }\ControlFlowTok{in} \DecValTok{1}\OperatorTok{:}\DecValTok{9}\NormalTok{) \{}
\NormalTok{    dataset[,i] <-}\StringTok{ }\KeywordTok{as.numeric}\NormalTok{(}\KeywordTok{as.character}\NormalTok{(dataset[,i]))}
\NormalTok{\}}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# summary}
\KeywordTok{summary}\NormalTok{(dataset)}
\CommentTok{#>   Cl.thickness     Cell.size       Cell.shape    Marg.adhesion  }
\CommentTok{#>  Min.   : 1.00   Min.   : 1.00   Min.   : 1.00   Min.   : 1.00  }
\CommentTok{#>  1st Qu.: 2.00   1st Qu.: 1.00   1st Qu.: 1.00   1st Qu.: 1.00  }
\CommentTok{#>  Median : 4.00   Median : 1.00   Median : 1.00   Median : 1.00  }
\CommentTok{#>  Mean   : 4.44   Mean   : 3.14   Mean   : 3.21   Mean   : 2.79  }
\CommentTok{#>  3rd Qu.: 6.00   3rd Qu.: 5.00   3rd Qu.: 5.00   3rd Qu.: 4.00  }
\CommentTok{#>  Max.   :10.00   Max.   :10.00   Max.   :10.00   Max.   :10.00  }
\CommentTok{#>                                                                 }
\CommentTok{#>   Epith.c.size    Bare.nuclei     Bl.cromatin    Normal.nucleoli}
\CommentTok{#>  Min.   : 1.00   Min.   : 1.00   Min.   : 1.00   Min.   : 1.00  }
\CommentTok{#>  1st Qu.: 2.00   1st Qu.: 1.00   1st Qu.: 2.00   1st Qu.: 1.00  }
\CommentTok{#>  Median : 2.00   Median : 1.00   Median : 3.00   Median : 1.00  }
\CommentTok{#>  Mean   : 3.23   Mean   : 3.48   Mean   : 3.45   Mean   : 2.94  }
\CommentTok{#>  3rd Qu.: 4.00   3rd Qu.: 5.25   3rd Qu.: 5.00   3rd Qu.: 4.00  }
\CommentTok{#>  Max.   :10.00   Max.   :10.00   Max.   :10.00   Max.   :10.00  }
\CommentTok{#>                  NA's   :12                                     }
\CommentTok{#>     Mitoses            Class    }
\CommentTok{#>  Min.   : 1.00   benign   :367  }
\CommentTok{#>  1st Qu.: 1.00   malignant:193  }
\CommentTok{#>  Median : 1.00                  }
\CommentTok{#>  Mean   : 1.59                  }
\CommentTok{#>  3rd Qu.: 1.00                  }
\CommentTok{#>  Max.   :10.00                  }
\CommentTok{#> }
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{skim}\NormalTok{(dataset)}
\CommentTok{#> Skim summary statistics}
\CommentTok{#>  n obs: 560 }
\CommentTok{#>  n variables: 10 }
\CommentTok{#> }
\CommentTok{#> -- Variable type:factor ----------------------------------------------------------}
\CommentTok{#>  variable missing complete   n n_unique                top_counts ordered}
\CommentTok{#>     Class       0      560 560        2 ben: 367, mal: 193, NA: 0   FALSE}
\CommentTok{#> }
\CommentTok{#> -- Variable type:numeric ---------------------------------------------------------}
\CommentTok{#>         variable missing complete   n mean   sd p0 p25 p50  p75 p100}
\CommentTok{#>      Bare.nuclei      12      548 560 3.48 3.62  1   1   1 5.25   10}
\CommentTok{#>      Bl.cromatin       0      560 560 3.45 2.43  1   2   3 5      10}
\CommentTok{#>       Cell.shape       0      560 560 3.21 2.97  1   1   1 5      10}
\CommentTok{#>        Cell.size       0      560 560 3.14 3.07  1   1   1 5      10}
\CommentTok{#>     Cl.thickness       0      560 560 4.44 2.83  1   2   4 6      10}
\CommentTok{#>     Epith.c.size       0      560 560 3.23 2.22  1   2   2 4      10}
\CommentTok{#>    Marg.adhesion       0      560 560 2.79 2.85  1   1   1 4      10}
\CommentTok{#>          Mitoses       0      560 560 1.59 1.7   1   1   1 1      10}
\CommentTok{#>  Normal.nucleoli       0      560 560 2.94 3.08  1   1   1 4      10}
\CommentTok{#>      hist}
\CommentTok{#>  ▇▁▁▁▁▁▁▂}
\CommentTok{#>  ▇▅▁▁▁▂▁▁}
\CommentTok{#>  ▇▁▁▁▁▁▁▁}
\CommentTok{#>  ▇▁▁▁▁▁▁▂}
\CommentTok{#>  ▇▅▃▅▂▁▂▃}
\CommentTok{#>  ▇▂▁▁▁▁▁▁}
\CommentTok{#>  ▇▁▁▁▁▁▁▁}
\CommentTok{#>  ▇▁▁▁▁▁▁▁}
\CommentTok{#>  ▇▁▁▁▁▁▁▂}
\end{Highlighting}
\end{Shaded}

\begin{quote}
we can see we have 13 NA values for the Bare.nuclei attribute. This suggests
we may need to remove the records (or impute values) with NA values for some analysis and modeling techniques.
\end{quote}

\hypertarget{analyze-the-class-variable}{%
\section{Analyze the class variable}\label{analyze-the-class-variable}}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# class distribution}
\KeywordTok{cbind}\NormalTok{(}\DataTypeTok{freq =} \KeywordTok{table}\NormalTok{(dataset}\OperatorTok{$}\NormalTok{Class), }
      \DataTypeTok{percentage =} \KeywordTok{prop.table}\NormalTok{(}\KeywordTok{table}\NormalTok{(dataset}\OperatorTok{$}\NormalTok{Class))}\OperatorTok{*}\DecValTok{100}\NormalTok{)}
\CommentTok{#>           freq percentage}
\CommentTok{#> benign     367       65.5}
\CommentTok{#> malignant  193       34.5}
\end{Highlighting}
\end{Shaded}

\begin{quote}
There is indeed a 65\% to 35\% split for benign-malignant in the class values which is imbalanced, but not so much that we need to be thinking about rebalancing the dataset, at least not yet.
\end{quote}

\hypertarget{remove-nas}{%
\subsection{remove NAs}\label{remove-nas}}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# summarize correlations between input variables}
\NormalTok{complete_cases <-}\StringTok{ }\KeywordTok{complete.cases}\NormalTok{(dataset)}
\KeywordTok{cor}\NormalTok{(dataset[complete_cases,}\DecValTok{1}\OperatorTok{:}\DecValTok{9}\NormalTok{])}
\CommentTok{#>                 Cl.thickness Cell.size Cell.shape Marg.adhesion}
\CommentTok{#> Cl.thickness           1.000     0.665      0.667         0.486}
\CommentTok{#> Cell.size              0.665     1.000      0.904         0.722}
\CommentTok{#> Cell.shape             0.667     0.904      1.000         0.694}
\CommentTok{#> Marg.adhesion          0.486     0.722      0.694         1.000}
\CommentTok{#> Epith.c.size           0.543     0.773      0.739         0.643}
\CommentTok{#> Bare.nuclei            0.598     0.700      0.721         0.669}
\CommentTok{#> Bl.cromatin            0.565     0.752      0.739         0.692}
\CommentTok{#> Normal.nucleoli        0.570     0.737      0.741         0.644}
\CommentTok{#> Mitoses                0.347     0.453      0.432         0.419}
\CommentTok{#>                 Epith.c.size Bare.nuclei Bl.cromatin Normal.nucleoli}
\CommentTok{#> Cl.thickness           0.543       0.598       0.565           0.570}
\CommentTok{#> Cell.size              0.773       0.700       0.752           0.737}
\CommentTok{#> Cell.shape             0.739       0.721       0.739           0.741}
\CommentTok{#> Marg.adhesion          0.643       0.669       0.692           0.644}
\CommentTok{#> Epith.c.size           1.000       0.614       0.628           0.642}
\CommentTok{#> Bare.nuclei            0.614       1.000       0.685           0.605}
\CommentTok{#> Bl.cromatin            0.628       0.685       1.000           0.692}
\CommentTok{#> Normal.nucleoli        0.642       0.605       0.692           1.000}
\CommentTok{#> Mitoses                0.485       0.351       0.356           0.432}
\CommentTok{#>                 Mitoses}
\CommentTok{#> Cl.thickness      0.347}
\CommentTok{#> Cell.size         0.453}
\CommentTok{#> Cell.shape        0.432}
\CommentTok{#> Marg.adhesion     0.419}
\CommentTok{#> Epith.c.size      0.485}
\CommentTok{#> Bare.nuclei       0.351}
\CommentTok{#> Bl.cromatin       0.356}
\CommentTok{#> Normal.nucleoli   0.432}
\CommentTok{#> Mitoses           1.000}
\end{Highlighting}
\end{Shaded}

\begin{quote}
We can see some modest to high correlation between some of the attributes. For example between cell shape and cell size at 0.90 correlation.
\end{quote}

\hypertarget{unimodal-visualization}{%
\section{Unimodal visualization}\label{unimodal-visualization}}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# histograms each attribute}
\KeywordTok{par}\NormalTok{(}\DataTypeTok{mfrow=}\KeywordTok{c}\NormalTok{(}\DecValTok{3}\NormalTok{,}\DecValTok{3}\NormalTok{))}
\ControlFlowTok{for}\NormalTok{(i }\ControlFlowTok{in} \DecValTok{1}\OperatorTok{:}\DecValTok{9}\NormalTok{) \{}
    \KeywordTok{hist}\NormalTok{(dataset[,i], }\DataTypeTok{main=}\KeywordTok{names}\NormalTok{(dataset)[i])}
\NormalTok{\}}
\end{Highlighting}
\end{Shaded}

\begin{center}\includegraphics[width=0.7\linewidth]{comparison_322-classification_BreastCancer-mlbench-multi_files/figure-latex/unnamed-chunk-16-1} \end{center}

\begin{quote}
We can see that almost all of the distributions have an exponential or bimodal shape to them.
\end{quote}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# density plot for each attribute}
\KeywordTok{par}\NormalTok{(}\DataTypeTok{mfrow=}\KeywordTok{c}\NormalTok{(}\DecValTok{3}\NormalTok{,}\DecValTok{3}\NormalTok{))}
\NormalTok{complete_cases <-}\StringTok{ }\KeywordTok{complete.cases}\NormalTok{(dataset)}
\ControlFlowTok{for}\NormalTok{(i }\ControlFlowTok{in} \DecValTok{1}\OperatorTok{:}\DecValTok{9}\NormalTok{) \{}
    \KeywordTok{plot}\NormalTok{(}\KeywordTok{density}\NormalTok{(dataset[complete_cases,i]), }\DataTypeTok{main=}\KeywordTok{names}\NormalTok{(dataset)[i])}
\NormalTok{\}}
\end{Highlighting}
\end{Shaded}

\begin{center}\includegraphics[width=0.7\linewidth]{comparison_322-classification_BreastCancer-mlbench-multi_files/figure-latex/unnamed-chunk-17-1} \end{center}

\begin{quote}
These plots add more support to our initial ideas. We can see bimodal distributions (two bumps) and exponential-looking distributions.
\end{quote}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# boxplots for each attribute}
\KeywordTok{par}\NormalTok{(}\DataTypeTok{mfrow=}\KeywordTok{c}\NormalTok{(}\DecValTok{3}\NormalTok{,}\DecValTok{3}\NormalTok{))}
\ControlFlowTok{for}\NormalTok{(i }\ControlFlowTok{in} \DecValTok{1}\OperatorTok{:}\DecValTok{9}\NormalTok{) \{}
    \KeywordTok{boxplot}\NormalTok{(dataset[,i], }\DataTypeTok{main=}\KeywordTok{names}\NormalTok{(dataset)[i])}
\NormalTok{\}}
\end{Highlighting}
\end{Shaded}

\begin{center}\includegraphics[width=0.7\linewidth]{comparison_322-classification_BreastCancer-mlbench-multi_files/figure-latex/unnamed-chunk-18-1} \end{center}

\hypertarget{multimodal-visualization}{%
\section{Multimodal visualization}\label{multimodal-visualization}}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# scatter plot matrix}
\NormalTok{jittered_x <-}\StringTok{ }\KeywordTok{sapply}\NormalTok{(dataset[,}\DecValTok{1}\OperatorTok{:}\DecValTok{9}\NormalTok{], jitter)}
\KeywordTok{pairs}\NormalTok{(jittered_x, }\KeywordTok{names}\NormalTok{(dataset[,}\DecValTok{1}\OperatorTok{:}\DecValTok{9}\NormalTok{]), }\DataTypeTok{col=}\NormalTok{dataset}\OperatorTok{$}\NormalTok{Class)}
\end{Highlighting}
\end{Shaded}

\begin{center}\includegraphics[width=0.7\linewidth]{comparison_322-classification_BreastCancer-mlbench-multi_files/figure-latex/unnamed-chunk-19-1} \end{center}

\begin{quote}
We can see that the black (benign) a part to be clustered around the bottom-right corner (smaller values) and red (malignant) are all over the place.
\end{quote}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# bar plots of each variable by class}
\KeywordTok{par}\NormalTok{(}\DataTypeTok{mfrow=}\KeywordTok{c}\NormalTok{(}\DecValTok{3}\NormalTok{,}\DecValTok{3}\NormalTok{))}
\ControlFlowTok{for}\NormalTok{(i }\ControlFlowTok{in} \DecValTok{1}\OperatorTok{:}\DecValTok{9}\NormalTok{) \{}
    \KeywordTok{barplot}\NormalTok{(}\KeywordTok{table}\NormalTok{(dataset}\OperatorTok{$}\NormalTok{Class,dataset[,i]), }\DataTypeTok{main=}\KeywordTok{names}\NormalTok{(dataset)[i], }
            \DataTypeTok{legend.text=}\KeywordTok{unique}\NormalTok{(dataset}\OperatorTok{$}\NormalTok{Class))}
\NormalTok{\}}
\end{Highlighting}
\end{Shaded}

\begin{center}\includegraphics[width=0.7\linewidth]{comparison_322-classification_BreastCancer-mlbench-multi_files/figure-latex/unnamed-chunk-20-1} \end{center}

\hypertarget{algorithms-evaluation}{%
\section{Algorithms Evaluation}\label{algorithms-evaluation}}

\begin{itemize}
\item
  Linear Algorithms: Logistic Regression (LG), Linear Discriminate Analysis (LDA) and Regularized Logistic Regression (GLMNET).
\item
  Nonlinear Algorithms: k-Nearest Neighbors (KNN), Classiﬁcation and Regression Trees (CART), Naive Bayes (NB) and Support Vector Machines with Radial Basis Functions (SVM).
\end{itemize}

For simplicity, we will use Accuracy and Kappa metrics. Given
that it is a medical test, we could have gone with the Area Under ROC Curve (AUC) and looked at the sensitivity and speciﬁcity to select the best algorithms.

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# 10-fold cross-validation with 3 repeats}
\NormalTok{trainControl <-}\StringTok{ }\KeywordTok{trainControl}\NormalTok{(}\DataTypeTok{method =} \StringTok{"repeatedcv"}\NormalTok{, }\DataTypeTok{number=}\DecValTok{10}\NormalTok{, }\DataTypeTok{repeats=}\DecValTok{3}\NormalTok{)}
\NormalTok{metric <-}\StringTok{ "Accuracy"}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{tic}\NormalTok{()}
\CommentTok{# LG}
\KeywordTok{set.seed}\NormalTok{(}\DecValTok{7}\NormalTok{)}
\NormalTok{fit.glm <-}\StringTok{ }\KeywordTok{train}\NormalTok{(Class}\OperatorTok{~}\NormalTok{., }\DataTypeTok{data=}\NormalTok{dataset, }\DataTypeTok{method=}\StringTok{"glm"}\NormalTok{, }\DataTypeTok{metric=}\NormalTok{metric,}
                 \DataTypeTok{trControl=}\NormalTok{trainControl, }\DataTypeTok{na.action=}\NormalTok{na.omit)}
\CommentTok{# LDA}
\KeywordTok{set.seed}\NormalTok{(}\DecValTok{7}\NormalTok{)}
\NormalTok{fit.lda <-}\StringTok{ }\KeywordTok{train}\NormalTok{(Class}\OperatorTok{~}\NormalTok{., }\DataTypeTok{data=}\NormalTok{dataset, }\DataTypeTok{method=}\StringTok{"lda"}\NormalTok{, }\DataTypeTok{metric=}\NormalTok{metric,}
                 \DataTypeTok{trControl=}\NormalTok{trainControl, }\DataTypeTok{na.action=}\NormalTok{na.omit)}
\CommentTok{# GLMNET}
\KeywordTok{set.seed}\NormalTok{(}\DecValTok{7}\NormalTok{)}
\NormalTok{fit.glmnet <-}\StringTok{ }\KeywordTok{train}\NormalTok{(Class}\OperatorTok{~}\NormalTok{., }\DataTypeTok{data=}\NormalTok{dataset, }\DataTypeTok{method=}\StringTok{"glmnet"}\NormalTok{, }\DataTypeTok{metric=}\NormalTok{metric,}
                    \DataTypeTok{trControl=}\NormalTok{trainControl, }\DataTypeTok{na.action=}\NormalTok{na.omit)}
\CommentTok{# KNN}
\KeywordTok{set.seed}\NormalTok{(}\DecValTok{7}\NormalTok{)}
\NormalTok{fit.knn <-}\StringTok{ }\KeywordTok{train}\NormalTok{(Class}\OperatorTok{~}\NormalTok{., }\DataTypeTok{data=}\NormalTok{dataset, }\DataTypeTok{method=}\StringTok{"knn"}\NormalTok{, }\DataTypeTok{metric=}\NormalTok{metric, }
                 \DataTypeTok{trControl=}\NormalTok{trainControl, }\DataTypeTok{na.action=}\NormalTok{na.omit)}
\CommentTok{# CART}
\KeywordTok{set.seed}\NormalTok{(}\DecValTok{7}\NormalTok{)}
\NormalTok{fit.cart <-}\StringTok{ }\KeywordTok{train}\NormalTok{(Class}\OperatorTok{~}\NormalTok{., }\DataTypeTok{data=}\NormalTok{dataset, }\DataTypeTok{method=}\StringTok{"rpart"}\NormalTok{, }\DataTypeTok{metric=}\NormalTok{metric, }
                  \DataTypeTok{trControl=}\NormalTok{trainControl, }\DataTypeTok{na.action=}\NormalTok{na.omit)}
\CommentTok{# Naive Bayes}
\KeywordTok{set.seed}\NormalTok{(}\DecValTok{7}\NormalTok{)}
\NormalTok{fit.nb <-}\StringTok{ }\KeywordTok{train}\NormalTok{(Class}\OperatorTok{~}\NormalTok{., }\DataTypeTok{data=}\NormalTok{dataset, }\DataTypeTok{method=}\StringTok{"nb"}\NormalTok{, }\DataTypeTok{metric=}\NormalTok{metric, }
                \DataTypeTok{trControl=}\NormalTok{trainControl, }\DataTypeTok{na.action=}\NormalTok{na.omit)}
\CommentTok{# SVM}
\KeywordTok{set.seed}\NormalTok{(}\DecValTok{7}\NormalTok{)}
\NormalTok{fit.svm <-}\StringTok{ }\KeywordTok{train}\NormalTok{(Class}\OperatorTok{~}\NormalTok{., }\DataTypeTok{data=}\NormalTok{dataset, }\DataTypeTok{method=}\StringTok{"svmRadial"}\NormalTok{, }\DataTypeTok{metric=}\NormalTok{metric, }
                 \DataTypeTok{trControl=}\NormalTok{trainControl, }\DataTypeTok{na.action=}\NormalTok{na.omit)}

\CommentTok{# Compare algorithms}
\NormalTok{results <-}\StringTok{ }\KeywordTok{resamples}\NormalTok{(}\KeywordTok{list}\NormalTok{(}\DataTypeTok{LG     =}\NormalTok{ fit.glm, }
                          \DataTypeTok{LDA    =}\NormalTok{ fit.lda, }
                          \DataTypeTok{GLMNET =}\NormalTok{ fit.glmnet, }
                          \DataTypeTok{KNN    =}\NormalTok{ fit.knn, }
                          \DataTypeTok{CART   =}\NormalTok{ fit.cart, }
                          \DataTypeTok{NB     =}\NormalTok{ fit.nb, }
                          \DataTypeTok{SVM    =}\NormalTok{ fit.svm))}
\KeywordTok{toc}\NormalTok{()}
\CommentTok{#> 14.804 sec elapsed}
\KeywordTok{summary}\NormalTok{(results)}
\CommentTok{#> }
\CommentTok{#> Call:}
\CommentTok{#> summary.resamples(object = results)}
\CommentTok{#> }
\CommentTok{#> Models: LG, LDA, GLMNET, KNN, CART, NB, SVM }
\CommentTok{#> Number of resamples: 30 }
\CommentTok{#> }
\CommentTok{#> Accuracy }
\CommentTok{#>         Min. 1st Qu. Median  Mean 3rd Qu. Max. NA's}
\CommentTok{#> LG     0.909   0.945  0.964 0.968   0.995    1    0}
\CommentTok{#> LDA    0.907   0.945  0.964 0.963   0.982    1    0}
\CommentTok{#> GLMNET 0.927   0.964  0.964 0.973   0.995    1    0}
\CommentTok{#> KNN    0.927   0.964  0.982 0.976   1.000    1    0}
\CommentTok{#> CART   0.833   0.927  0.945 0.943   0.964    1    0}
\CommentTok{#> NB     0.927   0.963  0.981 0.970   0.982    1    0}
\CommentTok{#> SVM    0.907   0.945  0.964 0.965   0.982    1    0}
\CommentTok{#> }
\CommentTok{#> Kappa }
\CommentTok{#>         Min. 1st Qu. Median  Mean 3rd Qu. Max. NA's}
\CommentTok{#> LG     0.806   0.880  0.921 0.930   0.990    1    0}
\CommentTok{#> LDA    0.786   0.880  0.918 0.917   0.959    1    0}
\CommentTok{#> GLMNET 0.843   0.918  0.922 0.940   0.990    1    0}
\CommentTok{#> KNN    0.843   0.920  0.959 0.947   1.000    1    0}
\CommentTok{#> CART   0.630   0.840  0.879 0.876   0.920    1    0}
\CommentTok{#> NB     0.835   0.918  0.959 0.934   0.960    1    0}
\CommentTok{#> SVM    0.804   0.883  0.922 0.926   0.960    1    0}
\KeywordTok{dotplot}\NormalTok{(results)}
\end{Highlighting}
\end{Shaded}

\begin{center}\includegraphics[width=0.7\linewidth]{comparison_322-classification_BreastCancer-mlbench-multi_files/figure-latex/models-first-run-1} \end{center}

\begin{quote}
We can see good accuracy across the board. All algorithms have a mean accuracy
above 90\%, well above the baseline of 65\% if we just predicted benign. The
problem is learnable. We can see that KNN (97.08\%) and logistic regression (NB
was 96.2\% and GLMNET was 96.4\%) had the highest accuracy on the problem.
\end{quote}

\hypertarget{data-transform}{%
\section{Data transform}\label{data-transform}}

We know we have some skewed distributions. There are transform methods that we can use to adjust and normalize these distributions. A favorite for positive input attributes (which we have in this case) is the Box-Cox transform.

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# 10-fold cross-validation with 3 repeats}
\NormalTok{trainControl <-}\StringTok{ }\KeywordTok{trainControl}\NormalTok{(}\DataTypeTok{method=}\StringTok{"repeatedcv"}\NormalTok{, }\DataTypeTok{number=}\DecValTok{10}\NormalTok{, }\DataTypeTok{repeats=}\DecValTok{3}\NormalTok{)}
\NormalTok{metric <-}\StringTok{ "Accuracy"}

\CommentTok{# LG}
\KeywordTok{set.seed}\NormalTok{(}\DecValTok{7}\NormalTok{)}
\NormalTok{fit.glm <-}\StringTok{ }\KeywordTok{train}\NormalTok{(Class}\OperatorTok{~}\NormalTok{., }\DataTypeTok{data=}\NormalTok{dataset, }\DataTypeTok{method=}\StringTok{"glm"}\NormalTok{, }\DataTypeTok{metric=}\NormalTok{metric, }
                 \DataTypeTok{preProc=}\KeywordTok{c}\NormalTok{(}\StringTok{"BoxCox"}\NormalTok{), }\DataTypeTok{trControl=}\NormalTok{trainControl, }\DataTypeTok{na.action=}\NormalTok{na.omit)}
\CommentTok{# LDA}
\KeywordTok{set.seed}\NormalTok{(}\DecValTok{7}\NormalTok{)}
\NormalTok{fit.lda <-}\StringTok{ }\KeywordTok{train}\NormalTok{(Class}\OperatorTok{~}\NormalTok{., }\DataTypeTok{data=}\NormalTok{dataset, }\DataTypeTok{method=}\StringTok{"lda"}\NormalTok{, }\DataTypeTok{metric=}\NormalTok{metric,}
                 \DataTypeTok{preProc=}\KeywordTok{c}\NormalTok{(}\StringTok{"BoxCox"}\NormalTok{), }\DataTypeTok{trControl=}\NormalTok{trainControl, }\DataTypeTok{na.action=}\NormalTok{na.omit)}
\CommentTok{# GLMNET}
\KeywordTok{set.seed}\NormalTok{(}\DecValTok{7}\NormalTok{)}
\NormalTok{fit.glmnet <-}\StringTok{ }\KeywordTok{train}\NormalTok{(Class}\OperatorTok{~}\NormalTok{., }\DataTypeTok{data=}\NormalTok{dataset, }\DataTypeTok{method=}\StringTok{"glmnet"}\NormalTok{, }\DataTypeTok{metric=}\NormalTok{metric, }
                    \DataTypeTok{preProc=}\KeywordTok{c}\NormalTok{(}\StringTok{"BoxCox"}\NormalTok{), }\DataTypeTok{trControl=}\NormalTok{trainControl, }
                    \DataTypeTok{na.action=}\NormalTok{na.omit)}
\CommentTok{# KNN}
\KeywordTok{set.seed}\NormalTok{(}\DecValTok{7}\NormalTok{)}
\NormalTok{fit.knn <-}\StringTok{ }\KeywordTok{train}\NormalTok{(Class}\OperatorTok{~}\NormalTok{., }\DataTypeTok{data=}\NormalTok{dataset, }\DataTypeTok{method=}\StringTok{"knn"}\NormalTok{, }\DataTypeTok{metric=}\NormalTok{metric, }
                 \DataTypeTok{preProc=}\KeywordTok{c}\NormalTok{(}\StringTok{"BoxCox"}\NormalTok{), }\DataTypeTok{trControl=}\NormalTok{trainControl, }\DataTypeTok{na.action=}\NormalTok{na.omit)}
\CommentTok{# CART}
\KeywordTok{set.seed}\NormalTok{(}\DecValTok{7}\NormalTok{)}
\NormalTok{fit.cart <-}\StringTok{ }\KeywordTok{train}\NormalTok{(Class}\OperatorTok{~}\NormalTok{., }\DataTypeTok{data=}\NormalTok{dataset, }\DataTypeTok{method=}\StringTok{"rpart"}\NormalTok{, }\DataTypeTok{metric=}\NormalTok{metric, }
                  \DataTypeTok{preProc=}\KeywordTok{c}\NormalTok{(}\StringTok{"BoxCox"}\NormalTok{), }\DataTypeTok{trControl=}\NormalTok{trainControl, }
                  \DataTypeTok{na.action=}\NormalTok{na.omit)}
\CommentTok{# Naive Bayes}
\KeywordTok{set.seed}\NormalTok{(}\DecValTok{7}\NormalTok{)}
\NormalTok{fit.nb <-}\StringTok{ }\KeywordTok{train}\NormalTok{(Class}\OperatorTok{~}\NormalTok{., }\DataTypeTok{data=}\NormalTok{dataset, }\DataTypeTok{method=}\StringTok{"nb"}\NormalTok{, }\DataTypeTok{metric=}\NormalTok{metric, }
                \DataTypeTok{preProc=}\KeywordTok{c}\NormalTok{(}\StringTok{"BoxCox"}\NormalTok{), }\DataTypeTok{trControl=}\NormalTok{trainControl, }\DataTypeTok{na.action=}\NormalTok{na.omit)}
\CommentTok{#> Warning in FUN(X[[i]], ...): Numerical 0 probability for all classes with}
\CommentTok{#> observation 1}
\CommentTok{#> Warning in FUN(X[[i]], ...): Numerical 0 probability for all classes with}
\CommentTok{#> observation 24}
\CommentTok{#> Warning in FUN(X[[i]], ...): Numerical 0 probability for all classes with}
\CommentTok{#> observation 28}
\CommentTok{#> Warning in FUN(X[[i]], ...): Numerical 0 probability for all classes with}
\CommentTok{#> observation 20}
\CommentTok{#> Warning in FUN(X[[i]], ...): Numerical 0 probability for all classes with}
\CommentTok{#> observation 11}
\CommentTok{#> Warning in FUN(X[[i]], ...): Numerical 0 probability for all classes with}
\CommentTok{#> observation 18}
\CommentTok{#> Warning in FUN(X[[i]], ...): Numerical 0 probability for all classes with}
\CommentTok{#> observation 54}
\CommentTok{#> Warning in FUN(X[[i]], ...): Numerical 0 probability for all classes with}
\CommentTok{#> observation 3}
\CommentTok{#> Warning in FUN(X[[i]], ...): Numerical 0 probability for all classes with}
\CommentTok{#> observation 23}
\CommentTok{#> Warning in FUN(X[[i]], ...): Numerical 0 probability for all classes with}
\CommentTok{#> observation 21}
\CommentTok{#> Warning in FUN(X[[i]], ...): Numerical 0 probability for all classes with}
\CommentTok{#> observation 27}
\CommentTok{#> Warning in FUN(X[[i]], ...): Numerical 0 probability for all classes with}
\CommentTok{#> observation 53}
\CommentTok{#> Warning in FUN(X[[i]], ...): Numerical 0 probability for all classes with}
\CommentTok{#> observation 12}
\CommentTok{#> Warning in FUN(X[[i]], ...): Numerical 0 probability for all classes with}
\CommentTok{#> observation 9}
\CommentTok{#> Warning in FUN(X[[i]], ...): Numerical 0 probability for all classes with}
\CommentTok{#> observation 2}
\CommentTok{#> Warning in FUN(X[[i]], ...): Numerical 0 probability for all classes with}
\CommentTok{#> observation 17}
\CommentTok{#> Warning in FUN(X[[i]], ...): Numerical 0 probability for all classes with}
\CommentTok{#> observation 9}
\CommentTok{#> Warning in FUN(X[[i]], ...): Numerical 0 probability for all classes with}
\CommentTok{#> observation 55}
\CommentTok{#> Warning in FUN(X[[i]], ...): Numerical 0 probability for all classes with}
\CommentTok{#> observation 23}
\CommentTok{#> Warning in FUN(X[[i]], ...): Numerical 0 probability for all classes with}
\CommentTok{#> observation 32}
\CommentTok{# SVM}
\KeywordTok{set.seed}\NormalTok{(}\DecValTok{7}\NormalTok{)}
\NormalTok{fit.svm <-}\StringTok{ }\KeywordTok{train}\NormalTok{(Class}\OperatorTok{~}\NormalTok{., }\DataTypeTok{data=}\NormalTok{dataset, }\DataTypeTok{method=}\StringTok{"svmRadial"}\NormalTok{, }\DataTypeTok{metric=}\NormalTok{metric, }
                 \DataTypeTok{preProc=}\KeywordTok{c}\NormalTok{(}\StringTok{"BoxCox"}\NormalTok{), }\DataTypeTok{trControl=}\NormalTok{trainControl, }\DataTypeTok{na.action=}\NormalTok{na.omit)}

\CommentTok{# Compare algorithms}
\NormalTok{transformResults <-}\StringTok{ }\KeywordTok{resamples}\NormalTok{(}\KeywordTok{list}\NormalTok{(}\DataTypeTok{LG     =}\NormalTok{ fit.glm, }
                                  \DataTypeTok{LDA    =}\NormalTok{ fit.lda, }
                                  \DataTypeTok{GLMNET =}\NormalTok{ fit.glmnet, }
                                  \DataTypeTok{KNN    =}\NormalTok{ fit.knn, }
                                  \DataTypeTok{CART   =}\NormalTok{ fit.cart, }
                                  \DataTypeTok{NB     =}\NormalTok{ fit.nb, }
                                  \DataTypeTok{SVM    =}\NormalTok{ fit.svm))}
\KeywordTok{summary}\NormalTok{(transformResults)}
\CommentTok{#> }
\CommentTok{#> Call:}
\CommentTok{#> summary.resamples(object = transformResults)}
\CommentTok{#> }
\CommentTok{#> Models: LG, LDA, GLMNET, KNN, CART, NB, SVM }
\CommentTok{#> Number of resamples: 30 }
\CommentTok{#> }
\CommentTok{#> Accuracy }
\CommentTok{#>         Min. 1st Qu. Median  Mean 3rd Qu. Max. NA's}
\CommentTok{#> LG     0.909   0.963  0.982 0.973   0.996    1    0}
\CommentTok{#> LDA    0.927   0.964  0.981 0.974   0.982    1    0}
\CommentTok{#> GLMNET 0.944   0.964  0.982 0.980   1.000    1    0}
\CommentTok{#> KNN    0.909   0.964  0.981 0.976   0.982    1    0}
\CommentTok{#> CART   0.833   0.927  0.945 0.943   0.964    1    0}
\CommentTok{#> NB     0.927   0.964  0.982 0.978   1.000    1    0}
\CommentTok{#> SVM    0.927   0.964  0.982 0.980   1.000    1    0}
\CommentTok{#> }
\CommentTok{#> Kappa }
\CommentTok{#>         Min. 1st Qu. Median  Mean 3rd Qu. Max. NA's}
\CommentTok{#> LG     0.806   0.919  0.959 0.941   0.990    1    0}
\CommentTok{#> LDA    0.847   0.921  0.959 0.945   0.961    1    0}
\CommentTok{#> GLMNET 0.878   0.922  0.960 0.957   1.000    1    0}
\CommentTok{#> KNN    0.806   0.922  0.959 0.949   0.961    1    0}
\CommentTok{#> CART   0.630   0.840  0.879 0.876   0.920    1    0}
\CommentTok{#> NB     0.843   0.922  0.960 0.953   1.000    1    0}
\CommentTok{#> SVM    0.847   0.922  0.960 0.957   1.000    1    0}
\KeywordTok{dotplot}\NormalTok{(transformResults)}
\end{Highlighting}
\end{Shaded}

\begin{center}\includegraphics[width=0.7\linewidth]{comparison_322-classification_BreastCancer-mlbench-multi_files/figure-latex/models-second-run-BoxCox-1} \end{center}

\begin{quote}
We can see that the accuracy of the previous best algorithm KNN was elevated to 97.14\%. We have a new ranking, showing SVM with the most accurate mean accuracy at 97.20\%.
\end{quote}

\hypertarget{tuning-svm}{%
\section{Tuning SVM}\label{tuning-svm}}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# 10-fold cross-validation with 3 repeats}
\NormalTok{trainControl <-}\StringTok{ }\KeywordTok{trainControl}\NormalTok{(}\DataTypeTok{method=}\StringTok{"repeatedcv"}\NormalTok{, }\DataTypeTok{number=}\DecValTok{10}\NormalTok{, }\DataTypeTok{repeats=}\DecValTok{3}\NormalTok{)}
\NormalTok{metric <-}\StringTok{ "Accuracy"}
\KeywordTok{set.seed}\NormalTok{(}\DecValTok{7}\NormalTok{)}

\NormalTok{grid <-}\StringTok{ }\KeywordTok{expand.grid}\NormalTok{(}\DataTypeTok{.sigma =} \KeywordTok{c}\NormalTok{(}\FloatTok{0.025}\NormalTok{, }\FloatTok{0.05}\NormalTok{, }\FloatTok{0.1}\NormalTok{, }\FloatTok{0.15}\NormalTok{), }
                    \DataTypeTok{.C =} \KeywordTok{seq}\NormalTok{(}\DecValTok{1}\NormalTok{, }\DecValTok{10}\NormalTok{, }\DataTypeTok{by=}\DecValTok{1}\NormalTok{))}

\NormalTok{fit.svm <-}\StringTok{ }\KeywordTok{train}\NormalTok{(Class}\OperatorTok{~}\NormalTok{., }\DataTypeTok{data=}\NormalTok{dataset, }\DataTypeTok{method=}\StringTok{"svmRadial"}\NormalTok{, }\DataTypeTok{metric=}\NormalTok{metric, }
                 \DataTypeTok{tuneGrid=}\NormalTok{grid, }
                 \DataTypeTok{preProc=}\KeywordTok{c}\NormalTok{(}\StringTok{"BoxCox"}\NormalTok{), }\DataTypeTok{trControl=}\NormalTok{trainControl, }
                 \DataTypeTok{na.action=}\NormalTok{na.omit)}
\KeywordTok{print}\NormalTok{(fit.svm)}
\CommentTok{#> Support Vector Machines with Radial Basis Function Kernel }
\CommentTok{#> }
\CommentTok{#> 560 samples}
\CommentTok{#>   9 predictor}
\CommentTok{#>   2 classes: 'benign', 'malignant' }
\CommentTok{#> }
\CommentTok{#> Pre-processing: Box-Cox transformation (9) }
\CommentTok{#> Resampling: Cross-Validated (10 fold, repeated 3 times) }
\CommentTok{#> Summary of sample sizes: 493, 492, 493, 493, 493, 494, ... }
\CommentTok{#> Resampling results across tuning parameters:}
\CommentTok{#> }
\CommentTok{#>   sigma  C   Accuracy  Kappa}
\CommentTok{#>   0.025   1  0.979     0.956}
\CommentTok{#>   0.025   2  0.979     0.954}
\CommentTok{#>   0.025   3  0.979     0.956}
\CommentTok{#>   0.025   4  0.977     0.950}
\CommentTok{#>   0.025   5  0.977     0.950}
\CommentTok{#>   0.025   6  0.978     0.951}
\CommentTok{#>   0.025   7  0.979     0.954}
\CommentTok{#>   0.025   8  0.979     0.956}
\CommentTok{#>   0.025   9  0.979     0.956}
\CommentTok{#>   0.025  10  0.979     0.956}
\CommentTok{#>   0.050   1  0.980     0.957}
\CommentTok{#>   0.050   2  0.980     0.957}
\CommentTok{#>   0.050   3  0.979     0.956}
\CommentTok{#>   0.050   4  0.980     0.957}
\CommentTok{#>   0.050   5  0.980     0.957}
\CommentTok{#>   0.050   6  0.980     0.957}
\CommentTok{#>   0.050   7  0.979     0.956}
\CommentTok{#>   0.050   8  0.979     0.954}
\CommentTok{#>   0.050   9  0.979     0.954}
\CommentTok{#>   0.050  10  0.979     0.954}
\CommentTok{#>   0.100   1  0.980     0.957}
\CommentTok{#>   0.100   2  0.980     0.957}
\CommentTok{#>   0.100   3  0.979     0.956}
\CommentTok{#>   0.100   4  0.978     0.953}
\CommentTok{#>   0.100   5  0.978     0.952}
\CommentTok{#>   0.100   6  0.975     0.946}
\CommentTok{#>   0.100   7  0.976     0.948}
\CommentTok{#>   0.100   8  0.976     0.948}
\CommentTok{#>   0.100   9  0.976     0.948}
\CommentTok{#>   0.100  10  0.975     0.946}
\CommentTok{#>   0.150   1  0.980     0.957}
\CommentTok{#>   0.150   2  0.978     0.953}
\CommentTok{#>   0.150   3  0.978     0.953}
\CommentTok{#>   0.150   4  0.976     0.949}
\CommentTok{#>   0.150   5  0.976     0.948}
\CommentTok{#>   0.150   6  0.975     0.946}
\CommentTok{#>   0.150   7  0.974     0.944}
\CommentTok{#>   0.150   8  0.972     0.939}
\CommentTok{#>   0.150   9  0.970     0.934}
\CommentTok{#>   0.150  10  0.968     0.930}
\CommentTok{#> }
\CommentTok{#> Accuracy was used to select the optimal model using the largest value.}
\CommentTok{#> The final values used for the model were sigma = 0.15 and C = 1.}
\KeywordTok{plot}\NormalTok{(fit.svm)}
\end{Highlighting}
\end{Shaded}

\begin{center}\includegraphics[width=0.7\linewidth]{comparison_322-classification_BreastCancer-mlbench-multi_files/figure-latex/model-svm-run-takes_a_while-1} \end{center}

\begin{quote}
We can see that we have made very little diﬀerence to the results. The most accurate model had a score of 97.31\% (the same as our previously rounded score of 97.20\%) using a sigma = 0.1 and C = 1. We could tune further, but I don't expect a payoﬀ.
\end{quote}

\hypertarget{tuning-knn}{%
\section{Tuning KNN}\label{tuning-knn}}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# 10-fold cross-validation with 3 repeats}
\NormalTok{trainControl <-}\StringTok{ }\KeywordTok{trainControl}\NormalTok{(}\DataTypeTok{method=}\StringTok{"repeatedcv"}\NormalTok{, }\DataTypeTok{number=}\DecValTok{10}\NormalTok{, }\DataTypeTok{repeats=}\DecValTok{3}\NormalTok{)}
\NormalTok{metric <-}\StringTok{ "Accuracy"}
\KeywordTok{set.seed}\NormalTok{(}\DecValTok{7}\NormalTok{)}

\NormalTok{grid <-}\StringTok{ }\KeywordTok{expand.grid}\NormalTok{(}\DataTypeTok{.k =} \KeywordTok{seq}\NormalTok{(}\DecValTok{1}\NormalTok{,}\DecValTok{20}\NormalTok{, }\DataTypeTok{by=}\DecValTok{1}\NormalTok{))}
\NormalTok{fit.knn <-}\StringTok{ }\KeywordTok{train}\NormalTok{(Class}\OperatorTok{~}\NormalTok{., }\DataTypeTok{data=}\NormalTok{dataset, }\DataTypeTok{method=}\StringTok{"knn"}\NormalTok{, }\DataTypeTok{metric=}\NormalTok{metric, }
                 \DataTypeTok{tuneGrid=}\NormalTok{grid, }
                 \DataTypeTok{preProc=}\KeywordTok{c}\NormalTok{(}\StringTok{"BoxCox"}\NormalTok{), }\DataTypeTok{trControl=}\NormalTok{trainControl, }
                 \DataTypeTok{na.action=}\NormalTok{na.omit)}
\KeywordTok{print}\NormalTok{(fit.knn)}
\CommentTok{#> k-Nearest Neighbors }
\CommentTok{#> }
\CommentTok{#> 560 samples}
\CommentTok{#>   9 predictor}
\CommentTok{#>   2 classes: 'benign', 'malignant' }
\CommentTok{#> }
\CommentTok{#> Pre-processing: Box-Cox transformation (9) }
\CommentTok{#> Resampling: Cross-Validated (10 fold, repeated 3 times) }
\CommentTok{#> Summary of sample sizes: 493, 492, 493, 493, 493, 494, ... }
\CommentTok{#> Resampling results across tuning parameters:}
\CommentTok{#> }
\CommentTok{#>   k   Accuracy  Kappa}
\CommentTok{#>    1  0.958     0.908}
\CommentTok{#>    2  0.960     0.912}
\CommentTok{#>    3  0.968     0.931}
\CommentTok{#>    4  0.970     0.935}
\CommentTok{#>    5  0.972     0.939}
\CommentTok{#>    6  0.973     0.942}
\CommentTok{#>    7  0.976     0.949}
\CommentTok{#>    8  0.975     0.946}
\CommentTok{#>    9  0.976     0.947}
\CommentTok{#>   10  0.976     0.949}
\CommentTok{#>   11  0.976     0.949}
\CommentTok{#>   12  0.976     0.947}
\CommentTok{#>   13  0.974     0.945}
\CommentTok{#>   14  0.975     0.946}
\CommentTok{#>   15  0.976     0.947}
\CommentTok{#>   16  0.975     0.946}
\CommentTok{#>   17  0.976     0.947}
\CommentTok{#>   18  0.976     0.947}
\CommentTok{#>   19  0.978     0.951}
\CommentTok{#>   20  0.977     0.950}
\CommentTok{#> }
\CommentTok{#> Accuracy was used to select the optimal model using the largest value.}
\CommentTok{#> The final value used for the model was k = 19.}
\KeywordTok{plot}\NormalTok{(fit.knn)}
\end{Highlighting}
\end{Shaded}

\begin{center}\includegraphics[width=0.7\linewidth]{comparison_322-classification_BreastCancer-mlbench-multi_files/figure-latex/model-knn-run-1} \end{center}

\begin{quote}
We can see again that tuning has made little diﬀerence, settling on a value of k = 7 with an accuracy of 97.19\%. This is higher than the previous 97.14\%, but very similar (or perhaps identical!) to the result achieved by the tuned SVM.
\end{quote}

\hypertarget{ensemble}{%
\section{Ensemble}\label{ensemble}}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# 10-fold cross-validation with 3 repeats}
\NormalTok{trainControl <-}\StringTok{ }\KeywordTok{trainControl}\NormalTok{(}\DataTypeTok{method=}\StringTok{"repeatedcv"}\NormalTok{, }\DataTypeTok{number=}\DecValTok{10}\NormalTok{, }\DataTypeTok{repeats=}\DecValTok{3}\NormalTok{)}
\NormalTok{metric <-}\StringTok{ "Accuracy"}

\CommentTok{# Bagged CART}
\KeywordTok{set.seed}\NormalTok{(}\DecValTok{7}\NormalTok{)}
\NormalTok{fit.treebag <-}\StringTok{ }\KeywordTok{train}\NormalTok{(Class}\OperatorTok{~}\NormalTok{., }\DataTypeTok{data=}\NormalTok{dataset, }\DataTypeTok{method=}\StringTok{"treebag"}\NormalTok{, }\DataTypeTok{metric=}\NormalTok{metric, }
                     \DataTypeTok{trControl=}\NormalTok{trainControl, }\DataTypeTok{na.action=}\NormalTok{na.omit)}

\CommentTok{# Random Forest}
\KeywordTok{set.seed}\NormalTok{(}\DecValTok{7}\NormalTok{)}
\NormalTok{fit.rf <-}\StringTok{ }\KeywordTok{train}\NormalTok{(Class}\OperatorTok{~}\NormalTok{., }\DataTypeTok{data=}\NormalTok{dataset, }\DataTypeTok{method=}\StringTok{"rf"}\NormalTok{, }\DataTypeTok{metric=}\NormalTok{metric, }
                \DataTypeTok{preProc=}\KeywordTok{c}\NormalTok{(}\StringTok{"BoxCox"}\NormalTok{), }\DataTypeTok{trControl=}\NormalTok{trainControl, }\DataTypeTok{na.action=}\NormalTok{na.omit)}

\CommentTok{# Stochastic Gradient Boosting}
\KeywordTok{set.seed}\NormalTok{(}\DecValTok{7}\NormalTok{)}
\NormalTok{fit.gbm <-}\StringTok{ }\KeywordTok{train}\NormalTok{(Class}\OperatorTok{~}\NormalTok{., }\DataTypeTok{data=}\NormalTok{dataset, }\DataTypeTok{method=}\StringTok{"gbm"}\NormalTok{, }\DataTypeTok{metric=}\NormalTok{metric, }
                 \DataTypeTok{preProc=}\KeywordTok{c}\NormalTok{(}\StringTok{"BoxCox"}\NormalTok{), }\DataTypeTok{trControl=}\NormalTok{trainControl, }\DataTypeTok{verbose=}\OtherTok{FALSE}\NormalTok{, }\DataTypeTok{na.action=}\NormalTok{na.omit)}

\CommentTok{# C5.0}
\KeywordTok{set.seed}\NormalTok{(}\DecValTok{7}\NormalTok{)}
\NormalTok{fit.c50 <-}\StringTok{ }\KeywordTok{train}\NormalTok{(Class}\OperatorTok{~}\NormalTok{., }\DataTypeTok{data=}\NormalTok{dataset, }\DataTypeTok{method=}\StringTok{"C5.0"}\NormalTok{, }\DataTypeTok{metric=}\NormalTok{metric, }
                 \DataTypeTok{preProc=}\KeywordTok{c}\NormalTok{(}\StringTok{"BoxCox"}\NormalTok{), }\DataTypeTok{trControl=}\NormalTok{trainControl, }\DataTypeTok{na.action=}\NormalTok{na.omit)}

\CommentTok{# Compare results}
\NormalTok{ensembleResults <-}\StringTok{ }\KeywordTok{resamples}\NormalTok{(}\KeywordTok{list}\NormalTok{(}\DataTypeTok{BAG =}\NormalTok{ fit.treebag, }
                                  \DataTypeTok{RF  =}\NormalTok{ fit.rf, }
                                  \DataTypeTok{GBM =}\NormalTok{ fit.gbm, }
                                  \DataTypeTok{C50 =}\NormalTok{ fit.c50))}
\KeywordTok{summary}\NormalTok{(ensembleResults)}
\CommentTok{#> }
\CommentTok{#> Call:}
\CommentTok{#> summary.resamples(object = ensembleResults)}
\CommentTok{#> }
\CommentTok{#> Models: BAG, RF, GBM, C50 }
\CommentTok{#> Number of resamples: 30 }
\CommentTok{#> }
\CommentTok{#> Accuracy }
\CommentTok{#>      Min. 1st Qu. Median  Mean 3rd Qu. Max. NA's}
\CommentTok{#> BAG 0.907   0.963  0.982 0.973   0.982    1    0}
\CommentTok{#> RF  0.926   0.981  0.982 0.979   0.995    1    0}
\CommentTok{#> GBM 0.929   0.963  0.981 0.973   0.995    1    0}
\CommentTok{#> C50 0.907   0.964  0.982 0.972   0.982    1    0}
\CommentTok{#> }
\CommentTok{#> Kappa }
\CommentTok{#>      Min. 1st Qu. Median  Mean 3rd Qu. Max. NA's}
\CommentTok{#> BAG 0.804   0.920  0.959 0.942    0.96    1    0}
\CommentTok{#> RF  0.841   0.959  0.960 0.955    0.99    1    0}
\CommentTok{#> GBM 0.844   0.919  0.959 0.941    0.99    1    0}
\CommentTok{#> C50 0.795   0.918  0.959 0.939    0.96    1    0}
\KeywordTok{dotplot}\NormalTok{(ensembleResults)}
\end{Highlighting}
\end{Shaded}

\begin{center}\includegraphics[width=0.7\linewidth]{comparison_322-classification_BreastCancer-mlbench-multi_files/figure-latex/models-ensembling-run-1} \end{center}

\begin{quote}
We see that Random Forest was the most accurate with a score of 97.26\%. Very similar to our tuned models above. We could spend time tuning the parameters of Random Forest (e.g.~increasing the number of trees) and the other ensemble methods, but I don't expect to see better accuracy scores other than random statistical ﬂuctuations.
\end{quote}

\hypertarget{finalize-model}{%
\section{Finalize model}\label{finalize-model}}

We now need to ﬁnalize the model, which really means choose which model we would like to use. For simplicity I would probably select the KNN method, at the expense of the memory required to store the training dataset. SVM would be a good choice to trade-oﬀ space and time complexity. I probably would not select the Random Forest algorithm given the complexity of the model. It seems overkill for this dataset, lots of trees with little beneﬁt in Accuracy.

Let's go with the KNN algorithm. This is really simple, as we do not need to store a model. We do need to capture the parameters of the Box-Cox transform though. And we also need to prepare the data by removing the unused Id attribute and converting all of the inputs to numeric format.

The implementation of KNN (knn3()) belongs to the caret package and does not support missing values. We will have to remove the rows with missing values from the training dataset as well as the validation dataset. The code below shows the preparation of the pre-processing parameters using the training dataset.

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# prepare parameters for data transform}
\KeywordTok{set.seed}\NormalTok{(}\DecValTok{7}\NormalTok{)}

\NormalTok{datasetNoMissing <-}\StringTok{ }\NormalTok{dataset[}\KeywordTok{complete.cases}\NormalTok{(dataset),]}
\NormalTok{x <-}\StringTok{ }\NormalTok{datasetNoMissing[,}\DecValTok{1}\OperatorTok{:}\DecValTok{9}\NormalTok{]}

\CommentTok{# transform}
\NormalTok{preprocessParams <-}\StringTok{ }\KeywordTok{preProcess}\NormalTok{(x, }\DataTypeTok{method=}\KeywordTok{c}\NormalTok{(}\StringTok{"BoxCox"}\NormalTok{))}
\NormalTok{x <-}\StringTok{ }\KeywordTok{predict}\NormalTok{(preprocessParams, x)}
\end{Highlighting}
\end{Shaded}

\hypertarget{prepare-the-validation-set}{%
\section{Prepare the validation set}\label{prepare-the-validation-set}}

Next we need to prepare the validation dataset for making a prediction. We must:

\begin{enumerate}
\def\labelenumi{\arabic{enumi}.}
\tightlist
\item
  Remove the Id attribute.
\item
  Remove those rows with missing data.
\item
  Convert all input attributes to numeric.
\item
  Apply the Box-Cox transform to the input attributes using parameters prepared on the training dataset.
\end{enumerate}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# prepare the validation dataset}
\KeywordTok{set.seed}\NormalTok{(}\DecValTok{7}\NormalTok{)}

\CommentTok{# remove id column}
\NormalTok{validation <-}\StringTok{ }\NormalTok{validation[,}\OperatorTok{-}\DecValTok{1}\NormalTok{]}

\CommentTok{# remove missing values (not allowed in this implementation of knn)}
\NormalTok{validation <-}\StringTok{ }\NormalTok{validation[}\KeywordTok{complete.cases}\NormalTok{(validation),]}

\CommentTok{# convert to numeric}
\ControlFlowTok{for}\NormalTok{(i }\ControlFlowTok{in} \DecValTok{1}\OperatorTok{:}\DecValTok{9}\NormalTok{) \{}
\NormalTok{    validation[,i] <-}\StringTok{ }\KeywordTok{as.numeric}\NormalTok{(}\KeywordTok{as.character}\NormalTok{(validation[,i]))}
\NormalTok{\}}

\CommentTok{# transform the validation dataset}
\NormalTok{validationX <-}\StringTok{ }\KeywordTok{predict}\NormalTok{(preprocessParams, validation[,}\DecValTok{1}\OperatorTok{:}\DecValTok{9}\NormalTok{])}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# make predictions}
\KeywordTok{set.seed}\NormalTok{(}\DecValTok{7}\NormalTok{)}
\CommentTok{# knn3Train(train, test, cl, k = 1, l = 0, prob = TRUE, use.all = TRUE)}
\CommentTok{# k: number of neighbours considered.}
\NormalTok{predictions <-}\StringTok{ }\KeywordTok{knn3Train}\NormalTok{(x, validationX, datasetNoMissing}\OperatorTok{$}\NormalTok{Class, }
                         \DataTypeTok{k =} \DecValTok{9}\NormalTok{, }
                         \DataTypeTok{prob =} \OtherTok{FALSE}\NormalTok{)}

\CommentTok{# convert }
\KeywordTok{confusionMatrix}\NormalTok{(}\KeywordTok{as.factor}\NormalTok{(predictions), validation}\OperatorTok{$}\NormalTok{Class)}
\CommentTok{#> Confusion Matrix and Statistics}
\CommentTok{#> }
\CommentTok{#>            Reference}
\CommentTok{#> Prediction  benign malignant}
\CommentTok{#>   benign        83         1}
\CommentTok{#>   malignant      4        47}
\CommentTok{#>                                         }
\CommentTok{#>                Accuracy : 0.963         }
\CommentTok{#>                  95% CI : (0.916, 0.988)}
\CommentTok{#>     No Information Rate : 0.644         }
\CommentTok{#>     P-Value [Acc > NIR] : <2e-16        }
\CommentTok{#>                                         }
\CommentTok{#>                   Kappa : 0.92          }
\CommentTok{#>                                         }
\CommentTok{#>  Mcnemar's Test P-Value : 0.371         }
\CommentTok{#>                                         }
\CommentTok{#>             Sensitivity : 0.954         }
\CommentTok{#>             Specificity : 0.979         }
\CommentTok{#>          Pos Pred Value : 0.988         }
\CommentTok{#>          Neg Pred Value : 0.922         }
\CommentTok{#>              Prevalence : 0.644         }
\CommentTok{#>          Detection Rate : 0.615         }
\CommentTok{#>    Detection Prevalence : 0.622         }
\CommentTok{#>       Balanced Accuracy : 0.967         }
\CommentTok{#>                                         }
\CommentTok{#>        'Positive' Class : benign        }
\CommentTok{#> }
\end{Highlighting}
\end{Shaded}

\begin{quote}
We can see that the accuracy of the final model on the validation dataset is 99.26\%. This is optimistic because there is only 136 rows, but it does show that we have an accurate standalone model that we could use on other unclassiﬁed data.
\end{quote}

\hypertarget{classification-algorithms-comparison.-outbreaks-dataset.-rf-glmnet-knn-pda-lda-nsc-c5-pls}{%
\chapter{\texorpdfstring{Classification algorithms comparison. outbreaks dataset. (\emph{RF, GLMNET, KNN, PDA, LDA, NSC, C5, PLS})}{Classification algorithms comparison. outbreaks dataset. (RF, GLMNET, KNN, PDA, LDA, NSC, C5, PLS)}}\label{classification-algorithms-comparison.-outbreaks-dataset.-rf-glmnet-knn-pda-lda-nsc-c5-pls}}

\hypertarget{introduction-5}{%
\section{Introduction}\label{introduction-5}}

Among the many nice R packages containing data collections is the \href{https://mran.microsoft.com/web/packages/outbreaks/outbreaks.pdf}{outbreaks} package. It contains datsets on epidemics and among them is data from the 2013 outbreak of \href{http://www.who.int/influenza/human_animal_interface/faq_H7N9/en/}{influenza A H7N9} in \href{http://www.who.int/influenza/human_animal_interface/influenza_h7n9/ChinaH7N9JointMissionReport2013u.pdf?ua=1}{China} as analysed by Kucharski et al. (2014):

\begin{quote}
A. Kucharski, H. Mills, A. Pinsent, C. Fraser, M. Van Kerkhove, C. A. Donnelly, and S. Riley. 2014. Distinguishing between reservoir exposure and human-to-human transmission for emerging pathogens using case onset data. PLOS Currents Outbreaks. Mar 7, edition 1. doi: 10.1371/currents.outbreaks.e1473d9bfc99d080ca242139a06c455f.
\end{quote}

\begin{quote}
A. Kucharski, H. Mills, A. Pinsent, C. Fraser, M. Van Kerkhove, C. A. Donnelly, and S. Riley. 2014. Data from: Distinguishing between reservoir exposure and human-to-human transmission for emerging pathogens using case onset data. Dryad Digital Repository. \url{http://dx.doi.org/10.5061/dryad.2g43n}.
\end{quote}

\hypertarget{algorithms-1}{%
\subsection{Algorithms}\label{algorithms-1}}

We compare these classification algorithms:

\begin{enumerate}
\def\labelenumi{\arabic{enumi}.}
\tightlist
\item
  Random Forest
\item
  GLM net
\item
  k-Nearest Neighbors
\item
  Penalized Discriminant Analysis
\item
  Stabilized Linear Discriminant Analysis
\item
  Nearest Shrunken Centroids
\item
  Single C5.0 Tree
\item
  Partial Least Squares
\end{enumerate}

\hypertarget{workflow-4}{%
\subsection{Workflow}\label{workflow-4}}

\begin{enumerate}
\def\labelenumi{\arabic{enumi}.}
\tightlist
\item
  Load dataset
\item
  Data wrangling
\end{enumerate}

\begin{itemize}
\tightlist
\item
  Many dates as one variable: \texttt{gather}
\item
  Convert group to factor: \texttt{factor}
\item
  Change dates descriptions: \texttt{dplyr::mapvalues}
\item
  Set several provinces as Other: \texttt{mapvalues}
\item
  Convert gender to factor
\item
  Convert province to factor
\end{itemize}

\begin{enumerate}
\def\labelenumi{\arabic{enumi}.}
\setcounter{enumi}{2}
\tightlist
\item
  Features visualization
\end{enumerate}

\begin{itemize}
\tightlist
\item
  Area density plot of Month vs Age by Province, by date group, by outcome, by gender
\item
  Number of flu cases by gender, by province
\item
  Age density plot of flu cases by outcome
\item
  Days passed from outset by province, by age, by gender, by outcome
\end{itemize}

\begin{enumerate}
\def\labelenumi{\arabic{enumi}.}
\setcounter{enumi}{3}
\tightlist
\item
  Feature engineering
\end{enumerate}

\begin{itemize}
\tightlist
\item
  Generate new features
\item
  Gender to numeric
\item
  Provinces to binary classifiers
\item
  Outcome to binary classifier
\item
  Impute missing data: \texttt{mice}
\end{itemize}

\begin{enumerate}
\def\labelenumi{\arabic{enumi}.}
\setcounter{enumi}{4}
\tightlist
\item
  Split dataset in training, validation and test sets\\
\item
  Feature importance
\end{enumerate}

\begin{itemize}
\tightlist
\item
  with Decision Trees
\item
  with Random Forest
\item
  Wrangling dataset
\item
  Plot Importance vs Variable
\end{itemize}

\begin{enumerate}
\def\labelenumi{\arabic{enumi}.}
\setcounter{enumi}{6}
\tightlist
\item
  Impact on Datasets\\
\end{enumerate}

\begin{itemize}
\tightlist
\item
  Density plot of training, validation and test datasets
\item
  Features vs outcome by age, days onset to hospital, day onset to outcome
\end{itemize}

\begin{enumerate}
\def\labelenumi{\arabic{enumi}.}
\setcounter{enumi}{7}
\tightlist
\item
  Train models on training validation dataset
\end{enumerate}

\begin{itemize}
\tightlist
\item
  Numeric and visual Comparison of models

  \begin{itemize}
  \tightlist
  \item
    Accuracy
  \item
    Kappa
  \end{itemize}
\item
  Compare predictions on training validation set

  \begin{itemize}
  \tightlist
  \item
    Create dataset for results
  \item
    New variable for outcome
  \end{itemize}
\end{itemize}

\begin{enumerate}
\def\labelenumi{\arabic{enumi}.}
\setcounter{enumi}{10}
\tightlist
\item
  Predicting on unknown outcomes on training data\\
\end{enumerate}

\begin{itemize}
\tightlist
\item
  Numeric and visual Comparison of models

  \begin{itemize}
  \tightlist
  \item
    Accuracy
  \item
    Kappa
  \end{itemize}
\item
  Compare predictions on training validation set

  \begin{itemize}
  \tightlist
  \item
    Create dataset for results
  \item
    New variable for outcome
  \end{itemize}
\item
  Calculate predicted outcome
\item
  Save to CSV file
\item
  Calculate recovery cases
\item
  Summarize outcome
\item
  Plot month vs log2-ratio of recovery vs death, by gender, by age, by date group
\end{itemize}

\hypertarget{can-we-predict-flu-outcome-with-machine-learning-in-r}{%
\subsection{Can we predict flu outcome with Machine Learning in R?}\label{can-we-predict-flu-outcome-with-machine-learning-in-r}}

I will be using their data as an example to show how to use Machine Learning algorithms for predicting disease outcome.

To do so, I selected and extracted features from the raw data, including age, days between onset and outcome, gender, whether the patients were hospitalised, etc. Missing values were imputed and different model algorithms were used to predict outcome (death or recovery). The prediction accuracy, sensitivity and specificity. The thus prepared dataset was devided into training and testing subsets. The test subset contained all cases with an unknown outcome. Before I applied the models to the test data, I further split the training data into validation subsets.

The tested modeling algorithms were similarly successful at predicting the outcomes of the validation data. To decide on final classifications, I compared predictions from all models and defined the outcome ``Death'' or ``Recovery'' as a function of all models, whereas classifications with a low prediction probability were flagged as ``uncertain''. Accounting for this uncertainty led to a 100\% correct classification of the validation test set.

The training cases with unknown outcome were then classified based on the same algorithms. From 57 unknown cases, 14 were classified as ``Recovery'', 10 as ``Death'' and 33 as uncertain.

In a Part 2, I am looking at how extreme gradient boosting performs on this dataset.

\begin{center}\rule{0.5\linewidth}{\linethickness}\end{center}

\textbf{Disclaimer:} I am not an expert in Machine Learning. Everything I know, I tought myself during the last months. So, if you see any mistakes or have tips and tricks for improvement, please don't hesitate to let me know! Thanks. :-)

\hypertarget{the-data}{%
\section{The data}\label{the-data}}

The dataset contains case ID, date of onset, date of hospitalisation, date of outcome, gender, age, province and of course the outcome: Death or Recovery. I can already see that there are a couple of missing values in the data, which I will deal with later.

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{options}\NormalTok{(}\DataTypeTok{width =} \DecValTok{1000}\NormalTok{)}

\ControlFlowTok{if}\NormalTok{ (}\OperatorTok{!}\KeywordTok{require}\NormalTok{(}\StringTok{"outbreaks"}\NormalTok{)) }\KeywordTok{install.packages}\NormalTok{(}\StringTok{"outbreaks"}\NormalTok{)}
\CommentTok{#> Loading required package: outbreaks}
\KeywordTok{library}\NormalTok{(outbreaks)}

\NormalTok{fluH7N9_china_}\DecValTok{2013}\NormalTok{_backup <-}\StringTok{ }\NormalTok{fluH7N9_china_}\DecValTok{2013}

\NormalTok{fluH7N9_china_}\DecValTok{2013}\OperatorTok{$}\NormalTok{age[}\KeywordTok{which}\NormalTok{(fluH7N9_china_}\DecValTok{2013}\OperatorTok{$}\NormalTok{age }\OperatorTok{==}\StringTok{ "?"}\NormalTok{)] <-}\StringTok{ }\OtherTok{NA}
\NormalTok{fluH7N9_china_}\DecValTok{2013}\OperatorTok{$}\NormalTok{case_ID <-}\StringTok{ }\KeywordTok{paste}\NormalTok{(}\StringTok{"case"}\NormalTok{, }
\NormalTok{                                    fluH7N9_china_}\DecValTok{2013}\OperatorTok{$}\NormalTok{case_id, }
                                    \DataTypeTok{sep =} \StringTok{"_"}\NormalTok{)}
\KeywordTok{head}\NormalTok{(fluH7N9_china_}\DecValTok{2013}\NormalTok{)}
\CommentTok{#>   case_id date_of_onset date_of_hospitalisation date_of_outcome outcome gender age province case_ID}
\CommentTok{#> 1       1    2013-02-19                    <NA>      2013-03-04   Death      m  87 Shanghai  case_1}
\CommentTok{#> 2       2    2013-02-27              2013-03-03      2013-03-10   Death      m  27 Shanghai  case_2}
\CommentTok{#> 3       3    2013-03-09              2013-03-19      2013-04-09   Death      f  35    Anhui  case_3}
\CommentTok{#> 4       4    2013-03-19              2013-03-27            <NA>    <NA>      f  45  Jiangsu  case_4}
\CommentTok{#> 5       5    2013-03-19              2013-03-30      2013-05-15 Recover      f  48  Jiangsu  case_5}
\CommentTok{#> 6       6    2013-03-21              2013-03-28      2013-04-26   Death      f  32  Jiangsu  case_6}
\end{Highlighting}
\end{Shaded}

Before I start preparing the data for Machine Learning, I want to get an idea of the distribution of the data points and their different variables by plotting.

Most provinces have only a handful of cases, so I am combining them into the category ``other'' and keep only Jiangsu, Shanghai and Zhejian and separate provinces.

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# make tidy data, clean up and simplify}
\KeywordTok{library}\NormalTok{(tidyr)}

\CommentTok{# put different type of dates in one variable (Date)}
\NormalTok{fluH7N9_china_}\DecValTok{2013}\NormalTok{_gather <-}\StringTok{ }\NormalTok{fluH7N9_china_}\DecValTok{2013} \OperatorTok{%>%}
\StringTok{  }\KeywordTok{gather}\NormalTok{(Group, Date, date_of_onset}\OperatorTok{:}\NormalTok{date_of_outcome)}

\CommentTok{# convert Group to factor}
\NormalTok{fluH7N9_china_}\DecValTok{2013}\NormalTok{_gather}\OperatorTok{$}\NormalTok{Group <-}\StringTok{ }\KeywordTok{factor}\NormalTok{(fluH7N9_china_}\DecValTok{2013}\NormalTok{_gather}\OperatorTok{$}\NormalTok{Group, }
                                          \DataTypeTok{levels =} \KeywordTok{c}\NormalTok{(}\StringTok{"date_of_onset"}\NormalTok{, }
                                                     \StringTok{"date_of_hospitalisation"}\NormalTok{, }
                                                     \StringTok{"date_of_outcome"}\NormalTok{))}

\CommentTok{# change the dates description with plyr::mapvalues}
\KeywordTok{library}\NormalTok{(plyr)}
\NormalTok{from <-}\StringTok{ }\KeywordTok{c}\NormalTok{(}\StringTok{"date_of_onset"}\NormalTok{, }\StringTok{"date_of_hospitalisation"}\NormalTok{, }\StringTok{"date_of_outcome"}\NormalTok{)}
\NormalTok{to <-}\StringTok{ }\KeywordTok{c}\NormalTok{(}\StringTok{"Date of onset"}\NormalTok{, }\StringTok{"Date of hospitalisation"}\NormalTok{, }\StringTok{"Date of outcome"}\NormalTok{)}
\NormalTok{fluH7N9_china_}\DecValTok{2013}\NormalTok{_gather}\OperatorTok{$}\NormalTok{Group <-}\StringTok{ }\KeywordTok{mapvalues}\NormalTok{(fluH7N9_china_}\DecValTok{2013}\NormalTok{_gather}\OperatorTok{$}\NormalTok{Group, }
                                             \DataTypeTok{from =}\NormalTok{ from, }\DataTypeTok{to =}\NormalTok{ to)}

\CommentTok{# change additional provinces to Other}
\NormalTok{from <-}\StringTok{ }\KeywordTok{c}\NormalTok{(}\StringTok{"Anhui"}\NormalTok{, }\StringTok{"Beijing"}\NormalTok{, }\StringTok{"Fujian"}\NormalTok{, }\StringTok{"Guangdong"}\NormalTok{, }\StringTok{"Hebei"}\NormalTok{, }\StringTok{"Henan"}\NormalTok{, }
          \StringTok{"Hunan"}\NormalTok{, }\StringTok{"Jiangxi"}\NormalTok{, }\StringTok{"Shandong"}\NormalTok{, }\StringTok{"Taiwan"}\NormalTok{)}
\NormalTok{to <-}\StringTok{ }\KeywordTok{rep}\NormalTok{(}\StringTok{"Other"}\NormalTok{, }\DecValTok{10}\NormalTok{)}
\NormalTok{fluH7N9_china_}\DecValTok{2013}\NormalTok{_gather}\OperatorTok{$}\NormalTok{province <-}\StringTok{ }
\StringTok{  }\KeywordTok{mapvalues}\NormalTok{(fluH7N9_china_}\DecValTok{2013}\NormalTok{_gather}\OperatorTok{$}\NormalTok{province, }
            \DataTypeTok{from =}\NormalTok{ from, }\DataTypeTok{to =}\NormalTok{ to)}

\CommentTok{# convert gender to factor}
\KeywordTok{levels}\NormalTok{(fluH7N9_china_}\DecValTok{2013}\NormalTok{_gather}\OperatorTok{$}\NormalTok{gender) <-}\StringTok{ }
\StringTok{  }\KeywordTok{c}\NormalTok{(}\KeywordTok{levels}\NormalTok{(fluH7N9_china_}\DecValTok{2013}\NormalTok{_gather}\OperatorTok{$}\NormalTok{gender), }\StringTok{"unknown"}\NormalTok{)}

\CommentTok{# replace NA in gender by "unknown}
\NormalTok{is_na <-}\StringTok{ }\KeywordTok{is.na}\NormalTok{(fluH7N9_china_}\DecValTok{2013}\NormalTok{_gather}\OperatorTok{$}\NormalTok{gender)}
\NormalTok{fluH7N9_china_}\DecValTok{2013}\NormalTok{_gather}\OperatorTok{$}\NormalTok{gender[is_na] <-}\StringTok{ "unknown"}

\CommentTok{# convert province to factor}
\NormalTok{fluH7N9_china_}\DecValTok{2013}\NormalTok{_gather}\OperatorTok{$}\NormalTok{province <-}\StringTok{ }\KeywordTok{factor}\NormalTok{(fluH7N9_china_}\DecValTok{2013}\NormalTok{_gather}\OperatorTok{$}\NormalTok{province, }
                                             \DataTypeTok{levels =} \KeywordTok{c}\NormalTok{(}\StringTok{"Jiangsu"}\NormalTok{,  }\StringTok{"Shanghai"}\NormalTok{, }
                                                        \StringTok{"Zhejiang"}\NormalTok{, }\StringTok{"Other"}\NormalTok{))}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{library}\NormalTok{(ggplot2)}
\CommentTok{#> Registered S3 methods overwritten by 'ggplot2':}
\CommentTok{#>   method         from }
\CommentTok{#>   [.quosures     rlang}
\CommentTok{#>   c.quosures     rlang}
\CommentTok{#>   print.quosures rlang}
\NormalTok{my_theme <-}\StringTok{ }\ControlFlowTok{function}\NormalTok{(}\DataTypeTok{base_size =} \DecValTok{12}\NormalTok{, }\DataTypeTok{base_family =} \StringTok{"sans"}\NormalTok{)\{}
  \KeywordTok{theme_minimal}\NormalTok{(}\DataTypeTok{base_size =}\NormalTok{ base_size, }\DataTypeTok{base_family =}\NormalTok{ base_family) }\OperatorTok{+}
\StringTok{  }\KeywordTok{theme}\NormalTok{(}
    \DataTypeTok{axis.text =} \KeywordTok{element_text}\NormalTok{(}\DataTypeTok{size =} \DecValTok{12}\NormalTok{),}
    \DataTypeTok{axis.text.x =} \KeywordTok{element_text}\NormalTok{(}\DataTypeTok{angle =} \DecValTok{45}\NormalTok{, }\DataTypeTok{vjust =} \FloatTok{0.5}\NormalTok{, }\DataTypeTok{hjust =} \FloatTok{0.5}\NormalTok{),}
    \DataTypeTok{axis.title =} \KeywordTok{element_text}\NormalTok{(}\DataTypeTok{size =} \DecValTok{14}\NormalTok{),}
    \DataTypeTok{panel.grid.major =} \KeywordTok{element_line}\NormalTok{(}\DataTypeTok{color =} \StringTok{"grey"}\NormalTok{),}
    \DataTypeTok{panel.grid.minor =} \KeywordTok{element_blank}\NormalTok{(),}
    \DataTypeTok{panel.background =} \KeywordTok{element_rect}\NormalTok{(}\DataTypeTok{fill =} \StringTok{"aliceblue"}\NormalTok{),}
    \DataTypeTok{strip.background =} \KeywordTok{element_rect}\NormalTok{(}\DataTypeTok{fill =} \StringTok{"lightgrey"}\NormalTok{, }\DataTypeTok{color =} \StringTok{"grey"}\NormalTok{, }
                                    \DataTypeTok{size =} \DecValTok{1}\NormalTok{),}
    \DataTypeTok{strip.text =} \KeywordTok{element_text}\NormalTok{(}\DataTypeTok{face =} \StringTok{"bold"}\NormalTok{, }\DataTypeTok{size =} \DecValTok{12}\NormalTok{, }\DataTypeTok{color =} \StringTok{"black"}\NormalTok{),}
    \DataTypeTok{legend.position =} \StringTok{"bottom"}\NormalTok{,}
    \DataTypeTok{legend.justification =} \StringTok{"top"}\NormalTok{, }
    \DataTypeTok{legend.box =} \StringTok{"horizontal"}\NormalTok{,}
    \DataTypeTok{legend.box.background =} \KeywordTok{element_rect}\NormalTok{(}\DataTypeTok{colour =} \StringTok{"grey50"}\NormalTok{),}
    \DataTypeTok{legend.background =} \KeywordTok{element_blank}\NormalTok{(),}
    \DataTypeTok{panel.border =} \KeywordTok{element_rect}\NormalTok{(}\DataTypeTok{color =} \StringTok{"grey"}\NormalTok{, }\DataTypeTok{fill =} \OtherTok{NA}\NormalTok{, }\DataTypeTok{size =} \FloatTok{0.5}\NormalTok{)}
\NormalTok{  )}
\NormalTok{\}}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{ggplot}\NormalTok{(}\DataTypeTok{data =}\NormalTok{ fluH7N9_china_}\DecValTok{2013}\NormalTok{_gather, }
       \KeywordTok{aes}\NormalTok{(}\DataTypeTok{x =}\NormalTok{ Date, }\DataTypeTok{y =} \KeywordTok{as.numeric}\NormalTok{(age), }\DataTypeTok{fill =}\NormalTok{ outcome)) }\OperatorTok{+}
\StringTok{  }\KeywordTok{stat_density2d}\NormalTok{(}\KeywordTok{aes}\NormalTok{(}\DataTypeTok{alpha =}\NormalTok{ ..level..), }\DataTypeTok{geom =} \StringTok{"polygon"}\NormalTok{) }\OperatorTok{+}
\StringTok{  }\KeywordTok{geom_jitter}\NormalTok{(}\KeywordTok{aes}\NormalTok{(}\DataTypeTok{color =}\NormalTok{ outcome, }\DataTypeTok{shape =}\NormalTok{ gender), }\DataTypeTok{size =} \FloatTok{1.5}\NormalTok{) }\OperatorTok{+}
\StringTok{  }\KeywordTok{geom_rug}\NormalTok{(}\KeywordTok{aes}\NormalTok{(}\DataTypeTok{color =}\NormalTok{ outcome)) }\OperatorTok{+}
\StringTok{  }\KeywordTok{labs}\NormalTok{(}
    \DataTypeTok{fill =} \StringTok{"Outcome"}\NormalTok{,}
    \DataTypeTok{color =} \StringTok{"Outcome"}\NormalTok{,}
    \DataTypeTok{alpha =} \StringTok{"Level"}\NormalTok{,}
    \DataTypeTok{shape =} \StringTok{"Gender"}\NormalTok{,}
    \DataTypeTok{x =} \StringTok{"Date in 2013"}\NormalTok{,}
    \DataTypeTok{y =} \StringTok{"Age"}\NormalTok{,}
    \DataTypeTok{title =} \StringTok{"2013 Influenza A H7N9 cases in China"}\NormalTok{,}
    \DataTypeTok{subtitle =} \StringTok{"Dataset from 'outbreaks' package (Kucharski et al. 2014)"}\NormalTok{,}
    \DataTypeTok{caption =} \StringTok{""}
\NormalTok{  ) }\OperatorTok{+}
\StringTok{  }\KeywordTok{facet_grid}\NormalTok{(Group }\OperatorTok{~}\StringTok{ }\NormalTok{province) }\OperatorTok{+}
\StringTok{  }\KeywordTok{my_theme}\NormalTok{() }\OperatorTok{+}
\StringTok{  }\KeywordTok{scale_shape_manual}\NormalTok{(}\DataTypeTok{values =} \KeywordTok{c}\NormalTok{(}\DecValTok{15}\NormalTok{, }\DecValTok{16}\NormalTok{, }\DecValTok{17}\NormalTok{)) }\OperatorTok{+}
\StringTok{  }\KeywordTok{scale_color_brewer}\NormalTok{(}\DataTypeTok{palette=}\StringTok{"Set1"}\NormalTok{, }\DataTypeTok{na.value =} \StringTok{"grey50"}\NormalTok{) }\OperatorTok{+}
\StringTok{  }\KeywordTok{scale_fill_brewer}\NormalTok{(}\DataTypeTok{palette=}\StringTok{"Set1"}\NormalTok{)}
\CommentTok{#> Warning: Removed 149 rows containing non-finite values (stat_density2d).}
\CommentTok{#> Warning: Removed 149 rows containing missing values (geom_point).}
\end{Highlighting}
\end{Shaded}

\begin{center}\includegraphics[width=0.7\linewidth]{comparison_330-classification_flu_outcome-multi-sglander_files/figure-latex/unnamed-chunk-6-1} \end{center}

This plot shows the dates of onset, hospitalisation and outcome (if known) of each data point. Outcome is marked by color and age shown on the y-axis. Gender is marked by point shape.

The density distribution of date by age for the cases seems to indicate that older people died more frequently in the Jiangsu and Zhejiang province than in Shanghai and in other provinces.

When we look at the distribution of points along the time axis, it suggests that their might be a positive correlation between the likelihood of death and an early onset or early outcome.

I also want to know how many cases there are for each gender and province and compare the genders' age distribution.

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# more tidy data. first remove age}
\NormalTok{fluH7N9_china_}\DecValTok{2013}\NormalTok{_gather_}\DecValTok{2}\NormalTok{ <-}\StringTok{ }\NormalTok{fluH7N9_china_}\DecValTok{2013}\NormalTok{_gather[, }\DecValTok{-4}\NormalTok{] }\OperatorTok{%>%}
\StringTok{  }\KeywordTok{gather}\NormalTok{(group_}\DecValTok{2}\NormalTok{, value, gender}\OperatorTok{:}\NormalTok{province)}
\CommentTok{#> Warning: attributes are not identical across measure variables;}
\CommentTok{#> they will be dropped}

\CommentTok{# change descriptions}
\NormalTok{from <-}\StringTok{ }\KeywordTok{c}\NormalTok{(}\StringTok{"m"}\NormalTok{, }\StringTok{"f"}\NormalTok{, }\StringTok{"unknown"}\NormalTok{, }\StringTok{"Other"}\NormalTok{)}
\NormalTok{to <-}\StringTok{ }\KeywordTok{c}\NormalTok{(}\StringTok{"Male"}\NormalTok{, }\StringTok{"Female"}\NormalTok{, }\StringTok{"Unknown gender"}\NormalTok{, }\StringTok{"Other province"}\NormalTok{)}
\NormalTok{fluH7N9_china_}\DecValTok{2013}\NormalTok{_gather_}\DecValTok{2}\OperatorTok{$}\NormalTok{value <-}\StringTok{ }\KeywordTok{mapvalues}\NormalTok{(fluH7N9_china_}\DecValTok{2013}\NormalTok{_gather_}\DecValTok{2}\OperatorTok{$}\NormalTok{value, }
                                               \DataTypeTok{from =}\NormalTok{ from, }\DataTypeTok{to =}\NormalTok{ to)}
\CommentTok{# convert to factor}
\NormalTok{fluH7N9_china_}\DecValTok{2013}\NormalTok{_gather_}\DecValTok{2}\OperatorTok{$}\NormalTok{value <-}\StringTok{ }\KeywordTok{factor}\NormalTok{(fluH7N9_china_}\DecValTok{2013}\NormalTok{_gather_}\DecValTok{2}\OperatorTok{$}\NormalTok{value, }
                                            \DataTypeTok{levels =} \KeywordTok{c}\NormalTok{(}\StringTok{"Female"}\NormalTok{, }\StringTok{"Male"}\NormalTok{, }
                                                       \StringTok{"Unknown gender"}\NormalTok{, }
                                                       \StringTok{"Jiangsu"}\NormalTok{, }\StringTok{"Shanghai"}\NormalTok{, }
                                                       \StringTok{"Zhejiang"}\NormalTok{, }\StringTok{"Other }
\StringTok{                                                       province"}\NormalTok{))}

\NormalTok{p1 <-}\StringTok{ }\KeywordTok{ggplot}\NormalTok{(}\DataTypeTok{data =}\NormalTok{ fluH7N9_china_}\DecValTok{2013}\NormalTok{_gather_}\DecValTok{2}\NormalTok{, }\KeywordTok{aes}\NormalTok{(}\DataTypeTok{x =}\NormalTok{ value, }
                                                     \DataTypeTok{fill =}\NormalTok{ outcome, }
                                                     \DataTypeTok{color =}\NormalTok{ outcome)) }\OperatorTok{+}
\StringTok{  }\KeywordTok{geom_bar}\NormalTok{(}\DataTypeTok{position =} \StringTok{"dodge"}\NormalTok{, }\DataTypeTok{alpha =} \FloatTok{0.7}\NormalTok{, }\DataTypeTok{size =} \DecValTok{1}\NormalTok{) }\OperatorTok{+}
\StringTok{  }\KeywordTok{my_theme}\NormalTok{() }\OperatorTok{+}
\StringTok{  }\KeywordTok{scale_fill_brewer}\NormalTok{(}\DataTypeTok{palette=}\StringTok{"Set1"}\NormalTok{, }\DataTypeTok{na.value =} \StringTok{"grey50"}\NormalTok{) }\OperatorTok{+}
\StringTok{  }\KeywordTok{scale_color_brewer}\NormalTok{(}\DataTypeTok{palette=}\StringTok{"Set1"}\NormalTok{, }\DataTypeTok{na.value =} \StringTok{"grey50"}\NormalTok{) }\OperatorTok{+}
\StringTok{  }\KeywordTok{labs}\NormalTok{(}
    \DataTypeTok{color =} \StringTok{""}\NormalTok{,}
    \DataTypeTok{fill =} \StringTok{""}\NormalTok{,}
    \DataTypeTok{x =} \StringTok{""}\NormalTok{,}
    \DataTypeTok{y =} \StringTok{"Count"}\NormalTok{,}
    \DataTypeTok{title =} \StringTok{"2013 Influenza A H7N9 cases in China"}\NormalTok{,}
    \DataTypeTok{subtitle =} \StringTok{"Gender and Province numbers of flu cases"}\NormalTok{,}
    \DataTypeTok{caption =} \StringTok{""}
\NormalTok{  )}

\NormalTok{p2 <-}\StringTok{ }\KeywordTok{ggplot}\NormalTok{(}\DataTypeTok{data =}\NormalTok{ fluH7N9_china_}\DecValTok{2013}\NormalTok{_gather, }\KeywordTok{aes}\NormalTok{(}\DataTypeTok{x =} \KeywordTok{as.numeric}\NormalTok{(age), }
                                                   \DataTypeTok{fill =}\NormalTok{ outcome, }
                                                   \DataTypeTok{color =}\NormalTok{ outcome)) }\OperatorTok{+}
\StringTok{  }\KeywordTok{geom_density}\NormalTok{(}\DataTypeTok{alpha =} \FloatTok{0.3}\NormalTok{, }\DataTypeTok{size =} \DecValTok{1}\NormalTok{) }\OperatorTok{+}
\StringTok{  }\KeywordTok{geom_rug}\NormalTok{() }\OperatorTok{+}
\StringTok{  }\KeywordTok{scale_color_brewer}\NormalTok{(}\DataTypeTok{palette=}\StringTok{"Set1"}\NormalTok{, }\DataTypeTok{na.value =} \StringTok{"grey50"}\NormalTok{) }\OperatorTok{+}
\StringTok{  }\KeywordTok{scale_fill_brewer}\NormalTok{(}\DataTypeTok{palette=}\StringTok{"Set1"}\NormalTok{, }\DataTypeTok{na.value =} \StringTok{"grey50"}\NormalTok{) }\OperatorTok{+}
\StringTok{  }\KeywordTok{my_theme}\NormalTok{() }\OperatorTok{+}
\StringTok{  }\KeywordTok{labs}\NormalTok{(}
    \DataTypeTok{color =} \StringTok{""}\NormalTok{,}
    \DataTypeTok{fill =} \StringTok{""}\NormalTok{,}
    \DataTypeTok{x =} \StringTok{"Age"}\NormalTok{,}
    \DataTypeTok{y =} \StringTok{"Density"}\NormalTok{,}
    \DataTypeTok{title =} \StringTok{""}\NormalTok{,}
    \DataTypeTok{subtitle =} \StringTok{"Age distribution of flu cases"}\NormalTok{,}
    \DataTypeTok{caption =} \StringTok{""}
\NormalTok{  )}

\KeywordTok{library}\NormalTok{(gridExtra)}
\KeywordTok{library}\NormalTok{(grid)}

\KeywordTok{grid.arrange}\NormalTok{(p1, p2, }\DataTypeTok{ncol =} \DecValTok{2}\NormalTok{)}
\CommentTok{#> Warning: Removed 6 rows containing non-finite values (stat_density).}
\end{Highlighting}
\end{Shaded}

\begin{center}\includegraphics[width=0.7\linewidth]{comparison_330-classification_flu_outcome-multi-sglander_files/figure-latex/unnamed-chunk-7-1} \end{center}

In the dataset, there are more male than female cases and correspondingly, we see more deaths, recoveries and unknown outcomes in men than in women. This is potentially a problem later on for modeling because the inherent likelihoods for outcome are not directly comparable between the sexes.

Most unknown outcomes were recorded in Zhejiang. Similarly to gender, we don't have an equal distribution of data points across provinces either.

When we look at the age distribution it is obvious that people who died tended to be slightly older than those who recovered. The density curve of unknown outcomes is more similar to that of death than of recovery, suggesting that among these people there might have been more deaths than recoveries.

And lastly, I want to plot how many days passed between onset, hospitalisation and outcome for each case.

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{ggplot}\NormalTok{(}\DataTypeTok{data =}\NormalTok{ fluH7N9_china_}\DecValTok{2013}\NormalTok{_gather, }\KeywordTok{aes}\NormalTok{(}\DataTypeTok{x =}\NormalTok{ Date, }\DataTypeTok{y =} \KeywordTok{as.numeric}\NormalTok{(age), }
                                             \DataTypeTok{color =}\NormalTok{ outcome)) }\OperatorTok{+}
\StringTok{  }\KeywordTok{geom_point}\NormalTok{(}\KeywordTok{aes}\NormalTok{(}\DataTypeTok{color =}\NormalTok{ outcome, }\DataTypeTok{shape =}\NormalTok{ gender), }\DataTypeTok{size =} \FloatTok{1.5}\NormalTok{, }\DataTypeTok{alpha =} \FloatTok{0.6}\NormalTok{) }\OperatorTok{+}
\StringTok{  }\KeywordTok{geom_path}\NormalTok{(}\KeywordTok{aes}\NormalTok{(}\DataTypeTok{group =}\NormalTok{ case_ID)) }\OperatorTok{+}
\StringTok{  }\KeywordTok{facet_wrap}\NormalTok{( }\OperatorTok{~}\StringTok{ }\NormalTok{province, }\DataTypeTok{ncol =} \DecValTok{2}\NormalTok{) }\OperatorTok{+}
\StringTok{  }\KeywordTok{my_theme}\NormalTok{() }\OperatorTok{+}
\StringTok{  }\KeywordTok{scale_shape_manual}\NormalTok{(}\DataTypeTok{values =} \KeywordTok{c}\NormalTok{(}\DecValTok{15}\NormalTok{, }\DecValTok{16}\NormalTok{, }\DecValTok{17}\NormalTok{)) }\OperatorTok{+}
\StringTok{  }\KeywordTok{scale_color_brewer}\NormalTok{(}\DataTypeTok{palette=}\StringTok{"Set1"}\NormalTok{, }\DataTypeTok{na.value =} \StringTok{"grey50"}\NormalTok{) }\OperatorTok{+}
\StringTok{  }\KeywordTok{scale_fill_brewer}\NormalTok{(}\DataTypeTok{palette=}\StringTok{"Set1"}\NormalTok{) }\OperatorTok{+}
\StringTok{  }\KeywordTok{labs}\NormalTok{(}
    \DataTypeTok{color =} \StringTok{"Outcome"}\NormalTok{,}
    \DataTypeTok{shape =} \StringTok{"Gender"}\NormalTok{,}
    \DataTypeTok{x =} \StringTok{"Date in 2013"}\NormalTok{,}
    \DataTypeTok{y =} \StringTok{"Age"}\NormalTok{,}
    \DataTypeTok{title =} \StringTok{"2013 Influenza A H7N9 cases in China"}\NormalTok{,}
    \DataTypeTok{subtitle =} \StringTok{"Dataset from 'outbreaks' package (Kucharski et al. 2014)"}\NormalTok{,}
    \DataTypeTok{caption =} \StringTok{"}\CharTok{\textbackslash{}n}\StringTok{Time from onset of flu to outcome."}
\NormalTok{  )}
\CommentTok{#> Warning: Removed 149 rows containing missing values (geom_point).}
\CommentTok{#> Warning: Removed 122 rows containing missing values (geom_path).}
\end{Highlighting}
\end{Shaded}

\begin{center}\includegraphics[width=0.7\linewidth]{comparison_330-classification_flu_outcome-multi-sglander_files/figure-latex/unnamed-chunk-8-1} \end{center}

This plot shows that there are many missing values in the dates, so it is hard to draw a general conclusion.

\hypertarget{features}{%
\section{Features}\label{features}}

In Machine Learning-speak features are the variables used for model training. Using the right features dramatically influences the accuracy of the model.

Because we don't have many features, I am keeping age as it is, but I am also generating new features:

\begin{itemize}
\item
  from the date information I am calculating the days between onset and outcome and between onset and hospitalisation
\item
  I am converting gender into numeric values with 1 for female and 0 for male
\item
  similarly, I am converting provinces to binary classifiers (yes == 1, no == 0) for Shanghai, Zhejiang, Jiangsu and other provinces
\item
  the same binary classification is given for whether a case was hospitalised, and whether they had an early onset or early outcome (earlier than the median date)
\end{itemize}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# convert gender, provinces to discrete and numeric values}
\KeywordTok{library}\NormalTok{(dplyr)}
\CommentTok{#> }
\CommentTok{#> Attaching package: 'dplyr'}
\CommentTok{#> The following object is masked from 'package:gridExtra':}
\CommentTok{#> }
\CommentTok{#>     combine}
\CommentTok{#> The following objects are masked from 'package:plyr':}
\CommentTok{#> }
\CommentTok{#>     arrange, count, desc, failwith, id, mutate, rename, summarise, summarize}
\CommentTok{#> The following objects are masked from 'package:stats':}
\CommentTok{#> }
\CommentTok{#>     filter, lag}
\CommentTok{#> The following objects are masked from 'package:base':}
\CommentTok{#> }
\CommentTok{#>     intersect, setdiff, setequal, union}

\NormalTok{dataset <-}\StringTok{ }\NormalTok{fluH7N9_china_}\DecValTok{2013} \OperatorTok{%>%}
\StringTok{  }\KeywordTok{mutate}\NormalTok{(}\DataTypeTok{hospital =} \KeywordTok{as.factor}\NormalTok{(}\KeywordTok{ifelse}\NormalTok{(}\KeywordTok{is.na}\NormalTok{(date_of_hospitalisation), }\DecValTok{0}\NormalTok{, }\DecValTok{1}\NormalTok{)),}
         \DataTypeTok{gender_f =} \KeywordTok{as.factor}\NormalTok{(}\KeywordTok{ifelse}\NormalTok{(gender }\OperatorTok{==}\StringTok{ "f"}\NormalTok{, }\DecValTok{1}\NormalTok{, }\DecValTok{0}\NormalTok{)),}
         \DataTypeTok{province_Jiangsu =} \KeywordTok{as.factor}\NormalTok{(}\KeywordTok{ifelse}\NormalTok{(province }\OperatorTok{==}\StringTok{ "Jiangsu"}\NormalTok{, }\DecValTok{1}\NormalTok{, }\DecValTok{0}\NormalTok{)),}
         \DataTypeTok{province_Shanghai =} \KeywordTok{as.factor}\NormalTok{(}\KeywordTok{ifelse}\NormalTok{(province }\OperatorTok{==}\StringTok{ "Shanghai"}\NormalTok{, }\DecValTok{1}\NormalTok{, }\DecValTok{0}\NormalTok{)),}
         \DataTypeTok{province_Zhejiang =} \KeywordTok{as.factor}\NormalTok{(}\KeywordTok{ifelse}\NormalTok{(province }\OperatorTok{==}\StringTok{ "Zhejiang"}\NormalTok{, }\DecValTok{1}\NormalTok{, }\DecValTok{0}\NormalTok{)),}
         \DataTypeTok{province_other =} \KeywordTok{as.factor}\NormalTok{(}\KeywordTok{ifelse}\NormalTok{(province }\OperatorTok{==}\StringTok{ "Zhejiang"} \OperatorTok{|}\StringTok{ }
\StringTok{                                             }\NormalTok{province }\OperatorTok{==}\StringTok{ "Jiangsu"} \OperatorTok{|}\StringTok{ }
\StringTok{                                             }\NormalTok{province }\OperatorTok{==}\StringTok{ "Shanghai"}\NormalTok{, }\DecValTok{0}\NormalTok{, }\DecValTok{1}\NormalTok{)),}
         \DataTypeTok{days_onset_to_outcome =} \KeywordTok{as.numeric}\NormalTok{(}\KeywordTok{as.character}\NormalTok{(}\KeywordTok{gsub}\NormalTok{(}\StringTok{" days"}\NormalTok{, }\StringTok{""}\NormalTok{,}
                \KeywordTok{as.Date}\NormalTok{(}\KeywordTok{as.character}\NormalTok{(date_of_outcome), }\DataTypeTok{format =} \StringTok{"%Y-%m-%d"}\NormalTok{) }\OperatorTok{-}\StringTok{ }
\StringTok{                }\KeywordTok{as.Date}\NormalTok{(}\KeywordTok{as.character}\NormalTok{(date_of_onset), }\DataTypeTok{format =} \StringTok{"%Y-%m-%d"}\NormalTok{)))),}
         
         \DataTypeTok{days_onset_to_hospital =} \KeywordTok{as.numeric}\NormalTok{(}\KeywordTok{as.character}\NormalTok{(}\KeywordTok{gsub}\NormalTok{(}\StringTok{" days"}\NormalTok{, }\StringTok{""}\NormalTok{,}
            \KeywordTok{as.Date}\NormalTok{(}\KeywordTok{as.character}\NormalTok{(date_of_hospitalisation), }\DataTypeTok{format =} \StringTok{"%Y-%m-%d"}\NormalTok{) }\OperatorTok{-}\StringTok{ }
\StringTok{            }\KeywordTok{as.Date}\NormalTok{(}\KeywordTok{as.character}\NormalTok{(date_of_onset), }\DataTypeTok{format =} \StringTok{"%Y-%m-%d"}\NormalTok{)))),}
         \DataTypeTok{age =} \KeywordTok{as.numeric}\NormalTok{(}\KeywordTok{as.character}\NormalTok{(age)),}
         \DataTypeTok{early_onset =} \KeywordTok{as.factor}\NormalTok{(}\KeywordTok{ifelse}\NormalTok{(date_of_onset }\OperatorTok{<}\StringTok{ }
\StringTok{                        }\KeywordTok{summary}\NormalTok{(date_of_onset)[[}\DecValTok{3}\NormalTok{]], }\DecValTok{1}\NormalTok{, }\DecValTok{0}\NormalTok{)),}
         \DataTypeTok{early_outcome =} \KeywordTok{as.factor}\NormalTok{(}\KeywordTok{ifelse}\NormalTok{(date_of_outcome }\OperatorTok{<}\StringTok{ }
\StringTok{                        }\KeywordTok{summary}\NormalTok{(date_of_outcome)[[}\DecValTok{3}\NormalTok{]], }\DecValTok{1}\NormalTok{, }\DecValTok{0}\NormalTok{))) }\OperatorTok{%>%}
\StringTok{  }\KeywordTok{subset}\NormalTok{(}\DataTypeTok{select =} \OperatorTok{-}\KeywordTok{c}\NormalTok{(}\DecValTok{2}\OperatorTok{:}\DecValTok{4}\NormalTok{, }\DecValTok{6}\NormalTok{, }\DecValTok{8}\NormalTok{))}
  \CommentTok{# print}

\KeywordTok{rownames}\NormalTok{(dataset) <-}\StringTok{ }\NormalTok{dataset}\OperatorTok{$}\NormalTok{case_ID}
\NormalTok{dataset <-}\StringTok{ }\NormalTok{dataset[, }\OperatorTok{-}\KeywordTok{c}\NormalTok{(}\DecValTok{1}\NormalTok{,}\DecValTok{4}\NormalTok{)]}
\KeywordTok{head}\NormalTok{(dataset)}
\CommentTok{#>        outcome age hospital gender_f province_Jiangsu province_Shanghai province_Zhejiang province_other days_onset_to_outcome days_onset_to_hospital early_onset early_outcome}
\CommentTok{#> case_1   Death  87        0        0                0                 1                 0              0                    13                     NA           1             1}
\CommentTok{#> case_2   Death  27        1        0                0                 1                 0              0                    11                      4           1             1}
\CommentTok{#> case_3   Death  35        1        1                0                 0                 0              1                    31                     10           1             1}
\CommentTok{#> case_4    <NA>  45        1        1                1                 0                 0              0                    NA                      8           1          <NA>}
\CommentTok{#> case_5 Recover  48        1        1                1                 0                 0              0                    57                     11           1             0}
\CommentTok{#> case_6   Death  32        1        1                1                 0                 0              0                    36                      7           1             1}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{summary}\NormalTok{(dataset}\OperatorTok{$}\NormalTok{outcome)}
\CommentTok{#>   Death Recover    NA's }
\CommentTok{#>      32      47      57}
\end{Highlighting}
\end{Shaded}

\hypertarget{imputing-missing-values}{%
\subsection{Imputing missing values}\label{imputing-missing-values}}

\url{https://www.r-bloggers.com/imputing-missing-data-with-r-mice-package/}

When looking at the dataset I created for modeling, it is obvious that we have quite a few missing values.

The missing values from the outcome column are what I want to predict but for the rest I would either have to remove the entire row from the data or impute the missing information. I decided to try the latter with the \texttt{mice} package.

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{library}\NormalTok{(mice)}
\CommentTok{#> Loading required package: lattice}
\CommentTok{#> }
\CommentTok{#> Attaching package: 'mice'}
\CommentTok{#> The following object is masked from 'package:tidyr':}
\CommentTok{#> }
\CommentTok{#>     complete}
\CommentTok{#> The following objects are masked from 'package:base':}
\CommentTok{#> }
\CommentTok{#>     cbind, rbind}

\NormalTok{dataset_impute  <-}\StringTok{ }\KeywordTok{mice}\NormalTok{(dataset[, }\DecValTok{-1}\NormalTok{],  }\DataTypeTok{print =} \OtherTok{FALSE}\NormalTok{)  }\CommentTok{# remove outcome}
\CommentTok{#> Warning: Number of logged events: 150}
\NormalTok{impute_complete <-}\StringTok{ }\NormalTok{mice}\OperatorTok{::}\KeywordTok{complete}\NormalTok{(dataset_impute, }\DecValTok{1}\NormalTok{) }\CommentTok{# return 1st imputed dataset}
\KeywordTok{rownames}\NormalTok{(impute_complete) <-}\StringTok{ }\KeywordTok{row.names}\NormalTok{(dataset)}
\NormalTok{impute_complete}
\CommentTok{#>          age hospital gender_f province_Jiangsu province_Shanghai province_Zhejiang province_other days_onset_to_outcome days_onset_to_hospital early_onset early_outcome}
\CommentTok{#> case_1    87        0        0                0                 1                 0              0                    13                      6           1             1}
\CommentTok{#> case_2    27        1        0                0                 1                 0              0                    11                      4           1             1}
\CommentTok{#> case_3    35        1        1                0                 0                 0              1                    31                     10           1             1}
\CommentTok{#> case_4    45        1        1                1                 0                 0              0                    14                      8           1             1}
\CommentTok{#> case_5    48        1        1                1                 0                 0              0                    57                     11           1             0}
\CommentTok{#> case_6    32        1        1                1                 0                 0              0                    36                      7           1             1}
\CommentTok{#> case_7    83        1        0                1                 0                 0              0                    20                      9           1             1}
\CommentTok{#> case_8    38        1        0                0                 0                 1              0                    20                     11           1             1}
\CommentTok{#> case_9    67        1        0                0                 0                 1              0                     7                      0           1             1}
\CommentTok{#> case_10   48        1        0                0                 1                 0              0                     6                      4           1             1}
\CommentTok{#> case_11   64        1        0                0                 0                 1              0                     6                      2           1             1}
\CommentTok{#> case_12   52        0        1                0                 1                 0              0                     7                      7           1             1}
\CommentTok{#> case_13   67        1        1                0                 1                 0              0                    12                      3           1             1}
\CommentTok{#> case_14    4        0        0                0                 1                 0              0                    10                      5           1             1}
\CommentTok{#> case_15   61        0        1                1                 0                 0              0                    32                      4           1             0}
\CommentTok{#> case_16   79        0        0                1                 0                 0              0                    38                      4           1             0}
\CommentTok{#> case_17   74        1        0                0                 1                 0              0                    14                      6           1             1}
\CommentTok{#> case_18   66        1        0                0                 1                 0              0                    20                      4           1             1}
\CommentTok{#> case_19   59        1        0                0                 1                 0              0                    67                      5           1             0}
\CommentTok{#> case_20   55        1        0                0                 0                 0              1                    22                      4           1             1}
\CommentTok{#> case_21   67        1        0                0                 1                 0              0                    23                      1           1             1}
\CommentTok{#> case_22   85        1        0                1                 0                 0              0                    31                      4           1             0}
\CommentTok{#> case_23   25        1        1                1                 0                 0              0                    46                      0           1             0}
\CommentTok{#> case_24   64        0        0                0                 1                 0              0                     6                      5           1             1}
\CommentTok{#> case_25   62        1        0                0                 1                 0              0                    35                      0           1             0}
\CommentTok{#> case_26   77        1        0                0                 1                 0              0                    11                      4           1             1}
\CommentTok{#> case_27   51        1        1                0                 0                 1              0                    37                     27           1             1}
\CommentTok{#> case_28   79        0        0                0                 0                 1              0                    32                      0           1             0}
\CommentTok{#> case_29   76        1        1                0                 1                 0              0                    32                      4           1             0}
\CommentTok{#> case_30   81        0        1                0                 1                 0              0                    23                      0           1             0}
\CommentTok{#> case_31   70        0        0                1                 0                 0              0                    32                      4           1             0}
\CommentTok{#> case_32   74        0        0                1                 0                 0              0                    38                      4           1             0}
\CommentTok{#> case_33   65        0        0                0                 0                 1              0                    24                      8           1             0}
\CommentTok{#> case_34   74        1        0                0                 1                 0              0                    11                      5           1             1}
\CommentTok{#> case_35   83        1        1                0                 1                 0              0                    38                      5           1             0}
\CommentTok{#> case_36   68        0        0                0                 1                 0              0                    17                      4           1             1}
\CommentTok{#> case_37   31        0        0                1                 0                 0              0                    45                      7           1             0}
\CommentTok{#> case_38   56        0        0                1                 0                 0              0                    23                      7           1             0}
\CommentTok{#> case_39   66        1        0                0                 0                 1              0                    13                      0           0             1}
\CommentTok{#> case_40   74        1        0                0                 0                 1              0                     6                      5           1             1}
\CommentTok{#> case_41   54        1        1                0                 0                 1              0                    23                      6           1             1}
\CommentTok{#> case_42   53        1        0                0                 1                 0              0                    11                      7           1             1}
\CommentTok{#> case_43   86        1        0                0                 1                 0              0                    18                      3           1             1}
\CommentTok{#> case_44    7        1        1                0                 0                 0              1                     6                      0           0             1}
\CommentTok{#> case_45   56        1        0                0                 1                 0              0                    86                      3           1             0}
\CommentTok{#> case_46   77        0        1                1                 0                 0              0                     9                      0           1             1}
\CommentTok{#> case_47   72        0        0                1                 0                 0              0                    32                      5           1             0}
\CommentTok{#> case_48   65        1        0                0                 0                 1              0                    20                      6           1             1}
\CommentTok{#> case_49   38        1        0                0                 0                 1              0                    28                      5           1             0}
\CommentTok{#> case_50   34        1        0                0                 0                 0              1                    17                      3           1             0}
\CommentTok{#> case_51   65        1        0                0                 0                 0              1                    15                      2           0             1}
\CommentTok{#> case_52   64        0        1                0                 0                 1              0                    17                      7           1             1}
\CommentTok{#> case_53   62        0        1                0                 0                 1              0                    22                      7           1             1}
\CommentTok{#> case_54   75        0        0                0                 0                 1              0                    37                      7           1             0}
\CommentTok{#> case_55   79        0        0                0                 0                 1              0                    18                      7           0             0}
\CommentTok{#> case_56   73        1        0                0                 1                 0              0                    11                      6           1             1}
\CommentTok{#> case_57   54        1        0                0                 1                 0              0                    13                      4           0             1}
\CommentTok{#> case_58   78        1        0                0                 1                 0              0                    31                      4           1             0}
\CommentTok{#> case_59   50        0        0                1                 0                 0              0                    37                      7           1             0}
\CommentTok{#> case_60   26        0        0                1                 0                 0              0                    18                      4           0             1}
\CommentTok{#> case_61   60        0        0                1                 0                 0              0                    10                      4           1             1}
\CommentTok{#> case_62   68        0        1                0                 0                 1              0                    11                      5           1             1}
\CommentTok{#> case_63   60        0        0                0                 0                 0              1                    26                      3           0             0}
\CommentTok{#> case_64   56        0        0                1                 0                 0              0                    16                      4           0             0}
\CommentTok{#> case_65   21        0        1                1                 0                 0              0                    37                      4           1             0}
\CommentTok{#> case_66   72        0        0                1                 0                 0              0                    32                      3           0             0}
\CommentTok{#> case_67   56        0        0                0                 0                 1              0                    31                      3           0             0}
\CommentTok{#> case_68   57        0        0                0                 0                 1              0                     6                     10           0             1}
\CommentTok{#> case_69   62        0        0                0                 0                 1              0                     8                      7           0             1}
\CommentTok{#> case_70   58        0        1                0                 0                 1              0                    10                     11           0             1}
\CommentTok{#> case_71   72        0        1                0                 0                 1              0                    13                      6           0             0}
\CommentTok{#> case_72   47        1        0                0                 1                 0              0                    17                      5           0             0}
\CommentTok{#> case_73   69        0        0                0                 1                 0              0                     7                      4           0             1}
\CommentTok{#> case_74   54        0        0                0                 1                 0              0                    17                      6           1             0}
\CommentTok{#> case_75   83        0        0                0                 1                 0              0                     6                      4           1             1}
\CommentTok{#> case_76   55        0        0                0                 1                 0              0                     6                      7           1             1}
\CommentTok{#> case_77    2        0        0                0                 1                 0              0                    13                      7           1             0}
\CommentTok{#> case_78   89        1        0                0                 1                 0              0                    17                      4           0             0}
\CommentTok{#> case_79   37        0        1                0                 0                 1              0                    16                      0           0             0}
\CommentTok{#> case_80   74        0        0                0                 0                 1              0                    22                      3           0             0}
\CommentTok{#> case_81   86        0        0                0                 0                 1              0                    10                      6           0             1}
\CommentTok{#> case_82   41        0        0                0                 0                 1              0                     8                     10           0             1}
\CommentTok{#> case_83   38        0        0                0                 0                 0              1                    23                      4           0             0}
\CommentTok{#> case_84   26        0        1                1                 0                 0              0                    13                      1           1             1}
\CommentTok{#> case_85   80        1        1                0                 1                 0              0                    13                      7           0             1}
\CommentTok{#> case_86   54        0        1                0                 0                 1              0                    10                      3           0             1}
\CommentTok{#> case_87   69        0        0                0                 0                 1              0                     8                      3           0             1}
\CommentTok{#> case_88    4        0        0                0                 0                 0              1                    11                      0           0             0}
\CommentTok{#> case_89   54        1        0                1                 0                 0              0                    36                      6           0             0}
\CommentTok{#> case_90   43        1        0                0                 0                 1              0                     9                      3           0             1}
\CommentTok{#> case_91   48        1        0                0                 0                 1              0                    16                      6           0             0}
\CommentTok{#> case_92   66        1        1                0                 0                 1              0                    13                      7           0             1}
\CommentTok{#> case_93   56        0        0                0                 0                 1              0                    17                      0           0             0}
\CommentTok{#> case_94   35        0        1                0                 0                 1              0                    13                      6           0             0}
\CommentTok{#> case_95   37        0        0                0                 0                 1              0                     7                      4           1             1}
\CommentTok{#> case_96   43        0        0                1                 0                 0              0                    37                      4           1             0}
\CommentTok{#> case_97   75        1        1                0                 1                 0              0                    22                      5           0             0}
\CommentTok{#> case_98   76        0        0                0                 0                 1              0                    13                      3           0             1}
\CommentTok{#> case_99   68        0        1                0                 0                 1              0                     6                      7           0             1}
\CommentTok{#> case_100  58        0        0                0                 0                 1              0                    20                      7           0             0}
\CommentTok{#> case_101  79        0        1                0                 0                 1              0                    13                      3           0             1}
\CommentTok{#> case_102  81        0        0                0                 0                 1              0                    32                      6           0             0}
\CommentTok{#> case_103  68        1        0                1                 0                 0              0                    37                      6           0             0}
\CommentTok{#> case_104  54        0        1                0                 0                 1              0                    20                      7           0             0}
\CommentTok{#> case_105  32        0        0                0                 0                 1              0                    22                      6           0             0}
\CommentTok{#> case_106  36        1        0                0                 0                 0              1                    30                      6           0             0}
\CommentTok{#> case_107  91        0        0                0                 0                 0              1                    21                     10           0             0}
\CommentTok{#> case_108  84        0        0                0                 0                 1              0                    13                      3           0             0}
\CommentTok{#> case_109  62        0        0                0                 0                 1              0                     6                      0           0             1}
\CommentTok{#> case_110  53        1        0                0                 0                 0              1                     9                      4           0             0}
\CommentTok{#> case_111  56        0        0                0                 0                 0              1                    22                      5           0             0}
\CommentTok{#> case_112  69        0        0                0                 0                 0              1                    10                      1           0             0}
\CommentTok{#> case_113  60        0        1                0                 0                 1              0                    13                      3           0             0}
\CommentTok{#> case_114  50        0        1                0                 0                 1              0                    10                      6           0             1}
\CommentTok{#> case_115  38        0        0                0                 0                 1              0                    16                      5           0             0}
\CommentTok{#> case_116  65        1        0                0                 0                 0              1                    21                      5           0             0}
\CommentTok{#> case_117  76        0        1                0                 0                 0              1                    28                      5           0             0}
\CommentTok{#> case_118  49        0        0                1                 0                 0              0                    18                      5           0             1}
\CommentTok{#> case_119  36        0        0                1                 0                 0              0                    26                      4           0             0}
\CommentTok{#> case_120  60        0        0                1                 0                 0              0                    31                      7           1             0}
\CommentTok{#> case_121  64        1        1                0                 0                 0              1                    30                      5           0             0}
\CommentTok{#> case_122  38        0        0                0                 0                 1              0                     2                      3           0             1}
\CommentTok{#> case_123  54        1        0                0                 0                 0              1                    16                      7           0             0}
\CommentTok{#> case_124  80        0        0                0                 0                 0              1                    17                      7           0             0}
\CommentTok{#> case_125  31        0        1                0                 0                 0              1                    20                      0           0             0}
\CommentTok{#> case_126  80        1        0                0                 0                 0              1                    24                     10           0             0}
\CommentTok{#> case_127   4        0        0                0                 0                 0              1                     9                      4           0             0}
\CommentTok{#> case_128  58        1        0                0                 0                 0              1                    22                      7           0             0}
\CommentTok{#> case_129  69        1        0                0                 0                 0              1                    28                      4           0             0}
\CommentTok{#> case_130  69        1        0                0                 0                 0              1                    30                      1           0             0}
\CommentTok{#> case_131   9        1        0                0                 0                 0              1                    11                      1           0             0}
\CommentTok{#> case_132  79        1        1                0                 0                 0              1                    18                      0           0             1}
\CommentTok{#> case_133   6        1        0                0                 0                 0              1                     2                      0           0             0}
\CommentTok{#> case_134  15        1        0                1                 0                 0              0                     7                      1           0             0}
\CommentTok{#> case_135  61        1        1                0                 0                 0              1                    32                      3           0             0}
\CommentTok{#> case_136  51        1        1                0                 0                 0              1                     8                      1           0             1}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{dataset_complete <-}\StringTok{ }\KeywordTok{merge}\NormalTok{(dataset[, }\DecValTok{1}\NormalTok{, }\DataTypeTok{drop =} \OtherTok{FALSE}\NormalTok{], }
                          \CommentTok{# mice::complete(dataset_impute, 1), }
\NormalTok{                          impute_complete,}
                          \DataTypeTok{by =} \StringTok{"row.names"}\NormalTok{, }\DataTypeTok{all =} \OtherTok{TRUE}\NormalTok{)}
\KeywordTok{rownames}\NormalTok{(dataset_complete) <-}\StringTok{ }\NormalTok{dataset_complete}\OperatorTok{$}\NormalTok{Row.names}
\NormalTok{dataset_complete <-}\StringTok{ }\NormalTok{dataset_complete[, }\DecValTok{-1}\NormalTok{]}
\NormalTok{dataset_complete}
\CommentTok{#>          outcome age hospital gender_f province_Jiangsu province_Shanghai province_Zhejiang province_other days_onset_to_outcome days_onset_to_hospital early_onset early_outcome}
\CommentTok{#> case_1     Death  87        0        0                0                 1                 0              0                    13                      6           1             1}
\CommentTok{#> case_10    Death  48        1        0                0                 1                 0              0                     6                      4           1             1}
\CommentTok{#> case_100    <NA>  58        0        0                0                 0                 1              0                    20                      7           0             0}
\CommentTok{#> case_101    <NA>  79        0        1                0                 0                 1              0                    13                      3           0             1}
\CommentTok{#> case_102    <NA>  81        0        0                0                 0                 1              0                    32                      6           0             0}
\CommentTok{#> case_103    <NA>  68        1        0                1                 0                 0              0                    37                      6           0             0}
\CommentTok{#> case_104    <NA>  54        0        1                0                 0                 1              0                    20                      7           0             0}
\CommentTok{#> case_105    <NA>  32        0        0                0                 0                 1              0                    22                      6           0             0}
\CommentTok{#> case_106 Recover  36        1        0                0                 0                 0              1                    30                      6           0             0}
\CommentTok{#> case_107   Death  91        0        0                0                 0                 0              1                    21                     10           0             0}
\CommentTok{#> case_108    <NA>  84        0        0                0                 0                 1              0                    13                      3           0             0}
\CommentTok{#> case_109    <NA>  62        0        0                0                 0                 1              0                     6                      0           0             1}
\CommentTok{#> case_11    Death  64        1        0                0                 0                 1              0                     6                      2           1             1}
\CommentTok{#> case_110    <NA>  53        1        0                0                 0                 0              1                     9                      4           0             0}
\CommentTok{#> case_111   Death  56        0        0                0                 0                 0              1                    22                      5           0             0}
\CommentTok{#> case_112    <NA>  69        0        0                0                 0                 0              1                    10                      1           0             0}
\CommentTok{#> case_113    <NA>  60        0        1                0                 0                 1              0                    13                      3           0             0}
\CommentTok{#> case_114    <NA>  50        0        1                0                 0                 1              0                    10                      6           0             1}
\CommentTok{#> case_115    <NA>  38        0        0                0                 0                 1              0                    16                      5           0             0}
\CommentTok{#> case_116 Recover  65        1        0                0                 0                 0              1                    21                      5           0             0}
\CommentTok{#> case_117 Recover  76        0        1                0                 0                 0              1                    28                      5           0             0}
\CommentTok{#> case_118    <NA>  49        0        0                1                 0                 0              0                    18                      5           0             1}
\CommentTok{#> case_119 Recover  36        0        0                1                 0                 0              0                    26                      4           0             0}
\CommentTok{#> case_12    Death  52        0        1                0                 1                 0              0                     7                      7           1             1}
\CommentTok{#> case_120    <NA>  60        0        0                1                 0                 0              0                    31                      7           1             0}
\CommentTok{#> case_121   Death  64        1        1                0                 0                 0              1                    30                      5           0             0}
\CommentTok{#> case_122    <NA>  38        0        0                0                 0                 1              0                     2                      3           0             1}
\CommentTok{#> case_123   Death  54        1        0                0                 0                 0              1                    16                      7           0             0}
\CommentTok{#> case_124 Recover  80        0        0                0                 0                 0              1                    17                      7           0             0}
\CommentTok{#> case_125 Recover  31        0        1                0                 0                 0              1                    20                      0           0             0}
\CommentTok{#> case_126    <NA>  80        1        0                0                 0                 0              1                    24                     10           0             0}
\CommentTok{#> case_127 Recover   4        0        0                0                 0                 0              1                     9                      4           0             0}
\CommentTok{#> case_128 Recover  58        1        0                0                 0                 0              1                    22                      7           0             0}
\CommentTok{#> case_129 Recover  69        1        0                0                 0                 0              1                    28                      4           0             0}
\CommentTok{#> case_13    Death  67        1        1                0                 1                 0              0                    12                      3           1             1}
\CommentTok{#> case_130    <NA>  69        1        0                0                 0                 0              1                    30                      1           0             0}
\CommentTok{#> case_131 Recover   9        1        0                0                 0                 0              1                    11                      1           0             0}
\CommentTok{#> case_132    <NA>  79        1        1                0                 0                 0              1                    18                      0           0             1}
\CommentTok{#> case_133 Recover   6        1        0                0                 0                 0              1                     2                      0           0             0}
\CommentTok{#> case_134 Recover  15        1        0                1                 0                 0              0                     7                      1           0             0}
\CommentTok{#> case_135   Death  61        1        1                0                 0                 0              1                    32                      3           0             0}
\CommentTok{#> case_136    <NA>  51        1        1                0                 0                 0              1                     8                      1           0             1}
\CommentTok{#> case_14  Recover   4        0        0                0                 1                 0              0                    10                      5           1             1}
\CommentTok{#> case_15     <NA>  61        0        1                1                 0                 0              0                    32                      4           1             0}
\CommentTok{#> case_16     <NA>  79        0        0                1                 0                 0              0                    38                      4           1             0}
\CommentTok{#> case_17    Death  74        1        0                0                 1                 0              0                    14                      6           1             1}
\CommentTok{#> case_18  Recover  66        1        0                0                 1                 0              0                    20                      4           1             1}
\CommentTok{#> case_19    Death  59        1        0                0                 1                 0              0                    67                      5           1             0}
\CommentTok{#> case_2     Death  27        1        0                0                 1                 0              0                    11                      4           1             1}
\CommentTok{#> case_20  Recover  55        1        0                0                 0                 0              1                    22                      4           1             1}
\CommentTok{#> case_21  Recover  67        1        0                0                 1                 0              0                    23                      1           1             1}
\CommentTok{#> case_22     <NA>  85        1        0                1                 0                 0              0                    31                      4           1             0}
\CommentTok{#> case_23  Recover  25        1        1                1                 0                 0              0                    46                      0           1             0}
\CommentTok{#> case_24    Death  64        0        0                0                 1                 0              0                     6                      5           1             1}
\CommentTok{#> case_25  Recover  62        1        0                0                 1                 0              0                    35                      0           1             0}
\CommentTok{#> case_26    Death  77        1        0                0                 1                 0              0                    11                      4           1             1}
\CommentTok{#> case_27  Recover  51        1        1                0                 0                 1              0                    37                     27           1             1}
\CommentTok{#> case_28     <NA>  79        0        0                0                 0                 1              0                    32                      0           1             0}
\CommentTok{#> case_29  Recover  76        1        1                0                 1                 0              0                    32                      4           1             0}
\CommentTok{#> case_3     Death  35        1        1                0                 0                 0              1                    31                     10           1             1}
\CommentTok{#> case_30  Recover  81        0        1                0                 1                 0              0                    23                      0           1             0}
\CommentTok{#> case_31     <NA>  70        0        0                1                 0                 0              0                    32                      4           1             0}
\CommentTok{#> case_32     <NA>  74        0        0                1                 0                 0              0                    38                      4           1             0}
\CommentTok{#> case_33  Recover  65        0        0                0                 0                 1              0                    24                      8           1             0}
\CommentTok{#> case_34    Death  74        1        0                0                 1                 0              0                    11                      5           1             1}
\CommentTok{#> case_35    Death  83        1        1                0                 1                 0              0                    38                      5           1             0}
\CommentTok{#> case_36  Recover  68        0        0                0                 1                 0              0                    17                      4           1             1}
\CommentTok{#> case_37  Recover  31        0        0                1                 0                 0              0                    45                      7           1             0}
\CommentTok{#> case_38     <NA>  56        0        0                1                 0                 0              0                    23                      7           1             0}
\CommentTok{#> case_39     <NA>  66        1        0                0                 0                 1              0                    13                      0           0             1}
\CommentTok{#> case_4      <NA>  45        1        1                1                 0                 0              0                    14                      8           1             1}
\CommentTok{#> case_40     <NA>  74        1        0                0                 0                 1              0                     6                      5           1             1}
\CommentTok{#> case_41     <NA>  54        1        1                0                 0                 1              0                    23                      6           1             1}
\CommentTok{#> case_42     <NA>  53        1        0                0                 1                 0              0                    11                      7           1             1}
\CommentTok{#> case_43    Death  86        1        0                0                 1                 0              0                    18                      3           1             1}
\CommentTok{#> case_44  Recover   7        1        1                0                 0                 0              1                     6                      0           0             1}
\CommentTok{#> case_45    Death  56        1        0                0                 1                 0              0                    86                      3           1             0}
\CommentTok{#> case_46    Death  77        0        1                1                 0                 0              0                     9                      0           1             1}
\CommentTok{#> case_47     <NA>  72        0        0                1                 0                 0              0                    32                      5           1             0}
\CommentTok{#> case_48     <NA>  65        1        0                0                 0                 1              0                    20                      6           1             1}
\CommentTok{#> case_49  Recover  38        1        0                0                 0                 1              0                    28                      5           1             0}
\CommentTok{#> case_5   Recover  48        1        1                1                 0                 0              0                    57                     11           1             0}
\CommentTok{#> case_50  Recover  34        1        0                0                 0                 0              1                    17                      3           1             0}
\CommentTok{#> case_51  Recover  65        1        0                0                 0                 0              1                    15                      2           0             1}
\CommentTok{#> case_52     <NA>  64        0        1                0                 0                 1              0                    17                      7           1             1}
\CommentTok{#> case_53    Death  62        0        1                0                 0                 1              0                    22                      7           1             1}
\CommentTok{#> case_54     <NA>  75        0        0                0                 0                 1              0                    37                      7           1             0}
\CommentTok{#> case_55  Recover  79        0        0                0                 0                 1              0                    18                      7           0             0}
\CommentTok{#> case_56     <NA>  73        1        0                0                 1                 0              0                    11                      6           1             1}
\CommentTok{#> case_57  Recover  54        1        0                0                 1                 0              0                    13                      4           0             1}
\CommentTok{#> case_58  Recover  78        1        0                0                 1                 0              0                    31                      4           1             0}
\CommentTok{#> case_59  Recover  50        0        0                1                 0                 0              0                    37                      7           1             0}
\CommentTok{#> case_6     Death  32        1        1                1                 0                 0              0                    36                      7           1             1}
\CommentTok{#> case_60  Recover  26        0        0                1                 0                 0              0                    18                      4           0             1}
\CommentTok{#> case_61    Death  60        0        0                1                 0                 0              0                    10                      4           1             1}
\CommentTok{#> case_62     <NA>  68        0        1                0                 0                 1              0                    11                      5           1             1}
\CommentTok{#> case_63     <NA>  60        0        0                0                 0                 0              1                    26                      3           0             0}
\CommentTok{#> case_64  Recover  56        0        0                1                 0                 0              0                    16                      4           0             0}
\CommentTok{#> case_65  Recover  21        0        1                1                 0                 0              0                    37                      4           1             0}
\CommentTok{#> case_66     <NA>  72        0        0                1                 0                 0              0                    32                      3           0             0}
\CommentTok{#> case_67     <NA>  56        0        0                0                 0                 1              0                    31                      3           0             0}
\CommentTok{#> case_68     <NA>  57        0        0                0                 0                 1              0                     6                     10           0             1}
\CommentTok{#> case_69     <NA>  62        0        0                0                 0                 1              0                     8                      7           0             1}
\CommentTok{#> case_7     Death  83        1        0                1                 0                 0              0                    20                      9           1             1}
\CommentTok{#> case_70     <NA>  58        0        1                0                 0                 1              0                    10                     11           0             1}
\CommentTok{#> case_71     <NA>  72        0        1                0                 0                 1              0                    13                      6           0             0}
\CommentTok{#> case_72  Recover  47        1        0                0                 1                 0              0                    17                      5           0             0}
\CommentTok{#> case_73  Recover  69        0        0                0                 1                 0              0                     7                      4           0             1}
\CommentTok{#> case_74  Recover  54        0        0                0                 1                 0              0                    17                      6           1             0}
\CommentTok{#> case_75    Death  83        0        0                0                 1                 0              0                     6                      4           1             1}
\CommentTok{#> case_76    Death  55        0        0                0                 1                 0              0                     6                      7           1             1}
\CommentTok{#> case_77  Recover   2        0        0                0                 1                 0              0                    13                      7           1             0}
\CommentTok{#> case_78    Death  89        1        0                0                 1                 0              0                    17                      4           0             0}
\CommentTok{#> case_79  Recover  37        0        1                0                 0                 1              0                    16                      0           0             0}
\CommentTok{#> case_8     Death  38        1        0                0                 0                 1              0                    20                     11           1             1}
\CommentTok{#> case_80     <NA>  74        0        0                0                 0                 1              0                    22                      3           0             0}
\CommentTok{#> case_81    Death  86        0        0                0                 0                 1              0                    10                      6           0             1}
\CommentTok{#> case_82  Recover  41        0        0                0                 0                 1              0                     8                     10           0             1}
\CommentTok{#> case_83  Recover  38        0        0                0                 0                 0              1                    23                      4           0             0}
\CommentTok{#> case_84     <NA>  26        0        1                1                 0                 0              0                    13                      1           1             1}
\CommentTok{#> case_85     <NA>  80        1        1                0                 1                 0              0                    13                      7           0             1}
\CommentTok{#> case_86     <NA>  54        0        1                0                 0                 1              0                    10                      3           0             1}
\CommentTok{#> case_87    Death  69        0        0                0                 0                 1              0                     8                      3           0             1}
\CommentTok{#> case_88     <NA>   4        0        0                0                 0                 0              1                    11                      0           0             0}
\CommentTok{#> case_89  Recover  54        1        0                1                 0                 0              0                    36                      6           0             0}
\CommentTok{#> case_9      <NA>  67        1        0                0                 0                 1              0                     7                      0           1             1}
\CommentTok{#> case_90     <NA>  43        1        0                0                 0                 1              0                     9                      3           0             1}
\CommentTok{#> case_91  Recover  48        1        0                0                 0                 1              0                    16                      6           0             0}
\CommentTok{#> case_92     <NA>  66        1        1                0                 0                 1              0                    13                      7           0             1}
\CommentTok{#> case_93     <NA>  56        0        0                0                 0                 1              0                    17                      0           0             0}
\CommentTok{#> case_94  Recover  35        0        1                0                 0                 1              0                    13                      6           0             0}
\CommentTok{#> case_95     <NA>  37        0        0                0                 0                 1              0                     7                      4           1             1}
\CommentTok{#> case_96     <NA>  43        0        0                1                 0                 0              0                    37                      4           1             0}
\CommentTok{#> case_97  Recover  75        1        1                0                 1                 0              0                    22                      5           0             0}
\CommentTok{#> case_98    Death  76        0        0                0                 0                 1              0                    13                      3           0             1}
\CommentTok{#> case_99     <NA>  68        0        1                0                 0                 1              0                     6                      7           0             1}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{cat}\NormalTok{(}\StringTok{"NAs before imput: "}\NormalTok{, }\KeywordTok{sum}\NormalTok{(}\KeywordTok{is.na}\NormalTok{(dataset)), }\StringTok{"}\CharTok{\textbackslash{}n}\StringTok{"}\NormalTok{)}
\CommentTok{#> NAs before imput:  277}
\KeywordTok{summary}\NormalTok{(dataset}\OperatorTok{$}\NormalTok{outcome)}
\CommentTok{#>   Death Recover    NA's }
\CommentTok{#>      32      47      57}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{cat}\NormalTok{(}\StringTok{"NAs after imput: "}\NormalTok{, }\KeywordTok{sum}\NormalTok{(}\KeywordTok{is.na}\NormalTok{(dataset_complete)), }\StringTok{"}\CharTok{\textbackslash{}n}\StringTok{"}\NormalTok{)}
\CommentTok{#> NAs after imput:  57}
\KeywordTok{summary}\NormalTok{(dataset_complete}\OperatorTok{$}\NormalTok{outcome)}
\CommentTok{#>   Death Recover    NA's }
\CommentTok{#>      32      47      57}
\end{Highlighting}
\end{Shaded}

\hypertarget{test-train-and-validation-data-sets}{%
\section{Test, train and validation data sets}\label{test-train-and-validation-data-sets}}

For building the model, I am separating the imputed data frame into training and test data. Test data are the 57 cases with unknown outcome.

The training data will be further devided for validation of the models: 70\% of the training data will be kept for model building and the remaining 30\% will be used for model testing.

I am using the caret package for modeling.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{train_index <-}\StringTok{ }\KeywordTok{which}\NormalTok{(}\KeywordTok{is.na}\NormalTok{(dataset_complete}\OperatorTok{$}\NormalTok{outcome))}
\NormalTok{train_data <-}\StringTok{ }\NormalTok{dataset_complete[}\OperatorTok{-}\NormalTok{train_index, ]     }\CommentTok{# 79x12}
\NormalTok{test_data  <-}\StringTok{ }\NormalTok{dataset_complete[train_index, }\DecValTok{-1}\NormalTok{]    }\CommentTok{# 57x11}

\KeywordTok{library}\NormalTok{(caret)}
\KeywordTok{set.seed}\NormalTok{(}\DecValTok{27}\NormalTok{)}
\NormalTok{val_index <-}\StringTok{ }\KeywordTok{createDataPartition}\NormalTok{(train_data}\OperatorTok{$}\NormalTok{outcome, }\DataTypeTok{p =} \FloatTok{0.7}\NormalTok{, }\DataTypeTok{list=}\OtherTok{FALSE}\NormalTok{)}
\NormalTok{val_train_data <-}\StringTok{ }\NormalTok{train_data[val_index, ]}
\NormalTok{val_test_data  <-}\StringTok{ }\NormalTok{train_data[}\OperatorTok{-}\NormalTok{val_index, ]}
\NormalTok{val_train_X <-}\StringTok{ }\NormalTok{val_train_data[,}\OperatorTok{-}\DecValTok{1}\NormalTok{]}
\NormalTok{val_test_X <-}\StringTok{ }\NormalTok{val_test_data[,}\OperatorTok{-}\DecValTok{1}\NormalTok{]}
\end{Highlighting}
\end{Shaded}

\hypertarget{decision-trees}{%
\subsection{Decision trees}\label{decision-trees}}

To get an idea about how each feature contributes to the prediction of the outcome, I first built a decision tree based on the training data using \texttt{rpart} and \texttt{rattle}.

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{library}\NormalTok{(rpart)}
\KeywordTok{library}\NormalTok{(rattle)}
\CommentTok{#> Rattle: A free graphical interface for data science with R.}
\CommentTok{#> Version 5.2.0 Copyright (c) 2006-2018 Togaware Pty Ltd.}
\CommentTok{#> Type 'rattle()' to shake, rattle, and roll your data.}
\KeywordTok{library}\NormalTok{(rpart.plot)}
\KeywordTok{library}\NormalTok{(RColorBrewer)}

\KeywordTok{set.seed}\NormalTok{(}\DecValTok{27}\NormalTok{)}
\NormalTok{fit <-}\StringTok{ }\KeywordTok{rpart}\NormalTok{(outcome }\OperatorTok{~}\StringTok{ }\NormalTok{., }\DataTypeTok{data =}\NormalTok{ train_data, }\DataTypeTok{method =} \StringTok{"class"}\NormalTok{, }
             \DataTypeTok{control =} \KeywordTok{rpart.control}\NormalTok{(}\DataTypeTok{xval =} \DecValTok{10}\NormalTok{, }\DataTypeTok{minbucket =} \DecValTok{2}\NormalTok{, }\DataTypeTok{cp =} \DecValTok{0}\NormalTok{), }
             \DataTypeTok{parms =} \KeywordTok{list}\NormalTok{(}\DataTypeTok{split =} \StringTok{"information"}\NormalTok{))}

\KeywordTok{fancyRpartPlot}\NormalTok{(fit)}
\end{Highlighting}
\end{Shaded}

\begin{center}\includegraphics[width=0.7\linewidth]{comparison_330-classification_flu_outcome-multi-sglander_files/figure-latex/model-rpart-run-1} \end{center}

This randomly generated decision tree shows that cases with an early outcome were most likely to die when they were 68 or older, when they also had an early onset and when they were sick for fewer than 13 days. If a person was not among the first cases and was younger than 52, they had a good chance of recovering, but if they were 82 or older, they were more likely to die from the flu.

\hypertarget{feature-importance}{%
\subsection{Feature Importance}\label{feature-importance}}

Not all of the features I created will be equally important to the model. The decision tree already gave me an idea of which features might be most important but I also want to estimate feature importance using a Random Forest approach with repeated cross validation.

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# prepare training scheme}
\NormalTok{control <-}\StringTok{ }\KeywordTok{trainControl}\NormalTok{(}\DataTypeTok{method =} \StringTok{"repeatedcv"}\NormalTok{, }\DataTypeTok{number =} \DecValTok{10}\NormalTok{, }\DataTypeTok{repeats =} \DecValTok{10}\NormalTok{)}

\CommentTok{# train the model}
\KeywordTok{set.seed}\NormalTok{(}\DecValTok{27}\NormalTok{)}
\NormalTok{model <-}\StringTok{ }\KeywordTok{train}\NormalTok{(outcome }\OperatorTok{~}\StringTok{ }\NormalTok{., }\DataTypeTok{data =}\NormalTok{ train_data, }\DataTypeTok{method =} \StringTok{"rf"}\NormalTok{, }
               \DataTypeTok{preProcess =} \OtherTok{NULL}\NormalTok{, }\DataTypeTok{trControl =}\NormalTok{ control)}

\CommentTok{# estimate variable importance}
\NormalTok{importance <-}\StringTok{ }\KeywordTok{varImp}\NormalTok{(model, }\DataTypeTok{scale=}\OtherTok{TRUE}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{from <-}\StringTok{ }\KeywordTok{c}\NormalTok{(}\StringTok{"age"}\NormalTok{, }\StringTok{"hospital1"}\NormalTok{, }\StringTok{"gender_f1"}\NormalTok{, }\StringTok{"province_Jiangsu1"}\NormalTok{, }
          \StringTok{"province_Shanghai1"}\NormalTok{, }\StringTok{"province_Zhejiang1"}\NormalTok{, }\StringTok{"province_other1"}\NormalTok{, }
          \StringTok{"days_onset_to_outcome"}\NormalTok{, }\StringTok{"days_onset_to_hospital"}\NormalTok{, }\StringTok{"early_onset1"}\NormalTok{, }
          \StringTok{"early_outcome1"}\NormalTok{ )}

\NormalTok{to <-}\StringTok{ }\KeywordTok{c}\NormalTok{(}\StringTok{"Age"}\NormalTok{, }\StringTok{"Hospital"}\NormalTok{, }\StringTok{"Female"}\NormalTok{, }\StringTok{"Jiangsu"}\NormalTok{, }\StringTok{"Shanghai"}\NormalTok{, }\StringTok{"Zhejiang"}\NormalTok{,}
        \StringTok{"Other province"}\NormalTok{, }\StringTok{"Days onset to outcome"}\NormalTok{, }\StringTok{"Days onset to hospital"}\NormalTok{, }
        \StringTok{"Early onset"}\NormalTok{, }\StringTok{"Early outcome"}\NormalTok{ )}

\NormalTok{importance_df_}\DecValTok{1}\NormalTok{ <-}\StringTok{ }\NormalTok{importance}\OperatorTok{$}\NormalTok{importance}
\NormalTok{importance_df_}\DecValTok{1}\OperatorTok{$}\NormalTok{group <-}\StringTok{ }\KeywordTok{rownames}\NormalTok{(importance_df_}\DecValTok{1}\NormalTok{)}

\NormalTok{importance_df_}\DecValTok{1}\OperatorTok{$}\NormalTok{group <-}\StringTok{ }\KeywordTok{mapvalues}\NormalTok{(importance_df_}\DecValTok{1}\OperatorTok{$}\NormalTok{group, }
                                           \DataTypeTok{from =}\NormalTok{ from, }
                                           \DataTypeTok{to =}\NormalTok{ to)}
\NormalTok{f =}\StringTok{ }\NormalTok{importance_df_}\DecValTok{1}\NormalTok{[}\KeywordTok{order}\NormalTok{(importance_df_}\DecValTok{1}\OperatorTok{$}\NormalTok{Overall, }\DataTypeTok{decreasing =} \OtherTok{FALSE}\NormalTok{), }\StringTok{"group"}\NormalTok{]}

\NormalTok{importance_df_}\DecValTok{2}\NormalTok{ <-}\StringTok{ }\NormalTok{importance_df_}\DecValTok{1}
\NormalTok{importance_df_}\DecValTok{2}\OperatorTok{$}\NormalTok{Overall <-}\StringTok{ }\DecValTok{0}

\NormalTok{importance_df <-}\StringTok{ }\KeywordTok{rbind}\NormalTok{(importance_df_}\DecValTok{1}\NormalTok{, importance_df_}\DecValTok{2}\NormalTok{)}

\CommentTok{# setting factor levels}
\NormalTok{importance_df <-}\StringTok{ }\KeywordTok{within}\NormalTok{(importance_df, group <-}\StringTok{ }\KeywordTok{factor}\NormalTok{(group, }\DataTypeTok{levels =}\NormalTok{ f))}
\NormalTok{importance_df_}\DecValTok{1}\NormalTok{ <-}\StringTok{ }\KeywordTok{within}\NormalTok{(importance_df_}\DecValTok{1}\NormalTok{, group <-}\StringTok{ }\KeywordTok{factor}\NormalTok{(group, }\DataTypeTok{levels =}\NormalTok{ f))}

\KeywordTok{ggplot}\NormalTok{() }\OperatorTok{+}
\StringTok{  }\KeywordTok{geom_point}\NormalTok{(}\DataTypeTok{data =}\NormalTok{ importance_df_}\DecValTok{1}\NormalTok{, }\KeywordTok{aes}\NormalTok{(}\DataTypeTok{x =}\NormalTok{ Overall, }\DataTypeTok{y =}\NormalTok{ group, }
                                         \DataTypeTok{color =}\NormalTok{ group), }\DataTypeTok{size =} \DecValTok{2}\NormalTok{) }\OperatorTok{+}
\StringTok{  }\KeywordTok{geom_path}\NormalTok{(}\DataTypeTok{data =}\NormalTok{ importance_df, }\KeywordTok{aes}\NormalTok{(}\DataTypeTok{x =}\NormalTok{ Overall, }\DataTypeTok{y =}\NormalTok{ group, }\DataTypeTok{color =}\NormalTok{ group, }
                                      \DataTypeTok{group =}\NormalTok{ group), }\DataTypeTok{size =} \DecValTok{1}\NormalTok{) }\OperatorTok{+}
\StringTok{  }\KeywordTok{scale_color_manual}\NormalTok{(}\DataTypeTok{values =} \KeywordTok{rep}\NormalTok{(}\KeywordTok{brewer.pal}\NormalTok{(}\DecValTok{1}\NormalTok{, }\StringTok{"Set1"}\NormalTok{)[}\DecValTok{1}\NormalTok{], }\DecValTok{11}\NormalTok{)) }\OperatorTok{+}
\StringTok{  }\KeywordTok{my_theme}\NormalTok{() }\OperatorTok{+}
\StringTok{  }\KeywordTok{theme}\NormalTok{(}\DataTypeTok{legend.position =} \StringTok{"none"}\NormalTok{,}
        \DataTypeTok{axis.text.x =} \KeywordTok{element_text}\NormalTok{(}\DataTypeTok{angle =} \DecValTok{0}\NormalTok{, }\DataTypeTok{vjust =} \FloatTok{0.5}\NormalTok{, }\DataTypeTok{hjust =} \FloatTok{0.5}\NormalTok{)) }\OperatorTok{+}
\StringTok{  }\KeywordTok{labs}\NormalTok{(}
    \DataTypeTok{x =} \StringTok{"Importance"}\NormalTok{,}
    \DataTypeTok{y =} \StringTok{""}\NormalTok{,}
    \DataTypeTok{title =} \StringTok{"2013 Influenza A H7N9 cases in China"}\NormalTok{,}
    \DataTypeTok{subtitle =} \StringTok{"Scaled feature importance"}\NormalTok{,}
    \DataTypeTok{caption =} \StringTok{"}\CharTok{\textbackslash{}n}\StringTok{Determined with Random Forest and}
\StringTok{    repeated cross validation (10 repeats, 10 times)"}
\NormalTok{  )}
\CommentTok{#> Warning in brewer.pal(1, "Set1"): minimal value for n is 3, returning requested palette with 3 different levels}
\end{Highlighting}
\end{Shaded}

\begin{center}\includegraphics[width=0.7\linewidth]{comparison_330-classification_flu_outcome-multi-sglander_files/figure-latex/plot-var-importance-1} \end{center}

This tells me that age is the most important determining factor for predicting disease outcome, followed by days between onset an outcome, early outcome and days between onset and hospitalisation.

\hypertarget{feature-plot}{%
\subsection{Feature Plot}\label{feature-plot}}

Before I start actually building models, I want to check whether the distribution of feature values is comparable between training, validation and test datasets.

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# tidy dataframe of 11 variables for plotting features for all datasets}
\CommentTok{# dataset_complete: 136x12. test + val_train + val_test}
\NormalTok{dataset_complete_gather <-}\StringTok{ }\NormalTok{dataset_complete }\OperatorTok{%>%}
\StringTok{  }\KeywordTok{mutate}\NormalTok{(}\DataTypeTok{set =} \KeywordTok{ifelse}\NormalTok{(}\KeywordTok{rownames}\NormalTok{(dataset_complete) }\OperatorTok{%in%}\StringTok{ }\KeywordTok{rownames}\NormalTok{(test_data), }
                      \StringTok{"Test Data"}\NormalTok{, }
               \KeywordTok{ifelse}\NormalTok{(}\KeywordTok{rownames}\NormalTok{(dataset_complete) }\OperatorTok{%in%}\StringTok{ }\KeywordTok{rownames}\NormalTok{(val_train_data), }
                      \StringTok{"Validation Train Data"}\NormalTok{,}
               \KeywordTok{ifelse}\NormalTok{(}\KeywordTok{rownames}\NormalTok{(dataset_complete) }\OperatorTok{%in%}\StringTok{ }\KeywordTok{rownames}\NormalTok{(val_test_data), }
                      \StringTok{"Validation Test Data"}\NormalTok{, }\StringTok{"NA"}\NormalTok{))),}
         \DataTypeTok{case_ID =} \KeywordTok{rownames}\NormalTok{(.)) }\OperatorTok{%>%}
\StringTok{  }\KeywordTok{gather}\NormalTok{(group, value, age}\OperatorTok{:}\NormalTok{early_outcome)}
\CommentTok{#> Warning: attributes are not identical across measure variables;}
\CommentTok{#> they will be dropped}

\CommentTok{# map values in group to more readable}
\NormalTok{from <-}\StringTok{ }\KeywordTok{c}\NormalTok{(}\StringTok{"age"}\NormalTok{, }\StringTok{"hospital"}\NormalTok{, }\StringTok{"gender_f"}\NormalTok{, }\StringTok{"province_Jiangsu"}\NormalTok{, }\StringTok{"province_Shanghai"}\NormalTok{, }
          \StringTok{"province_Zhejiang"}\NormalTok{, }\StringTok{"province_other"}\NormalTok{, }\StringTok{"days_onset_to_outcome"}\NormalTok{, }
          \StringTok{"days_onset_to_hospital"}\NormalTok{, }\StringTok{"early_onset"}\NormalTok{,  }\StringTok{"early_outcome"}\NormalTok{ )}
\NormalTok{to <-}\StringTok{ }\KeywordTok{c}\NormalTok{(}\StringTok{"Age"}\NormalTok{, }\StringTok{"Hospital"}\NormalTok{, }\StringTok{"Female"}\NormalTok{, }\StringTok{"Jiangsu"}\NormalTok{, }\StringTok{"Shanghai"}\NormalTok{, }\StringTok{"Zhejiang"}\NormalTok{, }
        \StringTok{"Other province"}\NormalTok{, }\StringTok{"Days onset to outcome"}\NormalTok{, }\StringTok{"Days onset to hospital"}\NormalTok{, }
        \StringTok{"Early onset"}\NormalTok{, }\StringTok{"Early outcome"}\NormalTok{ )}
\NormalTok{dataset_complete_gather}\OperatorTok{$}\NormalTok{group <-}\StringTok{ }\KeywordTok{mapvalues}\NormalTok{(dataset_complete_gather}\OperatorTok{$}\NormalTok{group, }
                      \DataTypeTok{from =}\NormalTok{ from, }
                      \DataTypeTok{to =}\NormalTok{ to)}
\end{Highlighting}
\end{Shaded}

\hypertarget{plot-distribution-of-features-in-each-dataset}{%
\subsection{Plot distribution of features in each dataset}\label{plot-distribution-of-features-in-each-dataset}}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# plot features all datasets}
\KeywordTok{ggplot}\NormalTok{(}\DataTypeTok{data =}\NormalTok{ dataset_complete_gather, }
       \KeywordTok{aes}\NormalTok{(}\DataTypeTok{x =} \KeywordTok{as.numeric}\NormalTok{(value), }\DataTypeTok{fill =}\NormalTok{ outcome, }\DataTypeTok{color =}\NormalTok{ outcome)) }\OperatorTok{+}
\StringTok{  }\KeywordTok{geom_density}\NormalTok{(}\DataTypeTok{alpha =} \FloatTok{0.2}\NormalTok{) }\OperatorTok{+}
\StringTok{  }\KeywordTok{geom_rug}\NormalTok{() }\OperatorTok{+}
\StringTok{  }\KeywordTok{scale_color_brewer}\NormalTok{(}\DataTypeTok{palette=}\StringTok{"Set1"}\NormalTok{, }\DataTypeTok{na.value =} \StringTok{"grey50"}\NormalTok{) }\OperatorTok{+}
\StringTok{  }\KeywordTok{scale_fill_brewer}\NormalTok{(}\DataTypeTok{palette=}\StringTok{"Set1"}\NormalTok{, }\DataTypeTok{na.value =} \StringTok{"grey50"}\NormalTok{) }\OperatorTok{+}
\StringTok{  }\KeywordTok{my_theme}\NormalTok{() }\OperatorTok{+}
\StringTok{  }\KeywordTok{facet_wrap}\NormalTok{(set }\OperatorTok{~}\StringTok{ }\NormalTok{group, }\DataTypeTok{ncol =} \DecValTok{11}\NormalTok{, }\DataTypeTok{scales =} \StringTok{"free"}\NormalTok{) }\OperatorTok{+}
\StringTok{  }\KeywordTok{labs}\NormalTok{(}
    \DataTypeTok{x =} \StringTok{"Value"}\NormalTok{,}
    \DataTypeTok{y =} \StringTok{"Density"}\NormalTok{,}
    \DataTypeTok{title =} \StringTok{"2013 Influenza A H7N9 cases in China"}\NormalTok{,}
    \DataTypeTok{subtitle =} \StringTok{"Features for classifying outcome"}\NormalTok{,}
    \DataTypeTok{caption =} \StringTok{"}\CharTok{\textbackslash{}n}\StringTok{Density distribution of all features used for }
\StringTok{    classification of flu outcome."}
\NormalTok{  )}
\end{Highlighting}
\end{Shaded}

\begin{center}\includegraphics[width=0.7\linewidth]{comparison_330-classification_flu_outcome-multi-sglander_files/figure-latex/plot-datasets-distribution-1} \end{center}

\hypertarget{plot-3-features-vs-outcome-all-datasets}{%
\subsection{Plot 3 features vs outcome, all datasets}\label{plot-3-features-vs-outcome-all-datasets}}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# plot three groups vs outcome}
\KeywordTok{ggplot}\NormalTok{(}\KeywordTok{subset}\NormalTok{(dataset_complete_gather, }
\NormalTok{              group }\OperatorTok{==}\StringTok{ "Age"} \OperatorTok{|}\StringTok{ }
\StringTok{              }\NormalTok{group }\OperatorTok{==}\StringTok{ "Days onset to hospital"} \OperatorTok{|}\StringTok{ }
\StringTok{              }\NormalTok{group }\OperatorTok{==}\StringTok{ "Days onset to outcome"}\NormalTok{), }
       \KeywordTok{aes}\NormalTok{(}\DataTypeTok{x=}\NormalTok{outcome, }\DataTypeTok{y=}\KeywordTok{as.numeric}\NormalTok{(value), }\DataTypeTok{fill=}\NormalTok{set)) }\OperatorTok{+}\StringTok{ }
\StringTok{  }\KeywordTok{geom_boxplot}\NormalTok{() }\OperatorTok{+}
\StringTok{  }\KeywordTok{my_theme}\NormalTok{() }\OperatorTok{+}
\StringTok{  }\KeywordTok{scale_fill_brewer}\NormalTok{(}\DataTypeTok{palette=}\StringTok{"Set1"}\NormalTok{, }\DataTypeTok{type =} \StringTok{"div "}\NormalTok{) }\OperatorTok{+}
\StringTok{  }\KeywordTok{facet_wrap}\NormalTok{( }\OperatorTok{~}\StringTok{ }\NormalTok{group, }\DataTypeTok{ncol =} \DecValTok{3}\NormalTok{, }\DataTypeTok{scales =} \StringTok{"free"}\NormalTok{) }\OperatorTok{+}
\StringTok{  }\KeywordTok{labs}\NormalTok{(}
    \DataTypeTok{fill =} \StringTok{""}\NormalTok{,}
    \DataTypeTok{x =} \StringTok{"Outcome"}\NormalTok{,}
    \DataTypeTok{y =} \StringTok{"Value"}\NormalTok{,}
    \DataTypeTok{title =} \StringTok{"2013 Influenza A H7N9 cases in China"}\NormalTok{,}
    \DataTypeTok{subtitle =} \StringTok{"Features for classifying outcome"}\NormalTok{,}
    \DataTypeTok{caption =} \StringTok{"}\CharTok{\textbackslash{}n}\StringTok{Boxplot of the features age, days from onset to }
\StringTok{    hospitalisation and days from onset to outcome."}
\NormalTok{  )}
\end{Highlighting}
\end{Shaded}

\begin{center}\includegraphics[width=0.7\linewidth]{comparison_330-classification_flu_outcome-multi-sglander_files/figure-latex/unnamed-chunk-16-1} \end{center}

Luckily, the distributions looks reasonably similar between the validation and test data, except for a few outliers.

\hypertarget{comparing-machine-learning-algorithms}{%
\section{Comparing Machine Learning algorithms}\label{comparing-machine-learning-algorithms}}

Before I try to predict the outcome of the unknown cases, I am testing the models' accuracy with the validation datasets on a couple of algorithms. I have chosen only a few more well known algorithms, but \texttt{caret} implements many more.

I have chosen to not do any preprocessing because I was worried that the different data distributions with continuous variables (e.g.~age) and binary variables (i.e.~0, 1 classification of e.g.~hospitalisation) would lead to problems.

\begin{itemize}
\tightlist
\item
  Random Forest
\item
  GLM net
\item
  k-Nearest Neighbors
\item
  Penalized Discriminant Analysis
\item
  Stabilized Linear Discriminant Analysis
\item
  Nearest Shrunken Centroids
\item
  Single C5.0 Tree
\item
  Partial Least Squares
\end{itemize}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{train_control <-}\StringTok{ }\KeywordTok{trainControl}\NormalTok{(}\DataTypeTok{method =} \StringTok{"repeatedcv"}\NormalTok{, }
                              \DataTypeTok{number =} \DecValTok{10}\NormalTok{, }
                              \DataTypeTok{repeats =} \DecValTok{10}\NormalTok{, }
                              \DataTypeTok{verboseIter =} \OtherTok{FALSE}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\hypertarget{random-forest-1}{%
\subsection{Random Forest}\label{random-forest-1}}

Random Forests predictions are based on the generation of multiple classification trees.

This model classified 14 out of 23 cases correctly.

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{set.seed}\NormalTok{(}\DecValTok{27}\NormalTok{)}
\NormalTok{model_rf <-}\StringTok{ }\NormalTok{caret}\OperatorTok{::}\KeywordTok{train}\NormalTok{(outcome }\OperatorTok{~}\StringTok{ }\NormalTok{.,}
                             \DataTypeTok{data =}\NormalTok{ val_train_data,}
                             \DataTypeTok{method =} \StringTok{"rf"}\NormalTok{,}
                             \DataTypeTok{preProcess =} \OtherTok{NULL}\NormalTok{,}
                             \DataTypeTok{trControl =}\NormalTok{ train_control)}
\NormalTok{model_rf}
\CommentTok{#> Random Forest }
\CommentTok{#> }
\CommentTok{#> 56 samples}
\CommentTok{#> 11 predictors}
\CommentTok{#>  2 classes: 'Death', 'Recover' }
\CommentTok{#> }
\CommentTok{#> No pre-processing}
\CommentTok{#> Resampling: Cross-Validated (10 fold, repeated 10 times) }
\CommentTok{#> Summary of sample sizes: 51, 49, 50, 51, 49, 51, ... }
\CommentTok{#> Resampling results across tuning parameters:}
\CommentTok{#> }
\CommentTok{#>   mtry  Accuracy  Kappa}
\CommentTok{#>    2    0.687     0.340}
\CommentTok{#>    6    0.732     0.432}
\CommentTok{#>   11    0.726     0.423}
\CommentTok{#> }
\CommentTok{#> Accuracy was used to select the optimal model using the largest value.}
\CommentTok{#> The final value used for the model was mtry = 6.}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{confusionMatrix}\NormalTok{(}\KeywordTok{predict}\NormalTok{(model_rf, val_test_data[, }\DecValTok{-1}\NormalTok{]), val_test_data}\OperatorTok{$}\NormalTok{outcome)}
\CommentTok{#> Confusion Matrix and Statistics}
\CommentTok{#> }
\CommentTok{#>           Reference}
\CommentTok{#> Prediction Death Recover}
\CommentTok{#>    Death       3       0}
\CommentTok{#>    Recover     6      14}
\CommentTok{#>                                         }
\CommentTok{#>                Accuracy : 0.739         }
\CommentTok{#>                  95% CI : (0.516, 0.898)}
\CommentTok{#>     No Information Rate : 0.609         }
\CommentTok{#>     P-Value [Acc > NIR] : 0.1421        }
\CommentTok{#>                                         }
\CommentTok{#>                   Kappa : 0.378         }
\CommentTok{#>                                         }
\CommentTok{#>  Mcnemar's Test P-Value : 0.0412        }
\CommentTok{#>                                         }
\CommentTok{#>             Sensitivity : 0.333         }
\CommentTok{#>             Specificity : 1.000         }
\CommentTok{#>          Pos Pred Value : 1.000         }
\CommentTok{#>          Neg Pred Value : 0.700         }
\CommentTok{#>              Prevalence : 0.391         }
\CommentTok{#>          Detection Rate : 0.130         }
\CommentTok{#>    Detection Prevalence : 0.130         }
\CommentTok{#>       Balanced Accuracy : 0.667         }
\CommentTok{#>                                         }
\CommentTok{#>        'Positive' Class : Death         }
\CommentTok{#> }
\end{Highlighting}
\end{Shaded}

\hypertarget{glm-net}{%
\subsection{GLM net}\label{glm-net}}

Lasso or elastic net regularization for generalized linear model regression are based on linear regression models and is useful when we have feature correlation in our model.

This model classified 13 out of 23 cases correctly.

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{set.seed}\NormalTok{(}\DecValTok{27}\NormalTok{)}
\NormalTok{model_glmnet <-}\StringTok{ }\NormalTok{caret}\OperatorTok{::}\KeywordTok{train}\NormalTok{(outcome }\OperatorTok{~}\StringTok{ }\NormalTok{.,}
                             \DataTypeTok{data =}\NormalTok{ val_train_data,}
                             \DataTypeTok{method =} \StringTok{"glmnet"}\NormalTok{,}
                             \DataTypeTok{preProcess =} \OtherTok{NULL}\NormalTok{,}
                             \DataTypeTok{trControl =}\NormalTok{ train_control)}
\NormalTok{model_glmnet}
\CommentTok{#> glmnet }
\CommentTok{#> }
\CommentTok{#> 56 samples}
\CommentTok{#> 11 predictors}
\CommentTok{#>  2 classes: 'Death', 'Recover' }
\CommentTok{#> }
\CommentTok{#> No pre-processing}
\CommentTok{#> Resampling: Cross-Validated (10 fold, repeated 10 times) }
\CommentTok{#> Summary of sample sizes: 51, 49, 50, 51, 49, 51, ... }
\CommentTok{#> Resampling results across tuning parameters:}
\CommentTok{#> }
\CommentTok{#>   alpha  lambda    Accuracy  Kappa}
\CommentTok{#>   0.10   0.000491  0.671     0.324}
\CommentTok{#>   0.10   0.004909  0.669     0.318}
\CommentTok{#>   0.10   0.049093  0.680     0.339}
\CommentTok{#>   0.55   0.000491  0.671     0.324}
\CommentTok{#>   0.55   0.004909  0.671     0.322}
\CommentTok{#>   0.55   0.049093  0.695     0.365}
\CommentTok{#>   1.00   0.000491  0.671     0.324}
\CommentTok{#>   1.00   0.004909  0.672     0.326}
\CommentTok{#>   1.00   0.049093  0.714     0.414}
\CommentTok{#> }
\CommentTok{#> Accuracy was used to select the optimal model using the largest value.}
\CommentTok{#> The final values used for the model were alpha = 1 and lambda = 0.0491.}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{confusionMatrix}\NormalTok{(}\KeywordTok{predict}\NormalTok{(model_glmnet, val_test_data[, }\DecValTok{-1}\NormalTok{]), val_test_data}\OperatorTok{$}\NormalTok{outcome)}
\CommentTok{#> Confusion Matrix and Statistics}
\CommentTok{#> }
\CommentTok{#>           Reference}
\CommentTok{#> Prediction Death Recover}
\CommentTok{#>    Death       3       2}
\CommentTok{#>    Recover     6      12}
\CommentTok{#>                                         }
\CommentTok{#>                Accuracy : 0.652         }
\CommentTok{#>                  95% CI : (0.427, 0.836)}
\CommentTok{#>     No Information Rate : 0.609         }
\CommentTok{#>     P-Value [Acc > NIR] : 0.422         }
\CommentTok{#>                                         }
\CommentTok{#>                   Kappa : 0.207         }
\CommentTok{#>                                         }
\CommentTok{#>  Mcnemar's Test P-Value : 0.289         }
\CommentTok{#>                                         }
\CommentTok{#>             Sensitivity : 0.333         }
\CommentTok{#>             Specificity : 0.857         }
\CommentTok{#>          Pos Pred Value : 0.600         }
\CommentTok{#>          Neg Pred Value : 0.667         }
\CommentTok{#>              Prevalence : 0.391         }
\CommentTok{#>          Detection Rate : 0.130         }
\CommentTok{#>    Detection Prevalence : 0.217         }
\CommentTok{#>       Balanced Accuracy : 0.595         }
\CommentTok{#>                                         }
\CommentTok{#>        'Positive' Class : Death         }
\CommentTok{#> }
\end{Highlighting}
\end{Shaded}

\hypertarget{k-nearest-neighbors}{%
\subsection{k-Nearest Neighbors}\label{k-nearest-neighbors}}

k-nearest neighbors predicts based on point distances with predefined constants.

This model classified 14 out of 23 cases correctly.

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{set.seed}\NormalTok{(}\DecValTok{27}\NormalTok{)}
\NormalTok{model_kknn <-}\StringTok{ }\NormalTok{caret}\OperatorTok{::}\KeywordTok{train}\NormalTok{(outcome }\OperatorTok{~}\StringTok{ }\NormalTok{.,}
                             \DataTypeTok{data =}\NormalTok{ val_train_data,}
                             \DataTypeTok{method =} \StringTok{"kknn"}\NormalTok{,}
                             \DataTypeTok{preProcess =} \OtherTok{NULL}\NormalTok{,}
                             \DataTypeTok{trControl =}\NormalTok{ train_control)}
\NormalTok{model_kknn}
\CommentTok{#> k-Nearest Neighbors }
\CommentTok{#> }
\CommentTok{#> 56 samples}
\CommentTok{#> 11 predictors}
\CommentTok{#>  2 classes: 'Death', 'Recover' }
\CommentTok{#> }
\CommentTok{#> No pre-processing}
\CommentTok{#> Resampling: Cross-Validated (10 fold, repeated 10 times) }
\CommentTok{#> Summary of sample sizes: 51, 49, 50, 51, 49, 51, ... }
\CommentTok{#> Resampling results across tuning parameters:}
\CommentTok{#> }
\CommentTok{#>   kmax  Accuracy  Kappa}
\CommentTok{#>   5     0.666     0.313}
\CommentTok{#>   7     0.653     0.274}
\CommentTok{#>   9     0.648     0.263}
\CommentTok{#> }
\CommentTok{#> Tuning parameter 'distance' was held constant at a value of 2}
\CommentTok{#> Tuning parameter 'kernel' was held constant at a value of optimal}
\CommentTok{#> Accuracy was used to select the optimal model using the largest value.}
\CommentTok{#> The final values used for the model were kmax = 5, distance = 2 and kernel = optimal.}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{confusionMatrix}\NormalTok{(}\KeywordTok{predict}\NormalTok{(model_kknn, val_test_data[, }\DecValTok{-1}\NormalTok{]), val_test_data}\OperatorTok{$}\NormalTok{outcome)}
\CommentTok{#> Confusion Matrix and Statistics}
\CommentTok{#> }
\CommentTok{#>           Reference}
\CommentTok{#> Prediction Death Recover}
\CommentTok{#>    Death       5       3}
\CommentTok{#>    Recover     4      11}
\CommentTok{#>                                         }
\CommentTok{#>                Accuracy : 0.696         }
\CommentTok{#>                  95% CI : (0.471, 0.868)}
\CommentTok{#>     No Information Rate : 0.609         }
\CommentTok{#>     P-Value [Acc > NIR] : 0.264         }
\CommentTok{#>                                         }
\CommentTok{#>                   Kappa : 0.348         }
\CommentTok{#>                                         }
\CommentTok{#>  Mcnemar's Test P-Value : 1.000         }
\CommentTok{#>                                         }
\CommentTok{#>             Sensitivity : 0.556         }
\CommentTok{#>             Specificity : 0.786         }
\CommentTok{#>          Pos Pred Value : 0.625         }
\CommentTok{#>          Neg Pred Value : 0.733         }
\CommentTok{#>              Prevalence : 0.391         }
\CommentTok{#>          Detection Rate : 0.217         }
\CommentTok{#>    Detection Prevalence : 0.348         }
\CommentTok{#>       Balanced Accuracy : 0.671         }
\CommentTok{#>                                         }
\CommentTok{#>        'Positive' Class : Death         }
\CommentTok{#> }
\end{Highlighting}
\end{Shaded}

\hypertarget{penalized-discriminant-analysis}{%
\subsection{Penalized Discriminant Analysis}\label{penalized-discriminant-analysis}}

Penalized Discriminant Analysis is the penalized linear discriminant analysis and is also useful for when we have highly correlated features.

This model classified 14 out of 23 cases correctly.

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{set.seed}\NormalTok{(}\DecValTok{27}\NormalTok{)}
\NormalTok{model_pda <-}\StringTok{ }\NormalTok{caret}\OperatorTok{::}\KeywordTok{train}\NormalTok{(outcome }\OperatorTok{~}\StringTok{ }\NormalTok{.,}
                             \DataTypeTok{data =}\NormalTok{ val_train_data,}
                             \DataTypeTok{method =} \StringTok{"pda"}\NormalTok{,}
                             \DataTypeTok{preProcess =} \OtherTok{NULL}\NormalTok{,}
                             \DataTypeTok{trControl =}\NormalTok{ train_control)}
\CommentTok{#> Warning: predictions failed for Fold01.Rep01: lambda=0e+00 Error in mindist[l] <- ndist[l] : }
\CommentTok{#>   NAs are not allowed in subscripted assignments}
\CommentTok{#> Warning: predictions failed for Fold02.Rep01: lambda=0e+00 Error in mindist[l] <- ndist[l] : }
\CommentTok{#>   NAs are not allowed in subscripted assignments}
\CommentTok{#> Warning: predictions failed for Fold03.Rep01: lambda=0e+00 Error in mindist[l] <- ndist[l] : }
\CommentTok{#>   NAs are not allowed in subscripted assignments}
\CommentTok{#> Warning: predictions failed for Fold04.Rep01: lambda=0e+00 Error in mindist[l] <- ndist[l] : }
\CommentTok{#>   NAs are not allowed in subscripted assignments}
\CommentTok{#> Warning: predictions failed for Fold05.Rep01: lambda=0e+00 Error in mindist[l] <- ndist[l] : }
\CommentTok{#>   NAs are not allowed in subscripted assignments}
\CommentTok{#> Warning: predictions failed for Fold06.Rep01: lambda=0e+00 Error in mindist[l] <- ndist[l] : }
\CommentTok{#>   NAs are not allowed in subscripted assignments}
\CommentTok{#> Warning: predictions failed for Fold07.Rep01: lambda=0e+00 Error in mindist[l] <- ndist[l] : }
\CommentTok{#>   NAs are not allowed in subscripted assignments}
\CommentTok{#> Warning: predictions failed for Fold08.Rep01: lambda=0e+00 Error in mindist[l] <- ndist[l] : }
\CommentTok{#>   NAs are not allowed in subscripted assignments}
\CommentTok{#> Warning: predictions failed for Fold09.Rep01: lambda=0e+00 Error in mindist[l] <- ndist[l] : }
\CommentTok{#>   NAs are not allowed in subscripted assignments}
\CommentTok{#> Warning: predictions failed for Fold10.Rep01: lambda=0e+00 Error in mindist[l] <- ndist[l] : }
\CommentTok{#>   NAs are not allowed in subscripted assignments}
\CommentTok{#> Warning: predictions failed for Fold01.Rep02: lambda=0e+00 Error in mindist[l] <- ndist[l] : }
\CommentTok{#>   NAs are not allowed in subscripted assignments}
\CommentTok{#> Warning: predictions failed for Fold02.Rep02: lambda=0e+00 Error in mindist[l] <- ndist[l] : }
\CommentTok{#>   NAs are not allowed in subscripted assignments}
\CommentTok{#> Warning: predictions failed for Fold03.Rep02: lambda=0e+00 Error in mindist[l] <- ndist[l] : }
\CommentTok{#>   NAs are not allowed in subscripted assignments}
\CommentTok{#> Warning: predictions failed for Fold04.Rep02: lambda=0e+00 Error in mindist[l] <- ndist[l] : }
\CommentTok{#>   NAs are not allowed in subscripted assignments}
\CommentTok{#> Warning: predictions failed for Fold05.Rep02: lambda=0e+00 Error in mindist[l] <- ndist[l] : }
\CommentTok{#>   NAs are not allowed in subscripted assignments}
\CommentTok{#> Warning: predictions failed for Fold06.Rep02: lambda=0e+00 Error in mindist[l] <- ndist[l] : }
\CommentTok{#>   NAs are not allowed in subscripted assignments}
\CommentTok{#> Warning: predictions failed for Fold07.Rep02: lambda=0e+00 Error in mindist[l] <- ndist[l] : }
\CommentTok{#>   NAs are not allowed in subscripted assignments}
\CommentTok{#> Warning: predictions failed for Fold08.Rep02: lambda=0e+00 Error in mindist[l] <- ndist[l] : }
\CommentTok{#>   NAs are not allowed in subscripted assignments}
\CommentTok{#> Warning: predictions failed for Fold09.Rep02: lambda=0e+00 Error in mindist[l] <- ndist[l] : }
\CommentTok{#>   NAs are not allowed in subscripted assignments}
\CommentTok{#> Warning: predictions failed for Fold10.Rep02: lambda=0e+00 Error in mindist[l] <- ndist[l] : }
\CommentTok{#>   NAs are not allowed in subscripted assignments}
\CommentTok{#> Warning: predictions failed for Fold01.Rep03: lambda=0e+00 Error in mindist[l] <- ndist[l] : }
\CommentTok{#>   NAs are not allowed in subscripted assignments}
\CommentTok{#> Warning: predictions failed for Fold02.Rep03: lambda=0e+00 Error in mindist[l] <- ndist[l] : }
\CommentTok{#>   NAs are not allowed in subscripted assignments}
\CommentTok{#> Warning: predictions failed for Fold03.Rep03: lambda=0e+00 Error in mindist[l] <- ndist[l] : }
\CommentTok{#>   NAs are not allowed in subscripted assignments}
\CommentTok{#> Warning: predictions failed for Fold04.Rep03: lambda=0e+00 Error in mindist[l] <- ndist[l] : }
\CommentTok{#>   NAs are not allowed in subscripted assignments}
\CommentTok{#> Warning: predictions failed for Fold05.Rep03: lambda=0e+00 Error in mindist[l] <- ndist[l] : }
\CommentTok{#>   NAs are not allowed in subscripted assignments}
\CommentTok{#> Warning: predictions failed for Fold06.Rep03: lambda=0e+00 Error in mindist[l] <- ndist[l] : }
\CommentTok{#>   NAs are not allowed in subscripted assignments}
\CommentTok{#> Warning: predictions failed for Fold07.Rep03: lambda=0e+00 Error in mindist[l] <- ndist[l] : }
\CommentTok{#>   NAs are not allowed in subscripted assignments}
\CommentTok{#> Warning: predictions failed for Fold08.Rep03: lambda=0e+00 Error in mindist[l] <- ndist[l] : }
\CommentTok{#>   NAs are not allowed in subscripted assignments}
\CommentTok{#> Warning: predictions failed for Fold09.Rep03: lambda=0e+00 Error in mindist[l] <- ndist[l] : }
\CommentTok{#>   NAs are not allowed in subscripted assignments}
\CommentTok{#> Warning: predictions failed for Fold10.Rep03: lambda=0e+00 Error in mindist[l] <- ndist[l] : }
\CommentTok{#>   NAs are not allowed in subscripted assignments}
\CommentTok{#> Warning: predictions failed for Fold01.Rep04: lambda=0e+00 Error in mindist[l] <- ndist[l] : }
\CommentTok{#>   NAs are not allowed in subscripted assignments}
\CommentTok{#> Warning: predictions failed for Fold02.Rep04: lambda=0e+00 Error in mindist[l] <- ndist[l] : }
\CommentTok{#>   NAs are not allowed in subscripted assignments}
\CommentTok{#> Warning: predictions failed for Fold03.Rep04: lambda=0e+00 Error in mindist[l] <- ndist[l] : }
\CommentTok{#>   NAs are not allowed in subscripted assignments}
\CommentTok{#> Warning: predictions failed for Fold04.Rep04: lambda=0e+00 Error in mindist[l] <- ndist[l] : }
\CommentTok{#>   NAs are not allowed in subscripted assignments}
\CommentTok{#> Warning: predictions failed for Fold05.Rep04: lambda=0e+00 Error in mindist[l] <- ndist[l] : }
\CommentTok{#>   NAs are not allowed in subscripted assignments}
\CommentTok{#> Warning: predictions failed for Fold06.Rep04: lambda=0e+00 Error in mindist[l] <- ndist[l] : }
\CommentTok{#>   NAs are not allowed in subscripted assignments}
\CommentTok{#> Warning: predictions failed for Fold07.Rep04: lambda=0e+00 Error in mindist[l] <- ndist[l] : }
\CommentTok{#>   NAs are not allowed in subscripted assignments}
\CommentTok{#> Warning: predictions failed for Fold08.Rep04: lambda=0e+00 Error in mindist[l] <- ndist[l] : }
\CommentTok{#>   NAs are not allowed in subscripted assignments}
\CommentTok{#> Warning: predictions failed for Fold09.Rep04: lambda=0e+00 Error in mindist[l] <- ndist[l] : }
\CommentTok{#>   NAs are not allowed in subscripted assignments}
\CommentTok{#> Warning: predictions failed for Fold10.Rep04: lambda=0e+00 Error in mindist[l] <- ndist[l] : }
\CommentTok{#>   NAs are not allowed in subscripted assignments}
\CommentTok{#> Warning: predictions failed for Fold01.Rep05: lambda=0e+00 Error in mindist[l] <- ndist[l] : }
\CommentTok{#>   NAs are not allowed in subscripted assignments}
\CommentTok{#> Warning: predictions failed for Fold02.Rep05: lambda=0e+00 Error in mindist[l] <- ndist[l] : }
\CommentTok{#>   NAs are not allowed in subscripted assignments}
\CommentTok{#> Warning: predictions failed for Fold03.Rep05: lambda=0e+00 Error in mindist[l] <- ndist[l] : }
\CommentTok{#>   NAs are not allowed in subscripted assignments}
\CommentTok{#> Warning: predictions failed for Fold04.Rep05: lambda=0e+00 Error in mindist[l] <- ndist[l] : }
\CommentTok{#>   NAs are not allowed in subscripted assignments}
\CommentTok{#> Warning: predictions failed for Fold05.Rep05: lambda=0e+00 Error in mindist[l] <- ndist[l] : }
\CommentTok{#>   NAs are not allowed in subscripted assignments}
\CommentTok{#> Warning: predictions failed for Fold06.Rep05: lambda=0e+00 Error in mindist[l] <- ndist[l] : }
\CommentTok{#>   NAs are not allowed in subscripted assignments}
\CommentTok{#> Warning: predictions failed for Fold07.Rep05: lambda=0e+00 Error in mindist[l] <- ndist[l] : }
\CommentTok{#>   NAs are not allowed in subscripted assignments}
\CommentTok{#> Warning: predictions failed for Fold08.Rep05: lambda=0e+00 Error in mindist[l] <- ndist[l] : }
\CommentTok{#>   NAs are not allowed in subscripted assignments}
\CommentTok{#> Warning: predictions failed for Fold09.Rep05: lambda=0e+00 Error in mindist[l] <- ndist[l] : }
\CommentTok{#>   NAs are not allowed in subscripted assignments}
\CommentTok{#> Warning: predictions failed for Fold10.Rep05: lambda=0e+00 Error in mindist[l] <- ndist[l] : }
\CommentTok{#>   NAs are not allowed in subscripted assignments}
\CommentTok{#> Warning: predictions failed for Fold01.Rep06: lambda=0e+00 Error in mindist[l] <- ndist[l] : }
\CommentTok{#>   NAs are not allowed in subscripted assignments}
\CommentTok{#> Warning: predictions failed for Fold02.Rep06: lambda=0e+00 Error in mindist[l] <- ndist[l] : }
\CommentTok{#>   NAs are not allowed in subscripted assignments}
\CommentTok{#> Warning: predictions failed for Fold03.Rep06: lambda=0e+00 Error in mindist[l] <- ndist[l] : }
\CommentTok{#>   NAs are not allowed in subscripted assignments}
\CommentTok{#> Warning: predictions failed for Fold04.Rep06: lambda=0e+00 Error in mindist[l] <- ndist[l] : }
\CommentTok{#>   NAs are not allowed in subscripted assignments}
\CommentTok{#> Warning: predictions failed for Fold05.Rep06: lambda=0e+00 Error in mindist[l] <- ndist[l] : }
\CommentTok{#>   NAs are not allowed in subscripted assignments}
\CommentTok{#> Warning: predictions failed for Fold06.Rep06: lambda=0e+00 Error in mindist[l] <- ndist[l] : }
\CommentTok{#>   NAs are not allowed in subscripted assignments}
\CommentTok{#> Warning: predictions failed for Fold07.Rep06: lambda=0e+00 Error in mindist[l] <- ndist[l] : }
\CommentTok{#>   NAs are not allowed in subscripted assignments}
\CommentTok{#> Warning: predictions failed for Fold08.Rep06: lambda=0e+00 Error in mindist[l] <- ndist[l] : }
\CommentTok{#>   NAs are not allowed in subscripted assignments}
\CommentTok{#> Warning: predictions failed for Fold09.Rep06: lambda=0e+00 Error in mindist[l] <- ndist[l] : }
\CommentTok{#>   NAs are not allowed in subscripted assignments}
\CommentTok{#> Warning: predictions failed for Fold10.Rep06: lambda=0e+00 Error in mindist[l] <- ndist[l] : }
\CommentTok{#>   NAs are not allowed in subscripted assignments}
\CommentTok{#> Warning: predictions failed for Fold01.Rep07: lambda=0e+00 Error in mindist[l] <- ndist[l] : }
\CommentTok{#>   NAs are not allowed in subscripted assignments}
\CommentTok{#> Warning: predictions failed for Fold02.Rep07: lambda=0e+00 Error in mindist[l] <- ndist[l] : }
\CommentTok{#>   NAs are not allowed in subscripted assignments}
\CommentTok{#> Warning: predictions failed for Fold03.Rep07: lambda=0e+00 Error in mindist[l] <- ndist[l] : }
\CommentTok{#>   NAs are not allowed in subscripted assignments}
\CommentTok{#> Warning: predictions failed for Fold04.Rep07: lambda=0e+00 Error in mindist[l] <- ndist[l] : }
\CommentTok{#>   NAs are not allowed in subscripted assignments}
\CommentTok{#> Warning: predictions failed for Fold05.Rep07: lambda=0e+00 Error in mindist[l] <- ndist[l] : }
\CommentTok{#>   NAs are not allowed in subscripted assignments}
\CommentTok{#> Warning: predictions failed for Fold06.Rep07: lambda=0e+00 Error in mindist[l] <- ndist[l] : }
\CommentTok{#>   NAs are not allowed in subscripted assignments}
\CommentTok{#> Warning: predictions failed for Fold07.Rep07: lambda=0e+00 Error in mindist[l] <- ndist[l] : }
\CommentTok{#>   NAs are not allowed in subscripted assignments}
\CommentTok{#> Warning: predictions failed for Fold08.Rep07: lambda=0e+00 Error in mindist[l] <- ndist[l] : }
\CommentTok{#>   NAs are not allowed in subscripted assignments}
\CommentTok{#> Warning: predictions failed for Fold09.Rep07: lambda=0e+00 Error in mindist[l] <- ndist[l] : }
\CommentTok{#>   NAs are not allowed in subscripted assignments}
\CommentTok{#> Warning: predictions failed for Fold10.Rep07: lambda=0e+00 Error in mindist[l] <- ndist[l] : }
\CommentTok{#>   NAs are not allowed in subscripted assignments}
\CommentTok{#> Warning: predictions failed for Fold01.Rep08: lambda=0e+00 Error in mindist[l] <- ndist[l] : }
\CommentTok{#>   NAs are not allowed in subscripted assignments}
\CommentTok{#> Warning: predictions failed for Fold02.Rep08: lambda=0e+00 Error in mindist[l] <- ndist[l] : }
\CommentTok{#>   NAs are not allowed in subscripted assignments}
\CommentTok{#> Warning: predictions failed for Fold03.Rep08: lambda=0e+00 Error in mindist[l] <- ndist[l] : }
\CommentTok{#>   NAs are not allowed in subscripted assignments}
\CommentTok{#> Warning: predictions failed for Fold04.Rep08: lambda=0e+00 Error in mindist[l] <- ndist[l] : }
\CommentTok{#>   NAs are not allowed in subscripted assignments}
\CommentTok{#> Warning: predictions failed for Fold05.Rep08: lambda=0e+00 Error in mindist[l] <- ndist[l] : }
\CommentTok{#>   NAs are not allowed in subscripted assignments}
\CommentTok{#> Warning: predictions failed for Fold06.Rep08: lambda=0e+00 Error in mindist[l] <- ndist[l] : }
\CommentTok{#>   NAs are not allowed in subscripted assignments}
\CommentTok{#> Warning: predictions failed for Fold07.Rep08: lambda=0e+00 Error in mindist[l] <- ndist[l] : }
\CommentTok{#>   NAs are not allowed in subscripted assignments}
\CommentTok{#> Warning: predictions failed for Fold08.Rep08: lambda=0e+00 Error in mindist[l] <- ndist[l] : }
\CommentTok{#>   NAs are not allowed in subscripted assignments}
\CommentTok{#> Warning: predictions failed for Fold09.Rep08: lambda=0e+00 Error in mindist[l] <- ndist[l] : }
\CommentTok{#>   NAs are not allowed in subscripted assignments}
\CommentTok{#> Warning: predictions failed for Fold10.Rep08: lambda=0e+00 Error in mindist[l] <- ndist[l] : }
\CommentTok{#>   NAs are not allowed in subscripted assignments}
\CommentTok{#> Warning: predictions failed for Fold01.Rep09: lambda=0e+00 Error in mindist[l] <- ndist[l] : }
\CommentTok{#>   NAs are not allowed in subscripted assignments}
\CommentTok{#> Warning: predictions failed for Fold02.Rep09: lambda=0e+00 Error in mindist[l] <- ndist[l] : }
\CommentTok{#>   NAs are not allowed in subscripted assignments}
\CommentTok{#> Warning: predictions failed for Fold03.Rep09: lambda=0e+00 Error in mindist[l] <- ndist[l] : }
\CommentTok{#>   NAs are not allowed in subscripted assignments}
\CommentTok{#> Warning: predictions failed for Fold04.Rep09: lambda=0e+00 Error in mindist[l] <- ndist[l] : }
\CommentTok{#>   NAs are not allowed in subscripted assignments}
\CommentTok{#> Warning: predictions failed for Fold05.Rep09: lambda=0e+00 Error in mindist[l] <- ndist[l] : }
\CommentTok{#>   NAs are not allowed in subscripted assignments}
\CommentTok{#> Warning: predictions failed for Fold06.Rep09: lambda=0e+00 Error in mindist[l] <- ndist[l] : }
\CommentTok{#>   NAs are not allowed in subscripted assignments}
\CommentTok{#> Warning: predictions failed for Fold07.Rep09: lambda=0e+00 Error in mindist[l] <- ndist[l] : }
\CommentTok{#>   NAs are not allowed in subscripted assignments}
\CommentTok{#> Warning: predictions failed for Fold08.Rep09: lambda=0e+00 Error in mindist[l] <- ndist[l] : }
\CommentTok{#>   NAs are not allowed in subscripted assignments}
\CommentTok{#> Warning: predictions failed for Fold09.Rep09: lambda=0e+00 Error in mindist[l] <- ndist[l] : }
\CommentTok{#>   NAs are not allowed in subscripted assignments}
\CommentTok{#> Warning: predictions failed for Fold10.Rep09: lambda=0e+00 Error in mindist[l] <- ndist[l] : }
\CommentTok{#>   NAs are not allowed in subscripted assignments}
\CommentTok{#> Warning: predictions failed for Fold01.Rep10: lambda=0e+00 Error in mindist[l] <- ndist[l] : }
\CommentTok{#>   NAs are not allowed in subscripted assignments}
\CommentTok{#> Warning: predictions failed for Fold02.Rep10: lambda=0e+00 Error in mindist[l] <- ndist[l] : }
\CommentTok{#>   NAs are not allowed in subscripted assignments}
\CommentTok{#> Warning: predictions failed for Fold03.Rep10: lambda=0e+00 Error in mindist[l] <- ndist[l] : }
\CommentTok{#>   NAs are not allowed in subscripted assignments}
\CommentTok{#> Warning: predictions failed for Fold04.Rep10: lambda=0e+00 Error in mindist[l] <- ndist[l] : }
\CommentTok{#>   NAs are not allowed in subscripted assignments}
\CommentTok{#> Warning: predictions failed for Fold05.Rep10: lambda=0e+00 Error in mindist[l] <- ndist[l] : }
\CommentTok{#>   NAs are not allowed in subscripted assignments}
\CommentTok{#> Warning: predictions failed for Fold06.Rep10: lambda=0e+00 Error in mindist[l] <- ndist[l] : }
\CommentTok{#>   NAs are not allowed in subscripted assignments}
\CommentTok{#> Warning: predictions failed for Fold07.Rep10: lambda=0e+00 Error in mindist[l] <- ndist[l] : }
\CommentTok{#>   NAs are not allowed in subscripted assignments}
\CommentTok{#> Warning: predictions failed for Fold08.Rep10: lambda=0e+00 Error in mindist[l] <- ndist[l] : }
\CommentTok{#>   NAs are not allowed in subscripted assignments}
\CommentTok{#> Warning: predictions failed for Fold09.Rep10: lambda=0e+00 Error in mindist[l] <- ndist[l] : }
\CommentTok{#>   NAs are not allowed in subscripted assignments}
\CommentTok{#> Warning: predictions failed for Fold10.Rep10: lambda=0e+00 Error in mindist[l] <- ndist[l] : }
\CommentTok{#>   NAs are not allowed in subscripted assignments}
\CommentTok{#> Warning in nominalTrainWorkflow(x = x, y = y, wts = weights, info = trainInfo, : There were missing values in resampled performance measures.}
\CommentTok{#> Warning in train.default(x, y, weights = w, ...): missing values found in aggregated results}
\NormalTok{model_pda}
\CommentTok{#> Penalized Discriminant Analysis }
\CommentTok{#> }
\CommentTok{#> 56 samples}
\CommentTok{#> 11 predictors}
\CommentTok{#>  2 classes: 'Death', 'Recover' }
\CommentTok{#> }
\CommentTok{#> No pre-processing}
\CommentTok{#> Resampling: Cross-Validated (10 fold, repeated 10 times) }
\CommentTok{#> Summary of sample sizes: 51, 49, 50, 51, 49, 51, ... }
\CommentTok{#> Resampling results across tuning parameters:}
\CommentTok{#> }
\CommentTok{#>   lambda  Accuracy  Kappa}
\CommentTok{#>   0e+00     NaN       NaN}
\CommentTok{#>   1e-04   0.681     0.343}
\CommentTok{#>   1e-01   0.681     0.343}
\CommentTok{#> }
\CommentTok{#> Accuracy was used to select the optimal model using the largest value.}
\CommentTok{#> The final value used for the model was lambda = 1e-04.}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{confusionMatrix}\NormalTok{(}\KeywordTok{predict}\NormalTok{(model_pda, val_test_data[, }\DecValTok{-1}\NormalTok{]), val_test_data}\OperatorTok{$}\NormalTok{outcome)}
\CommentTok{#> Confusion Matrix and Statistics}
\CommentTok{#> }
\CommentTok{#>           Reference}
\CommentTok{#> Prediction Death Recover}
\CommentTok{#>    Death       3       2}
\CommentTok{#>    Recover     6      12}
\CommentTok{#>                                         }
\CommentTok{#>                Accuracy : 0.652         }
\CommentTok{#>                  95% CI : (0.427, 0.836)}
\CommentTok{#>     No Information Rate : 0.609         }
\CommentTok{#>     P-Value [Acc > NIR] : 0.422         }
\CommentTok{#>                                         }
\CommentTok{#>                   Kappa : 0.207         }
\CommentTok{#>                                         }
\CommentTok{#>  Mcnemar's Test P-Value : 0.289         }
\CommentTok{#>                                         }
\CommentTok{#>             Sensitivity : 0.333         }
\CommentTok{#>             Specificity : 0.857         }
\CommentTok{#>          Pos Pred Value : 0.600         }
\CommentTok{#>          Neg Pred Value : 0.667         }
\CommentTok{#>              Prevalence : 0.391         }
\CommentTok{#>          Detection Rate : 0.130         }
\CommentTok{#>    Detection Prevalence : 0.217         }
\CommentTok{#>       Balanced Accuracy : 0.595         }
\CommentTok{#>                                         }
\CommentTok{#>        'Positive' Class : Death         }
\CommentTok{#> }
\end{Highlighting}
\end{Shaded}

\hypertarget{stabilized-linear-discriminant-analysis}{%
\subsection{Stabilized Linear Discriminant Analysis}\label{stabilized-linear-discriminant-analysis}}

Stabilized Linear Discriminant Analysis is designed for high-dimensional data and correlated co-variables.

This model classified 15 out of 23 cases correctly.

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{set.seed}\NormalTok{(}\DecValTok{27}\NormalTok{)}
\NormalTok{model_slda <-}\StringTok{ }\NormalTok{caret}\OperatorTok{::}\KeywordTok{train}\NormalTok{(outcome }\OperatorTok{~}\StringTok{ }\NormalTok{.,}
                             \DataTypeTok{data =}\NormalTok{ val_train_data,}
                             \DataTypeTok{method =} \StringTok{"slda"}\NormalTok{,}
                             \DataTypeTok{preProcess =} \OtherTok{NULL}\NormalTok{,}
                             \DataTypeTok{trControl =}\NormalTok{ train_control)}
\NormalTok{model_slda}
\CommentTok{#> Stabilized Linear Discriminant Analysis }
\CommentTok{#> }
\CommentTok{#> 56 samples}
\CommentTok{#> 11 predictors}
\CommentTok{#>  2 classes: 'Death', 'Recover' }
\CommentTok{#> }
\CommentTok{#> No pre-processing}
\CommentTok{#> Resampling: Cross-Validated (10 fold, repeated 10 times) }
\CommentTok{#> Summary of sample sizes: 51, 49, 50, 51, 49, 51, ... }
\CommentTok{#> Resampling results:}
\CommentTok{#> }
\CommentTok{#>   Accuracy  Kappa}
\CommentTok{#>   0.682     0.358}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{confusionMatrix}\NormalTok{(}\KeywordTok{predict}\NormalTok{(model_slda, val_test_data[, }\DecValTok{-1}\NormalTok{]), val_test_data}\OperatorTok{$}\NormalTok{outcome)}
\CommentTok{#> Confusion Matrix and Statistics}
\CommentTok{#> }
\CommentTok{#>           Reference}
\CommentTok{#> Prediction Death Recover}
\CommentTok{#>    Death       3       3}
\CommentTok{#>    Recover     6      11}
\CommentTok{#>                                         }
\CommentTok{#>                Accuracy : 0.609         }
\CommentTok{#>                  95% CI : (0.385, 0.803)}
\CommentTok{#>     No Information Rate : 0.609         }
\CommentTok{#>     P-Value [Acc > NIR] : 0.590         }
\CommentTok{#>                                         }
\CommentTok{#>                   Kappa : 0.127         }
\CommentTok{#>                                         }
\CommentTok{#>  Mcnemar's Test P-Value : 0.505         }
\CommentTok{#>                                         }
\CommentTok{#>             Sensitivity : 0.333         }
\CommentTok{#>             Specificity : 0.786         }
\CommentTok{#>          Pos Pred Value : 0.500         }
\CommentTok{#>          Neg Pred Value : 0.647         }
\CommentTok{#>              Prevalence : 0.391         }
\CommentTok{#>          Detection Rate : 0.130         }
\CommentTok{#>    Detection Prevalence : 0.261         }
\CommentTok{#>       Balanced Accuracy : 0.560         }
\CommentTok{#>                                         }
\CommentTok{#>        'Positive' Class : Death         }
\CommentTok{#> }
\end{Highlighting}
\end{Shaded}

\hypertarget{nearest-shrunken-centroids}{%
\subsection{Nearest Shrunken Centroids}\label{nearest-shrunken-centroids}}

Nearest Shrunken Centroids computes a standardized centroid for each class and shrinks each centroid toward the overall centroid for all classes.

This model classified 15 out of 23 cases correctly.

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{set.seed}\NormalTok{(}\DecValTok{27}\NormalTok{)}
\NormalTok{model_pam <-}\StringTok{ }\NormalTok{caret}\OperatorTok{::}\KeywordTok{train}\NormalTok{(outcome }\OperatorTok{~}\StringTok{ }\NormalTok{.,}
                             \DataTypeTok{data =}\NormalTok{ val_train_data,}
                             \DataTypeTok{method =} \StringTok{"pam"}\NormalTok{,}
                             \DataTypeTok{preProcess =} \OtherTok{NULL}\NormalTok{,}
                             \DataTypeTok{trControl =}\NormalTok{ train_control)}
\CommentTok{#> 12345678910111213141516171819202122232425262728293011111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111}
\NormalTok{model_pam}
\CommentTok{#> Nearest Shrunken Centroids }
\CommentTok{#> }
\CommentTok{#> 56 samples}
\CommentTok{#> 11 predictors}
\CommentTok{#>  2 classes: 'Death', 'Recover' }
\CommentTok{#> }
\CommentTok{#> No pre-processing}
\CommentTok{#> Resampling: Cross-Validated (10 fold, repeated 10 times) }
\CommentTok{#> Summary of sample sizes: 51, 49, 50, 51, 49, 51, ... }
\CommentTok{#> Resampling results across tuning parameters:}
\CommentTok{#> }
\CommentTok{#>   threshold  Accuracy  Kappa}
\CommentTok{#>   0.142      0.709     0.416}
\CommentTok{#>   2.065      0.714     0.382}
\CommentTok{#>   3.987      0.590     0.000}
\CommentTok{#> }
\CommentTok{#> Accuracy was used to select the optimal model using the largest value.}
\CommentTok{#> The final value used for the model was threshold = 2.06.}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{confusionMatrix}\NormalTok{(}\KeywordTok{predict}\NormalTok{(model_pam, val_test_data[, }\DecValTok{-1}\NormalTok{]), val_test_data}\OperatorTok{$}\NormalTok{outcome)}
\CommentTok{#> Confusion Matrix and Statistics}
\CommentTok{#> }
\CommentTok{#>           Reference}
\CommentTok{#> Prediction Death Recover}
\CommentTok{#>    Death       1       3}
\CommentTok{#>    Recover     8      11}
\CommentTok{#>                                         }
\CommentTok{#>                Accuracy : 0.522         }
\CommentTok{#>                  95% CI : (0.306, 0.732)}
\CommentTok{#>     No Information Rate : 0.609         }
\CommentTok{#>     P-Value [Acc > NIR] : 0.857         }
\CommentTok{#>                                         }
\CommentTok{#>                   Kappa : -0.115        }
\CommentTok{#>                                         }
\CommentTok{#>  Mcnemar's Test P-Value : 0.228         }
\CommentTok{#>                                         }
\CommentTok{#>             Sensitivity : 0.1111        }
\CommentTok{#>             Specificity : 0.7857        }
\CommentTok{#>          Pos Pred Value : 0.2500        }
\CommentTok{#>          Neg Pred Value : 0.5789        }
\CommentTok{#>              Prevalence : 0.3913        }
\CommentTok{#>          Detection Rate : 0.0435        }
\CommentTok{#>    Detection Prevalence : 0.1739        }
\CommentTok{#>       Balanced Accuracy : 0.4484        }
\CommentTok{#>                                         }
\CommentTok{#>        'Positive' Class : Death         }
\CommentTok{#> }
\end{Highlighting}
\end{Shaded}

\hypertarget{single-c5.0-tree}{%
\subsection{Single C5.0 Tree}\label{single-c5.0-tree}}

C5.0 is another tree-based modeling algorithm.

This model classified 15 out of 23 cases correctly.

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{set.seed}\NormalTok{(}\DecValTok{27}\NormalTok{)}
\NormalTok{model_C5}\FloatTok{.0}\NormalTok{Tree <-}\StringTok{ }\NormalTok{caret}\OperatorTok{::}\KeywordTok{train}\NormalTok{(outcome }\OperatorTok{~}\StringTok{ }\NormalTok{.,}
                             \DataTypeTok{data =}\NormalTok{ val_train_data,}
                             \DataTypeTok{method =} \StringTok{"C5.0Tree"}\NormalTok{,}
                             \DataTypeTok{preProcess =} \OtherTok{NULL}\NormalTok{,}
                             \DataTypeTok{trControl =}\NormalTok{ train_control)}
\NormalTok{model_C5}\FloatTok{.0}\NormalTok{Tree}
\CommentTok{#> Single C5.0 Tree }
\CommentTok{#> }
\CommentTok{#> 56 samples}
\CommentTok{#> 11 predictors}
\CommentTok{#>  2 classes: 'Death', 'Recover' }
\CommentTok{#> }
\CommentTok{#> No pre-processing}
\CommentTok{#> Resampling: Cross-Validated (10 fold, repeated 10 times) }
\CommentTok{#> Summary of sample sizes: 51, 49, 50, 51, 49, 51, ... }
\CommentTok{#> Resampling results:}
\CommentTok{#> }
\CommentTok{#>   Accuracy  Kappa}
\CommentTok{#>   0.696     0.359}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{confusionMatrix}\NormalTok{(}\KeywordTok{predict}\NormalTok{(model_C5}\FloatTok{.0}\NormalTok{Tree, val_test_data[, }\DecValTok{-1}\NormalTok{]), val_test_data}\OperatorTok{$}\NormalTok{outcome)}
\CommentTok{#> Confusion Matrix and Statistics}
\CommentTok{#> }
\CommentTok{#>           Reference}
\CommentTok{#> Prediction Death Recover}
\CommentTok{#>    Death       4       1}
\CommentTok{#>    Recover     5      13}
\CommentTok{#>                                         }
\CommentTok{#>                Accuracy : 0.739         }
\CommentTok{#>                  95% CI : (0.516, 0.898)}
\CommentTok{#>     No Information Rate : 0.609         }
\CommentTok{#>     P-Value [Acc > NIR] : 0.142         }
\CommentTok{#>                                         }
\CommentTok{#>                   Kappa : 0.405         }
\CommentTok{#>                                         }
\CommentTok{#>  Mcnemar's Test P-Value : 0.221         }
\CommentTok{#>                                         }
\CommentTok{#>             Sensitivity : 0.444         }
\CommentTok{#>             Specificity : 0.929         }
\CommentTok{#>          Pos Pred Value : 0.800         }
\CommentTok{#>          Neg Pred Value : 0.722         }
\CommentTok{#>              Prevalence : 0.391         }
\CommentTok{#>          Detection Rate : 0.174         }
\CommentTok{#>    Detection Prevalence : 0.217         }
\CommentTok{#>       Balanced Accuracy : 0.687         }
\CommentTok{#>                                         }
\CommentTok{#>        'Positive' Class : Death         }
\CommentTok{#> }
\end{Highlighting}
\end{Shaded}

\hypertarget{partial-least-squares}{%
\subsection{Partial Least Squares}\label{partial-least-squares}}

modeling with correlated features.

This model classified 15 out of 23 cases correctly.

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{set.seed}\NormalTok{(}\DecValTok{27}\NormalTok{)}
\NormalTok{model_pls <-}\StringTok{ }\NormalTok{caret}\OperatorTok{::}\KeywordTok{train}\NormalTok{(outcome }\OperatorTok{~}\StringTok{ }\NormalTok{.,}
                             \DataTypeTok{data =}\NormalTok{ val_train_data,}
                             \DataTypeTok{method =} \StringTok{"pls"}\NormalTok{,}
                             \DataTypeTok{preProcess =} \OtherTok{NULL}\NormalTok{,}
                             \DataTypeTok{trControl =}\NormalTok{ train_control)}
\NormalTok{model_pls}
\CommentTok{#> Partial Least Squares }
\CommentTok{#> }
\CommentTok{#> 56 samples}
\CommentTok{#> 11 predictors}
\CommentTok{#>  2 classes: 'Death', 'Recover' }
\CommentTok{#> }
\CommentTok{#> No pre-processing}
\CommentTok{#> Resampling: Cross-Validated (10 fold, repeated 10 times) }
\CommentTok{#> Summary of sample sizes: 51, 49, 50, 51, 49, 51, ... }
\CommentTok{#> Resampling results across tuning parameters:}
\CommentTok{#> }
\CommentTok{#>   ncomp  Accuracy  Kappa}
\CommentTok{#>   1      0.663     0.315}
\CommentTok{#>   2      0.676     0.341}
\CommentTok{#>   3      0.691     0.376}
\CommentTok{#> }
\CommentTok{#> Accuracy was used to select the optimal model using the largest value.}
\CommentTok{#> The final value used for the model was ncomp = 3.}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{confusionMatrix}\NormalTok{(}\KeywordTok{predict}\NormalTok{(model_pls, val_test_data[, }\DecValTok{-1}\NormalTok{]), val_test_data}\OperatorTok{$}\NormalTok{outcome)}
\CommentTok{#> Confusion Matrix and Statistics}
\CommentTok{#> }
\CommentTok{#>           Reference}
\CommentTok{#> Prediction Death Recover}
\CommentTok{#>    Death       2       3}
\CommentTok{#>    Recover     7      11}
\CommentTok{#>                                         }
\CommentTok{#>                Accuracy : 0.565         }
\CommentTok{#>                  95% CI : (0.345, 0.768)}
\CommentTok{#>     No Information Rate : 0.609         }
\CommentTok{#>     P-Value [Acc > NIR] : 0.742         }
\CommentTok{#>                                         }
\CommentTok{#>                   Kappa : 0.009         }
\CommentTok{#>                                         }
\CommentTok{#>  Mcnemar's Test P-Value : 0.343         }
\CommentTok{#>                                         }
\CommentTok{#>             Sensitivity : 0.222         }
\CommentTok{#>             Specificity : 0.786         }
\CommentTok{#>          Pos Pred Value : 0.400         }
\CommentTok{#>          Neg Pred Value : 0.611         }
\CommentTok{#>              Prevalence : 0.391         }
\CommentTok{#>          Detection Rate : 0.087         }
\CommentTok{#>    Detection Prevalence : 0.217         }
\CommentTok{#>       Balanced Accuracy : 0.504         }
\CommentTok{#>                                         }
\CommentTok{#>        'Positive' Class : Death         }
\CommentTok{#> }
\end{Highlighting}
\end{Shaded}

\hypertarget{comparing-accuracy-of-models}{%
\section{Comparing accuracy of models}\label{comparing-accuracy-of-models}}

All models were similarly accurate.

\hypertarget{summary-accuracy-and-kappa}{%
\subsection{Summary Accuracy and Kappa}\label{summary-accuracy-and-kappa}}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# Create a list of models}
\NormalTok{models <-}\StringTok{ }\KeywordTok{list}\NormalTok{(}\DataTypeTok{rf       =}\NormalTok{ model_rf, }
               \DataTypeTok{glmnet   =}\NormalTok{ model_glmnet, }
               \DataTypeTok{kknn     =}\NormalTok{ model_kknn, }
               \DataTypeTok{pda      =}\NormalTok{ model_pda, }
               \DataTypeTok{slda     =}\NormalTok{ model_slda,}
               \DataTypeTok{pam      =}\NormalTok{ model_pam, }
               \DataTypeTok{C5.0Tree =}\NormalTok{ model_C5}\FloatTok{.0}\NormalTok{Tree, }
               \DataTypeTok{pls      =}\NormalTok{ model_pls)}

\CommentTok{# Resample the models}
\NormalTok{resample_results <-}\StringTok{ }\KeywordTok{resamples}\NormalTok{(models)}

\CommentTok{# Generate a summary}
\KeywordTok{summary}\NormalTok{(resample_results, }\DataTypeTok{metric =} \KeywordTok{c}\NormalTok{(}\StringTok{"Kappa"}\NormalTok{, }\StringTok{"Accuracy"}\NormalTok{))}
\CommentTok{#> }
\CommentTok{#> Call:}
\CommentTok{#> summary.resamples(object = resample_results, metric = c("Kappa", "Accuracy"))}
\CommentTok{#> }
\CommentTok{#> Models: rf, glmnet, kknn, pda, slda, pam, C5.0Tree, pls }
\CommentTok{#> Number of resamples: 100 }
\CommentTok{#> }
\CommentTok{#> Kappa }
\CommentTok{#>            Min. 1st Qu. Median  Mean 3rd Qu. Max. NA's}
\CommentTok{#> rf       -0.500   0.167  0.545 0.432   0.667    1    0}
\CommentTok{#> glmnet   -0.667   0.167  0.545 0.414   0.667    1    0}
\CommentTok{#> kknn     -0.667   0.125  0.333 0.313   0.615    1    0}
\CommentTok{#> pda      -0.667   0.142  0.333 0.343   0.615    1    0}
\CommentTok{#> slda     -0.667   0.167  0.367 0.358   0.615    1    0}
\CommentTok{#> pam      -0.667   0.167  0.545 0.382   0.571    1    0}
\CommentTok{#> C5.0Tree -0.667   0.167  0.333 0.359   0.615    1    0}
\CommentTok{#> pls      -0.667   0.167  0.333 0.376   0.667    1    0}
\CommentTok{#> }
\CommentTok{#> Accuracy }
\CommentTok{#>           Min. 1st Qu. Median  Mean 3rd Qu. Max. NA's}
\CommentTok{#> rf       0.333   0.600  0.800 0.732   0.833    1    0}
\CommentTok{#> glmnet   0.167   0.600  0.800 0.714   0.833    1    0}
\CommentTok{#> kknn     0.167   0.600  0.667 0.666   0.800    1    0}
\CommentTok{#> pda      0.167   0.593  0.667 0.681   0.800    1    0}
\CommentTok{#> slda     0.167   0.600  0.667 0.682   0.800    1    0}
\CommentTok{#> pam      0.200   0.600  0.800 0.714   0.800    1    0}
\CommentTok{#> C5.0Tree 0.167   0.600  0.667 0.696   0.800    1    0}
\CommentTok{#> pls      0.167   0.600  0.667 0.691   0.833    1    0}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{bwplot}\NormalTok{(resample_results , }\DataTypeTok{metric =} \KeywordTok{c}\NormalTok{(}\StringTok{"Kappa"}\NormalTok{,}\StringTok{"Accuracy"}\NormalTok{))}
\end{Highlighting}
\end{Shaded}

\begin{center}\includegraphics[width=0.7\linewidth]{comparison_330-classification_flu_outcome-multi-sglander_files/figure-latex/unnamed-chunk-27-1} \end{center}

\hypertarget{combined-results-of-predicting-validation-test-samples}{%
\subsection{Combined results of predicting validation test samples}\label{combined-results-of-predicting-validation-test-samples}}

To compare the predictions from all models, I summed up the prediction probabilities for Death and Recovery from all models and calculated the log2 of the ratio between the summed probabilities for Recovery by the summed probabilities for Death. All cases with a log2 ratio bigger than 1.5 were defined as Recover, cases with a log2 ratio below -1.5 were defined as Death, and the remaining cases were defined as uncertain.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{results <-}\StringTok{ }\KeywordTok{data.frame}\NormalTok{(}
  \DataTypeTok{randomForest =} \KeywordTok{predict}\NormalTok{(model_rf, }\DataTypeTok{newdata =}\NormalTok{ val_test_data[, }\DecValTok{-1}\NormalTok{], }\DataTypeTok{type=}\StringTok{"prob"}\NormalTok{),}
  \DataTypeTok{glmnet =} \KeywordTok{predict}\NormalTok{(model_glmnet, }\DataTypeTok{newdata =}\NormalTok{ val_test_data[, }\DecValTok{-1}\NormalTok{], }\DataTypeTok{type=}\StringTok{"prob"}\NormalTok{),}
  \DataTypeTok{kknn =} \KeywordTok{predict}\NormalTok{(model_kknn, }\DataTypeTok{newdata =}\NormalTok{ val_test_data[, }\DecValTok{-1}\NormalTok{], }\DataTypeTok{type=}\StringTok{"prob"}\NormalTok{),}
  \DataTypeTok{pda =} \KeywordTok{predict}\NormalTok{(model_pda, }\DataTypeTok{newdata =}\NormalTok{ val_test_data[, }\DecValTok{-1}\NormalTok{], }\DataTypeTok{type=}\StringTok{"prob"}\NormalTok{),}
  \DataTypeTok{slda =} \KeywordTok{predict}\NormalTok{(model_slda, }\DataTypeTok{newdata =}\NormalTok{ val_test_data[, }\DecValTok{-1}\NormalTok{], }\DataTypeTok{type=}\StringTok{"prob"}\NormalTok{),}
  \DataTypeTok{pam =} \KeywordTok{predict}\NormalTok{(model_pam, }\DataTypeTok{newdata =}\NormalTok{ val_test_data[, }\DecValTok{-1}\NormalTok{], }\DataTypeTok{type=}\StringTok{"prob"}\NormalTok{),}
  \DataTypeTok{C5.0Tree =} \KeywordTok{predict}\NormalTok{(model_C5}\FloatTok{.0}\NormalTok{Tree, }\DataTypeTok{newdata =}\NormalTok{ val_test_data[, }\DecValTok{-1}\NormalTok{], }\DataTypeTok{type=}\StringTok{"prob"}\NormalTok{),}
  \DataTypeTok{pls =} \KeywordTok{predict}\NormalTok{(model_pls, }\DataTypeTok{newdata =}\NormalTok{ val_test_data[, }\DecValTok{-1}\NormalTok{], }\DataTypeTok{type=}\StringTok{"prob"}\NormalTok{))}

\NormalTok{results}\OperatorTok{$}\NormalTok{sum_Death <-}\StringTok{ }\KeywordTok{rowSums}\NormalTok{(results[, }\KeywordTok{grep}\NormalTok{(}\StringTok{"Death"}\NormalTok{, }\KeywordTok{colnames}\NormalTok{(results))])}
\NormalTok{results}\OperatorTok{$}\NormalTok{sum_Recover <-}\StringTok{ }\KeywordTok{rowSums}\NormalTok{(results[, }\KeywordTok{grep}\NormalTok{(}\StringTok{"Recover"}\NormalTok{, }\KeywordTok{colnames}\NormalTok{(results))])}
\NormalTok{results}\OperatorTok{$}\NormalTok{log2_ratio <-}\StringTok{ }\KeywordTok{log2}\NormalTok{(results}\OperatorTok{$}\NormalTok{sum_Recover}\OperatorTok{/}\NormalTok{results}\OperatorTok{$}\NormalTok{sum_Death)}
\NormalTok{results}\OperatorTok{$}\NormalTok{true_outcome <-}\StringTok{ }\NormalTok{val_test_data}\OperatorTok{$}\NormalTok{outcome}
\NormalTok{results}\OperatorTok{$}\NormalTok{pred_outcome <-}\StringTok{ }\KeywordTok{ifelse}\NormalTok{(results}\OperatorTok{$}\NormalTok{log2_ratio }\OperatorTok{>}\StringTok{ }\FloatTok{1.5}\NormalTok{, }\StringTok{"Recover"}\NormalTok{, }
              \KeywordTok{ifelse}\NormalTok{(results}\OperatorTok{$}\NormalTok{log2_ratio }\OperatorTok{<}\StringTok{ }\FloatTok{-1.5}\NormalTok{, }\StringTok{"Death"}\NormalTok{, }\StringTok{"uncertain"}\NormalTok{))}
\NormalTok{results}\OperatorTok{$}\NormalTok{prediction <-}\StringTok{ }\KeywordTok{ifelse}\NormalTok{(results}\OperatorTok{$}\NormalTok{pred_outcome }\OperatorTok{==}\StringTok{ }\NormalTok{results}\OperatorTok{$}\NormalTok{true_outcome, }\StringTok{"CORRECT"}\NormalTok{, }
              \KeywordTok{ifelse}\NormalTok{(results}\OperatorTok{$}\NormalTok{pred_outcome }\OperatorTok{==}\StringTok{ "uncertain"}\NormalTok{, }\StringTok{"uncertain"}\NormalTok{, }\StringTok{"wrong"}\NormalTok{))}
\NormalTok{results[, }\OperatorTok{-}\KeywordTok{c}\NormalTok{(}\DecValTok{1}\OperatorTok{:}\DecValTok{16}\NormalTok{)]}
\CommentTok{#>          sum_Death sum_Recover log2_ratio true_outcome pred_outcome prediction}
\CommentTok{#> case_10      4.237        3.76    -0.1709        Death    uncertain  uncertain}
\CommentTok{#> case_11      5.181        2.82    -0.8778        Death    uncertain  uncertain}
\CommentTok{#> case_116     2.412        5.59     1.2123      Recover    uncertain  uncertain}
\CommentTok{#> case_12      5.219        2.78    -0.9085        Death    uncertain  uncertain}
\CommentTok{#> case_121     2.356        5.64     1.2606        Death    uncertain  uncertain}
\CommentTok{#> case_127     0.694        7.31     3.3972      Recover      Recover    CORRECT}
\CommentTok{#> case_131     0.685        7.31     3.4164      Recover      Recover    CORRECT}
\CommentTok{#> case_133     0.649        7.35     3.5024      Recover      Recover    CORRECT}
\CommentTok{#> case_135     2.027        5.97     1.5589        Death      Recover      wrong}
\CommentTok{#> case_2       2.161        5.84     1.4337        Death    uncertain  uncertain}
\CommentTok{#> case_20      3.144        4.86     0.6272      Recover    uncertain  uncertain}
\CommentTok{#> case_30      4.493        3.51    -0.3576      Recover    uncertain  uncertain}
\CommentTok{#> case_45      2.594        5.41     1.0590        Death    uncertain  uncertain}
\CommentTok{#> case_5       3.019        4.98     0.7227      Recover    uncertain  uncertain}
\CommentTok{#> case_55      3.925        4.08     0.0543      Recover    uncertain  uncertain}
\CommentTok{#> case_59      1.894        6.11     1.6886      Recover      Recover    CORRECT}
\CommentTok{#> case_72      2.545        5.46     1.1002      Recover    uncertain  uncertain}
\CommentTok{#> case_74      2.339        5.66     1.2748      Recover    uncertain  uncertain}
\CommentTok{#> case_77      0.845        7.15     3.0819      Recover      Recover    CORRECT}
\CommentTok{#> case_8       2.237        5.76     1.3650        Death    uncertain  uncertain}
\CommentTok{#> case_89      1.712        6.29     1.8772      Recover      Recover    CORRECT}
\CommentTok{#> case_97      2.959        5.04     0.7687      Recover    uncertain  uncertain}
\CommentTok{#> case_98      4.798        3.20    -0.5833        Death    uncertain  uncertain}
\end{Highlighting}
\end{Shaded}

All predictions based on all models were either correct or uncertain.

\hypertarget{predicting-unknown-outcomes}{%
\section{Predicting unknown outcomes}\label{predicting-unknown-outcomes}}

The above models will now be used to predict the outcome of cases with unknown fate.

\begin{Shaded}
\begin{Highlighting}[]

\NormalTok{train_control <-}\StringTok{ }\KeywordTok{trainControl}\NormalTok{(}\DataTypeTok{method =} \StringTok{"repeatedcv"}\NormalTok{, }
                              \DataTypeTok{number =} \DecValTok{10}\NormalTok{, }
                              \DataTypeTok{repeats =} \DecValTok{10}\NormalTok{, }
                              \DataTypeTok{verboseIter =} \OtherTok{FALSE}\NormalTok{)}

\KeywordTok{set.seed}\NormalTok{(}\DecValTok{27}\NormalTok{)}
\NormalTok{model_rf <-}\StringTok{ }\NormalTok{caret}\OperatorTok{::}\KeywordTok{train}\NormalTok{(outcome }\OperatorTok{~}\StringTok{ }\NormalTok{.,}
                             \DataTypeTok{data =}\NormalTok{ train_data,}
                             \DataTypeTok{method =} \StringTok{"rf"}\NormalTok{,}
                             \DataTypeTok{preProcess =} \OtherTok{NULL}\NormalTok{,}
                             \DataTypeTok{trControl =}\NormalTok{ train_control)}
\NormalTok{model_glmnet <-}\StringTok{ }\NormalTok{caret}\OperatorTok{::}\KeywordTok{train}\NormalTok{(outcome }\OperatorTok{~}\StringTok{ }\NormalTok{.,}
                             \DataTypeTok{data =}\NormalTok{ train_data,}
                             \DataTypeTok{method =} \StringTok{"glmnet"}\NormalTok{,}
                             \DataTypeTok{preProcess =} \OtherTok{NULL}\NormalTok{,}
                             \DataTypeTok{trControl =}\NormalTok{ train_control)}
\NormalTok{model_kknn <-}\StringTok{ }\NormalTok{caret}\OperatorTok{::}\KeywordTok{train}\NormalTok{(outcome }\OperatorTok{~}\StringTok{ }\NormalTok{.,}
                             \DataTypeTok{data =}\NormalTok{ train_data,}
                             \DataTypeTok{method =} \StringTok{"kknn"}\NormalTok{,}
                             \DataTypeTok{preProcess =} \OtherTok{NULL}\NormalTok{,}
                             \DataTypeTok{trControl =}\NormalTok{ train_control)}
\NormalTok{model_pda <-}\StringTok{ }\NormalTok{caret}\OperatorTok{::}\KeywordTok{train}\NormalTok{(outcome }\OperatorTok{~}\StringTok{ }\NormalTok{.,}
                             \DataTypeTok{data =}\NormalTok{ train_data,}
                             \DataTypeTok{method =} \StringTok{"pda"}\NormalTok{,}
                             \DataTypeTok{preProcess =} \OtherTok{NULL}\NormalTok{,}
                             \DataTypeTok{trControl =}\NormalTok{ train_control)}
\CommentTok{#> Warning: predictions failed for Fold01.Rep01: lambda=0e+00 Error in mindist[l] <- ndist[l] : }
\CommentTok{#>   NAs are not allowed in subscripted assignments}
\CommentTok{#> Warning: predictions failed for Fold02.Rep01: lambda=0e+00 Error in mindist[l] <- ndist[l] : }
\CommentTok{#>   NAs are not allowed in subscripted assignments}
\CommentTok{#> Warning: predictions failed for Fold03.Rep01: lambda=0e+00 Error in mindist[l] <- ndist[l] : }
\CommentTok{#>   NAs are not allowed in subscripted assignments}
\CommentTok{#> Warning: predictions failed for Fold04.Rep01: lambda=0e+00 Error in mindist[l] <- ndist[l] : }
\CommentTok{#>   NAs are not allowed in subscripted assignments}
\CommentTok{#> Warning: predictions failed for Fold05.Rep01: lambda=0e+00 Error in mindist[l] <- ndist[l] : }
\CommentTok{#>   NAs are not allowed in subscripted assignments}
\CommentTok{#> Warning: predictions failed for Fold06.Rep01: lambda=0e+00 Error in mindist[l] <- ndist[l] : }
\CommentTok{#>   NAs are not allowed in subscripted assignments}
\CommentTok{#> Warning: predictions failed for Fold07.Rep01: lambda=0e+00 Error in mindist[l] <- ndist[l] : }
\CommentTok{#>   NAs are not allowed in subscripted assignments}
\CommentTok{#> Warning: predictions failed for Fold08.Rep01: lambda=0e+00 Error in mindist[l] <- ndist[l] : }
\CommentTok{#>   NAs are not allowed in subscripted assignments}
\CommentTok{#> Warning: predictions failed for Fold09.Rep01: lambda=0e+00 Error in mindist[l] <- ndist[l] : }
\CommentTok{#>   NAs are not allowed in subscripted assignments}
\CommentTok{#> Warning: predictions failed for Fold10.Rep01: lambda=0e+00 Error in mindist[l] <- ndist[l] : }
\CommentTok{#>   NAs are not allowed in subscripted assignments}
\CommentTok{#> Warning: predictions failed for Fold01.Rep02: lambda=0e+00 Error in mindist[l] <- ndist[l] : }
\CommentTok{#>   NAs are not allowed in subscripted assignments}
\CommentTok{#> Warning: predictions failed for Fold02.Rep02: lambda=0e+00 Error in mindist[l] <- ndist[l] : }
\CommentTok{#>   NAs are not allowed in subscripted assignments}
\CommentTok{#> Warning: predictions failed for Fold03.Rep02: lambda=0e+00 Error in mindist[l] <- ndist[l] : }
\CommentTok{#>   NAs are not allowed in subscripted assignments}
\CommentTok{#> Warning: predictions failed for Fold04.Rep02: lambda=0e+00 Error in mindist[l] <- ndist[l] : }
\CommentTok{#>   NAs are not allowed in subscripted assignments}
\CommentTok{#> Warning: predictions failed for Fold05.Rep02: lambda=0e+00 Error in mindist[l] <- ndist[l] : }
\CommentTok{#>   NAs are not allowed in subscripted assignments}
\CommentTok{#> Warning: predictions failed for Fold06.Rep02: lambda=0e+00 Error in mindist[l] <- ndist[l] : }
\CommentTok{#>   NAs are not allowed in subscripted assignments}
\CommentTok{#> Warning: predictions failed for Fold07.Rep02: lambda=0e+00 Error in mindist[l] <- ndist[l] : }
\CommentTok{#>   NAs are not allowed in subscripted assignments}
\CommentTok{#> Warning: predictions failed for Fold08.Rep02: lambda=0e+00 Error in mindist[l] <- ndist[l] : }
\CommentTok{#>   NAs are not allowed in subscripted assignments}
\CommentTok{#> Warning: predictions failed for Fold09.Rep02: lambda=0e+00 Error in mindist[l] <- ndist[l] : }
\CommentTok{#>   NAs are not allowed in subscripted assignments}
\CommentTok{#> Warning: predictions failed for Fold10.Rep02: lambda=0e+00 Error in mindist[l] <- ndist[l] : }
\CommentTok{#>   NAs are not allowed in subscripted assignments}
\CommentTok{#> Warning: predictions failed for Fold01.Rep03: lambda=0e+00 Error in mindist[l] <- ndist[l] : }
\CommentTok{#>   NAs are not allowed in subscripted assignments}
\CommentTok{#> Warning: predictions failed for Fold02.Rep03: lambda=0e+00 Error in mindist[l] <- ndist[l] : }
\CommentTok{#>   NAs are not allowed in subscripted assignments}
\CommentTok{#> Warning: predictions failed for Fold03.Rep03: lambda=0e+00 Error in mindist[l] <- ndist[l] : }
\CommentTok{#>   NAs are not allowed in subscripted assignments}
\CommentTok{#> Warning: predictions failed for Fold04.Rep03: lambda=0e+00 Error in mindist[l] <- ndist[l] : }
\CommentTok{#>   NAs are not allowed in subscripted assignments}
\CommentTok{#> Warning: predictions failed for Fold05.Rep03: lambda=0e+00 Error in mindist[l] <- ndist[l] : }
\CommentTok{#>   NAs are not allowed in subscripted assignments}
\CommentTok{#> Warning: predictions failed for Fold06.Rep03: lambda=0e+00 Error in mindist[l] <- ndist[l] : }
\CommentTok{#>   NAs are not allowed in subscripted assignments}
\CommentTok{#> Warning: predictions failed for Fold07.Rep03: lambda=0e+00 Error in mindist[l] <- ndist[l] : }
\CommentTok{#>   NAs are not allowed in subscripted assignments}
\CommentTok{#> Warning: predictions failed for Fold08.Rep03: lambda=0e+00 Error in mindist[l] <- ndist[l] : }
\CommentTok{#>   NAs are not allowed in subscripted assignments}
\CommentTok{#> Warning: predictions failed for Fold09.Rep03: lambda=0e+00 Error in mindist[l] <- ndist[l] : }
\CommentTok{#>   NAs are not allowed in subscripted assignments}
\CommentTok{#> Warning: predictions failed for Fold10.Rep03: lambda=0e+00 Error in mindist[l] <- ndist[l] : }
\CommentTok{#>   NAs are not allowed in subscripted assignments}
\CommentTok{#> Warning: predictions failed for Fold01.Rep04: lambda=0e+00 Error in mindist[l] <- ndist[l] : }
\CommentTok{#>   NAs are not allowed in subscripted assignments}
\CommentTok{#> Warning: predictions failed for Fold02.Rep04: lambda=0e+00 Error in mindist[l] <- ndist[l] : }
\CommentTok{#>   NAs are not allowed in subscripted assignments}
\CommentTok{#> Warning: predictions failed for Fold03.Rep04: lambda=0e+00 Error in mindist[l] <- ndist[l] : }
\CommentTok{#>   NAs are not allowed in subscripted assignments}
\CommentTok{#> Warning: predictions failed for Fold04.Rep04: lambda=0e+00 Error in mindist[l] <- ndist[l] : }
\CommentTok{#>   NAs are not allowed in subscripted assignments}
\CommentTok{#> Warning: predictions failed for Fold05.Rep04: lambda=0e+00 Error in mindist[l] <- ndist[l] : }
\CommentTok{#>   NAs are not allowed in subscripted assignments}
\CommentTok{#> Warning: predictions failed for Fold06.Rep04: lambda=0e+00 Error in mindist[l] <- ndist[l] : }
\CommentTok{#>   NAs are not allowed in subscripted assignments}
\CommentTok{#> Warning: predictions failed for Fold07.Rep04: lambda=0e+00 Error in mindist[l] <- ndist[l] : }
\CommentTok{#>   NAs are not allowed in subscripted assignments}
\CommentTok{#> Warning: predictions failed for Fold08.Rep04: lambda=0e+00 Error in mindist[l] <- ndist[l] : }
\CommentTok{#>   NAs are not allowed in subscripted assignments}
\CommentTok{#> Warning: predictions failed for Fold09.Rep04: lambda=0e+00 Error in mindist[l] <- ndist[l] : }
\CommentTok{#>   NAs are not allowed in subscripted assignments}
\CommentTok{#> Warning: predictions failed for Fold10.Rep04: lambda=0e+00 Error in mindist[l] <- ndist[l] : }
\CommentTok{#>   NAs are not allowed in subscripted assignments}
\CommentTok{#> Warning: predictions failed for Fold01.Rep05: lambda=0e+00 Error in mindist[l] <- ndist[l] : }
\CommentTok{#>   NAs are not allowed in subscripted assignments}
\CommentTok{#> Warning: predictions failed for Fold02.Rep05: lambda=0e+00 Error in mindist[l] <- ndist[l] : }
\CommentTok{#>   NAs are not allowed in subscripted assignments}
\CommentTok{#> Warning: predictions failed for Fold03.Rep05: lambda=0e+00 Error in mindist[l] <- ndist[l] : }
\CommentTok{#>   NAs are not allowed in subscripted assignments}
\CommentTok{#> Warning: predictions failed for Fold04.Rep05: lambda=0e+00 Error in mindist[l] <- ndist[l] : }
\CommentTok{#>   NAs are not allowed in subscripted assignments}
\CommentTok{#> Warning: predictions failed for Fold05.Rep05: lambda=0e+00 Error in mindist[l] <- ndist[l] : }
\CommentTok{#>   NAs are not allowed in subscripted assignments}
\CommentTok{#> Warning: predictions failed for Fold06.Rep05: lambda=0e+00 Error in mindist[l] <- ndist[l] : }
\CommentTok{#>   NAs are not allowed in subscripted assignments}
\CommentTok{#> Warning: predictions failed for Fold07.Rep05: lambda=0e+00 Error in mindist[l] <- ndist[l] : }
\CommentTok{#>   NAs are not allowed in subscripted assignments}
\CommentTok{#> Warning: predictions failed for Fold08.Rep05: lambda=0e+00 Error in mindist[l] <- ndist[l] : }
\CommentTok{#>   NAs are not allowed in subscripted assignments}
\CommentTok{#> Warning: predictions failed for Fold09.Rep05: lambda=0e+00 Error in mindist[l] <- ndist[l] : }
\CommentTok{#>   NAs are not allowed in subscripted assignments}
\CommentTok{#> Warning: predictions failed for Fold10.Rep05: lambda=0e+00 Error in mindist[l] <- ndist[l] : }
\CommentTok{#>   NAs are not allowed in subscripted assignments}
\CommentTok{#> Warning: predictions failed for Fold01.Rep06: lambda=0e+00 Error in mindist[l] <- ndist[l] : }
\CommentTok{#>   NAs are not allowed in subscripted assignments}
\CommentTok{#> Warning: predictions failed for Fold02.Rep06: lambda=0e+00 Error in mindist[l] <- ndist[l] : }
\CommentTok{#>   NAs are not allowed in subscripted assignments}
\CommentTok{#> Warning: predictions failed for Fold03.Rep06: lambda=0e+00 Error in mindist[l] <- ndist[l] : }
\CommentTok{#>   NAs are not allowed in subscripted assignments}
\CommentTok{#> Warning: predictions failed for Fold04.Rep06: lambda=0e+00 Error in mindist[l] <- ndist[l] : }
\CommentTok{#>   NAs are not allowed in subscripted assignments}
\CommentTok{#> Warning: predictions failed for Fold05.Rep06: lambda=0e+00 Error in mindist[l] <- ndist[l] : }
\CommentTok{#>   NAs are not allowed in subscripted assignments}
\CommentTok{#> Warning: predictions failed for Fold06.Rep06: lambda=0e+00 Error in mindist[l] <- ndist[l] : }
\CommentTok{#>   NAs are not allowed in subscripted assignments}
\CommentTok{#> Warning: predictions failed for Fold07.Rep06: lambda=0e+00 Error in mindist[l] <- ndist[l] : }
\CommentTok{#>   NAs are not allowed in subscripted assignments}
\CommentTok{#> Warning: predictions failed for Fold08.Rep06: lambda=0e+00 Error in mindist[l] <- ndist[l] : }
\CommentTok{#>   NAs are not allowed in subscripted assignments}
\CommentTok{#> Warning: predictions failed for Fold09.Rep06: lambda=0e+00 Error in mindist[l] <- ndist[l] : }
\CommentTok{#>   NAs are not allowed in subscripted assignments}
\CommentTok{#> Warning: predictions failed for Fold10.Rep06: lambda=0e+00 Error in mindist[l] <- ndist[l] : }
\CommentTok{#>   NAs are not allowed in subscripted assignments}
\CommentTok{#> Warning: predictions failed for Fold01.Rep07: lambda=0e+00 Error in mindist[l] <- ndist[l] : }
\CommentTok{#>   NAs are not allowed in subscripted assignments}
\CommentTok{#> Warning: predictions failed for Fold02.Rep07: lambda=0e+00 Error in mindist[l] <- ndist[l] : }
\CommentTok{#>   NAs are not allowed in subscripted assignments}
\CommentTok{#> Warning: predictions failed for Fold03.Rep07: lambda=0e+00 Error in mindist[l] <- ndist[l] : }
\CommentTok{#>   NAs are not allowed in subscripted assignments}
\CommentTok{#> Warning: predictions failed for Fold04.Rep07: lambda=0e+00 Error in mindist[l] <- ndist[l] : }
\CommentTok{#>   NAs are not allowed in subscripted assignments}
\CommentTok{#> Warning: predictions failed for Fold05.Rep07: lambda=0e+00 Error in mindist[l] <- ndist[l] : }
\CommentTok{#>   NAs are not allowed in subscripted assignments}
\CommentTok{#> Warning: predictions failed for Fold06.Rep07: lambda=0e+00 Error in mindist[l] <- ndist[l] : }
\CommentTok{#>   NAs are not allowed in subscripted assignments}
\CommentTok{#> Warning: predictions failed for Fold07.Rep07: lambda=0e+00 Error in mindist[l] <- ndist[l] : }
\CommentTok{#>   NAs are not allowed in subscripted assignments}
\CommentTok{#> Warning: predictions failed for Fold08.Rep07: lambda=0e+00 Error in mindist[l] <- ndist[l] : }
\CommentTok{#>   NAs are not allowed in subscripted assignments}
\CommentTok{#> Warning: predictions failed for Fold09.Rep07: lambda=0e+00 Error in mindist[l] <- ndist[l] : }
\CommentTok{#>   NAs are not allowed in subscripted assignments}
\CommentTok{#> Warning: predictions failed for Fold10.Rep07: lambda=0e+00 Error in mindist[l] <- ndist[l] : }
\CommentTok{#>   NAs are not allowed in subscripted assignments}
\CommentTok{#> Warning: predictions failed for Fold01.Rep08: lambda=0e+00 Error in mindist[l] <- ndist[l] : }
\CommentTok{#>   NAs are not allowed in subscripted assignments}
\CommentTok{#> Warning: predictions failed for Fold02.Rep08: lambda=0e+00 Error in mindist[l] <- ndist[l] : }
\CommentTok{#>   NAs are not allowed in subscripted assignments}
\CommentTok{#> Warning: predictions failed for Fold03.Rep08: lambda=0e+00 Error in mindist[l] <- ndist[l] : }
\CommentTok{#>   NAs are not allowed in subscripted assignments}
\CommentTok{#> Warning: predictions failed for Fold04.Rep08: lambda=0e+00 Error in mindist[l] <- ndist[l] : }
\CommentTok{#>   NAs are not allowed in subscripted assignments}
\CommentTok{#> Warning: predictions failed for Fold05.Rep08: lambda=0e+00 Error in mindist[l] <- ndist[l] : }
\CommentTok{#>   NAs are not allowed in subscripted assignments}
\CommentTok{#> Warning: predictions failed for Fold06.Rep08: lambda=0e+00 Error in mindist[l] <- ndist[l] : }
\CommentTok{#>   NAs are not allowed in subscripted assignments}
\CommentTok{#> Warning: predictions failed for Fold07.Rep08: lambda=0e+00 Error in mindist[l] <- ndist[l] : }
\CommentTok{#>   NAs are not allowed in subscripted assignments}
\CommentTok{#> Warning: predictions failed for Fold08.Rep08: lambda=0e+00 Error in mindist[l] <- ndist[l] : }
\CommentTok{#>   NAs are not allowed in subscripted assignments}
\CommentTok{#> Warning: predictions failed for Fold09.Rep08: lambda=0e+00 Error in mindist[l] <- ndist[l] : }
\CommentTok{#>   NAs are not allowed in subscripted assignments}
\CommentTok{#> Warning: predictions failed for Fold10.Rep08: lambda=0e+00 Error in mindist[l] <- ndist[l] : }
\CommentTok{#>   NAs are not allowed in subscripted assignments}
\CommentTok{#> Warning: predictions failed for Fold01.Rep09: lambda=0e+00 Error in mindist[l] <- ndist[l] : }
\CommentTok{#>   NAs are not allowed in subscripted assignments}
\CommentTok{#> Warning: predictions failed for Fold02.Rep09: lambda=0e+00 Error in mindist[l] <- ndist[l] : }
\CommentTok{#>   NAs are not allowed in subscripted assignments}
\CommentTok{#> Warning: predictions failed for Fold03.Rep09: lambda=0e+00 Error in mindist[l] <- ndist[l] : }
\CommentTok{#>   NAs are not allowed in subscripted assignments}
\CommentTok{#> Warning: predictions failed for Fold04.Rep09: lambda=0e+00 Error in mindist[l] <- ndist[l] : }
\CommentTok{#>   NAs are not allowed in subscripted assignments}
\CommentTok{#> Warning: predictions failed for Fold05.Rep09: lambda=0e+00 Error in mindist[l] <- ndist[l] : }
\CommentTok{#>   NAs are not allowed in subscripted assignments}
\CommentTok{#> Warning: predictions failed for Fold06.Rep09: lambda=0e+00 Error in mindist[l] <- ndist[l] : }
\CommentTok{#>   NAs are not allowed in subscripted assignments}
\CommentTok{#> Warning: predictions failed for Fold07.Rep09: lambda=0e+00 Error in mindist[l] <- ndist[l] : }
\CommentTok{#>   NAs are not allowed in subscripted assignments}
\CommentTok{#> Warning: predictions failed for Fold08.Rep09: lambda=0e+00 Error in mindist[l] <- ndist[l] : }
\CommentTok{#>   NAs are not allowed in subscripted assignments}
\CommentTok{#> Warning: predictions failed for Fold09.Rep09: lambda=0e+00 Error in mindist[l] <- ndist[l] : }
\CommentTok{#>   NAs are not allowed in subscripted assignments}
\CommentTok{#> Warning: predictions failed for Fold10.Rep09: lambda=0e+00 Error in mindist[l] <- ndist[l] : }
\CommentTok{#>   NAs are not allowed in subscripted assignments}
\CommentTok{#> Warning: predictions failed for Fold01.Rep10: lambda=0e+00 Error in mindist[l] <- ndist[l] : }
\CommentTok{#>   NAs are not allowed in subscripted assignments}
\CommentTok{#> Warning: predictions failed for Fold02.Rep10: lambda=0e+00 Error in mindist[l] <- ndist[l] : }
\CommentTok{#>   NAs are not allowed in subscripted assignments}
\CommentTok{#> Warning: predictions failed for Fold03.Rep10: lambda=0e+00 Error in mindist[l] <- ndist[l] : }
\CommentTok{#>   NAs are not allowed in subscripted assignments}
\CommentTok{#> Warning: predictions failed for Fold04.Rep10: lambda=0e+00 Error in mindist[l] <- ndist[l] : }
\CommentTok{#>   NAs are not allowed in subscripted assignments}
\CommentTok{#> Warning: predictions failed for Fold05.Rep10: lambda=0e+00 Error in mindist[l] <- ndist[l] : }
\CommentTok{#>   NAs are not allowed in subscripted assignments}
\CommentTok{#> Warning: predictions failed for Fold06.Rep10: lambda=0e+00 Error in mindist[l] <- ndist[l] : }
\CommentTok{#>   NAs are not allowed in subscripted assignments}
\CommentTok{#> Warning: predictions failed for Fold07.Rep10: lambda=0e+00 Error in mindist[l] <- ndist[l] : }
\CommentTok{#>   NAs are not allowed in subscripted assignments}
\CommentTok{#> Warning: predictions failed for Fold08.Rep10: lambda=0e+00 Error in mindist[l] <- ndist[l] : }
\CommentTok{#>   NAs are not allowed in subscripted assignments}
\CommentTok{#> Warning: predictions failed for Fold09.Rep10: lambda=0e+00 Error in mindist[l] <- ndist[l] : }
\CommentTok{#>   NAs are not allowed in subscripted assignments}
\CommentTok{#> Warning: predictions failed for Fold10.Rep10: lambda=0e+00 Error in mindist[l] <- ndist[l] : }
\CommentTok{#>   NAs are not allowed in subscripted assignments}
\CommentTok{#> Warning in nominalTrainWorkflow(x = x, y = y, wts = weights, info = trainInfo, : There were missing values in resampled performance measures.}
\CommentTok{#> Warning in train.default(x, y, weights = w, ...): missing values found in aggregated results}
\NormalTok{model_slda <-}\StringTok{ }\NormalTok{caret}\OperatorTok{::}\KeywordTok{train}\NormalTok{(outcome }\OperatorTok{~}\StringTok{ }\NormalTok{.,}
                             \DataTypeTok{data =}\NormalTok{ train_data,}
                             \DataTypeTok{method =} \StringTok{"slda"}\NormalTok{,}
                             \DataTypeTok{preProcess =} \OtherTok{NULL}\NormalTok{,}
                             \DataTypeTok{trControl =}\NormalTok{ train_control)}
\NormalTok{model_pam <-}\StringTok{ }\NormalTok{caret}\OperatorTok{::}\KeywordTok{train}\NormalTok{(outcome }\OperatorTok{~}\StringTok{ }\NormalTok{.,}
                             \DataTypeTok{data =}\NormalTok{ train_data,}
                             \DataTypeTok{method =} \StringTok{"pam"}\NormalTok{,}
                             \DataTypeTok{preProcess =} \OtherTok{NULL}\NormalTok{,}
                             \DataTypeTok{trControl =}\NormalTok{ train_control)}
\CommentTok{#> 12345678910111213141516171819202122232425262728293011111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111}
\NormalTok{model_C5}\FloatTok{.0}\NormalTok{Tree <-}\StringTok{ }\NormalTok{caret}\OperatorTok{::}\KeywordTok{train}\NormalTok{(outcome }\OperatorTok{~}\StringTok{ }\NormalTok{.,}
                             \DataTypeTok{data =}\NormalTok{ train_data,}
                             \DataTypeTok{method =} \StringTok{"C5.0Tree"}\NormalTok{,}
                             \DataTypeTok{preProcess =} \OtherTok{NULL}\NormalTok{,}
                             \DataTypeTok{trControl =}\NormalTok{ train_control)}
\NormalTok{model_pls <-}\StringTok{ }\NormalTok{caret}\OperatorTok{::}\KeywordTok{train}\NormalTok{(outcome }\OperatorTok{~}\StringTok{ }\NormalTok{.,}
                             \DataTypeTok{data =}\NormalTok{ train_data,}
                             \DataTypeTok{method =} \StringTok{"pls"}\NormalTok{,}
                             \DataTypeTok{preProcess =} \OtherTok{NULL}\NormalTok{,}
                             \DataTypeTok{trControl =}\NormalTok{ train_control)}

\NormalTok{models <-}\StringTok{ }\KeywordTok{list}\NormalTok{(}\DataTypeTok{rf =}\NormalTok{ model_rf, }
               \DataTypeTok{glmnet   =}\NormalTok{ model_glmnet, }
               \DataTypeTok{kknn     =}\NormalTok{ model_kknn, }
               \DataTypeTok{pda      =}\NormalTok{ model_pda, }
               \DataTypeTok{slda     =}\NormalTok{ model_slda,}
               \DataTypeTok{pam      =}\NormalTok{ model_pam, }
               \DataTypeTok{C5.0Tree =}\NormalTok{ model_C5}\FloatTok{.0}\NormalTok{Tree, }
               \DataTypeTok{pls      =}\NormalTok{ model_pls)}

\CommentTok{# Resample the models}
\NormalTok{resample_results <-}\StringTok{ }\KeywordTok{resamples}\NormalTok{(models)}

\KeywordTok{bwplot}\NormalTok{(resample_results , }\DataTypeTok{metric =} \KeywordTok{c}\NormalTok{(}\StringTok{"Kappa"}\NormalTok{,}\StringTok{"Accuracy"}\NormalTok{))}
\end{Highlighting}
\end{Shaded}

\begin{center}\includegraphics[width=0.7\linewidth]{comparison_330-classification_flu_outcome-multi-sglander_files/figure-latex/model-train-all-run-1} \end{center}

Here again, the accuracy is similar in all models.

\hypertarget{final-results}{%
\subsection{Final results}\label{final-results}}

The final results are calculated as described above.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{results <-}\StringTok{ }\KeywordTok{data.frame}\NormalTok{(}
  \DataTypeTok{randomForest =} \KeywordTok{predict}\NormalTok{(model_rf, }\DataTypeTok{newdata =}\NormalTok{ test_data, }\DataTypeTok{type=}\StringTok{"prob"}\NormalTok{),}
  \DataTypeTok{glmnet =} \KeywordTok{predict}\NormalTok{(model_glmnet, }\DataTypeTok{newdata =}\NormalTok{ test_data, }\DataTypeTok{type=}\StringTok{"prob"}\NormalTok{),}
  \DataTypeTok{kknn =} \KeywordTok{predict}\NormalTok{(model_kknn, }\DataTypeTok{newdata =}\NormalTok{ test_data, }\DataTypeTok{type=}\StringTok{"prob"}\NormalTok{),}
  \DataTypeTok{pda =} \KeywordTok{predict}\NormalTok{(model_pda, }\DataTypeTok{newdata =}\NormalTok{ test_data, }\DataTypeTok{type=}\StringTok{"prob"}\NormalTok{),}
  \DataTypeTok{slda =} \KeywordTok{predict}\NormalTok{(model_slda, }\DataTypeTok{newdata =}\NormalTok{ test_data, }\DataTypeTok{type=}\StringTok{"prob"}\NormalTok{),}
  \DataTypeTok{pam =} \KeywordTok{predict}\NormalTok{(model_pam, }\DataTypeTok{newdata =}\NormalTok{ test_data, }\DataTypeTok{type=}\StringTok{"prob"}\NormalTok{),}
  \DataTypeTok{C5.0Tree =} \KeywordTok{predict}\NormalTok{(model_C5}\FloatTok{.0}\NormalTok{Tree, }\DataTypeTok{newdata =}\NormalTok{ test_data, }\DataTypeTok{type=}\StringTok{"prob"}\NormalTok{),}
  \DataTypeTok{pls =} \KeywordTok{predict}\NormalTok{(model_pls, }\DataTypeTok{newdata =}\NormalTok{ test_data, }\DataTypeTok{type=}\StringTok{"prob"}\NormalTok{))}

\NormalTok{results}\OperatorTok{$}\NormalTok{sum_Death <-}\StringTok{ }\KeywordTok{rowSums}\NormalTok{(results[, }\KeywordTok{grep}\NormalTok{(}\StringTok{"Death"}\NormalTok{, }\KeywordTok{colnames}\NormalTok{(results))])}
\NormalTok{results}\OperatorTok{$}\NormalTok{sum_Recover <-}\StringTok{ }\KeywordTok{rowSums}\NormalTok{(results[, }\KeywordTok{grep}\NormalTok{(}\StringTok{"Recover"}\NormalTok{, }\KeywordTok{colnames}\NormalTok{(results))])}
\NormalTok{results}\OperatorTok{$}\NormalTok{log2_ratio <-}\StringTok{ }\KeywordTok{log2}\NormalTok{(results}\OperatorTok{$}\NormalTok{sum_Recover}\OperatorTok{/}\NormalTok{results}\OperatorTok{$}\NormalTok{sum_Death)}
\NormalTok{results}\OperatorTok{$}\NormalTok{predicted_outcome <-}\StringTok{ }\KeywordTok{ifelse}\NormalTok{(results}\OperatorTok{$}\NormalTok{log2_ratio }\OperatorTok{>}\StringTok{ }\FloatTok{1.5}\NormalTok{, }\StringTok{"Recover"}\NormalTok{, }
                                    \KeywordTok{ifelse}\NormalTok{(results}\OperatorTok{$}\NormalTok{log2_ratio }\OperatorTok{<}\StringTok{ }\FloatTok{-1.5}\NormalTok{, }\StringTok{"Death"}\NormalTok{, }
                                           \StringTok{"uncertain"}\NormalTok{))}
\NormalTok{results[, }\OperatorTok{-}\KeywordTok{c}\NormalTok{(}\DecValTok{1}\OperatorTok{:}\DecValTok{16}\NormalTok{)]}
\CommentTok{#>          sum_Death sum_Recover log2_ratio predicted_outcome}
\CommentTok{#> case_100     1.854        6.15     1.7287           Recover}
\CommentTok{#> case_101     5.432        2.57    -1.0807         uncertain}
\CommentTok{#> case_102     2.806        5.19     0.8887         uncertain}
\CommentTok{#> case_103     2.342        5.66     1.2729         uncertain}
\CommentTok{#> case_104     1.744        6.26     1.8432           Recover}
\CommentTok{#> case_105     0.955        7.04     2.8828           Recover}
\CommentTok{#> case_108     4.489        3.51    -0.3543         uncertain}
\CommentTok{#> case_109     4.515        3.48    -0.3736         uncertain}
\CommentTok{#> case_110     2.411        5.59     1.2132         uncertain}
\CommentTok{#> case_112     2.632        5.37     1.0281         uncertain}
\CommentTok{#> case_113     2.198        5.80     1.4004         uncertain}
\CommentTok{#> case_114     3.339        4.66     0.4810         uncertain}
\CommentTok{#> case_115     1.112        6.89     2.6307           Recover}
\CommentTok{#> case_118     2.778        5.22     0.9109         uncertain}
\CommentTok{#> case_120     2.213        5.79     1.3868         uncertain}
\CommentTok{#> case_122     3.235        4.77     0.5590         uncertain}
\CommentTok{#> case_126     3.186        4.81     0.5952         uncertain}
\CommentTok{#> case_130     2.300        5.70     1.3091         uncertain}
\CommentTok{#> case_132     4.473        3.53    -0.3427         uncertain}
\CommentTok{#> case_136     3.281        4.72     0.5243         uncertain}
\CommentTok{#> case_15      2.270        5.73     1.3355         uncertain}
\CommentTok{#> case_16      2.820        5.18     0.8772         uncertain}
\CommentTok{#> case_22      4.779        3.22    -0.5689         uncertain}
\CommentTok{#> case_28      2.862        5.14     0.8445         uncertain}
\CommentTok{#> case_31      2.412        5.59     1.2117         uncertain}
\CommentTok{#> case_32      2.591        5.41     1.0616         uncertain}
\CommentTok{#> case_38      2.060        5.94     1.5280           Recover}
\CommentTok{#> case_39      4.749        3.25    -0.5466         uncertain}
\CommentTok{#> case_4       5.342        2.66    -1.0074         uncertain}
\CommentTok{#> case_40      6.550        1.45    -2.1750             Death}
\CommentTok{#> case_41      4.611        3.39    -0.4441         uncertain}
\CommentTok{#> case_42      5.570        2.43    -1.1966         uncertain}
\CommentTok{#> case_47      2.563        5.44     1.0850         uncertain}
\CommentTok{#> case_48      4.850        3.15    -0.6224         uncertain}
\CommentTok{#> case_52      4.709        3.29    -0.5173         uncertain}
\CommentTok{#> case_54      2.718        5.28     0.9586         uncertain}
\CommentTok{#> case_56      6.394        1.61    -1.9933             Death}
\CommentTok{#> case_62      6.048        1.95    -1.6319             Death}
\CommentTok{#> case_63      2.337        5.66     1.2766         uncertain}
\CommentTok{#> case_66      2.176        5.82     1.4205         uncertain}
\CommentTok{#> case_67      1.893        6.11     1.6895           Recover}
\CommentTok{#> case_68      3.907        4.09     0.0672         uncertain}
\CommentTok{#> case_69      4.465        3.53    -0.3370         uncertain}
\CommentTok{#> case_70      3.885        4.12     0.0833         uncertain}
\CommentTok{#> case_71      2.524        5.48     1.1172         uncertain}
\CommentTok{#> case_80      2.759        5.24     0.9261         uncertain}
\CommentTok{#> case_84      3.661        4.34     0.2448         uncertain}
\CommentTok{#> case_85      4.921        3.08    -0.6762         uncertain}
\CommentTok{#> case_86      3.563        4.44     0.3164         uncertain}
\CommentTok{#> case_88      0.566        7.43     3.7160           Recover}
\CommentTok{#> case_9       5.981        2.02    -1.5665             Death}
\CommentTok{#> case_90      3.570        4.43     0.3116         uncertain}
\CommentTok{#> case_92      4.664        3.34    -0.4835         uncertain}
\CommentTok{#> case_93      2.056        5.94     1.5319           Recover}
\CommentTok{#> case_95      4.495        3.50    -0.3589         uncertain}
\CommentTok{#> case_96      1.313        6.69     2.3482           Recover}
\CommentTok{#> case_99      4.799        3.20    -0.5839         uncertain}
\KeywordTok{write.table}\NormalTok{(results, }\StringTok{"results_prediction_unknown_outcome_ML_part1.txt"}\NormalTok{, }
            \DataTypeTok{col.names =}\NormalTok{ T, }\DataTypeTok{sep =} \StringTok{"}\CharTok{\textbackslash{}t}\StringTok{"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{results }\OperatorTok{%>%}\StringTok{ }
\StringTok{  }\KeywordTok{filter}\NormalTok{(predicted_outcome }\OperatorTok{==}\StringTok{ "Recover"}\NormalTok{) }\OperatorTok{%>%}\StringTok{ }
\StringTok{  }\KeywordTok{select}\NormalTok{(}\OperatorTok{-}\KeywordTok{c}\NormalTok{(}\DecValTok{1}\OperatorTok{:}\DecValTok{16}\NormalTok{))}
\CommentTok{#>   sum_Death sum_Recover log2_ratio predicted_outcome}
\CommentTok{#> 1     1.854        6.15       1.73           Recover}
\CommentTok{#> 2     1.744        6.26       1.84           Recover}
\CommentTok{#> 3     0.955        7.04       2.88           Recover}
\CommentTok{#> 4     1.112        6.89       2.63           Recover}
\CommentTok{#> 5     2.060        5.94       1.53           Recover}
\CommentTok{#> 6     1.893        6.11       1.69           Recover}
\CommentTok{#> 7     0.566        7.43       3.72           Recover}
\CommentTok{#> 8     2.056        5.94       1.53           Recover}
\CommentTok{#> 9     1.313        6.69       2.35           Recover}
\end{Highlighting}
\end{Shaded}

\hypertarget{predicted-outcome}{%
\subsection{Predicted outcome}\label{predicted-outcome}}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{results }\OperatorTok{%>%}\StringTok{ }
\StringTok{  }\KeywordTok{group_by}\NormalTok{(predicted_outcome) }\OperatorTok{%>%}\StringTok{ }
\StringTok{  }\KeywordTok{summarize}\NormalTok{(}\DataTypeTok{n =} \KeywordTok{n}\NormalTok{())}
\CommentTok{#> # A tibble: 3 x 2}
\CommentTok{#>   predicted_outcome     n}
\CommentTok{#>   <chr>             <int>}
\CommentTok{#> 1 Death                 4}
\CommentTok{#> 2 Recover               9}
\CommentTok{#> 3 uncertain            44}
\end{Highlighting}
\end{Shaded}

From 57 cases, 14 were defined as Recover, 3 as Death and 40 as uncertain.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{results_combined <-}\StringTok{ }\KeywordTok{merge}\NormalTok{(results[, }\OperatorTok{-}\KeywordTok{c}\NormalTok{(}\DecValTok{1}\OperatorTok{:}\DecValTok{16}\NormalTok{)],}
\NormalTok{                          fluH7N9_china_}\DecValTok{2013}\NormalTok{[}\KeywordTok{which}\NormalTok{(fluH7N9_china_}\DecValTok{2013}\OperatorTok{$}\NormalTok{case_ID }
                                                   \OperatorTok{%in%}\StringTok{ }\KeywordTok{rownames}\NormalTok{(results)), ], }
                          \DataTypeTok{by.x =} \StringTok{"row.names"}\NormalTok{, }\DataTypeTok{by.y =} \StringTok{"case_ID"}\NormalTok{)}
\CommentTok{# results_combined <- results_combined[, -c(2, 3, 8, 9)]}
\NormalTok{results_combined <-}\StringTok{ }\NormalTok{results_combined[, }\OperatorTok{-}\KeywordTok{c}\NormalTok{(}\DecValTok{1}\NormalTok{, }\DecValTok{2}\NormalTok{, }\DecValTok{3}\NormalTok{, }\DecValTok{9}\NormalTok{, }\DecValTok{10}\NormalTok{)]}
\NormalTok{results_combined}
\CommentTok{#>    log2_ratio predicted_outcome case_id date_of_onset date_of_hospitalisation gender age  province}
\CommentTok{#> 1      1.7287           Recover     100    2013-04-16                    <NA>      m  58  Zhejiang}
\CommentTok{#> 2     -1.0807         uncertain     101    2013-04-13                    <NA>      f  79  Zhejiang}
\CommentTok{#> 3      0.8887         uncertain     102    2013-04-12                    <NA>      m  81  Zhejiang}
\CommentTok{#> 4      1.2729         uncertain     103    2013-04-13              2013-04-19      m  68   Jiangsu}
\CommentTok{#> 5      1.8432           Recover     104    2013-04-16                    <NA>      f  54  Zhejiang}
\CommentTok{#> 6      2.8828           Recover     105    2013-04-14                    <NA>      m  32  Zhejiang}
\CommentTok{#> 7     -0.3543         uncertain     108    2013-04-15                    <NA>      m  84  Zhejiang}
\CommentTok{#> 8     -0.3736         uncertain     109    2013-04-15                    <NA>      m  62  Zhejiang}
\CommentTok{#> 9      1.2132         uncertain     110    2013-04-12              2013-04-16      m  53    Taiwan}
\CommentTok{#> 10     1.0281         uncertain     112    2013-04-17                    <NA>      m  69   Jiangxi}
\CommentTok{#> 11     1.4004         uncertain     113    2013-04-15                    <NA>      f  60  Zhejiang}
\CommentTok{#> 12     0.4810         uncertain     114    2013-04-18                    <NA>      f  50  Zhejiang}
\CommentTok{#> 13     2.6307           Recover     115    2013-04-17                    <NA>      m  38  Zhejiang}
\CommentTok{#> 14     0.9109         uncertain     118    2013-04-17                    <NA>      m  49   Jiangsu}
\CommentTok{#> 15     1.3868         uncertain     120    2013-03-08                    <NA>      m  60   Jiangsu}
\CommentTok{#> 16     0.5590         uncertain     122    2013-04-18                    <NA>      m  38  Zhejiang}
\CommentTok{#> 17     0.5952         uncertain     126    2013-04-17              2013-04-27      m  80    Fujian}
\CommentTok{#> 18     1.3091         uncertain     130    2013-04-29              2013-04-30      m  69    Fujian}
\CommentTok{#> 19    -0.3427         uncertain     132    2013-05-03              2013-05-03      f  79   Jiangxi}
\CommentTok{#> 20     0.5243         uncertain     136    2013-07-27              2013-07-28      f  51 Guangdong}
\CommentTok{#> 21     1.3355         uncertain      15    2013-03-20                    <NA>      f  61   Jiangsu}
\CommentTok{#> 22     0.8772         uncertain      16    2013-03-21                    <NA>      m  79   Jiangsu}
\CommentTok{#> 23    -0.5689         uncertain      22    2013-03-28              2013-04-01      m  85   Jiangsu}
\CommentTok{#> 24     0.8445         uncertain      28    2013-03-29                    <NA>      m  79  Zhejiang}
\CommentTok{#> 25     1.2117         uncertain      31    2013-03-29                    <NA>      m  70   Jiangsu}
\CommentTok{#> 26     1.0616         uncertain      32    2013-04-02                    <NA>      m  74   Jiangsu}
\CommentTok{#> 27     1.5280           Recover      38    2013-04-03                    <NA>      m  56   Jiangsu}
\CommentTok{#> 28    -0.5466         uncertain      39    2013-04-08              2013-04-08      m  66  Zhejiang}
\CommentTok{#> 29    -1.0074         uncertain       4    2013-03-19              2013-03-27      f  45   Jiangsu}
\CommentTok{#> 30    -2.1750             Death      40    2013-04-06              2013-04-11      m  74  Zhejiang}
\CommentTok{#> 31    -0.4441         uncertain      41    2013-04-06              2013-04-12      f  54  Zhejiang}
\CommentTok{#> 32    -1.1966         uncertain      42    2013-04-03              2013-04-10      m  53  Shanghai}
\CommentTok{#> 33     1.0850         uncertain      47    2013-04-01                    <NA>      m  72   Jiangsu}
\CommentTok{#> 34    -0.6224         uncertain      48    2013-04-03              2013-04-09      m  65  Zhejiang}
\CommentTok{#> 35    -0.5173         uncertain      52    2013-04-06                    <NA>      f  64  Zhejiang}
\CommentTok{#> 36     0.9586         uncertain      54    2013-04-06                    <NA>      m  75  Zhejiang}
\CommentTok{#> 37    -1.9933             Death      56    2013-04-05              2013-04-11      m  73  Shanghai}
\CommentTok{#> 38    -1.6319             Death      62    2013-04-03                    <NA>      f  68  Zhejiang}
\CommentTok{#> 39     1.2766         uncertain      63    2013-04-10                    <NA>      m  60     Anhui}
\CommentTok{#> 40     1.4205         uncertain      66          <NA>                    <NA>      m  72   Jiangsu}
\CommentTok{#> 41     1.6895           Recover      67    2013-04-12                    <NA>      m  56  Zhejiang}
\CommentTok{#> 42     0.0672         uncertain      68    2013-04-10                    <NA>      m  57  Zhejiang}
\CommentTok{#> 43    -0.3370         uncertain      69    2013-04-10                    <NA>      m  62  Zhejiang}
\CommentTok{#> 44     0.0833         uncertain      70    2013-04-11                    <NA>      f  58  Zhejiang}
\CommentTok{#> 45     1.1172         uncertain      71    2013-04-10                    <NA>      f  72  Zhejiang}
\CommentTok{#> 46     0.9261         uncertain      80    2013-04-08                    <NA>      m  74  Zhejiang}
\CommentTok{#> 47     0.2448         uncertain      84          <NA>                    <NA>      f  26   Jiangsu}
\CommentTok{#> 48    -0.6762         uncertain      85    2013-04-09              2013-04-16      f  80  Shanghai}
\CommentTok{#> 49     0.3164         uncertain      86    2013-04-13                    <NA>      f  54  Zhejiang}
\CommentTok{#> 50     3.7160           Recover      88          <NA>                    <NA>      m   4   Beijing}
\CommentTok{#> 51    -1.5665             Death       9    2013-03-25              2013-03-25      m  67  Zhejiang}
\CommentTok{#> 52     0.3116         uncertain      90    2013-04-12              2013-04-15      m  43  Zhejiang}
\CommentTok{#> 53    -0.4835         uncertain      92    2013-04-10              2013-04-17      f  66  Zhejiang}
\CommentTok{#> 54     1.5319           Recover      93    2013-04-11                    <NA>      m  56  Zhejiang}
\CommentTok{#> 55    -0.3589         uncertain      95    2013-03-30                    <NA>      m  37  Zhejiang}
\CommentTok{#> 56     2.3482           Recover      96    2013-04-07                    <NA>      m  43   Jiangsu}
\CommentTok{#> 57    -0.5839         uncertain      99    2013-04-12                    <NA>      f  68  Zhejiang}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# tidy dataframe for plotting}
\NormalTok{results_combined_gather <-}\StringTok{ }\NormalTok{results_combined }\OperatorTok{%>%}
\StringTok{  }\KeywordTok{gather}\NormalTok{(group_dates, date, date_of_onset}\OperatorTok{:}\NormalTok{date_of_hospitalisation)}

\NormalTok{results_combined_gather}\OperatorTok{$}\NormalTok{group_dates <-}\StringTok{ }\KeywordTok{factor}\NormalTok{(results_combined_gather}\OperatorTok{$}\NormalTok{group_dates, }
                          \DataTypeTok{levels =} \KeywordTok{c}\NormalTok{(}\StringTok{"date_of_onset"}\NormalTok{, }\StringTok{"date_of_hospitalisation"}\NormalTok{))}

\NormalTok{results_combined_gather}\OperatorTok{$}\NormalTok{group_dates <-}\StringTok{ }\KeywordTok{mapvalues}\NormalTok{(results_combined_gather}\OperatorTok{$}\NormalTok{group_dates, }
                            \DataTypeTok{from =} \KeywordTok{c}\NormalTok{(}\StringTok{"date_of_onset"}\NormalTok{, }\StringTok{"date_of_hospitalisation"}\NormalTok{), }
                              \DataTypeTok{to =} \KeywordTok{c}\NormalTok{(}\StringTok{"Date of onset"}\NormalTok{, }\StringTok{"Date of hospitalisation"}\NormalTok{))}

\NormalTok{results_combined_gather}\OperatorTok{$}\NormalTok{gender <-}\StringTok{ }\KeywordTok{mapvalues}\NormalTok{(results_combined_gather}\OperatorTok{$}\NormalTok{gender, }
                                            \DataTypeTok{from =} \KeywordTok{c}\NormalTok{(}\StringTok{"f"}\NormalTok{, }\StringTok{"m"}\NormalTok{), }
                                             \DataTypeTok{to =} \KeywordTok{c}\NormalTok{(}\StringTok{"Female"}\NormalTok{, }\StringTok{"Male"}\NormalTok{))}
\KeywordTok{levels}\NormalTok{(results_combined_gather}\OperatorTok{$}\NormalTok{gender) <-}\StringTok{ }\KeywordTok{c}\NormalTok{(}\KeywordTok{levels}\NormalTok{(results_combined_gather}\OperatorTok{$}\NormalTok{gender), }
                                            \StringTok{"unknown"}\NormalTok{)}
\NormalTok{results_combined_gather}\OperatorTok{$}\NormalTok{gender[}\KeywordTok{is.na}\NormalTok{(results_combined_gather}\OperatorTok{$}\NormalTok{gender)] <-}\StringTok{ "unknown"}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{ggplot}\NormalTok{(}\DataTypeTok{data =}\NormalTok{ results_combined_gather, }\KeywordTok{aes}\NormalTok{(}\DataTypeTok{x =}\NormalTok{ date, }\DataTypeTok{y =}\NormalTok{ log2_ratio, }
                                           \DataTypeTok{color =}\NormalTok{ predicted_outcome)) }\OperatorTok{+}
\StringTok{  }\KeywordTok{geom_jitter}\NormalTok{(}\KeywordTok{aes}\NormalTok{(}\DataTypeTok{size =} \KeywordTok{as.numeric}\NormalTok{(age)), }\DataTypeTok{alpha =} \FloatTok{0.3}\NormalTok{) }\OperatorTok{+}
\StringTok{  }\KeywordTok{geom_rug}\NormalTok{() }\OperatorTok{+}
\StringTok{  }\KeywordTok{facet_grid}\NormalTok{(gender }\OperatorTok{~}\StringTok{ }\NormalTok{group_dates) }\OperatorTok{+}
\StringTok{  }\KeywordTok{labs}\NormalTok{(}
    \DataTypeTok{color =} \StringTok{"Predicted outcome"}\NormalTok{,}
    \DataTypeTok{size =} \StringTok{"Age"}\NormalTok{,}
    \DataTypeTok{x =} \StringTok{"Date in 2013"}\NormalTok{,}
    \DataTypeTok{y =} \StringTok{"log2 ratio of prediction Recover vs Death"}\NormalTok{,}
    \DataTypeTok{title =} \StringTok{"2013 Influenza A H7N9 cases in China"}\NormalTok{,}
    \DataTypeTok{subtitle =} \StringTok{"Predicted outcome"}\NormalTok{,}
    \DataTypeTok{caption =} \StringTok{""}
\NormalTok{  ) }\OperatorTok{+}
\StringTok{  }\KeywordTok{my_theme}\NormalTok{() }\OperatorTok{+}
\StringTok{  }\KeywordTok{scale_shape_manual}\NormalTok{(}\DataTypeTok{values =} \KeywordTok{c}\NormalTok{(}\DecValTok{15}\NormalTok{, }\DecValTok{16}\NormalTok{, }\DecValTok{17}\NormalTok{)) }\OperatorTok{+}
\StringTok{  }\KeywordTok{scale_color_brewer}\NormalTok{(}\DataTypeTok{palette=}\StringTok{"Set1"}\NormalTok{) }\OperatorTok{+}
\StringTok{  }\KeywordTok{scale_fill_brewer}\NormalTok{(}\DataTypeTok{palette=}\StringTok{"Set1"}\NormalTok{)}
\CommentTok{#> Warning: Removed 42 rows containing missing values (geom_point).}
\end{Highlighting}
\end{Shaded}

\begin{center}\includegraphics[width=0.7\linewidth]{comparison_330-classification_flu_outcome-multi-sglander_files/figure-latex/unnamed-chunk-32-1} \end{center}

The comparison of date of onset, data of hospitalisation, gender and age with predicted outcome shows that predicted deaths were associated with older age than predicted recoveries. Date of onset does not show an obvious bias in either direction.

\hypertarget{conclusions}{%
\section{Conclusions}\label{conclusions}}

This dataset posed a couple of difficulties to begin with, like unequal distribution of data points across variables and missing data. This makes the modeling inherently prone to flaws. However, real life data isn't perfect either, so I went ahead and tested the modeling success anyway.

By accounting for uncertain classification with low predictions probability, the validation data could be classified accurately. However, for a more accurate model, these few cases don't give enough information to reliably predict the outcome. More cases, more information (i.e.~more features) and fewer missing data would improve the modeling outcome.

Also, this example is only applicable for this specific case of flu. In order to be able to draw more general conclusions about flu outcome, other cases and additional information, for example on medical parameters like preexisting medical conditions, disase parameters, demographic information, etc. would be necessary.

All in all, this dataset served as a nice example of the possibilities (and pitfalls) of machine learning applications and showcases a basic workflow for building prediction models with R.

For a comparison of feature selection methods see here.

If you see any mistakes or have tips and tricks for improvement, please don't hesitate to let me know! Thanks. :-)

\begin{center}\rule{0.5\linewidth}{\linethickness}\end{center}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{sessionInfo}\NormalTok{()}
\CommentTok{#> R version 3.6.0 (2019-04-26)}
\CommentTok{#> Platform: x86_64-pc-linux-gnu (64-bit)}
\CommentTok{#> Running under: Ubuntu 18.04.3 LTS}
\CommentTok{#> }
\CommentTok{#> Matrix products: default}
\CommentTok{#> BLAS/LAPACK: /usr/lib/x86_64-linux-gnu/libopenblasp-r0.2.20.so}
\CommentTok{#> }
\CommentTok{#> locale:}
\CommentTok{#>  [1] LC_CTYPE=en_US.UTF-8       LC_NUMERIC=C               LC_TIME=en_US.UTF-8        LC_COLLATE=en_US.UTF-8     LC_MONETARY=en_US.UTF-8    LC_MESSAGES=en_US.UTF-8    LC_PAPER=en_US.UTF-8       LC_NAME=C                  LC_ADDRESS=C               LC_TELEPHONE=C             LC_MEASUREMENT=en_US.UTF-8 LC_IDENTIFICATION=C       }
\CommentTok{#> }
\CommentTok{#> attached base packages:}
\CommentTok{#> [1] grid      stats     graphics  grDevices utils     datasets  methods   base     }
\CommentTok{#> }
\CommentTok{#> other attached packages:}
\CommentTok{#>  [1] RColorBrewer_1.1-2 rpart.plot_3.0.7   rattle_5.2.0       rpart_4.1-15       caret_6.0-84       mice_3.4.0         lattice_0.20-38    dplyr_0.8.0.1      gridExtra_2.3      ggplot2_3.1.1      plyr_1.8.4         tidyr_0.8.3        outbreaks_1.5.0    logging_0.9-107   }
\CommentTok{#> }
\CommentTok{#> loaded via a namespace (and not attached):}
\CommentTok{#>  [1] nlme_3.1-139        lubridate_1.7.4     rprojroot_1.3-2     C50_0.1.2           tools_3.6.0         backports_1.1.4     utf8_1.1.4          R6_2.4.0            lazyeval_0.2.2      colorspace_1.4-1    jomo_2.6-7          nnet_7.3-12         withr_2.1.2         tidyselect_0.2.5    compiler_3.6.0      mda_0.4-10          cli_1.1.0           glmnet_2.0-16       Cubist_0.2.2        labeling_0.3        bookdown_0.10       scales_1.0.0        mvtnorm_1.0-10      randomForest_4.6-14 stringr_1.4.0       digest_0.6.18       minqa_1.2.4         rmarkdown_1.12      pkgconfig_2.0.2     htmltools_0.3.6     lme4_1.1-21         rlang_0.3.4         rstudioapi_0.10     generics_0.0.2      ModelMetrics_1.2.2  magrittr_1.5        Formula_1.2-3       Matrix_1.2-17       Rcpp_1.0.1          munsell_0.5.0       fansi_0.4.0         partykit_1.2-3      stringi_1.4.3       yaml_2.2.0          inum_1.0-1          MASS_7.3-51.4       pamr_1.56.1         recipes_0.1.5       parallel_3.6.0     }
\CommentTok{#> [50] pls_2.7-1           mitml_0.3-7         crayon_1.3.4        splines_3.6.0       zeallot_0.1.0       knitr_1.22          pillar_1.4.0        igraph_1.2.4.1      boot_1.3-22         reshape2_1.4.3      codetools_0.2-16    stats4_3.6.0        pan_1.6             glue_1.3.1          evaluate_0.13       data.table_1.12.2   vctrs_0.1.0         nloptr_1.2.1        foreach_1.4.4       gtable_0.3.0        purrr_0.3.2         assertthat_0.2.1    xfun_0.6            gower_0.2.0         prodlim_2018.04.18  libcoin_1.0-4       broom_0.5.2         e1071_1.7-1         class_7.3-15        survival_2.44-1.1   timeDate_3043.102   tibble_2.1.1        iterators_1.0.10    kknn_1.3.1          cluster_2.0.9       lava_1.6.5          ipred_0.9-9}
\end{Highlighting}
\end{Shaded}

\bibliography{book.bib,packages.bib}


\end{document}
